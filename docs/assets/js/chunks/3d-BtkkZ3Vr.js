const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/chunks/three-addons-NWlwyKh6.js","assets/js/chunks/three-fabxt0FC.js","assets/js/chunks/gui-Cf7HXqQk.js"])))=>i.map(i=>d[i]);
import{S as e,C as t,P as n,W as o,N as s,a as i,A as a,F as r,R as l,M as c,E as d,T as g,V as u,L as m,G as h,B as p,b as f,c as y,d as b,D as v,e as w,Q as S,f as L,g as E,h as x,i as M,j as k,H as C}from"./three-fabxt0FC.js";import{G as P}from"./three-addons-NWlwyKh6.js";import{init as R,importNavMesh as I,NavMeshQuery as $}from"@recast-navigation/core";import{threeToSoloNavMesh as j}from"@recast-navigation/three";const z=new e;z.background=new t(1710618);const D=new n(75,window.innerWidth/window.innerHeight,.1,1e3);D.position.set(0,5,10);const _=new o({antialias:!1,powerPreference:"high-performance",stencil:!1,depth:!0}),O=document.getElementById("canvas-container");function F(){const e=O.getBoundingClientRect();return{width:e.width,height:e.height}}const W=F();_.setSize(W.width,W.height),_.setPixelRatio(Math.min(window.devicePixelRatio,1.5)),_.shadowMap.enabled=!1,_.toneMapping=s,_.outputColorSpace=i,O.appendChild(_.domElement);const U=_.domElement;let B=()=>{const e=F();D.aspect=e.width/e.height,D.updateProjectionMatrix(),_.setSize(e.width,e.height),_.setPixelRatio(Math.min(window.devicePixelRatio,1.5))};function A(e){window.removeEventListener("resize",B),B=e,window.addEventListener("resize",B)}function T(){const e=new a(16777215,.2);z.add(e),z.fog=new r(1710618,20,60)}window.addEventListener("resize",B);const G={},V=function(e,t,n){let o=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),s=n?.nonce||n?.getAttribute("nonce");o=e(t.map(e=>{if((e=function(e){return"/"+e}(e))in G)return;G[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const o=document.createElement("link");return o.rel=t?"stylesheet":"modulepreload",t||(o.as="script"),o.crossOrigin="",o.href=e,s&&o.setAttribute("nonce",s),document.head.appendChild(o),t?new Promise((t,n)=>{o.addEventListener("load",t),o.addEventListener("error",()=>n(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function s(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return o.then(t=>{for(const e of t||[])"rejected"===e.status&&s(e.reason);return e().catch(s)})},q=1.6,N={x:5,y:10,z:5},Y={emissive:new t(16777215),emissiveIntensity:1,color:new t(16777215),toneMapped:!1,transparent:!1,opacity:1};function H(e,t){if(!t)return;const n=Array.isArray(t.material)?t.material[0]:t.material;n?(n.map&&n.map.dispose(),n.emissiveMap&&n.emissiveMap.dispose(),n.map=e,n.emissiveMap=e,Object.assign(n,Y),n.needsUpdate=!0):t.material=new c({map:e,emissiveMap:e,...Y})}function X(e){e.flipY=!0,e.wrapS=l,e.wrapT=l,e.repeat.x=-1,e.colorSpace=i,e.needsUpdate=!0}function J(e){return Array.isArray(e.material)?e.material[0]:e.material}function Q(e){return`#${Math.floor(255*e.r).toString(16).padStart(2,"0")}${Math.floor(255*e.g).toString(16).padStart(2,"0")}${Math.floor(255*e.b).toString(16).padStart(2,"0")}`}function Z(e){e&&e.children&&(e.children=e.children.filter(Boolean),e.children.forEach(e=>Z(e)))}function K(e,t){if(!e)return;const n=[e];for(;n.length;){const e=n.pop();if(e&&(t(e),e.children&&e.children.length))for(let t=e.children.length-1;t>=0;t--){const o=e.children[t];o&&"function"==typeof o.traverse?n.push(o):e.children.splice(t,1)}}}let ee={cameraHeight:1.6,navmeshSearchBox:{x:5,y:10,z:5},screenMaterialSettings:{emissive:[1,1,1],emissiveIntensity:1,color:[1,1,1],toneMapped:!1,transparent:!1,opacity:1},ledCount:384,ledRadius:.03},te=.02,ne={sensitivity:.002,rotationSpeed:120},oe={x:0,y:5.4,z:-4.3},se={x:-3,y:0,z:3.121154018741333},ie={x:0,y:0,z:0},ae={x:0,y:0,z:0},re={enabled:!0,strength:1.5,radius:.4,threshold:.85},le={pulseSpeed:2,pulseWidth:.3,baseIntensity:0,maxIntensity:4,mirrored:!1,rimVisible:!1,hueStart:.5,hueRange:.3,saturation:1,lightness:.5},ce={backgroundColor:"#000000",textColor:"#ffffff",dotColor:"#ffffff",sidebarColor:"#333333",sidebarVisible:!0,headerIslandVisible:!1,blendMode:"normal",vignette:{enabled:!1,size:8,fadeWidth:2}},de={enabled:!0,scrollTimeout:25,touchThreshold:30,snapThreshold:.5,initialSnapThreshold:1,gridColumns:15,gridRows:10},ge={rows:8},ue={defaultImage:"assets/img/background-text.jpg"},me={enabled:!1,speed:.1,direction:1},he={canvas:{backgroundColor:"#000000",backgroundImage:null},about:{backgroundColor:"#463434",backgroundImage:null},team:{backgroundColor:"#000000",backgroundImage:null}};function pe(e){te=e}function fe(e){void 0!==e.moveSpeed&&(te=e.moveSpeed),e.cameraSettings&&Object.assign(ne,e.cameraSettings),e.startCameraPosition&&Object.assign(oe,e.startCameraPosition),e.startCameraRotation&&Object.assign(se,e.startCameraRotation),e.colorSettings?window.savedColorSettings=e.colorSettings:window.savedColorSettings=null,e.lightSettings?window.savedLightSettings=e.lightSettings:window.savedLightSettings=null,e.bloomSettings&&Object.assign(re,e.bloomSettings),e.ledStripSettings&&Object.assign(le,e.ledStripSettings),e.pageColorSettings&&(e.pageColorSettings.vignette&&(ce.vignette={...ce.vignette,...e.pageColorSettings.vignette}),Object.assign(ce,e.pageColorSettings),ce.vignette||(ce.vignette={enabled:!0,size:8,fadeWidth:2}),we()),e.scrollSettings&&Object.assign(de,e.scrollSettings),e.canvasSettings&&Object.assign(ge,e.canvasSettings),e.screenSettings&&Object.assign(ue,e.screenSettings),e.textureRotationSettings&&Object.assign(me,e.textureRotationSettings),e.pageBackgroundSettings&&(Object.assign(he,e.pageBackgroundSettings),be())}function ye(e,t=.5){if(!e)return null;if(e.startsWith("rgba"))return e;if(e.startsWith("rgb")){const n=e.match(/\d+/g);if(n&&n.length>=3)return`rgba(${n[0]}, ${n[1]}, ${n[2]}, ${t})`}const n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(n){return`rgba(${parseInt(n[1],16)}, ${parseInt(n[2],16)}, ${parseInt(n[3],16)}, ${t})`}return e}function be(){const e=document.querySelector(".canvas-wrapper");e&&(he.canvas.backgroundColor?e.style.setProperty("background-color",he.canvas.backgroundColor,"important"):e.style.removeProperty("background-color"),he.canvas.backgroundImage?(e.style.setProperty("background-image",`url(${he.canvas.backgroundImage})`,"important"),e.style.setProperty("background-size","cover","important"),e.style.setProperty("background-position","center","important"),e.style.setProperty("background-repeat","no-repeat","important")):e.style.setProperty("background-image","none","important"));const t=document.querySelectorAll(".page-section");if(t.length>0&&t.length>1&&he.team)for(let n=1;n<t.length;n++){const e=t[n];if(he.team.backgroundColor&&"#000000"!==he.team.backgroundColor){const t=ye(he.team.backgroundColor,.5);e.style.setProperty("background-color",t,"important")}else e.style.removeProperty("background-color");he.team.backgroundImage?(e.style.setProperty("background-image",`url(${he.team.backgroundImage})`,"important"),e.style.setProperty("background-size","cover","important"),e.style.setProperty("background-position","center","important"),e.style.setProperty("background-repeat","no-repeat","important")):e.style.setProperty("background-image","none","important")}}function ve(){const e=document.getElementById("canvas-container");if(!e)return;const t=ce.vignette||{enabled:!0,size:8,fadeWidth:2};if(!t.enabled)return e.style.maskImage="none",void(e.style.webkitMaskImage="none");const n=`${t.size}%`,o=`${t.size+t.fadeWidth}%`,s=`${t.size+2*t.fadeWidth}%`,i=100-t.size-2*t.fadeWidth+"%",a=100-t.size-t.fadeWidth+"%",r=100-t.size+"%",l=`linear-gradient(to right, transparent 0%, transparent ${n}, rgba(0, 0, 0, 0.5) ${o}, black ${s}, black ${i}, rgba(0, 0, 0, 0.5) ${a}, transparent ${r}, transparent 100%)`,c=`linear-gradient(to bottom, transparent 0%, transparent ${n}, rgba(0, 0, 0, 0.5) ${o}, black ${s}, black ${i}, rgba(0, 0, 0, 0.5) ${a}, transparent ${r}, transparent 100%)`;e.style.maskImage=`${l}, ${c}`,e.style.maskComposite="intersect",e.style.webkitMaskImage=`${l}, ${c}`,e.style.webkitMaskComposite="source-in"}function we(){document.documentElement.style.setProperty("--color-bg",ce.backgroundColor),document.documentElement.style.setProperty("--color-text",ce.textColor),document.documentElement.style.setProperty("--color-dot",ce.dotColor),document.body.style.backgroundColor=ce.backgroundColor;const e=document.querySelector("main");e&&(e.style.color=ce.textColor);const t=document.querySelector("section.intro");t&&(t.style.color=ce.textColor);const n=document.querySelector(".intro-text");n&&(n.style.color=ce.textColor);const o=document.querySelector(".canvas-wrapper");o&&ce.blendMode&&(o.style.mixBlendMode=ce.blendMode),ve()}function Se(){ve()}async function Le(e=!1){const t=await async function(e=!1){try{const t=new URL(import.meta.url),n=new URL("./default-settings.json",t),o=e?`${n}?t=${Date.now()}`:n,s=await fetch(o);if(!s.ok)return console.warn("Could not load default-settings.json, using hardcoded defaults"),!1;const i=await s.json();return i.constants&&(ee={...ee,...i.constants}),i.settings&&fe(i.settings),!0}catch(t){return console.warn("Failed to load default settings from JSON:",t),!1}}(e);if(t||e)t&&(console.log("Loaded settings from default-settings.json"),we());else try{const e=localStorage.getItem("domeDreamingSettings");if(!e)return void we();fe(JSON.parse(e)),console.log("Loaded settings from localStorage (JSON file not available)")}catch(n){console.warn("Failed to load settings from localStorage:",n),we()}be()}async function Ee(){V(()=>Promise.resolve().then(()=>St),void 0).then(e=>{window.savedColorSettings&&e.fbxMeshes&&e.fbxMeshes.forEach(e=>{const t=J(e.mesh);if(t&&window.savedColorSettings[e.name]){const n=window.savedColorSettings[e.name];t.color.setRGB(n.r,n.g,n.b),t.needsUpdate=!0}}),window.savedLightSettings&&e.glbLights&&e.glbLights.forEach((e,t)=>{const n=e.name||`light_${t}`;if(window.savedLightSettings[n]){const t=window.savedLightSettings[n];e.color.setRGB(t.r,t.g,t.b);const o=Math.max(0,Math.min(t.intensity??e.intensity,10));e.intensity=o}})}),V(()=>import("./three-addons-NWlwyKh6.js").then(e=>e.p),__vite__mapDeps([0,1])).then(e=>{const t=e.getBloomPass();t&&(t.enabled=!1!==re.enabled,re.enabled?(t.strength=re.strength,t.radius=re.radius,t.threshold=re.threshold):t.strength=0)}),V(()=>Promise.resolve().then(()=>ht),void 0).then(e=>{e.loadLEDStripSettings(),void 0!==le.rimVisible&&e.setRimVisible(le.rimVisible)})}async function xe(){await Le(!0),await Ee(),V(()=>import("./gui-Cf7HXqQk.js"),__vite__mapDeps([2,1,0])).then(e=>{"function"==typeof e.createColorGUI&&e.createColorGUI()}),console.log("Settings reloaded from JSON file")}function Me(e,t){try{const n={};e&&Array.isArray(e)&&e.forEach((e,t)=>{const o=J(e.mesh);if(o?.color){const s=e.name||`mesh_${t}`;n[s]={r:o.color.r,g:o.color.g,b:o.color.b}}});const o={};t&&Array.isArray(t)&&t.forEach((e,t)=>{const n=e.name||`light_${t}`;o[n]={r:e.color.r,g:e.color.g,b:e.color.b,intensity:e.intensity}});const s={moveSpeed:te,cameraSettings:ne,startCameraPosition:oe,startCameraRotation:se,colorSettings:n,lightSettings:o,bloomSettings:re,ledStripSettings:le,pageColorSettings:ce,scrollSettings:de,canvasSettings:ge,screenSettings:ue,textureRotationSettings:me,pageBackgroundSettings:he};localStorage.setItem("domeDreamingSettings",JSON.stringify(s))}catch(n){console.warn("Failed to save settings:",n)}}function ke(e,t){try{const n={};e.forEach((e,t)=>{const o=J(e.mesh);if(o?.color){const s=e.name||`mesh_${t}`;n[s]={r:o.color.r,g:o.color.g,b:o.color.b}}});const o={};t.forEach((e,t)=>{const n=e.name||`light_${t}`;o[n]={r:e.color.r,g:e.color.g,b:e.color.b,intensity:e.intensity}});const s={version:"1.0.0",constants:ee,settings:{moveSpeed:te,pageColorSettings:ce,scrollSettings:de,canvasSettings:ge,cameraSettings:ne,startCameraPosition:oe,startCameraRotation:se,bloomSettings:re,ledStripSettings:le,colorSettings:n,lightSettings:o,screenSettings:ue,textureRotationSettings:me,pageBackgroundSettings:he}},i=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),a=URL.createObjectURL(i),r=document.createElement("a");r.href=a,r.download="dome-dreaming-settings.json",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a),console.log("Settings file exported successfully")}catch(n){console.error("Failed to export settings file:",n)}}let Ce=!1,Pe=!1,Re=new d(0,0,0,"YXZ"),Ie=!1,$e=0,je=0,ze={};function De(){function e(){const e=Ce;Ce=document.pointerLockElement===U||document.mozPointerLockElement===U||document.webkitPointerLockElement===U,!e&&Ce&&Ie&&Re.setFromQuaternion(D.quaternion)}document.addEventListener("pointerlockchange",e),document.addEventListener("mozpointerlockchange",e),document.addEventListener("webkitpointerlockchange",e),U.addEventListener("click",()=>{!Ce&&window.enterDomeModeFromCanvas&&window.enterDomeModeFromCanvas()}),U.addEventListener("mousemove",function(e){if(!Ce||!Ie)return;const t=e.movementX||e.mozMovementX||e.webkitMovementX||0,n=e.movementY||e.mozMovementY||e.webkitMovementY||0;Re.y-=t*ne.sensitivity,Re.x-=n*ne.sensitivity,Re.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,Re.x)),D.quaternion.setFromEuler(Re)}),U.addEventListener("touchstart",e=>{if(!document.body.classList.contains("dome-mode")||!Ie)return;e.preventDefault();const t=e.touches[0];$e=t.clientX,je=t.clientY,Pe=!0,Re.setFromQuaternion(D.quaternion)},{passive:!1}),U.addEventListener("touchmove",e=>{if(!document.body.classList.contains("dome-mode")||!Pe||!Ie)return;e.preventDefault();const t=e.touches[0],n=t.clientX-$e,o=t.clientY-je;Re.y-=n*ne.sensitivity,Re.x-=o*ne.sensitivity,Re.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,Re.x)),D.quaternion.setFromEuler(Re),$e=t.clientX,je=t.clientY},{passive:!1}),U.addEventListener("touchend",e=>{document.body.classList.contains("dome-mode")&&(e.preventDefault(),Pe=!1)},{passive:!1}),U.addEventListener("touchcancel",e=>{document.body.classList.contains("dome-mode")&&(e.preventDefault(),Pe=!1)},{passive:!1}),window.addEventListener("keydown",e=>{ze[e.key.toLowerCase()]=!0,"c"!==e.key&&"C"!==e.key||(console.log("Camera Position:",D.position),console.log("Camera Rotation:",D.rotation))}),window.addEventListener("keyup",e=>{ze[e.key.toLowerCase()]=!1,"q"===e.key||"Q"===e.key||"e"===e.key||e.key})}let _e=null,Oe=null,Fe=null,We=null,Ue=null;function Be(e){_e=e}function Ae(){return Oe}function Te(){return We}function Ge(e=ue.defaultImage||"assets/media/background.jpg"){if(!_e)return;(new g).load(e,e=>{X(e),e.rotation=0,H(e,_e),We=e},void 0,()=>{})}function Ve(){_e&&(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(e=>{Oe&&(Oe.dispose(),Oe=null),Fe&&(Fe.pause(),Fe.srcObject=null,Fe=null),We&&(We.dispose(),We=null),Ue&&(Ue.getTracks().forEach(e=>e.stop()),Ue=null);const t=document.createElement("video");t.srcObject=e,t.autoplay=!0,t.playsInline=!0,t.muted=!0,t.addEventListener("loadedmetadata",()=>{t.play();const n=new u(t);X(n),n.minFilter=m,n.magFilter=m,n.rotation=0,H(n,_e),Oe=n,Fe=t,Ue=e;const o=J(_e);o&&setTimeout(()=>{Object.assign(o,Y),o.needsUpdate=!0},200)}),t.addEventListener("error",()=>{alert("Error accessing webcam.")})}).catch(e=>{console.error("Error accessing webcam:",e),alert("Could not access webcam. Please check permissions.")}):alert("Webcam access is not available in your browser."))}function qe(){const e=document.getElementById("drop-zone");function n(e){e.preventDefault(),e.stopPropagation()}function o(e){if(!_e)return;const n=J(_e);n&&(e?(n.emissive=new t(38655),n.emissiveIntensity=.8):(Object.assign(n,Y),n.needsUpdate=!0))}document.addEventListener("dragenter",t=>{n(t),e.classList.add("drag-over"),o(!0)},!1),document.addEventListener("dragover",t=>{n(t),e.classList.add("drag-over"),o(!0)},!1),document.addEventListener("dragleave",t=>{n(t),0===t.clientX&&0===t.clientY&&(e.classList.remove("drag-over"),o(!1))},!1),document.addEventListener("drop",t=>{n(t),e.classList.remove("drag-over"),o(!1);const s=t.dataTransfer.files;if(s.length>0){const e=s[0];e.type.startsWith("image/")?function(e){if(!_e)return;const t=new FileReader;t.onload=e=>{(new g).load(e.target.result,e=>{Oe&&(Oe.dispose(),Oe=null),Fe&&(Fe.pause(),Fe.src="",URL.revokeObjectURL(Fe.src),Fe=null),We&&We.dispose(),X(e),e.rotation=0,H(e,_e),We=e;const t=J(_e);t&&setTimeout(()=>{Object.assign(t,Y),t.needsUpdate=!0},200)},void 0,()=>{})},t.readAsDataURL(e)}(e):e.type.startsWith("video/")&&function(e){if(!_e)return;const t=document.createElement("video");t.src=URL.createObjectURL(e),t.crossOrigin="anonymous",t.loop=!0,t.muted=!0,t.playsInline=!0,t.addEventListener("loadedmetadata",()=>{t.play(),Oe&&Oe.dispose(),Fe&&(Fe.pause(),Fe.src="",URL.revokeObjectURL(Fe.src)),We&&(We.dispose(),We=null);const e=new u(t);X(e),e.minFilter=m,e.magFilter=m,e.rotation=0,H(e,_e),Oe=e,Fe=t;const n=J(_e);n&&setTimeout(()=>{Object.assign(n,Y),n.needsUpdate=!0},200)}),t.addEventListener("error",()=>{})}(e)}},!1)}let Ne=!1,Ye=null,He=[],Xe=null;async function Je(){if(!Ne)try{await R(),Ne=!0,async function(){if(!Ne)return void(await Je());try{const e=await fetch("assets/models/navmesh.bin");if(e.ok){const t=await e.arrayBuffer(),n=new Uint8Array(t),{navMesh:o}=I(n);return Xe=new $(o),Et(Xe),console.log("Navmesh loaded from navmesh.bin"),void(Ie&&Qe())}}catch(e){console.log("navmesh.bin not found, will generate from GLTF")}(new P).load("assets/models/navmesh.gltf",async e=>{if(Ye=e.scene,Ye.scale.setScalar(1),Ye.visible=!1,K(Ye,e=>{e.isMesh&&(He.push(e),e.updateMatrixWorld())}),z.add(Ye),He.length>0&&Ne){const{success:e,navMesh:t}=j(He,{cs:.05,ch:.05,walkableRadius:.2});e&&(Xe=new $(t),Et(Xe),console.log("Navmesh generated from GLTF"))}},void 0,e=>{console.warn("Navmesh GLTF not found:",e)})}()}catch(e){console.error("Failed to initialize recast-navigation:",e),Ne=!0}}function Qe(){if(!Xe||!Ie)return;const e={x:D.position.x,y:D.position.y-q,z:D.position.z},t=Xe.findClosestPoint(e,{halfExtents:N});t.success&&(D.position.y=t.point.y+q)}let Ze=null,Ke=[],et=null;const tt=384;let nt=0,ot=2,st=.3,it=0,at=4,rt=!1,lt={hueStart:.5,hueRange:.3,saturation:1,lightness:.5};function ct(){V(()=>Promise.resolve().then(()=>St),void 0).then(e=>{Me(e.fbxMeshes,e.glbLights)})}function dt(e){if(!e)return console.warn("findLEDRim: model is null"),null;let t=null;const n=[];return e.traverse(e=>{n.push(e.name||"unnamed"),("LED_Rim"===e.name||e.name.includes("LED_Rim")||e.name.toLowerCase().includes("led"))&&(t=e,console.log(`Found LED rim object: "${e.name}", type: ${e.type||e.constructor.name}`))}),t||console.warn("LED_Rim object not found. Available object names:",n.filter(e=>e).slice(0,20)),t}function gt(e){if(!e)return void console.warn("LED_Rim object not found");Ze=e,et=new h,et.name="LED_Strip";let t=null;e.traverse(e=>{e.isMesh&&e.geometry&&(t=e.geometry)});const n=new p;n.setFromObject(e);const o=n.getSize(new f);n.getCenter(new f);let s=Math.max(o.x,o.z)/2;const i=o.y/2;let a=.75*s;s<.1&&(console.warn(`LED Rim radius too small (${s.toFixed(2)}), using default 5.0`),s=5,a=3.5),console.log(`LED Rim dimensions: outerRadius=${s.toFixed(2)}, innerRadius=${a.toFixed(2)}, height=${i.toFixed(2)}, size:`,o),console.log("Rim object position:",e.position),console.log("Rim object rotation:",e.rotation),console.log("Rim object scale:",e.scale),console.log("Rim object matrix:",e.matrix);let r=[];if(t&&t.attributes&&t.attributes.position){const e=t.attributes.position,n=e.count;console.log(`Found rim geometry with ${n} vertices`);const o=[];for(let t=0;t<n;t++){const n=e.getX(t),s=e.getY(t),i=e.getZ(t);o.push(new f(n,s,i))}const s=Math.min(...o.map(e=>e.y)),i=Math.max(...o.map(e=>e.y)),l=i-s,c=s+.1*l;console.log(`Rim Y range: ${s.toFixed(2)} to ${i.toFixed(2)}, using bottom Y: ${c.toFixed(2)}`);const d=o.filter(e=>Math.abs(e.y-c)<.15*l).map(e=>({vertex:e,distance:Math.sqrt(e.x*e.x+e.z*e.z),angle:Math.atan2(e.z,e.x)})).sort((e,t)=>e.angle-t.angle);if(d.length>10){console.log(`Found ${d.length} bottom edge vertices`);const e=d.reduce((e,t)=>e+t.vertex.x,0)/d.length,t=d.reduce((e,t)=>e+t.vertex.z,0)/d.length;new f(e,c,t),d.reduce((n,o)=>{const s=o.vertex.x-e,i=o.vertex.z-t;return n+Math.sqrt(s*s+i*i)},0),d.length;for(let n=0;n<tt;n++){const o=n/tt*Math.PI*2;let s=d[0],i=1/0;for(const n of d){const a=Math.atan2(n.vertex.z-t,n.vertex.x-e);let r=Math.abs(a-o);r>Math.PI&&(r=2*Math.PI-r),r<i&&(i=r,s=n)}const l=new f(e+Math.cos(o)*a,s.vertex.y,t+Math.sin(o)*a);r.push(l)}console.log(`Created ${r.length} evenly distributed LED positions using angular distribution`)}else{console.log(`Not enough bottom vertices (${d.length}), using perfectly evenly distributed circle positions`);for(let e=0;e<tt;e++){const t=e/tt*Math.PI*2,n=new f(Math.cos(t)*a,c,Math.sin(t)*a);r.push(n)}}}else{console.log("No rim geometry found, using perfectly evenly distributed circle positions");for(let e=0;e<tt;e++){const t=e/tt*Math.PI*2,n=new f(Math.cos(t)*a,-i,Math.sin(t)*a);r.push(n)}}if(r.length!==tt){console.log(`Adjusting positions from ${r.length} to 384 for even distribution`);const e=[];for(let t=0;t<tt;t++){const n=t/tt,o=Math.floor(n*r.length),s=(o+1)%r.length,i=n*r.length-o,a=(new f).lerpVectors(r[o],r[s],i);e.push(a)}r=e}const l=new y(.024,.024,.009,8,1),d=new c({color:16777215,emissive:65535,emissiveIntensity:0,metalness:0,roughness:.8}),g=new h;g.name="LED_Diffuser";const u=new b(a+.006,.0045,16,64),m=new c({color:16777215,transparent:!0,opacity:.3,roughness:1,metalness:0,side:v}),L=new w(u,m);if(L.position.y=-i,L.rotation.x=Math.PI/2,g.add(L),r.length!==tt){for(console.warn(`Position count mismatch: ${r.length} positions, need 384. Creating missing positions.`);r.length<tt;){const e=r.length/tt*Math.PI*2,t=new f(Math.cos(e)*a,-i,Math.sin(e)*a);r.push(t)}r=r.slice(0,tt)}for(let c=0;c<tt&&c<r.length;c++){const e=new w(l,d.clone());e.position.copy(r[c]);const t=new f(0,r[c].y,0);e.lookAt(t),e.rotateX(Math.PI/2),e.name=`LED_${c}`,Ke.push({mesh:e,index:c,material:e.material}),et.add(e)}if(e.add(et),e.add(g),et.visible=!0,et.matrixAutoUpdate=!0,console.log(`Created LED strip with ${Ke.length} pixels (target: 384) at inner radius ${a.toFixed(2)}`),console.log(`Positions array length: ${r.length}`),Ke.length!==tt?console.error(`LED count mismatch! Expected 384, got ${Ke.length}`):console.log("âœ“ Successfully created all 384 LEDs"),console.log("LED strip group position (local):",et.position),console.log("LED strip group visible:",et.visible),console.log("Rim object visible:",e.visible),Ke.length>0){const t=Ke[0].mesh,n=new f;t.getWorldPosition(n);const o=new f;e.getWorldPosition(o);const s=new S;if(e.getWorldQuaternion(s),console.log("First LED local position:",t.position),console.log("First LED world position:",n),console.log("Rim object world position:",o),console.log("Rim object world rotation:",e.getWorldQuaternion(s)),console.log("Rim object world scale:",e.getWorldScale(new f)),Ke.length>10){const e=Ke[Math.floor(Ke.length/4)].mesh,t=new f;e.getWorldPosition(t),console.log("Quarter LED world position:",t)}}}function ut(e){0!==Ke.length&&(nt+=e*ot,Ke.forEach((e,n)=>{const o=n/tt;let s;if(rt){const e=o-.5,t=Math.abs(e),n=(.5-t+nt)%1,i=(.5-t-nt+1)%1;s=Math.min(n,i)}else s=(o+nt)%1;const i=2*Math.abs(s-.5);let a=0;i<st?(a=1-i/st,a=Math.pow(a,2),a=it+(at-it)*a):a=it,e.material.emissiveIntensity=Math.max(a,0);const r=.1*nt,l=(lt.hueStart+(o+.5*nt)*lt.hueRange+r)%1,c=(new t).setHSL(l,lt.saturation,lt.lightness);e.material.emissive=c,e.mesh.visible=!0}))}function mt(e){Ze&&(Ze.visible=e,Ze.traverse(t=>{t.isMesh&&(t.visible=e)}))}const ht=Object.freeze(Object.defineProperty({__proto__:null,get baseIntensity(){return it},colorPalette:lt,createLEDStrip:gt,findLEDRim:dt,getLEDStrip:function(){return et},getRimObject:function(){return Ze},isRimVisible:function(){return!Ze||Ze.visible},loadLEDStripSettings:function(){ot=le.pulseSpeed,st=le.pulseWidth,it=le.baseIntensity,at=le.maxIntensity,rt=le.mirrored||!1,lt.hueStart=le.hueStart,lt.hueRange=le.hueRange,lt.saturation=le.saturation,lt.lightness=le.lightness,mt(void 0!==le.rimVisible&&le.rimVisible)},get maxIntensity(){return at},get mirrored(){return rt},get pulseSpeed(){return ot},get pulseWidth(){return st},setBaseIntensity:function(e){it=e,le.baseIntensity=e,ct()},setColorPalette:function(e,t,n,o){lt.hueStart=e,lt.hueRange=t,lt.saturation=n,lt.lightness=o,le.hueStart=e,le.hueRange=t,le.saturation=n,le.lightness=o,ct()},setLEDColor:function(e){Ke.forEach(t=>{t.material.emissive.set(e)})},setLEDIntensity:function(e){Ke.forEach(t=>{t.material.emissiveIntensity=e})},setMaxIntensity:function(e){at=e,le.maxIntensity=e,ct()},setMirrored:function(e){rt=e,le.mirrored=e,ct()},setPulseSpeed:function(e){ot=e,le.pulseSpeed=e,ct()},setPulseWidth:function(e){st=e,le.pulseWidth=e,ct()},setRimVisible:mt,updateLEDAnimation:ut},Symbol.toStringTag,{value:"Module"}));let pt=null,ft=[],yt=[],bt=null,vt=[];function wt(e){const n=new P,o=document.getElementById("loading");n.load("assets/models/wisdome-rim.glb",n=>{if(console.log("Wisdome GLB loaded successfully"),!n||!n.scene)return console.error("GLB loaded but scene is missing"),void(o.innerHTML='<div style="color: #ff4444;">Error: Model scene is missing.</div>');const s=n.scene;pt=s,s.scale.setScalar(1),s.position.set(0,0,0),Z(s),bt=new h,bt.name="GLBLights",K(s,e=>{e.isLight&&(yt.push(e),bt.add(e),console.log("Found GLB light:",e.name||"Unnamed",e.type,"intensity:",e.intensity))}),0===yt.length&&(console.log("No lights found with isLight, checking object for light instances..."),K(s,e=>{(e instanceof L||e instanceof E||e instanceof x||e instanceof M||e instanceof k||e instanceof C)&&(yt.includes(e)||(yt.push(e),bt.add(e),console.log("Found additional light:",e.name||"Unnamed",e.constructor.name)))})),yt.length>0?(z.add(bt),console.log(`Grouped ${yt.length} lights from GLB`),window.savedLightSettings&&yt.forEach((e,t)=>{const n=e.name||`light_${t}`,o=window.savedLightSettings[n];if(o){e.color.setRGB(o.r,o.g,o.b);const t=Math.max(0,Math.min(o.intensity??e.intensity,10));e.intensity=t}})):console.log("No lights found in GLB file. Lights GUI will not be available."),K(s,e=>{"Hotspots"===e.name&&K(e,e=>{if("Hotspot.001"===e.name||e.name.includes("Hotspot")){const t=new f;e.getWorldPosition(t),vt.push({object:e,position:t,name:e.name,triggered:!1}),console.log(`Found hotspot: ${e.name} at position:`,t)}})});const a=dt(s);a?(console.log("Found LED_Rim object, creating LED strip..."),V(()=>Promise.resolve().then(()=>ht),void 0).then(e=>{e.loadLEDStripSettings()}),gt(a)):console.log("LED_Rim object not found in model"),K(s,e=>{if(e.isMesh){const n=e.name.toLowerCase();if(n.includes("led_rim")||n.includes("led_strip")||n.startsWith("led_"))return;if(n.includes("screen")||n.includes("display")||n.includes("monitor")||n.includes("panel")||n.includes("projection")||n.includes("canvas"))Be(e),e.visible=!0;else{let n=J(e);const o=n?.color?n.color.clone():new t(16777215);if(n){if(void 0!==n.metalness&&(n.metalness=Math.max(n.metalness||0,.1)),void 0!==n.roughness&&(n.roughness=Math.min(n.roughness||.5,.8)),n.map&&(n.map.colorSpace=i),n.isMeshBasicMaterial){const t=new c({color:n.color,map:n.map,transparent:n.transparent,opacity:n.opacity,metalness:.1,roughness:.5});e.material=t,n=t}n.needsUpdate=!0}ft.push({mesh:e,name:e.name||"Unnamed",originalColor:o})}}});let r=!1;K(s,e=>{e.isMesh&&e.name&&(e.name.toLowerCase().includes("screen")||e.name.toLowerCase().includes("display")||e.name.toLowerCase().includes("monitor")||e.name.toLowerCase().includes("panel")||e.name.toLowerCase().includes("projection")||e.name.toLowerCase().includes("canvas"))&&(r=!0)}),!r&&s&&s.children.length>0&&K(s,e=>{e.isMesh&&!r&&(Be(e),e.visible=!0,ft=ft.filter(t=>t.mesh!==e),r=!0)}),z.add(s),setTimeout(()=>{o.classList.add("hidden");const e=document.getElementById("canvas-container"),t=document.getElementById("info-panel");e&&e.classList.add("loaded"),t&&t.classList.add("loaded")},300),D.position.set(oe.x,oe.y,oe.z),D.rotation.set(se.x,se.y,se.z),Re.set(se.x,se.y,se.z),Ie=!0;Xe&&Qe(),Je().catch(console.error),e(),Ge(),qe()},void 0,e=>{console.error("Error loading 3D model:",e),o.innerHTML='<div style="color: #ff4444;">Error loading 3D model.</div>'})}const St=Object.freeze(Object.defineProperty({__proto__:null,get fbxMeshes(){return ft},glbLights:yt,get glbLightsGroup(){return bt},hotspots:vt,loadModel:wt,get wisdomeModel(){return pt}},Symbol.toStringTag,{value:"Module"}));let Lt=null;function Et(e){Lt=e}function xt(){D.updateMatrixWorld();const e=new f;e.setFromMatrixColumn(D.matrixWorld,2),e.multiplyScalar(-1).normalize();const t=new f;t.setFromMatrixColumn(D.matrixWorld,0),t.normalize();const n=new f,o=te;if(ze.w&&n.add(e.clone().multiplyScalar(o)),ze.s&&n.add(e.clone().multiplyScalar(-o)),ze.a&&n.add(t.clone().multiplyScalar(-o)),ze.d&&n.add(t.clone().multiplyScalar(o)),0!==n.length())if(Lt){const e=D.position.clone();e.x+=n.x,e.z+=n.z;const t={x:e.x,y:e.y-q,z:e.z},o=Lt.findClosestPoint(t,{halfExtents:N});if(o.success)D.position.set(o.point.x,o.point.y+q,o.point.z);else{const t=Lt.findClosestPoint({x:e.x,y:D.position.y-q,z:D.position.z},{halfExtents:N});if(t.success)D.position.set(t.point.x,t.point.y+q,D.position.z);else{const t=Lt.findClosestPoint({x:D.position.x,y:D.position.y-q,z:e.z},{halfExtents:N});t.success&&D.position.set(D.position.x,t.point.y+q,t.point.z)}}}else D.position.add(n)}export{_ as A,z as B,A as C,Le as D,T as E,De as F,wt as G,U as H,xt as I,ut as J,Ve as K,Te as L,Ae as M,ht as N,V as _,de as a,ue as b,Se as c,he as d,be as e,ft as f,yt as g,J as h,Q as i,pe as j,ne as k,Ge as l,te as m,oe as n,se as o,ce as p,ie as q,ae as r,Me as s,me as t,re as u,le as v,xe as w,ke as x,D as y,Ee as z};
