import{S as e,C as t,P as n,W as o,N as s,a as i,A as a,F as r,R as l,M as c,E as d,T as u,V as m,L as g,G as p,B as h,b as f,c as y,d as v,D as b,e as w,Q as L,f as S,g as x,h as E,i as M,j as k,H as C}from"./three-fabxt0FC.js";import{G as P}from"./three-addons-bh36ixWv.js";import{init as R,importNavMesh as $,NavMeshQuery as j}from"@recast-navigation/core";import{threeToSoloNavMesh as I}from"@recast-navigation/three";const z=new e;z.background=new t(1710618);const D=new n(75,window.innerWidth/window.innerHeight,.1,1e3);D.position.set(0,5,10);const F=new o({antialias:!1,powerPreference:"high-performance",stencil:!1,depth:!0}),O=document.getElementById("canvas-container");function W(){const e=O.getBoundingClientRect();return{width:e.width,height:e.height}}const _=W();F.setSize(_.width,_.height),F.setPixelRatio(Math.min(window.devicePixelRatio,1.5)),F.shadowMap.enabled=!1,F.toneMapping=s,F.outputColorSpace=i,O.appendChild(F.domElement);const U=F.domElement;let B=()=>{const e=W();D.aspect=e.width/e.height,D.updateProjectionMatrix(),F.setSize(e.width,e.height),F.setPixelRatio(Math.min(window.devicePixelRatio,1.5))};function T(e){window.removeEventListener("resize",B),B=e,window.addEventListener("resize",B)}function A(){const e=new a(16777215,.2);z.add(e),z.fog=new r(1710618,20,60)}window.addEventListener("resize",B);const q={},G=function(e,t,n){let o=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};const s=document.getElementsByTagName("link"),i=document.querySelector("meta[property=csp-nonce]"),a=i?.nonce||i?.getAttribute("nonce");o=e(t.map(e=>{if(e=function(e,t){return new URL(e,t).href}(e,n),e in q)return;q[e]=!0;const t=e.endsWith(".css"),o=t?'[rel="stylesheet"]':"";if(n)for(let n=s.length-1;n>=0;n--){const o=s[n];if(o.href===e&&(!t||"stylesheet"===o.rel))return}else if(document.querySelector(`link[href="${e}"]${o}`))return;const i=document.createElement("link");return i.rel=t?"stylesheet":"modulepreload",t||(i.as="script"),i.crossOrigin="",i.href=e,a&&i.setAttribute("nonce",a),document.head.appendChild(i),t?new Promise((t,n)=>{i.addEventListener("load",t),i.addEventListener("error",()=>n(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function s(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return o.then(t=>{for(const e of t||[])"rejected"===e.status&&s(e.reason);return e().catch(s)})},N=1.6,Y={x:5,y:10,z:5},V={emissive:new t(16777215),emissiveIntensity:1,color:new t(16777215),toneMapped:!1,transparent:!1,opacity:1};function X(e,t){if(!t)return;const n=Array.isArray(t.material)?t.material[0]:t.material;n?(n.map&&n.map.dispose(),n.emissiveMap&&n.emissiveMap.dispose(),n.map=e,n.emissiveMap=e,Object.assign(n,V),n.needsUpdate=!0):t.material=new c({map:e,emissiveMap:e,...V})}function H(e){e.flipY=!0,e.wrapS=l,e.wrapT=l,e.repeat.x=-1,e.colorSpace=i,e.needsUpdate=!0}function Q(e){return Array.isArray(e.material)?e.material[0]:e.material}function J(e){e&&e.children&&(e.children=e.children.filter(Boolean),e.children.forEach(e=>J(e)))}function Z(e,t){if(!e)return;const n=[e];for(;n.length;){const e=n.pop();if(e&&(t(e),e.children&&e.children.length))for(let t=e.children.length-1;t>=0;t--){const o=e.children[t];o&&"function"==typeof o.traverse?n.push(o):e.children.splice(t,1)}}}let K={cameraHeight:1.6,navmeshSearchBox:{x:5,y:10,z:5},screenMaterialSettings:{emissive:[1,1,1],emissiveIntensity:1,color:[1,1,1],toneMapped:!1,transparent:!1,opacity:1},ledCount:384,ledRadius:.03},ee=.02,te={sensitivity:.002,rotationSpeed:120},ne={x:0,y:5.4,z:-4.3},oe={x:-3,y:0,z:3.121154018741333},se={x:0,y:0,z:0},ie={x:0,y:0,z:0},ae={enabled:!0,strength:1.5,radius:.4,threshold:.85},re={pulseSpeed:2,pulseWidth:.3,baseIntensity:0,maxIntensity:4,mirrored:!1,rimVisible:!1,hueStart:.5,hueRange:.3,saturation:1,lightness:.5},le={backgroundColor:"#000000",textColor:"#ffffff",dotColor:"#ffffff",sidebarColor:"#333333",sidebarVisible:!0,headerIslandVisible:!1,blendMode:"normal",vignette:{enabled:!1,size:8,fadeWidth:2}},ce={enabled:!0,scrollTimeout:25,touchThreshold:30,snapThreshold:.5,initialSnapThreshold:1,gridColumns:15,gridRows:10},de={rows:8},ue={defaultImage:"assets/img/background-text.jpg"},me={enabled:!1,speed:.1,direction:1},ge={canvas:{backgroundColor:"#000000",backgroundImage:null},about:{backgroundColor:"#463434",backgroundImage:null},team:{backgroundColor:"#000000",backgroundImage:null}};function pe(e){void 0!==e.moveSpeed&&(ee=e.moveSpeed),e.cameraSettings&&Object.assign(te,e.cameraSettings),e.startCameraPosition&&Object.assign(ne,e.startCameraPosition),e.startCameraRotation&&Object.assign(oe,e.startCameraRotation),e.colorSettings?window.savedColorSettings=e.colorSettings:window.savedColorSettings=null,e.lightSettings?window.savedLightSettings=e.lightSettings:window.savedLightSettings=null,e.bloomSettings&&Object.assign(ae,e.bloomSettings),e.ledStripSettings&&Object.assign(re,e.ledStripSettings),e.pageColorSettings&&(e.pageColorSettings.vignette&&(le.vignette={...le.vignette,...e.pageColorSettings.vignette}),Object.assign(le,e.pageColorSettings),le.vignette||(le.vignette={enabled:!0,size:8,fadeWidth:2}),ye()),e.scrollSettings&&Object.assign(ce,e.scrollSettings),e.canvasSettings&&Object.assign(de,e.canvasSettings),e.screenSettings&&Object.assign(ue,e.screenSettings),e.textureRotationSettings&&Object.assign(me,e.textureRotationSettings),e.pageBackgroundSettings&&(Object.assign(ge,e.pageBackgroundSettings),fe())}function he(e,t=.5){if(!e)return null;if(e.startsWith("rgba"))return e;if(e.startsWith("rgb")){const n=e.match(/\d+/g);if(n&&n.length>=3)return`rgba(${n[0]}, ${n[1]}, ${n[2]}, ${t})`}const n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(n){return`rgba(${parseInt(n[1],16)}, ${parseInt(n[2],16)}, ${parseInt(n[3],16)}, ${t})`}return e}function fe(){const e=document.querySelector(".canvas-wrapper");e&&(ge.canvas.backgroundColor?e.style.setProperty("background-color",ge.canvas.backgroundColor,"important"):e.style.removeProperty("background-color"),ge.canvas.backgroundImage?(e.style.setProperty("background-image",`url(${ge.canvas.backgroundImage})`,"important"),e.style.setProperty("background-size","cover","important"),e.style.setProperty("background-position","center","important"),e.style.setProperty("background-repeat","no-repeat","important")):e.style.setProperty("background-image","none","important"));const t=document.querySelectorAll(".page-section");if(t.length>0&&t.length>1&&ge.team)for(let n=1;n<t.length;n++){const e=t[n];if(ge.team.backgroundColor&&"#000000"!==ge.team.backgroundColor){const t=he(ge.team.backgroundColor,.5);e.style.setProperty("background-color",t,"important")}else e.style.removeProperty("background-color");ge.team.backgroundImage?(e.style.setProperty("background-image",`url(${ge.team.backgroundImage})`,"important"),e.style.setProperty("background-size","cover","important"),e.style.setProperty("background-position","center","important"),e.style.setProperty("background-repeat","no-repeat","important")):e.style.setProperty("background-image","none","important")}}function ye(){document.documentElement.style.setProperty("--color-bg",le.backgroundColor),document.documentElement.style.setProperty("--color-text",le.textColor),document.documentElement.style.setProperty("--color-dot",le.dotColor),document.body.style.backgroundColor=le.backgroundColor;const e=document.querySelector("main");e&&(e.style.color=le.textColor);const t=document.querySelector("section.intro");t&&(t.style.color=le.textColor);const n=document.querySelector(".intro-text");n&&(n.style.color=le.textColor);const o=document.querySelector(".canvas-wrapper");o&&le.blendMode&&(o.style.mixBlendMode=le.blendMode),function(){const e=document.getElementById("canvas-container");if(!e)return;const t=le.vignette||{enabled:!0,size:8,fadeWidth:2};if(!t.enabled)return e.style.maskImage="none",void(e.style.webkitMaskImage="none");const n=`${t.size}%`,o=`${t.size+t.fadeWidth}%`,s=`${t.size+2*t.fadeWidth}%`,i=100-t.size-2*t.fadeWidth+"%",a=100-t.size-t.fadeWidth+"%",r=100-t.size+"%",l=`linear-gradient(to right, transparent 0%, transparent ${n}, rgba(0, 0, 0, 0.5) ${o}, black ${s}, black ${i}, rgba(0, 0, 0, 0.5) ${a}, transparent ${r}, transparent 100%)`,c=`linear-gradient(to bottom, transparent 0%, transparent ${n}, rgba(0, 0, 0, 0.5) ${o}, black ${s}, black ${i}, rgba(0, 0, 0, 0.5) ${a}, transparent ${r}, transparent 100%)`;e.style.maskImage=`${l}, ${c}`,e.style.maskComposite="intersect",e.style.webkitMaskImage=`${l}, ${c}`,e.style.webkitMaskComposite="source-in"}()}async function ve(e=!1){const t=await async function(e=!1){try{const t=new URL(import.meta.url),n=new URL("./default-settings.json",t),o=e?`${n}?t=${Date.now()}`:n,s=await fetch(o);if(!s.ok)return console.warn("Could not load default-settings.json, using hardcoded defaults"),!1;const i=await s.json();return i.constants&&(K={...K,...i.constants}),i.settings&&pe(i.settings),!0}catch(t){return console.warn("Failed to load default settings from JSON:",t),!1}}(e);if(t||e)t&&(console.log("Loaded settings from default-settings.json"),ye());else try{const e=localStorage.getItem("domeDreamingSettings");if(!e)return void ye();pe(JSON.parse(e)),console.log("Loaded settings from localStorage (JSON file not available)")}catch(n){console.warn("Failed to load settings from localStorage:",n),ye()}fe()}function be(e,t){try{const n={};e&&Array.isArray(e)&&e.forEach((e,t)=>{const o=Q(e.mesh);if(o?.color){const s=e.name||`mesh_${t}`;n[s]={r:o.color.r,g:o.color.g,b:o.color.b}}});const o={};t&&Array.isArray(t)&&t.forEach((e,t)=>{const n=e.name||`light_${t}`;o[n]={r:e.color.r,g:e.color.g,b:e.color.b,intensity:e.intensity}});const s={moveSpeed:ee,cameraSettings:te,startCameraPosition:ne,startCameraRotation:oe,colorSettings:n,lightSettings:o,bloomSettings:ae,ledStripSettings:re,pageColorSettings:le,scrollSettings:ce,canvasSettings:de,screenSettings:ue,textureRotationSettings:me,pageBackgroundSettings:ge};localStorage.setItem("domeDreamingSettings",JSON.stringify(s))}catch(n){console.warn("Failed to save settings:",n)}}let we=!1,Le=!1,Se=new d(0,0,0,"YXZ"),xe=!1,Ee=0,Me=0,ke={};function Ce(){function e(){const e=we;we=document.pointerLockElement===U||document.mozPointerLockElement===U||document.webkitPointerLockElement===U,!e&&we&&xe&&Se.setFromQuaternion(D.quaternion)}document.addEventListener("pointerlockchange",e),document.addEventListener("mozpointerlockchange",e),document.addEventListener("webkitpointerlockchange",e),U.addEventListener("click",()=>{!we&&window.enterDomeModeFromCanvas&&window.enterDomeModeFromCanvas()}),U.addEventListener("mousemove",function(e){if(!we||!xe)return;const t=e.movementX||e.mozMovementX||e.webkitMovementX||0,n=e.movementY||e.mozMovementY||e.webkitMovementY||0;Se.y-=t*te.sensitivity,Se.x-=n*te.sensitivity,Se.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,Se.x)),D.quaternion.setFromEuler(Se)}),U.addEventListener("touchstart",e=>{if(!document.body.classList.contains("dome-mode")||!xe)return;e.preventDefault();const t=e.touches[0];Ee=t.clientX,Me=t.clientY,Le=!0,Se.setFromQuaternion(D.quaternion)},{passive:!1}),U.addEventListener("touchmove",e=>{if(!document.body.classList.contains("dome-mode")||!Le||!xe)return;e.preventDefault();const t=e.touches[0],n=t.clientX-Ee,o=t.clientY-Me;Se.y-=n*te.sensitivity,Se.x-=o*te.sensitivity,Se.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,Se.x)),D.quaternion.setFromEuler(Se),Ee=t.clientX,Me=t.clientY},{passive:!1}),U.addEventListener("touchend",e=>{document.body.classList.contains("dome-mode")&&(e.preventDefault(),Le=!1)},{passive:!1}),U.addEventListener("touchcancel",e=>{document.body.classList.contains("dome-mode")&&(e.preventDefault(),Le=!1)},{passive:!1}),window.addEventListener("keydown",e=>{ke[e.key.toLowerCase()]=!0,"c"!==e.key&&"C"!==e.key||(console.log("Camera Position:",D.position),console.log("Camera Rotation:",D.rotation))}),window.addEventListener("keyup",e=>{ke[e.key.toLowerCase()]=!1,"q"===e.key||"Q"===e.key||"e"===e.key||e.key})}let Pe=null,Re=null,$e=null,je=null,Ie=null;function ze(e){Pe=e}function De(){return Re}function Fe(){return je}function Oe(){Pe&&(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(e=>{Re&&(Re.dispose(),Re=null),$e&&($e.pause(),$e.srcObject=null,$e=null),je&&(je.dispose(),je=null),Ie&&(Ie.getTracks().forEach(e=>e.stop()),Ie=null);const t=document.createElement("video");t.srcObject=e,t.autoplay=!0,t.playsInline=!0,t.muted=!0,t.addEventListener("loadedmetadata",()=>{t.play();const n=new m(t);H(n),n.minFilter=g,n.magFilter=g,n.rotation=0,X(n,Pe),Re=n,$e=t,Ie=e;const o=Q(Pe);o&&setTimeout(()=>{Object.assign(o,V),o.needsUpdate=!0},200)}),t.addEventListener("error",()=>{alert("Error accessing webcam.")})}).catch(e=>{console.error("Error accessing webcam:",e),alert("Could not access webcam. Please check permissions.")}):alert("Webcam access is not available in your browser."))}function We(){const e=document.getElementById("drop-zone");function n(e){e.preventDefault(),e.stopPropagation()}function o(e){if(!Pe)return;const n=Q(Pe);n&&(e?(n.emissive=new t(38655),n.emissiveIntensity=.8):(Object.assign(n,V),n.needsUpdate=!0))}document.addEventListener("dragenter",t=>{n(t),e.classList.add("drag-over"),o(!0)},!1),document.addEventListener("dragover",t=>{n(t),e.classList.add("drag-over"),o(!0)},!1),document.addEventListener("dragleave",t=>{n(t),0===t.clientX&&0===t.clientY&&(e.classList.remove("drag-over"),o(!1))},!1),document.addEventListener("drop",t=>{n(t),e.classList.remove("drag-over"),o(!1);const s=t.dataTransfer.files;if(s.length>0){const e=s[0];e.type.startsWith("image/")?function(e){if(!Pe)return;const t=new FileReader;t.onload=e=>{(new u).load(e.target.result,e=>{Re&&(Re.dispose(),Re=null),$e&&($e.pause(),$e.src="",URL.revokeObjectURL($e.src),$e=null),je&&je.dispose(),H(e),e.rotation=0,X(e,Pe),je=e;const t=Q(Pe);t&&setTimeout(()=>{Object.assign(t,V),t.needsUpdate=!0},200)},void 0,()=>{})},t.readAsDataURL(e)}(e):e.type.startsWith("video/")&&function(e){if(!Pe)return;const t=document.createElement("video");t.src=URL.createObjectURL(e),t.crossOrigin="anonymous",t.loop=!0,t.muted=!0,t.playsInline=!0,t.addEventListener("loadedmetadata",()=>{t.play(),Re&&Re.dispose(),$e&&($e.pause(),$e.src="",URL.revokeObjectURL($e.src)),je&&(je.dispose(),je=null);const e=new m(t);H(e),e.minFilter=g,e.magFilter=g,e.rotation=0,X(e,Pe),Re=e,$e=t;const n=Q(Pe);n&&setTimeout(()=>{Object.assign(n,V),n.needsUpdate=!0},200)}),t.addEventListener("error",()=>{})}(e)}},!1)}let _e=!1,Ue=null,Be=[],Te=null;async function Ae(){if(!_e)try{await R(),_e=!0,async function(){if(!_e)return void(await Ae());try{const e=await fetch("assets/models/navmesh.bin");if(e.ok){const t=await e.arrayBuffer(),n=new Uint8Array(t),{navMesh:o}=$(n);return Te=new j(o),ht(Te),console.log("Navmesh loaded from navmesh.bin"),void(xe&&qe())}}catch(e){console.log("navmesh.bin not found, will generate from GLTF")}(new P).load("assets/models/navmesh.gltf",async e=>{if(Ue=e.scene,Ue.scale.setScalar(1),Ue.visible=!1,Z(Ue,e=>{e.isMesh&&(Be.push(e),e.updateMatrixWorld())}),z.add(Ue),Be.length>0&&_e){const{success:e,navMesh:t}=I(Be,{cs:.05,ch:.05,walkableRadius:.2});e&&(Te=new j(t),ht(Te),console.log("Navmesh generated from GLTF"))}},void 0,e=>{console.warn("Navmesh GLTF not found:",e)})}()}catch(e){console.error("Failed to initialize recast-navigation:",e),_e=!0}}function qe(){if(!Te||!xe)return;const e={x:D.position.x,y:D.position.y-N,z:D.position.z},t=Te.findClosestPoint(e,{halfExtents:Y});t.success&&(D.position.y=t.point.y+N)}let Ge=null,Ne=[],Ye=null;const Ve=384;let Xe=0,He=2,Qe=.3,Je=0,Ze=4,Ke=!1,et={hueStart:.5,hueRange:.3,saturation:1,lightness:.5};function tt(){G(()=>Promise.resolve().then(()=>gt),void 0,import.meta.url).then(e=>{be(e.fbxMeshes,e.glbLights)})}function nt(e){if(!e)return console.warn("findLEDRim: model is null"),null;let t=null;const n=[];return e.traverse(e=>{n.push(e.name||"unnamed"),("LED_Rim"===e.name||e.name.includes("LED_Rim")||e.name.toLowerCase().includes("led"))&&(t=e,console.log(`Found LED rim object: "${e.name}", type: ${e.type||e.constructor.name}`))}),t||console.warn("LED_Rim object not found. Available object names:",n.filter(e=>e).slice(0,20)),t}function ot(e){if(!e)return void console.warn("LED_Rim object not found");Ge=e,Ye=new p,Ye.name="LED_Strip";let t=null;e.traverse(e=>{e.isMesh&&e.geometry&&(t=e.geometry)});const n=new h;n.setFromObject(e);const o=n.getSize(new f);n.getCenter(new f);let s=Math.max(o.x,o.z)/2;const i=o.y/2;let a=.75*s;s<.1&&(console.warn(`LED Rim radius too small (${s.toFixed(2)}), using default 5.0`),s=5,a=3.5),console.log(`LED Rim dimensions: outerRadius=${s.toFixed(2)}, innerRadius=${a.toFixed(2)}, height=${i.toFixed(2)}, size:`,o),console.log("Rim object position:",e.position),console.log("Rim object rotation:",e.rotation),console.log("Rim object scale:",e.scale),console.log("Rim object matrix:",e.matrix);let r=[];if(t&&t.attributes&&t.attributes.position){const e=t.attributes.position,n=e.count;console.log(`Found rim geometry with ${n} vertices`);const o=[];for(let t=0;t<n;t++){const n=e.getX(t),s=e.getY(t),i=e.getZ(t);o.push(new f(n,s,i))}const s=Math.min(...o.map(e=>e.y)),i=Math.max(...o.map(e=>e.y)),l=i-s,c=s+.1*l;console.log(`Rim Y range: ${s.toFixed(2)} to ${i.toFixed(2)}, using bottom Y: ${c.toFixed(2)}`);const d=o.filter(e=>Math.abs(e.y-c)<.15*l).map(e=>({vertex:e,distance:Math.sqrt(e.x*e.x+e.z*e.z),angle:Math.atan2(e.z,e.x)})).sort((e,t)=>e.angle-t.angle);if(d.length>10){console.log(`Found ${d.length} bottom edge vertices`);const e=d.reduce((e,t)=>e+t.vertex.x,0)/d.length,t=d.reduce((e,t)=>e+t.vertex.z,0)/d.length;new f(e,c,t),d.reduce((n,o)=>{const s=o.vertex.x-e,i=o.vertex.z-t;return n+Math.sqrt(s*s+i*i)},0),d.length;for(let n=0;n<Ve;n++){const o=n/Ve*Math.PI*2;let s=d[0],i=1/0;for(const n of d){const a=Math.atan2(n.vertex.z-t,n.vertex.x-e);let r=Math.abs(a-o);r>Math.PI&&(r=2*Math.PI-r),r<i&&(i=r,s=n)}const l=new f(e+Math.cos(o)*a,s.vertex.y,t+Math.sin(o)*a);r.push(l)}console.log(`Created ${r.length} evenly distributed LED positions using angular distribution`)}else{console.log(`Not enough bottom vertices (${d.length}), using perfectly evenly distributed circle positions`);for(let e=0;e<Ve;e++){const t=e/Ve*Math.PI*2,n=new f(Math.cos(t)*a,c,Math.sin(t)*a);r.push(n)}}}else{console.log("No rim geometry found, using perfectly evenly distributed circle positions");for(let e=0;e<Ve;e++){const t=e/Ve*Math.PI*2,n=new f(Math.cos(t)*a,-i,Math.sin(t)*a);r.push(n)}}if(r.length!==Ve){console.log(`Adjusting positions from ${r.length} to 384 for even distribution`);const e=[];for(let t=0;t<Ve;t++){const n=t/Ve,o=Math.floor(n*r.length),s=(o+1)%r.length,i=n*r.length-o,a=(new f).lerpVectors(r[o],r[s],i);e.push(a)}r=e}const l=new y(.024,.024,.009,8,1),d=new c({color:16777215,emissive:65535,emissiveIntensity:0,metalness:0,roughness:.8}),u=new p;u.name="LED_Diffuser";const m=new v(a+.006,.0045,16,64),g=new c({color:16777215,transparent:!0,opacity:.3,roughness:1,metalness:0,side:b}),S=new w(m,g);if(S.position.y=-i,S.rotation.x=Math.PI/2,u.add(S),r.length!==Ve){for(console.warn(`Position count mismatch: ${r.length} positions, need 384. Creating missing positions.`);r.length<Ve;){const e=r.length/Ve*Math.PI*2,t=new f(Math.cos(e)*a,-i,Math.sin(e)*a);r.push(t)}r=r.slice(0,Ve)}for(let c=0;c<Ve&&c<r.length;c++){const e=new w(l,d.clone());e.position.copy(r[c]);const t=new f(0,r[c].y,0);e.lookAt(t),e.rotateX(Math.PI/2),e.name=`LED_${c}`,Ne.push({mesh:e,index:c,material:e.material}),Ye.add(e)}if(e.add(Ye),e.add(u),Ye.visible=!0,Ye.matrixAutoUpdate=!0,console.log(`Created LED strip with ${Ne.length} pixels (target: 384) at inner radius ${a.toFixed(2)}`),console.log(`Positions array length: ${r.length}`),Ne.length!==Ve?console.error(`LED count mismatch! Expected 384, got ${Ne.length}`):console.log("âœ“ Successfully created all 384 LEDs"),console.log("LED strip group position (local):",Ye.position),console.log("LED strip group visible:",Ye.visible),console.log("Rim object visible:",e.visible),Ne.length>0){const t=Ne[0].mesh,n=new f;t.getWorldPosition(n);const o=new f;e.getWorldPosition(o);const s=new L;if(e.getWorldQuaternion(s),console.log("First LED local position:",t.position),console.log("First LED world position:",n),console.log("Rim object world position:",o),console.log("Rim object world rotation:",e.getWorldQuaternion(s)),console.log("Rim object world scale:",e.getWorldScale(new f)),Ne.length>10){const e=Ne[Math.floor(Ne.length/4)].mesh,t=new f;e.getWorldPosition(t),console.log("Quarter LED world position:",t)}}}function st(e){0!==Ne.length&&(Xe+=e*He,Ne.forEach((e,n)=>{const o=n/Ve;let s;if(Ke){const e=o-.5,t=Math.abs(e),n=(.5-t+Xe)%1,i=(.5-t-Xe+1)%1;s=Math.min(n,i)}else s=(o+Xe)%1;const i=2*Math.abs(s-.5);let a=0;i<Qe?(a=1-i/Qe,a=Math.pow(a,2),a=Je+(Ze-Je)*a):a=Je,e.material.emissiveIntensity=Math.max(a,0);const r=.1*Xe,l=(et.hueStart+(o+.5*Xe)*et.hueRange+r)%1,c=(new t).setHSL(l,et.saturation,et.lightness);e.material.emissive=c,e.mesh.visible=!0}))}function it(e){Ge&&(Ge.visible=e,Ge.traverse(t=>{t.isMesh&&(t.visible=e)}))}const at=Object.freeze(Object.defineProperty({__proto__:null,get baseIntensity(){return Je},colorPalette:et,createLEDStrip:ot,findLEDRim:nt,getLEDStrip:function(){return Ye},getRimObject:function(){return Ge},isRimVisible:function(){return!Ge||Ge.visible},loadLEDStripSettings:function(){He=re.pulseSpeed,Qe=re.pulseWidth,Je=re.baseIntensity,Ze=re.maxIntensity,Ke=re.mirrored||!1,et.hueStart=re.hueStart,et.hueRange=re.hueRange,et.saturation=re.saturation,et.lightness=re.lightness,it(void 0!==re.rimVisible&&re.rimVisible)},get maxIntensity(){return Ze},get mirrored(){return Ke},get pulseSpeed(){return He},get pulseWidth(){return Qe},setBaseIntensity:function(e){Je=e,re.baseIntensity=e,tt()},setColorPalette:function(e,t,n,o){et.hueStart=e,et.hueRange=t,et.saturation=n,et.lightness=o,re.hueStart=e,re.hueRange=t,re.saturation=n,re.lightness=o,tt()},setLEDColor:function(e){Ne.forEach(t=>{t.material.emissive.set(e)})},setLEDIntensity:function(e){Ne.forEach(t=>{t.material.emissiveIntensity=e})},setMaxIntensity:function(e){Ze=e,re.maxIntensity=e,tt()},setMirrored:function(e){Ke=e,re.mirrored=e,tt()},setPulseSpeed:function(e){He=e,re.pulseSpeed=e,tt()},setPulseWidth:function(e){Qe=e,re.pulseWidth=e,tt()},setRimVisible:it,updateLEDAnimation:st},Symbol.toStringTag,{value:"Module"}));let rt=null,lt=[],ct=[],dt=null,ut=[];function mt(){const e=new P,n=document.getElementById("loading");e.load("assets/models/wisdome.glb",e=>{if(console.log("Wisdome GLB loaded successfully"),!e||!e.scene)return console.error("GLB loaded but scene is missing"),void(n.innerHTML='<div style="color: #ff4444;">Error: Model scene is missing.</div>');const o=e.scene;rt=o,o.scale.setScalar(1),o.position.set(0,0,0),J(o),dt=new p,dt.name="GLBLights",Z(o,e=>{e.isLight&&(ct.push(e),dt.add(e),console.log("Found GLB light:",e.name||"Unnamed",e.type,"intensity:",e.intensity))}),0===ct.length&&(console.log("No lights found with isLight, checking object for light instances..."),Z(o,e=>{(e instanceof S||e instanceof x||e instanceof E||e instanceof M||e instanceof k||e instanceof C)&&(ct.includes(e)||(ct.push(e),dt.add(e),console.log("Found additional light:",e.name||"Unnamed",e.constructor.name)))})),ct.length>0?(z.add(dt),console.log(`Grouped ${ct.length} lights from GLB`),window.savedLightSettings&&ct.forEach((e,t)=>{const n=e.name||`light_${t}`,o=window.savedLightSettings[n];if(o){e.color.setRGB(o.r,o.g,o.b);const t=Math.max(0,Math.min(o.intensity??e.intensity,10));e.intensity=t}})):console.log("No lights found in GLB file. Lights GUI will not be available."),Z(o,e=>{"Hotspots"===e.name&&Z(e,e=>{if("Hotspot.001"===e.name||e.name.includes("Hotspot")){const t=new f;e.getWorldPosition(t),ut.push({object:e,position:t,name:e.name,triggered:!1}),console.log(`Found hotspot: ${e.name} at position:`,t)}})});const s=nt(o);s?(console.log("Found LED_Rim object, creating LED strip..."),G(()=>Promise.resolve().then(()=>at),void 0,import.meta.url).then(e=>{e.loadLEDStripSettings()}),ot(s)):console.log("LED_Rim object not found in model"),Z(o,e=>{if(e.isMesh){const n=e.name.toLowerCase();if(n.includes("led_rim")||n.includes("led_strip")||n.startsWith("led_"))return;if(n.includes("screen")||n.includes("display")||n.includes("monitor")||n.includes("panel")||n.includes("projection")||n.includes("canvas"))ze(e),e.visible=!0;else{let n=Q(e);const o=n?.color?n.color.clone():new t(16777215);if(n){if(void 0!==n.metalness&&(n.metalness=Math.max(n.metalness||0,.1)),void 0!==n.roughness&&(n.roughness=Math.min(n.roughness||.5,.8)),n.map&&(n.map.colorSpace=i),n.isMeshBasicMaterial){const t=new c({color:n.color,map:n.map,transparent:n.transparent,opacity:n.opacity,metalness:.1,roughness:.5});e.material=t,n=t}n.needsUpdate=!0}lt.push({mesh:e,name:e.name||"Unnamed",originalColor:o})}}});let a=!1;Z(o,e=>{e.isMesh&&e.name&&(e.name.toLowerCase().includes("screen")||e.name.toLowerCase().includes("display")||e.name.toLowerCase().includes("monitor")||e.name.toLowerCase().includes("panel")||e.name.toLowerCase().includes("projection")||e.name.toLowerCase().includes("canvas"))&&(a=!0)}),!a&&o&&o.children.length>0&&Z(o,e=>{e.isMesh&&!a&&(ze(e),e.visible=!0,lt=lt.filter(t=>t.mesh!==e),a=!0)}),z.add(o),setTimeout(()=>{n.classList.add("hidden");const e=document.getElementById("canvas-container"),t=document.getElementById("info-panel");e&&e.classList.add("loaded"),t&&t.classList.add("loaded")},300),D.position.set(ne.x,ne.y,ne.z),D.rotation.set(oe.x,oe.y,oe.z),Se.set(oe.x,oe.y,oe.z),xe=!0;Te&&qe(),Ae().catch(console.error),function(e=ue.defaultImage||"assets/media/background.jpg"){if(!Pe)return;(new u).load(e,e=>{H(e),e.rotation=0,X(e,Pe),je=e},void 0,()=>{})}(),We()},void 0,e=>{console.error("Error loading 3D model:",e),n.innerHTML='<div style="color: #ff4444;">Error loading 3D model.</div>'})}const gt=Object.freeze(Object.defineProperty({__proto__:null,get fbxMeshes(){return lt},glbLights:ct,get glbLightsGroup(){return dt},hotspots:ut,loadModel:mt,get wisdomeModel(){return rt}},Symbol.toStringTag,{value:"Module"}));let pt=null;function ht(e){pt=e}function ft(){D.updateMatrixWorld();const e=new f;e.setFromMatrixColumn(D.matrixWorld,2),e.multiplyScalar(-1).normalize();const t=new f;t.setFromMatrixColumn(D.matrixWorld,0),t.normalize();const n=new f,o=ee;if(ke.w&&n.add(e.clone().multiplyScalar(o)),ke.s&&n.add(e.clone().multiplyScalar(-o)),ke.a&&n.add(t.clone().multiplyScalar(-o)),ke.d&&n.add(t.clone().multiplyScalar(o)),0!==n.length())if(pt){const e=D.position.clone();e.x+=n.x,e.z+=n.z;const t={x:e.x,y:e.y-N,z:e.z},o=pt.findClosestPoint(t,{halfExtents:Y});if(o.success)D.position.set(o.point.x,o.point.y+N,o.point.z);else{const t=pt.findClosestPoint({x:e.x,y:D.position.y-N,z:D.position.z},{halfExtents:Y});if(t.success)D.position.set(t.point.x,t.point.y+N,D.position.z);else{const t=pt.findClosestPoint({x:D.position.x,y:D.position.y-N,z:e.z},{halfExtents:Y});t.success&&D.position.set(D.position.x,t.point.y+N,t.point.z)}}}else D.position.add(n)}export{T as a,ae as b,D as c,ce as d,A as e,Ce as f,mt as g,U as h,ne as i,se as j,oe as k,ve as l,ie as m,be as n,st as o,Oe as p,ct as q,F as r,z as s,me as t,ft as u,lt as v,Fe as w,De as x};
