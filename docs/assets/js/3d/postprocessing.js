import*as THREE from"three";import{EffectComposer}from"three/addons/postprocessing/EffectComposer.js";import{RenderPass}from"three/addons/postprocessing/RenderPass.js";import{UnrealBloomPass}from"three/addons/postprocessing/UnrealBloomPass.js";import{BokehPass}from"three/addons/postprocessing/BokehPass.js";import{OutputPass}from"three/addons/postprocessing/OutputPass.js";import{FXAAPass}from"three/addons/postprocessing/FXAAPass.js";import{scene,camera,renderer,setResizeHandler}from"./scene.js";import{bloomSettings,dofSettings}from"../core/settings.js";let composer=null,renderPass=null,bloomPass=null,bokehPass=null,fxaaPass=null,outputPass=null;export function initPostProcessing(){const e=document.getElementById("canvas-container").getBoundingClientRect(),s=new THREE.Vector2(e.width,e.height),o=new THREE.WebGLRenderTarget(s.width,s.height,{type:THREE.HalfFloatType,samples:0});composer=new EffectComposer(renderer,o),renderPass=new RenderPass(scene,camera),composer.addPass(renderPass);const t=!1!==bloomSettings.enabled?bloomSettings.strength:0;bloomPass=new UnrealBloomPass(s,t,bloomSettings.radius,bloomSettings.threshold),bloomPass.enabled=!1!==bloomSettings.enabled,composer.addPass(bloomPass),bokehPass=new BokehPass(scene,camera,{focus:dofSettings.focus,aperture:dofSettings.aperture,maxblur:dofSettings.maxblur}),bokehPass.enabled=!1!==dofSettings.enabled,composer.addPass(bokehPass),setResizeHandler(()=>{const e=document.getElementById("canvas-container").getBoundingClientRect(),s=e.width,o=e.height;camera.aspect=s/o,camera.updateProjectionMatrix(),renderer.setSize(s,o),renderer.setPixelRatio(Math.min(window.devicePixelRatio,1.5)),resizePostProcessing()})}export function updatePostProcessing(){composer?composer.render():renderer.render(scene,camera)}export function resizePostProcessing(){if(composer){const e=document.getElementById("canvas-container").getBoundingClientRect(),s=e.width,o=e.height;composer.setSize(s,o),bloomPass&&bloomPass.setSize(s,o),bokehPass&&bokehPass.setSize(s,o),fxaaPass&&fxaaPass.setSize(s,o)}}export function getBloomPass(){return bloomPass}export function getBokehPass(){return bokehPass}