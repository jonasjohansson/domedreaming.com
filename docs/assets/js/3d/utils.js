import*as THREE from"three";import{SCREEN_MATERIAL_SETTINGS}from"./config.js";const COLOR_PALETTE=[new THREE.Color(.4,.2,.6),new THREE.Color(.2,.5,.6),new THREE.Color(.7,.4,.2)];function generateRandomMutedColor(){const e=Math.floor(Math.random()*COLOR_PALETTE.length);return COLOR_PALETTE[e].clone()}function getScreenColor(){if(window.savedColorSettings||(window.savedColorSettings={}),!window.savedColorSettings.Screen){const e=generateRandomMutedColor();window.savedColorSettings.Screen={r:e.r,g:e.g,b:e.b}}const e=window.savedColorSettings.Screen;return new THREE.Color(e.r,e.g,e.b)}export function applyTextureToScreen(e,r){if(!r)return;const t=Array.isArray(r.material)?r.material[0]:r.material;if(!t){const t=new THREE.MeshStandardMaterial({map:e,...SCREEN_MATERIAL_SETTINGS,color:new THREE.Color(16777215),emissive:new THREE.Color(16777215),emissiveMap:e,emissiveIntensity:1});return void(r.material=t)}t.map&&t.map.dispose(),t.emissiveMap&&t.emissiveMap!==e&&t.emissiveMap.dispose(),t.map=e,t.emissiveMap=e,Object.assign(t,SCREEN_MATERIAL_SETTINGS),t.color.setRGB(1,1,1),t.emissive.setRGB(1,1,1),t.emissiveIntensity=1,t.needsUpdate=!0}export function configureTexture(e){e.flipY=!0,e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,e.repeat.x=1,e.repeat.y=-1,e.colorSpace=THREE.SRGBColorSpace,e.center.set(.5,.5),e.minFilter=THREE.LinearMipmapLinearFilter,e.magFilter=THREE.LinearFilter,e.anisotropy=16,e.generateMipmaps=!0,e.needsUpdate=!0}export function getMaterial(e){return Array.isArray(e.material)?e.material[0]:e.material}export function colorToHex(e){return`#${Math.floor(255*e.r).toString(16).padStart(2,"0")}${Math.floor(255*e.g).toString(16).padStart(2,"0")}${Math.floor(255*e.b).toString(16).padStart(2,"0")}`}export function rgbToHex(e){return`#${Math.round(255*e.r).toString(16).padStart(2,"0")}${Math.round(255*e.g).toString(16).padStart(2,"0")}${Math.round(255*e.b).toString(16).padStart(2,"0")}`}export function pruneObjectChildren(e){e&&e.children&&(e.children=e.children.filter(Boolean),e.children.forEach(e=>pruneObjectChildren(e)))}export function safeTraverse(e,r){if(!e)return;const t=[e];for(;t.length;){const e=t.pop();if(e&&(r(e),e.children&&e.children.length))for(let r=e.children.length-1;r>=0;r--){const n=e.children[r];n&&"function"==typeof n.traverse?t.push(n):e.children.splice(r,1)}}}