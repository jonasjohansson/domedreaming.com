var yi=Object.defineProperty;var oe=(e,t)=>()=>(e&&(t=e(e=0)),t);var ye=(e,t)=>{for(var o in t)yi(e,o,{get:t[o],enumerable:!0})};import*as Io from"three";var fe,$e,ze,Lt=oe(()=>{fe=1.6,$e={x:5,y:10,z:5},ze={emissive:new Io.Color(16777215),emissiveIntensity:1,color:new Io.Color(16777215),toneMapped:!1,transparent:!0,opacity:1}});var oa={};ye(oa,{applyTextureToScreen:()=>st,colorToHex:()=>Si,configureTexture:()=>lt,getMaterial:()=>ne,pruneObjectChildren:()=>qt,rgbToHex:()=>kt,safeTraverse:()=>Se});import*as _ from"three";function st(e,t){if(!t)return;let o=Array.isArray(t.material)?t.material[0]:t.material;if(!o){let n=new _.MeshStandardMaterial({map:e,...ze,color:new _.Color(16777215),emissive:new _.Color(16777215),emissiveMap:e,emissiveIntensity:1});t.material=n;return}o.map&&o.map.dispose(),o.emissiveMap&&o.emissiveMap!==e&&o.emissiveMap.dispose(),o.map=e,o.emissiveMap=e,Object.assign(o,ze),o.color.setRGB(1,1,1),o.emissive.setRGB(1,1,1),o.emissiveIntensity=1,o.needsUpdate=!0}function lt(e){e.flipY=!0,e.wrapS=_.RepeatWrapping,e.wrapT=_.RepeatWrapping,e.repeat.x=1,e.repeat.y=-1,e.colorSpace=_.SRGBColorSpace,e.center.set(.5,.5),e.minFilter=_.LinearMipmapLinearFilter,e.magFilter=_.LinearFilter,e.anisotropy=16,e.generateMipmaps=!0,e.needsUpdate=!0}function ne(e){return Array.isArray(e.material)?e.material[0]:e.material}function Si(e){return`#${Math.floor(e.r*255).toString(16).padStart(2,"0")}${Math.floor(e.g*255).toString(16).padStart(2,"0")}${Math.floor(e.b*255).toString(16).padStart(2,"0")}`}function kt(e){let t=Math.round(e.r*255).toString(16).padStart(2,"0"),o=Math.round(e.g*255).toString(16).padStart(2,"0"),n=Math.round(e.b*255).toString(16).padStart(2,"0");return`#${t}${o}${n}`}function qt(e){!e||!e.children||(e.children=e.children.filter(Boolean),e.children.forEach(t=>qt(t)))}function Se(e,t){if(!e)return;let o=[e];for(;o.length;){let n=o.pop();if(n&&(t(n),n.children&&n.children.length))for(let i=n.children.length-1;i>=0;i--){let a=n.children[i];a&&typeof a.traverse=="function"?o.push(a):n.children.splice(i,1)}}}var ns,Ne=oe(()=>{Lt();ns=[new _.Color(.4,.2,.6),new _.Color(.2,.5,.6),new _.Color(.7,.4,.2)]});var Ho={};ye(Ho,{camera:()=>y,canvas:()=>se,canvasContainer:()=>Fo,renderer:()=>O,resetCamera:()=>bi,scene:()=>T,setResizeHandler:()=>zo,setSceneBackground:()=>Ci});import*as ae from"three";function Ci(e){e&&typeof e=="object"?T.background=new ae.Color(e.r,e.g,e.b):typeof e=="string"&&(T.background=new ae.Color(e))}function na(){let e=Fo.getBoundingClientRect();return{width:e.width,height:e.height}}function zo(e){window.removeEventListener("resize",Vt),Vt=e,window.addEventListener("resize",Vt)}function bi(e,t,o){e&&y.position.set(e.x,e.y,e.z),t&&(y.rotation.set(t.x,t.y,t.z),y.updateMatrixWorld(),o&&o.set(t.x,t.y,t.z,"YXZ"))}var T,y,O,Fo,_t,se,Vt,Ce=oe(()=>{T=new ae.Scene;T.background=new ae.Color(14211288);y=new ae.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);y.position.set(0,5.4,-4.3);y.rotation.set(-2.8,0,3.121154018741333);O=new ae.WebGLRenderer({antialias:!1,powerPreference:"high-performance",stencil:!1,depth:!0}),Fo=document.getElementById("canvas-container");_t=na();O.setSize(_t.width,_t.height);O.setPixelRatio(Math.min(window.devicePixelRatio,1.5));y.aspect=_t.width/_t.height;y.updateProjectionMatrix();setTimeout(()=>{window.dispatchEvent(new Event("resize"))},100);O.shadowMap.enabled=!1;O.toneMapping=ae.NoToneMapping;O.outputColorSpace=ae.SRGBColorSpace;Fo.appendChild(O.domElement);se=O.domElement,Vt=()=>{let e=na();y.aspect=e.width/e.height,y.updateProjectionMatrix(),O.setSize(e.width,e.height),O.setPixelRatio(Math.min(window.devicePixelRatio,1.5))};window.addEventListener("resize",Vt)});var aa={};ye(aa,{checkHotspots:()=>Mi,constrainToNavmesh:()=>vi,setNavMeshQuery:()=>Yt,touchMovement:()=>je,updateMovement:()=>Ei,updateRotation:()=>xi});import*as Ut from"three";function Yt(e){We=e}function Ei(){if(!ie)return;y.updateMatrixWorld();let e=new Ut.Vector3;e.setFromMatrixColumn(y.matrixWorld,2),e.multiplyScalar(-1).normalize();let t=new Ut.Vector3;t.setFromMatrixColumn(y.matrixWorld,0),t.normalize();let o=new Ut.Vector3,n=qe;ue.w&&o.add(e.clone().multiplyScalar(n)),ue.s&&o.add(e.clone().multiplyScalar(-n)),ue.a&&o.add(t.clone().multiplyScalar(-n)),ue.d&&o.add(t.clone().multiplyScalar(n));let i=n*2;if(je.forward&&o.add(e.clone().multiplyScalar(i)),je.backward&&o.add(e.clone().multiplyScalar(-i)),je.left&&o.add(t.clone().multiplyScalar(-i)),je.right&&o.add(t.clone().multiplyScalar(i)),o.length()!==0)if(We){let a=y.position.clone();a.x+=o.x,a.z+=o.z;let r={x:a.x,y:a.y-fe,z:a.z},s=We.findClosestPoint(r,{halfExtents:$e});if(s.success)y.position.set(s.point.x,s.point.y+fe,s.point.z);else{let l=We.findClosestPoint({x:a.x,y:y.position.y-fe,z:y.position.z},{halfExtents:$e});if(l.success)y.position.set(l.point.x,l.point.y+fe,y.position.z);else{let m=We.findClosestPoint({x:y.position.x,y:y.position.y-fe,z:a.z},{halfExtents:$e});m.success&&y.position.set(y.position.x,m.point.y+fe,m.point.z)}}}else y.position.add(o)}function vi(){if(!We)return;let e={x:y.position.x,y:y.position.y-fe,z:y.position.z},t=We.findClosestPoint(e,{halfExtents:$e});t.success&&(y.position.y=t.point.y+fe)}function xi(e){ue.q||ue.Q?Ge(me.rotationSpeed*(Math.PI/180)):ue.e||ue.E?Ge(-me.rotationSpeed*(Math.PI/180)):Ge(0),ct!==0&&ie&&(Q.y+=ct*e,y.quaternion.setFromEuler(Q)),ie&&(je.rotateLeft&&(Q.y+=1.5*e,y.quaternion.setFromEuler(Q)),je.rotateRight&&(Q.y-=1.5*e,y.quaternion.setFromEuler(Q)))}function Mi(){if(!ie||!He||He.length===0)return;let e=.4;for(let t=He.length-1;t>=0;t--){let o=He[t];if(!o||!o.object||o.triggered)continue;let n=y.position.x-o.position.x,i=y.position.z-o.position.z;if(Math.sqrt(n*n+i*i)<e){o.triggered=!0,o.object.parent&&o.object.parent.remove(o.object),He.splice(t,1),alert(""),console.log(`Hotspot ${o.name} triggered and removed`);break}}}var We,je,Xt=oe(()=>{Ce();Lt();Pe();Pt();dt();We=null,je={forward:!1,backward:!1,left:!1,right:!1,rotateLeft:!1,rotateRight:!1}});var ra={};ye(ra,{euler:()=>Q,isPointerLocked:()=>Ti,isTouching:()=>Kt,keys:()=>ue,modelLoaded:()=>ie,qeRotationSpeed:()=>ct,setModelLoaded:()=>Do,setQeRotationSpeed:()=>Ge,setupCameraControls:()=>Li,touchStartX:()=>Zt,touchStartY:()=>Jt});import*as ia from"three";function Do(e){ie=e}function Ge(e){ct=e}function Li(){let e=!1,t=0,o=0;se.addEventListener("mousedown",a=>{ie&&(e=!0,t=a.clientX,o=a.clientY,se.style.cursor="grabbing")}),se.addEventListener("mousemove",a=>{if(!e||!ie)return;let r=a.clientX-t,s=a.clientY-o;Q.y-=r*me.sensitivity,Q.x-=s*me.sensitivity,y.quaternion.setFromEuler(Q),t=a.clientX,o=a.clientY}),se.addEventListener("mouseup",()=>{e=!1,se.style.cursor="default"}),se.addEventListener("mouseleave",()=>{e=!1,se.style.cursor="default"});let n=null;se.addEventListener("touchstart",a=>{if(ie&&(a.preventDefault(),a.touches.length===1&&n===null)){let r=a.touches[0];n=r.identifier,Zt=r.clientX,Jt=r.clientY,Kt=!0}},{passive:!1}),se.addEventListener("touchmove",a=>{if(ie&&(a.preventDefault(),n!==null&&a.touches.length===1)){let r=Array.from(a.touches).find(s=>s.identifier===n);if(r){let s=r.clientX-Zt,l=r.clientY-Jt;Q.y-=s*me.sensitivity,Q.x-=l*me.sensitivity,y.quaternion.setFromEuler(Q),Zt=r.clientX,Jt=r.clientY}}},{passive:!1}),se.addEventListener("touchend",a=>{a.preventDefault();for(let r=0;r<a.changedTouches.length;r++)a.changedTouches[r].identifier===n&&(n=null,Kt=!1)},{passive:!1}),se.addEventListener("touchcancel",a=>{a.preventDefault();for(let r=0;r<a.changedTouches.length;r++)a.changedTouches[r].identifier===n&&(n=null,Kt=!1)},{passive:!1});function i(a,r){let s=a.toLowerCase();["q","w","a","s","d","e"].includes(s)&&document.querySelectorAll(`[data-key="${s}"]`).forEach(m=>{r?m.classList.add("active"):m.classList.remove("active")})}window.addEventListener("keydown",a=>{let r=a.key.toLowerCase();ue[r]=!0,i(a.key,!0),(a.key==="c"||a.key==="C")&&(console.log("Camera Position:",y.position),console.log("Camera Rotation:",y.rotation)),(a.key==="q"||a.key==="Q")&&Ge(1.5),(a.key==="e"||a.key==="E")&&Ge(-1.5)}),window.addEventListener("keyup",a=>{let r=a.key.toLowerCase();ue[r]=!1,i(a.key,!1),(a.key==="q"||a.key==="Q"||a.key==="e"||a.key==="E")&&(ct=0)})}var Ti,Kt,Q,ie,Zt,Jt,ue,ct,Pt=oe(()=>{Ce();Pe();Xt();Ti=!1,Kt=!1,Q=new ia.Euler(-2.85,0,3.121154018741333,"YXZ"),ie=!1,Zt=0,Jt=0,ue={},ct=0});function le(){return/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||"ontouchstart"in window||navigator.maxTouchPoints>0}function ki(){return window.visualViewport&&window.visualViewport.height?window.visualViewport.height:document.documentElement.clientHeight||window.innerHeight}function ft(){let e=getComputedStyle(document.documentElement),t=e.getPropertyValue("--row-height"),o=parseFloat(t);if(!isNaN(o)&&o>0)return o;let n=parseFloat(e.getPropertyValue("--grid-rows"))||16;return ki()/n}var Ve=oe(()=>{});var Oo={};ye(Oo,{getBloomPass:()=>Di,getBokehPass:()=>gt,initPostProcessing:()=>zi,resizePostProcessing:()=>ca,updatePostProcessing:()=>Hi});import*as pt from"three";import{EffectComposer as Pi}from"three/addons/postprocessing/EffectComposer.js";import{RenderPass as Ri}from"three/addons/postprocessing/RenderPass.js";import{UnrealBloomPass as Ii}from"three/addons/postprocessing/UnrealBloomPass.js";import{BokehPass as Fi}from"three/addons/postprocessing/BokehPass.js";import"three/addons/postprocessing/OutputPass.js";import"three/addons/postprocessing/FXAAPass.js";function zi(){let t=document.getElementById("canvas-container").getBoundingClientRect(),o=new pt.Vector2(t.width,t.height),n=new pt.WebGLRenderTarget(o.width,o.height,{type:pt.HalfFloatType,samples:0});De=new Pi(O,n),sa=new Ri(T,y),De.addPass(sa);let i=G.enabled!==!1?G.strength:0;ut=new Ii(o,i,G.radius,G.threshold),ut.enabled=G.enabled!==!1,De.addPass(ut),mt=new Fi(T,y,{focus:W.focus,aperture:W.aperture,maxblur:W.maxblur}),mt.enabled=W.enabled!==!1,De.addPass(mt),zo(()=>{let r=document.getElementById("canvas-container").getBoundingClientRect(),s=r.width,l=r.height;y.aspect=s/l,y.updateProjectionMatrix(),O.setSize(s,l),O.setPixelRatio(Math.min(window.devicePixelRatio,1.5)),ca()}),console.log("Post-processing initialized")}function Hi(){De?De.render():O.render(T,y)}function ca(){if(De){let t=document.getElementById("canvas-container").getBoundingClientRect(),o=t.width,n=t.height;De.setSize(o,n),ut&&ut.setSize(o,n),mt&&mt.setSize(o,n),la&&la.setSize(o,n)}}function Di(){return ut}function gt(){return mt}var De,sa,ut,mt,la,eo=oe(()=>{Ce();Pe();De=null,sa=null,ut=null,mt=null,la=null});var pa={};ye(pa,{audioSettings:()=>U,createPulseSynths:()=>oo,getActivePulseIndex:()=>Wo,getTickIntensity:()=>No,initAudio:()=>ma,isAudioEnabled:()=>Qo,isAudioInitialized:()=>$i,setMasterVolume:()=>Uo,setReverbWet:()=>Yo,setScrambleTrigger:()=>Ao,setSpatialSpread:()=>Xo,setTotalPulseCount:()=>jo,startAudio:()=>qo,stopAudio:()=>Vo,updateListenerPosition:()=>Ai,updatePulseAudio:()=>_o,updateTickIntensity:()=>Go});function Ao(e){Bo=e}function No(){return Rt}function Wo(){return $o}function jo(e){ua=e}function Go(){Rt=Math.max(0,Rt-.15),Rt<=0&&($o=-1)}async function Bi(){return K||(window.Tone?(K=window.Tone,K):new Promise((e,t)=>{let o=document.createElement("script");o.src="https://cdn.jsdelivr.net/npm/tone@14.7.77/build/Tone.js",o.onload=()=>{K=window.Tone,console.log("Tone.js loaded for spatial audio"),e(K)},o.onerror=t,document.head.appendChild(o)}))}async function ma(){if(Ft)return!0;try{return await Bi(),K?(await K.start(),console.log("Spatial audio context started"),It=new K.Reverb({decay:6,wet:U.reverbWet}).toDestination(),await It.generate(),to=new K.Gain(U.masterVolume).connect(It),Ft=!0,!0):!1}catch(e){return console.error("Error initializing spatial audio:",e),!1}}function oo(e){if(!K||!Ft){console.log("Cannot create synths - audio not initialized");return}Me.forEach(t=>{try{t.synth.dispose(),t.panner&&t.panner.dispose(),t.panner3d&&t.panner3d.dispose()}catch{}}),Me=[];for(let t=0;t<e;t++){let o=new K.Panner(0).connect(to),n=t%2===1,i;n?i=new K.Synth({oscillator:{type:"triangle"},envelope:{attack:.001,decay:.15,sustain:0,release:.1},volume:-6}).connect(o):i=new K.Synth({oscillator:{type:"triangle"},envelope:{attack:2,decay:.5,sustain:.7,release:2},volume:0}).connect(o),Me.push({synth:i,panner:o,playing:!1,frequency:n?fa[Math.floor(t/2)%fa.length]:da[Math.floor(t/2)%da.length],isTick:n,lastTickTime:0,tickInterval:6e4/U.tickBPM*(1+t*.25),x:0,y:0,z:0})}console.log(`Created ${e} spatial synths`),ht&&Me.forEach((t,o)=>{!t.playing&&!t.isTick?(t.synth.triggerAttack(t.frequency),t.playing=!0,console.log(`Started drone synth ${o} at ${t.frequency}Hz`)):t.isTick&&(t.playing=!0,t.lastTickTime=performance.now())})}async function qo(){return console.log("Starting spatial audio..."),!Ft&&!await ma()?(console.error("Failed to initialize audio"),!1):(Me.length===0&&oo(8),ht=!0,U.enabled=!0,Me.forEach((e,t)=>{!e.playing&&!e.isTick?(e.synth.triggerAttack(e.frequency),e.playing=!0,console.log(`Started drone synth ${t} at ${e.frequency}Hz`)):e.isTick&&(e.playing=!0,e.lastTickTime=performance.now(),console.log(`Tick synth ${t} ready at ${e.frequency}Hz`))}),!0)}function Vo(){ht=!1,U.enabled=!1,Me.forEach(e=>{if(e.playing){try{e.synth.triggerRelease()}catch{}e.playing=!1}}),console.log("Spatial audio stopped")}function _o(e,t){if(!ht||Me.length===0)return;let o=U.spatialSpread,{circleStep:n}=t,i=performance.now();e.forEach((a,r)=>{if(r>=Me.length)return;let s=Me[r],l=Math.cos(a.angle)*.8;if(s.panner&&(s.panner.pan.value=l),s.x=Math.cos(a.angle)*a.circle,s.y=a.circle,s.z=Math.sin(a.angle)*a.circle,s.isTick){let m=6e4/U.tickBPM*(1+r*.1);if(i-s.lastTickTime>=m){try{s.synth.triggerAttackRelease(s.frequency,"64n"),Bo&&Bo(),Rt=1,Oi=i,$o=Math.floor(Math.random()*ua)}catch(g){console.error("Tick error:",g)}s.lastTickTime=i}}else{let g=Math.sin(a.angle*2)*2;s.synth.volume.value=-6+g}})}function Ai(e,t){if(!(!K||!ht))try{let o=K.Listener;o.positionX.value=e.x||0,o.positionY.value=e.y||0,o.positionZ.value=e.z||0,t&&(o.forwardX.value=t.x||0,o.forwardY.value=t.y||0,o.forwardZ.value=t.z||-1)}catch{}}function Uo(e){U.masterVolume=e,to&&to.gain.rampTo(e,.1)}function Yo(e){U.reverbWet=e,It&&It.wet.rampTo(e,.1)}function Xo(e){U.spatialSpread=e}function Qo(){return ht}function $i(){return Ft}var Bo,Oi,Rt,$o,ua,K,Ft,ht,Me,to,It,da,fa,U,no=oe(()=>{Bo=null;Oi=0,Rt=0,$o=-1;ua=8;K=null,Ft=!1,ht=!1,Me=[],to=null,It=null,da=[55,65.41,73.42,82.41],fa=[440,523.25,659.25,783.99],U={enabled:!1,masterVolume:.5,reverbWet:.5,spatialSpread:15,tickBPM:60}});import*as ro from"three";function Wi(e,t,o,n,i,a,r,s,l,m,g){e.font=`${r}px OffBit, monospace`,e.fillStyle=s,e.textAlign="center",e.textBaseline="middle";let u=t.split(""),p=u.length*l,d=m?-1:1,h=a-p/2*d;for(let f of u){let S=o+Math.cos(h)*i,b=n+Math.sin(h)*i;e.save(),e.translate(S,b);let x=h+Math.PI/2;g&&(x+=Math.PI),e.rotate(x),e.fillText(f,0,0),e.restore(),h+=l*d}}function Ca(e,t,o,n,i,a,r,s,l=.08,m=!1,g=!1){let u=t.split(`
`),p=r*1.4,d=(u.length-1)*p;u.forEach((h,f)=>{let S=g?(f-(u.length-1)/2)*p:((u.length-1)/2-f)*p,b=i+S;Wi(e,h,o,n,b,a,r,s,l,m,g)})}function ba(e,t,o,n,i,a,r,s,l,m,g,u){let p=t.split(""),d=p.length,h=i*a,S=i*(a+1)-h,b=c.textVerticalOffset||.5,x=h+S*b,k=2*Math.PI/s,F=(c.globalFontSize||100)/100,I=S*l/100*F*.8;e.font=`${I}px OffBit, monospace`,e.textAlign="center",e.textBaseline="middle";let $=g?-1:1;for(let q=0;q<d;q++){let N=p[q];if(N===" ")continue;let z=(r+q*$+s)%s*k-Math.PI/2+k/2,w=o+Math.cos(z)*x,M=n+Math.sin(z)*x;e.save(),e.translate(w,M);let Wt=z+Math.PI/2;u&&(Wt+=Math.PI),e.rotate(Wt),e.globalCompositeOperation="difference",c.textShadow&&(e.shadowColor=c.textShadowColor,e.shadowBlur=c.textShadowBlur,e.shadowOffsetX=2,e.shadowOffsetY=2),c.textOutline&&(e.strokeStyle=c.textOutlineColor,e.lineWidth=c.textOutlineWidth,e.strokeText(N,0,0)),e.fillStyle=m,e.shadowBlur=0,e.fillText(N,0,0),e.restore()}}function Ko(e,t,o){return{r:e.r+(t.r-e.r)*o,g:e.g+(t.g-e.g)*o,b:e.b+(t.b-e.b)*o}}function ji(e,t,o,n,i,a,r,s,l=8){e.strokeStyle=s,e.lineWidth=.5;let m=(a+r)/2,g=(n+i)/2,p=(i-n)/l;for(let d=0;d<l;d++){let h=n+p*d+p/2;e.beginPath(),e.arc(t,o,h,a,r),e.stroke()}}function Gi(e,t,o,n,i,a,r,s,l=12){e.strokeStyle=s,e.lineWidth=.5;let m=(r-a)/l;for(let g=0;g<=l;g++){let u=a+m*g;e.beginPath(),e.moveTo(t+Math.cos(u)*n,o+Math.sin(u)*n),e.lineTo(t+Math.cos(u)*i,o+Math.sin(u)*i),e.stroke()}}function qi(e,t,o,n,i,a,r,s,l=5){let m=(a+r)/2,g=(n+i)/2,u=Math.min(i-n,(r-a)*g)/2,p=t+Math.cos(m)*g,d=o+Math.sin(m)*g;e.strokeStyle=s,e.lineWidth=.5;for(let h=1;h<=l;h++){let f=u/l*h;e.beginPath(),e.arc(p,d,f,0,Math.PI*2),e.stroke()}}function Vi(e,t,o,n,i,a,r,s,l=4){e.fillStyle=s;let m=(a+r)/2,g=r-a,u=i-n,p=Math.min(u,g*n)/(l*4);for(let d=0;d<l;d++)for(let h=0;h<l;h++){let f=n+u/l*(d+.5),S=a+g/l*(h+.5),b=t+Math.cos(S)*f,x=o+Math.sin(S)*f;e.beginPath(),e.arc(b,x,p,0,Math.PI*2),e.fill()}}function _i(e,t,o,n,i,a,r,s,l=24){let m=(a+r)/2,g=(n+i)/2,u=Math.min(i-n,(r-a)*g)/2,p=t+Math.cos(m)*g,d=o+Math.sin(m)*g;e.strokeStyle=s,e.lineWidth=.5;for(let h=0;h<l;h++){let f=Math.PI*2/l*h;e.beginPath(),e.moveTo(p+Math.cos(f)*(u*.2),d+Math.sin(f)*(u*.2)),e.lineTo(p+Math.cos(f)*u,d+Math.sin(f)*u),e.stroke()}}function Ui(e,t,o,n,i,a,r,s,l,m,g,u=0){let p=Math.sin(u)*.5+.5;switch(l){case"horizontal":ji(e,t,o,n,i,a,r,s,6+m);break;case"radial":Gi(e,t,o,n,i,a,r,s,8+g%4);break;case"concentric":qi(e,t,o,n,i,a,r,s,4+m%3);break;case"dots":Vi(e,t,o,n,i,a,r,s,3+m%2);break;case"sunburst":_i(e,t,o,n,i,a,r,s,16+m*2);break;case"diagonal":er(e,t,o,n,i,a,r,s,5,g%2?1:-1);break;case"gradient":let d=.3+p*.5;Ji(e,t,o,n,i,a,r,s,d,u);break;case"square":ha(e,t,o,n,i,a,r,s,!0);break;case"squareOutline":ha(e,t,o,n,i,a,r,s,!1);break;case"grayscale":Yi(e,t,o,n,i,a,r,g%2?"horizontal":"vertical");break;case"rainbow":Xi(e,t,o,n,i,a,r);break;case"checker":Zi(e,t,o,n,i,a,r,s);break}}function ha(e,t,o,n,i,a,r,s,l=!0){let m=(a+r)/2,g=(n+i)/2,u=Math.min(i-n,(r-a)*g)*.7,p=t+Math.cos(m)*g,d=o+Math.sin(m)*g;e.save(),e.translate(p,d),e.rotate(m+Math.PI/2),l?(e.fillStyle=s,e.fillRect(-u/2,-u/2,u,u),e.fillStyle="#000000",e.fillRect(-u/4,-u/4,u/2,u/2)):(e.strokeStyle=s,e.lineWidth=2,e.strokeRect(-u/2,-u/2,u,u)),e.restore()}function Yi(e,t,o,n,i,a,r,s="radial"){e.save(),e.beginPath(),e.arc(t,o,i,a,r),e.arc(t,o,n,r,a,!0),e.closePath(),e.clip();let l;if(s==="radial")l=e.createRadialGradient(t,o,n,t,o,i);else{let m=(a+r)/2,g=(n+i)/2,u=t+Math.cos(a)*g,p=o+Math.sin(a)*g,d=t+Math.cos(r)*g,h=o+Math.sin(r)*g;l=e.createLinearGradient(u,p,d,h)}l.addColorStop(0,"#ffffff"),l.addColorStop(.5,"#888888"),l.addColorStop(1,"#000000"),e.fillStyle=l,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.restore()}function Xi(e,t,o,n,i,a,r){e.save(),e.beginPath(),e.arc(t,o,i,a,r),e.arc(t,o,n,r,a,!0),e.closePath(),e.clip();let s=7,l=["#ff0000","#ff8800","#ffff00","#00ff00","#00ffff","#0000ff","#ff00ff"],m=(r-a)/s;for(let g=0;g<s;g++){let u=a+g*m,p=u+m;e.fillStyle=l[g],e.beginPath(),e.moveTo(t,o),e.arc(t,o,i*1.1,u,p),e.closePath(),e.fill()}e.restore()}function Qi(e,t,o,n,i,a,r,s,l=!0,m=.5){if(!t||!t.complete)return;e.save(),e.beginPath(),e.arc(o,n,a,r,s),e.arc(o,n,i,s,r,!0),e.closePath(),e.clip();let g=(r+s)/2,u=(i+a)/2,p=a-i,d=(s-r)*u,h=o+Math.cos(g)*u,f=n+Math.sin(g)*u,S=t.width/t.height,b=d/p,x,k;if(S>b?(k=p*1.4,x=k*S):(x=d*1.4,k=x/S),e.translate(h,f),e.rotate(g-Math.PI/2),e.scale(1,-1),l){let F=document.createElement("canvas"),I=Math.max(x,k)*1.5;F.width=I,F.height=I;let $=F.getContext("2d");$.drawImage(t,0,0,I,I);let q=$.getImageData(0,0,I,I),N=q.data,he=m*255;for(let z=0;z<N.length;z+=4){let M=N[z]*.299+N[z+1]*.587+N[z+2]*.114>he?255:0;N[z]=M,N[z+1]=M,N[z+2]=M}$.putImageData(q,0,0),e.drawImage(F,-x/2,-k/2,x,k)}else e.drawImage(t,-x/2,-k/2,x,k);e.restore()}function Ki(e){return ao.has(e)?Promise.resolve(ao.get(e)):new Promise((t,o)=>{let n=new Image;e.startsWith("http")&&!e.includes(window.location.hostname)&&(n.crossOrigin="anonymous"),n.onload=()=>{ao.set(e,n),t(n)},n.onerror=()=>{console.warn(`Failed to load image: ${e}`),t(null)},n.src=e})}async function Ea(){let e=Zo.map(t=>Ki(t).catch(()=>null));await Promise.all(e)}function Zi(e,t,o,n,i,a,r,s){let l=(a+r)/2,m=(n+i)/2,g=Math.min(i-n,(r-a)*m)*.8,u=t+Math.cos(l)*m,p=o+Math.sin(l)*m;e.save(),e.translate(u,p),e.rotate(l+Math.PI/2);let d=g/4;for(let h=0;h<4;h++)for(let f=0;f<4;f++)e.fillStyle=(h+f)%2===0?s:"#000000",e.fillRect(-g/2+f*d,-g/2+h*d,d,d);e.restore()}function Ji(e,t,o,n,i,a,r,s,l,m){let g=(a+r)/2,u=(n+i)/2,p=Math.sin(m)*.3,d=e.createRadialGradient(t+Math.cos(g)*u*p,o+Math.sin(g)*u*p,0,t,o,i),h=parseInt(s.slice(1,3),16),f=parseInt(s.slice(3,5),16),S=parseInt(s.slice(5,7),16);d.addColorStop(0,`rgba(${h}, ${f}, ${S}, ${l})`),d.addColorStop(1,`rgba(${h}, ${f}, ${S}, 0)`),e.fillStyle=d,e.beginPath(),e.arc(t,o,i,a,r),e.arc(t,o,n,r,a,!0),e.closePath(),e.fill()}function er(e,t,o,n,i,a,r,s,l=6,m=1){let g=(a+r)/2,u=(n+i)/2,p=(r-a)*u,d=i-n;e.save(),e.beginPath(),e.arc(t,o,i,a,r),e.arc(t,o,n,r,a,!0),e.closePath(),e.clip(),e.strokeStyle=s,e.lineWidth=.5;let h=t+Math.cos(g)*u,f=o+Math.sin(g)*u,S=Math.max(p,d)*1.5,b=S/l;for(let x=-l;x<=l;x++)e.beginPath(),e.moveTo(h-S/2+x*b,f-S/2),e.lineTo(h-S/2+x*b+S*m,f+S/2),e.stroke();e.restore()}function va(e=1024,t={}){let{backgroundColor:o="#000000",lineWidth:n=c.lineWidth||2,tickWidth:i=c.tickWidth||1,numCircles:a=8,numRadialLines:r=36,showLabels:s=!0,labelColor:l="#ffffff",fontSize:m=e/40,mainColor:g={r:.4,g:.45,b:.5},chairsColor:u={r:.55,g:.32,b:.38},floorColor:p={r:.65,g:.52,b:.25},curvedTexts:d=[]}=t;c.mainColor=g,c.chairsColor=u,c.floorColor=p;let h=document.createElement("canvas");h.width=e,h.height=e;let f=h.getContext("2d",{alpha:!1,willReadFrequently:!1});c.antialias?(f.imageSmoothingEnabled=!0,f.imageSmoothingQuality="high"):f.imageSmoothingEnabled=!1,f.lineCap="round",f.lineJoin="round";let S=e/2,b=e/2,x=e/2-m*2;f.fillStyle=o,f.fillRect(0,0,e,e);let k=P=>{let R=(P%360+360)%360;return R<120?Ko(g,u,R/120):R<240?Ko(u,p,(R-120)/120):Ko(p,g,(R-240)/120)},F=x/a,I=2*Math.PI/r,$=Math.floor((g.r+u.g+p.b)*1e3),q=(P,R)=>{let D=Math.sin($+P*127+R*311)*1e4;return D-Math.floor(D)},N=[],he=[];if(c.imageCellsEnabled){let P=Math.min(c.imageCellCount||12,Zo.length),R=new Set,D=c.imageThreshold,j=c.imageThresholdLevel||.5,te=[...Zo].sort(()=>Math.random()-.5);for(let V=0;V<Math.min(c.imageCellCount||12,te.length);V++){let ve=ao.get(te[V]);if(!ve)continue;let xe=Math.random(),X=1,we=1;xe>.7?(X=3,we=4+Math.floor(Math.random()*2)):xe>.4?(X=2+Math.floor(Math.random()*2),we=3+Math.floor(Math.random()*2)):(X=2,we=2+Math.floor(Math.random()*2));let Be=0,Ae=!1;for(;Be<100&&!Ae;){let at=1+Math.floor(Math.random()*Math.max(1,a-X)),jt=Math.floor(Math.random()*r);if(at+X>a){Be++;continue}let Gt=!0;for(let it=0;it<X&&Gt;it++)for(let rt=0;rt<we&&Gt;rt++){let Tt=`${at+it}-${(jt+rt)%r}`;R.has(Tt)&&(Gt=!1)}if(Gt){for(let Po=0;Po<X;Po++)for(let Ro=0;Ro<we;Ro++){let wi=`${at+Po}-${(jt+Ro)%r}`;R.add(wi)}let it=F*at,rt=F*(at+X),Tt=jt*I-Math.PI/2,ta=Tt+we*I;Qi(f,ve,S,b,it,rt,Tt,ta,D,j),he.push({imgIdx:V,ring:at,sector:jt,ringSpan:X,sectorSpan:we,innerRadius:it,outerRadius:rt,startAngle:Tt,endAngle:ta}),Ae=!0}Be++}}}let z=c.gridLineColor||"#ffffff";for(let P=1;P<=a;P++){let R=F*P;f.strokeStyle=z,f.lineWidth=n,f.beginPath(),f.arc(S,b,R,0,Math.PI*2),f.stroke()}let w=360/r,M=n*3;f.strokeStyle=z,f.lineWidth=n;for(let P=0;P<r;P++){let D=(P*w-90)*Math.PI/180,j=S+Math.cos(D)*M,te=b+Math.sin(D)*M,V=S+Math.cos(D)*x,ve=b+Math.sin(D)*x;f.beginPath(),f.moveTo(j,te),f.lineTo(V,ve),f.stroke()}let Wt=c.rimOffset||0,Mt=x*(1-Wt),ko=i;for(let P=0;P<360;P+=1){let R=(P-90)*Math.PI/180,D,j;P%10===0?(D=m*.5,j=ko*1.5):P%5===0?(D=m*.3,j=ko):(D=m*.15,j=ko*.5),f.strokeStyle=z,f.lineWidth=j,f.beginPath(),f.moveTo(S+Math.cos(R)*Mt,b+Math.sin(R)*Mt),f.lineTo(S+Math.cos(R)*(Mt+D),b+Math.sin(R)*(Mt+D)),f.stroke()}if(s){let P=c.labelsFlipX,R=c.labelsFlipY;f.font=`${m}px OffBit, monospace`,f.textAlign="center",f.textBaseline="middle";for(let j=0;j<360;j+=10){let te=(j-90)*Math.PI/180,V=Mt+m*1,ve=S+Math.cos(te)*V,xe=b+Math.sin(te)*V;f.fillStyle=l,f.font=`${m*.6}px OffBit, monospace`,f.save(),f.translate(ve,xe);let X=te+Math.PI/2;R&&(X+=Math.PI),f.rotate(X),P&&f.scale(-1,1),f.fillText(j.toString(),0,0),f.restore()}let D=[0,90,180,270];for(let j of D){let te=(j-90)*Math.PI/180;for(let V=1;V<a;V++){let xe=F*(a-V),X=S+Math.cos(te)*xe,we=b+Math.sin(te)*xe,Be=V*10;f.fillStyle=l,f.font=`${m*.35}px OffBit, monospace`,f.save(),f.translate(X,we);let Ae=te+Math.PI/2;R&&(Ae+=Math.PI),f.rotate(Ae),P&&f.scale(-1,1),f.textAlign="center",f.textBaseline="middle",f.fillText(Be.toString(),0,0),f.restore()}}f.textAlign="center"}let gi=f.getImageData(0,0,e,e);for(let P of d){let{text:R="",row:D=7,startSector:j=0,textFontSize:te=m,color:V=l,flipX:ve=!1,flipY:xe=!1,cellMode:X=!0}=P;if(X)ba(f,R,S,b,F,D,j,r,te,V,ve,xe);else{let we=x*(D/a),Be=(j*(360/r)-90)*Math.PI/180,Ae=P.letterSpacing||.08;Ca(f,R,S,b,we,Be,te,V,Ae,ve,xe)}}let hi=c.dotSize||4;f.fillStyle=l,f.beginPath(),f.arc(S,b,hi,0,Math.PI*2),f.fill();let nt=new ro.CanvasTexture(h);return nt.colorSpace=ro.SRGBColorSpace,nt.needsUpdate=!0,nt._polarGridCanvas=h,nt._polarGridCtx=f,nt._polarGridParams={centerX:S,centerY:b,maxRadius:x,circleStep:F,numCircles:a,numRadialLines:r,getColorAtAngle:k,cellPatterns:N,backgroundColor:o,baseImageWithoutText:gi,curvedTexts:d,labelColor:l,fontSize:m},nt}function tr(e,t,o,n){let i="";for(let a=0;a<e.length;a++){let r=e[a],s=t[a];if(!s||!s.active||r===" ")i+=r;else{let l=o-s.startTime;Math.min(l/n,1)>=1?(s.active=!1,i+=r):i+=Sa[Math.floor(Math.random()*Sa.length)]}}return i}function xa(){io++}function or(e){let t={},o=c.textScrambleDuration;for(;io>0&&c.textScrambleEnabled;){io--;let n=["text1","text2","text3","text4","text5"],i=n[Math.floor(Math.random()*n.length)],a=ya[i],r=c[`${i}Content`];a.chars.length!==r.length&&(a.chars=r.split("").map(()=>({active:!1,startTime:0})));let s=[];for(let l=0;l<r.length;l++)r[l]!==" "&&!a.chars[l].active&&s.push(l);if(s.length>0){let l=s[Math.floor(Math.random()*s.length)];a.chars[l].active=!0,a.chars[l].startTime=e}}return["text1","text2","text3","text4","text5"].forEach(n=>{let i=ya[n],a=c[`${n}Content`];i.chars.length!==a.length&&(i.chars=a.split("").map(()=>({active:!1,startTime:0}))),t[n]=tr(a,i.chars,e,o)}),t}function nr(e,t,o,n){let{centerX:i,centerY:a,circleStep:r,numCircles:s,numRadialLines:l,curvedTexts:m,labelColor:g,fontSize:u}=t;m&&m.forEach((p,d)=>{let{row:h=7,startSector:f=0,textFontSize:S=u,color:b=g,flipX:x=!1,flipY:k=!1,cellMode:F=!0}=p,I=`text${d+1}`,$=n&&n[I]?n[I]:p.text||"",q=(f+o+l)%l;if(F)ba(e,$,i,a,r,h,q,l,S,b,x,k);else{let N=t.maxRadius*(h/s),he=(q*(360/l)-90)*Math.PI/180,z=p.letterSpacing||.08;Ca(e,$,i,a,N,he,S,b,z,x,k)}})}function Ma(e,t){Ht=[];for(let o=0;o<e;o++)Ht.push({circle:Math.floor(Math.random()*t)+1,angle:Math.random()*Math.PI*2,speed:(.5+Math.random()*.5)*(Math.random()>.5?1:-1),size:.8+Math.random()*.4});jo(e),oo(e)}function ar(e,t,o,n){let{centerX:i,centerY:a,circleStep:r}=t,s=n&&!le(),l=No(),m=Wo();Ht.forEach((g,u)=>{let p=r*g.circle,d=i+Math.cos(g.angle)*p,h=a+Math.sin(g.angle)*p,f=o*g.size,b=u===m?l:0,x=1+b*1.5,k=f*x,F=.9+b*.1;if(s){let I=k*(3+b*2),$=e.createRadialGradient(d,h,0,d,h,I);$.addColorStop(0,`rgba(255, 255, 255, ${F})`),$.addColorStop(.5,`rgba(255, 255, 255, ${.4+b*.3})`),$.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=$,e.beginPath(),e.arc(d,h,I,0,Math.PI*2),e.fill()}e.fillStyle="#ffffff",e.beginPath(),e.arc(d,h,k,0,Math.PI*2),e.fill(),e.fillStyle="#ffffff",e.beginPath(),e.arc(d,h,k*.5,0,Math.PI*2),e.fill()}),Go()}function ir(e,t){for(let o of Ht)o.angle+=o.speed*t*e*.001,o.angle>Math.PI*2&&(o.angle-=Math.PI*2),o.angle<0&&(o.angle+=Math.PI*2)}function Jo(e){if(!e||!e._polarGridCanvas)return;Ue=e;let t=e._polarGridCanvas,o=e._polarGridCtx,n=e._polarGridParams;zt=o.getImageData(0,0,t.width,t.height),Ma(c.pulseCount,n.numCircles);let i=performance.now(),a=0;function r(s){if(le()&&s-ga<Ni){Re=requestAnimationFrame(r);return}ga=s;let l=c.pulsesEnabled,m=c.cellAnimationEnabled,g=c.textRotationEnabled,u=c.textScrambleEnabled;if(!l&&!m&&!g&&!u){o.putImageData(zt,0,0),e.needsUpdate=!0,Re=null;return}let p=s-i;if(i=s,a+=p*.001*c.cellAnimationSpeed,g){if(c.textStepRotation){let h=6e4/c.textRotationBPM;s-wa>=h&&(_e-=1,wa=s,u&&io++)}else _e+=c.textRotationSpeed*p*.001;for(;_e>=n.numRadialLines;)_e-=n.numRadialLines;for(;_e<0;)_e+=n.numRadialLines}let d=g||u;if(d&&n.baseImageWithoutText?o.putImageData(n.baseImageWithoutText,0,0):o.putImageData(zt,0,0),m&&n.cellPatterns)for(let h of n.cellPatterns){let f=a*2+h.phase;h.pattern==="gradient"&&Ui(o,n.centerX,n.centerY,h.innerRadius,h.outerRadius,h.startAngle,h.endAngle,h.colorHex,h.pattern,h.ring,h.sector,f)}if(d&&n.curvedTexts){let h=u?or(s):null;nr(o,n,_e,h)}l&&(ir(p,c.pulseSpeed),ar(o,n,c.pulseSize,c.pulseGlow),Qo()&&_o(Ht,n)),e.needsUpdate=!0,Re=requestAnimationFrame(r)}Re&&cancelAnimationFrame(Re),Re=requestAnimationFrame(r)}function en(){Re&&(cancelAnimationFrame(Re),Re=null),Ue&&zt&&(Ue._polarGridCtx.putImageData(zt,0,0),Ue.needsUpdate=!0)}function Ta(){Ue&&Ue._polarGridParams&&Ma(c.pulseCount,Ue._polarGridParams.numCircles)}var c,ga,Ni,ao,Zo,Ht,Re,Ue,zt,_e,wa,ya,Sa,io,La=oe(()=>{no();Ve();Ne();c={globalFontSize:100,text1Row:3,text1FlipX:!0,text1FlipY:!0,text1FontSize:100,text1StartSector:24,text1Content:"STHLM 7-9 MAY",text1CellMode:!0,text2Row:4,text2FlipX:!0,text2FlipY:!0,text2FontSize:100,text2StartSector:24,text2Content:"MALM\xD6  12 MAY",text2CellMode:!0,text3Row:5,text3FlipX:!0,text3FlipY:!0,text3FontSize:100,text3StartSector:24,text3Content:"DOME DREAMING",text3CellMode:!0,text4Row:6,text4FlipX:!0,text4FlipY:!0,text4FontSize:100,text4StartSector:28,text4Content:"FULLDOME FILM FESTIVAL",text4CellMode:!0,text5Row:7,text5FlipX:!0,text5FlipY:!0,text5FontSize:100,text5StartSector:27,text5Content:"OPEN CALL IS LIVE!",text5CellMode:!0,labelsFlipX:!1,labelsFlipY:!0,gridLineColor:"#ffffff",rimOffset:.02,lineWidth:2,tickWidth:1,antialias:!0,dotSize:4,pulsesEnabled:!0,pulseCount:8,pulseSpeed:.5,pulseSize:12,pulseGlow:!0,textRotationEnabled:!1,textRotationSpeed:-.3,textStepRotation:!0,textRotationBPM:30,textScrambleEnabled:!0,textScrambleChance:.08,textScrambleDuration:200,textOutline:!1,textOutlineColor:"#000000",textOutlineWidth:3,textShadow:!1,textShadowBlur:8,textShadowColor:"#000000",textVerticalOffset:.6,cellAnimationEnabled:!0,cellAnimationSpeed:.5,cellPatternDensity:.25,imageCellsEnabled:!1,imageCellCount:12,imageThreshold:!0,imageThresholdLevel:.5,mainColor:null,chairsColor:null,floorColor:null,regenerate:null},ga=0,Ni=33;ao=new Map;Zo=["assets/img/jpg/wisdome-stockholm-visuals.jpg","assets/img/jpg/wisdome-malmo-visuals.jpg","assets/img/jpg/untold-garden.jpg","assets/img/jpg/tiny-massive.jpg","assets/img/jpg/akiko-nakayama.jpg","assets/img/jpg/nordic-lights.jpg","assets/img/jpg/the-new-infinity.jpg","assets/img/jpg/baltic-analog-lab.jpg","assets/img/jpg/visualia.jpg","assets/img/jpeg/nam-june-paik-magnet-tv.jpeg","assets/img/jpg/rhythm-in-light-mary-ellen-bute.jpg","assets/img/png/movie-drome.png"];Ht=[],Re=null,Ue=null,zt=null,_e=0,wa=0,ya={text1:{chars:[]},text2:{chars:[]},text3:{chars:[]},text4:{chars:[]},text5:{chars:[]}},Sa="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%&*!?<>[]{}|/\\~";io=0});var ka={};ye(ka,{getToneMappingOptions:()=>un,lightingSettings:()=>C,setAmbientColor:()=>nn,setAmbientIntensity:()=>on,setDirectColor:()=>fn,setDirectIntensity:()=>dn,setDirectLightEnabled:()=>cn,setExposure:()=>lo,setFogColor:()=>rn,setFogEnabled:()=>an,setFogFar:()=>ln,setFogNear:()=>sn,setGradientEnd:()=>lr,setGradientStart:()=>sr,setSection1FadeStart:()=>mn,setSection2FadeEnd:()=>pn,setToneMapping:()=>so,setupLighting:()=>rr});import*as H from"three";function rr(){wt=new H.AmbientLight(C.ambientColor,C.ambientIntensity),T.add(wt),pe=new H.DirectionalLight(C.directColor,C.directIntensity),pe.position.set(5,10,5),C.directLightEnabled&&T.add(pe),C.fogEnabled&&(T.fog=new H.Fog(C.fogColor,C.fogNear,C.fogFar)),so(C.toneMapping),lo(C.exposure)}function on(e){C.ambientIntensity=e,wt&&(wt.intensity=e)}function nn(e){C.ambientColor=e,wt&&wt.color.set(e)}function an(e){C.fogEnabled=e,e?T.fog=new H.Fog(C.fogColor,C.fogNear,C.fogFar):T.fog=null}function rn(e){C.fogColor=e,T.fog&&T.fog.color.set(e)}function sn(e){C.fogNear=e,T.fog&&(T.fog.near=e)}function ln(e){C.fogFar=e,T.fog&&(T.fog.far=e)}function so(e){C.toneMapping=e,O&&tn[e]!==void 0&&(O.toneMapping=tn[e])}function lo(e){C.exposure=e,O&&(O.toneMappingExposure=e)}function cn(e){C.directLightEnabled=e,pe&&(e&&!pe.parent?T.add(pe):!e&&pe.parent&&T.remove(pe))}function dn(e){C.directIntensity=e,pe&&(pe.intensity=e)}function fn(e){C.directColor=e,pe&&pe.color.set(e)}function un(){return Object.keys(tn)}function sr(e){C.gradientStart=e,document.documentElement.style.setProperty("--bg-gradient-start",`${e}%`)}function lr(e){C.gradientEnd=e,document.documentElement.style.setProperty("--bg-gradient-end",`${e}%`)}function mn(e){C.section1FadeStart=e,document.documentElement.style.setProperty("--section1-fade-start",`${e}%`)}function pn(e){C.section2FadeEnd=e,document.documentElement.style.setProperty("--section2-fade-end",`${e}%`)}var C,tn,pe,wt,gn=oe(()=>{Ce();C={ambientIntensity:.5,ambientColor:"#ffffff",fogEnabled:!1,fogColor:"#1a1a1a",fogNear:20,fogFar:60,toneMapping:"Linear",exposure:1,directLightEnabled:!0,directIntensity:1,directColor:"#ffffff",gradientStart:20,gradientEnd:80,section1FadeStart:70,section2FadeEnd:30},tn={None:H.NoToneMapping,Linear:H.LinearToneMapping,Reinhard:H.ReinhardToneMapping,Cineon:H.CineonToneMapping,"ACES Filmic":H.ACESFilmicToneMapping,AgX:H.AgXToneMapping,Neutral:H.NeutralToneMapping},pe=null,wt=null});var Fa={};ye(Fa,{connectWebcam:()=>fr,disconnectWebcam:()=>ur,getCurrentImageTexture:()=>Cn,getCurrentVideo:()=>dr,getCurrentVideoTexture:()=>Sn,getScreenObject:()=>yn,loadDefaultScreenTexture:()=>fo,loadImage:()=>Ra,loadVideo:()=>Ia,regeneratePolarGridTexture:()=>E,setScreenObject:()=>co,setupDragAndDrop:()=>bn,setupPolarGridGUI:()=>Pa});import*as ge from"three";import cr from"lil-gui";function co(e){J=e}function yn(){return J}function Sn(){return re}function dr(){return B}function Cn(){return Z}function fo(e=yt.defaultImage||"assets/media/background.png"){return J?(Z&&(Z.dispose(),Z=null),new Promise(async t=>{await Ea();let o=window.savedColorSettings||{},n=o.Main_Structure||{r:.4,g:.45,b:.5},i=o.Chairs||{r:.55,g:.32,b:.38},a=o.Floor||{r:.65,g:.52,b:.25},r=le()?2048:4096,s=va(r,{backgroundColor:"#000000",numCircles:8,numRadialLines:36,showLabels:!0,labelColor:"#ffffff",mainColor:n,chairsColor:i,floorColor:a,curvedTexts:[{text:c.text1Content,row:c.text1Row,startSector:c.text1StartSector,textFontSize:c.text1FontSize,color:"#ffffff",flipX:c.text1FlipX,flipY:c.text1FlipY,cellMode:c.text1CellMode},{text:c.text2Content,row:c.text2Row,startSector:c.text2StartSector,textFontSize:c.text2FontSize,color:"#ffffff",flipX:c.text2FlipX,flipY:c.text2FlipY,cellMode:c.text2CellMode},{text:c.text3Content,row:c.text3Row,startSector:c.text3StartSector,textFontSize:c.text3FontSize,color:"#ffffff",flipX:c.text3FlipX,flipY:c.text3FlipY,cellMode:c.text3CellMode},{text:c.text4Content,row:c.text4Row,startSector:c.text4StartSector,textFontSize:c.text4FontSize,color:"#ffffff",flipX:c.text4FlipX,flipY:c.text4FlipY,cellMode:c.text4CellMode},{text:c.text5Content,row:c.text5Row,startSector:c.text5StartSector,textFontSize:c.text5FontSize,color:"#ffffff",flipX:c.text5FlipX,flipY:c.text5FlipY,cellMode:c.text5CellMode}]});lt(s),s.rotation=0,st(s,J),Z=s,Pa(),c.pulsesEnabled&&Jo(s),t(s)})):Promise.resolve()}function E(){J&&(en(),fo())}function hn(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16)/255,g:parseInt(t[2],16)/255,b:parseInt(t[3],16)/255}:null}async function wn(e,t){let o=await Promise.resolve().then(()=>(dt(),Dt)),{getMaterial:n}=await Promise.resolve().then(()=>(Ne(),oa));if(o.fbxMeshes){let i=o.fbxMeshes.find(a=>a.name===e);if(i){let a=n(i.mesh);a&&(a.color.setRGB(t.r,t.g,t.b),a.needsUpdate=!0)}}window.savedColorSettings||(window.savedColorSettings={}),window.savedColorSettings[e]=t}function Pa(){if(Y)return;Y=new cr({title:"Dome Dreaming"}),Y.domElement.style.position="fixed",Y.domElement.style.top="10px",Y.domElement.style.left="10px",Y.domElement.style.zIndex="99999",Y.domElement.style.display="none",window.addEventListener("keydown",w=>{if((w.metaKey||w.ctrlKey)&&w.key.toLowerCase()==="g"){w.preventDefault();let M=Y.domElement.style.display==="none";Y.domElement.style.display=M?"":"none"}});let e=Y.addFolder("Typography");e.add(c,"globalFontSize",50,200,5).name("Global Font Size %").onChange(()=>E());let t=e.addFolder("Text 1");t.add(c,"text1Content").name("Text").onChange(()=>E()),t.add(c,"text1Row",1,8,1).name("Row (Circle)").onChange(()=>E()),t.add(c,"text1StartSector",0,35,1).name("Start Sector").onChange(()=>E()),t.add(c,"text1FontSize",20,200,5).name("Font Size %").onChange(()=>E()),t.close();let o=e.addFolder("Text 2");o.add(c,"text2Content").name("Text").onChange(()=>E()),o.add(c,"text2Row",1,8,1).name("Row (Circle)").onChange(()=>E()),o.add(c,"text2StartSector",0,35,1).name("Start Sector").onChange(()=>E()),o.add(c,"text2FontSize",20,200,5).name("Font Size %").onChange(()=>E()),o.close();let n=e.addFolder("Text 3");n.add(c,"text3Content").name("Text").onChange(()=>E()),n.add(c,"text3Row",1,8,1).name("Row (Circle)").onChange(()=>E()),n.add(c,"text3StartSector",0,35,1).name("Start Sector").onChange(()=>E()),n.add(c,"text3FontSize",20,200,5).name("Font Size %").onChange(()=>E()),n.close();let i=e.addFolder("Text 4");i.add(c,"text4Content").name("Text").onChange(()=>E()),i.add(c,"text4Row",1,8,1).name("Row (Circle)").onChange(()=>E()),i.add(c,"text4StartSector",0,35,1).name("Start Sector").onChange(()=>E()),i.add(c,"text4FontSize",20,200,5).name("Font Size %").onChange(()=>E()),i.close();let a=e.addFolder("Text 5");a.add(c,"text5Content").name("Text").onChange(()=>E()),a.add(c,"text5Row",1,8,1).name("Row (Circle)").onChange(()=>E()),a.add(c,"text5StartSector",0,35,1).name("Start Sector").onChange(()=>E()),a.add(c,"text5FontSize",20,200,5).name("Font Size %").onChange(()=>E()),a.close();let r=e.addFolder("Style");r.add(c,"textOutline").name("Outline").onChange(()=>E()),r.addColor(c,"textOutlineColor").name("Outline Color").onChange(()=>E()),r.add(c,"textOutlineWidth",1,10,1).name("Outline Width").onChange(()=>E()),r.add(c,"textShadow").name("Shadow").onChange(()=>E()),r.add(c,"textShadowBlur",0,20,1).name("Shadow Blur").onChange(()=>E()),r.add(c,"textVerticalOffset",.1,.9,.05).name("Radial Position").onChange(()=>E()),r.close(),e.close();let s=Y.addFolder("Grid"),l=s.addFolder("Lines");l.addColor(c,"gridLineColor").name("Color").onChange(()=>E()),l.add(c,"lineWidth",.5,5,.5).name("Width").onChange(()=>E()),l.add(c,"tickWidth",.5,4,.5).name("Tick Width").onChange(()=>E()),l.add(c,"rimOffset",0,.2,.01).name("Rim Offset").onChange(()=>E()),l.add(c,"dotSize",1,20,1).name("Dot Size").onChange(()=>E()),l.close();let m=s.addFolder("Images");m.add(c,"imageCellsEnabled").name("Enable").onChange(()=>E()),m.add(c,"imageCellCount",1,12,1).name("Count").onChange(()=>E()),m.add(c,"imageThreshold").name("Threshold").onChange(()=>E()),m.add(c,"imageThresholdLevel",.2,.8,.05).name("Threshold Level").onChange(()=>E()),m.close();let g=s.addFolder("Rendering");g.add(c,"antialias").name("Antialiasing").onChange(()=>E()),g.close(),s.close();let u=Y.addFolder("Animation"),p=u.addFolder("Rotation");p.add(c,"textRotationEnabled").name("Rotate Text"),p.add(c,"textStepRotation").name("Step Mode (BPM)"),p.add(c,"textRotationBPM",10,120,5).name("Text BPM"),p.add(c,"textRotationSpeed",-2,2,.1).name("Continuous Speed"),p.add(ce,"enabled").name("Rotate Grid"),p.add(ce,"speed",-.1,.1,.005).name("Grid Speed"),p.close();let d=u.addFolder("Pulses");d.add(c,"pulsesEnabled").name("Enable").onChange(w=>{w&&Z?Jo(Z):en()}),d.add(c,"pulseCount",1,20,1).name("Count").onChange(()=>Ta()),d.add(c,"pulseSpeed",.1,2,.1).name("Speed"),d.add(c,"pulseSize",4,30,1).name("Size"),d.add(c,"pulseGlow").name("Glow"),d.close(),u.close();let h=Y.addFolder("Audio");h.add(U,"enabled").name("Enable Sound").onChange(async w=>{w?await qo():Vo()}),h.add(U,"masterVolume",0,1,.05).name("Volume").onChange(w=>Uo(w)),h.add(U,"tickBPM",20,180,5).name("Tick BPM"),h.add(U,"reverbWet",0,1,.05).name("Reverb").onChange(w=>Yo(w)),h.add(U,"spatialSpread",1,20,1).name("3D Spread").onChange(w=>Xo(w)),h.close();let f=Y.addFolder("Colors"),S={get mainColor(){let w=c.mainColor||{r:.4,g:.45,b:.5};return kt(w)},set mainColor(w){let M=hn(w);M&&(c.mainColor=M,window.savedColorSettings=window.savedColorSettings||{},window.savedColorSettings.Main_Structure=M,wn("Main_Structure",M),E())},get chairsColor(){let w=c.chairsColor||{r:.55,g:.32,b:.38};return kt(w)},set chairsColor(w){let M=hn(w);M&&(c.chairsColor=M,window.savedColorSettings=window.savedColorSettings||{},window.savedColorSettings.Chairs=M,wn("Chairs",M),E())},get floorColor(){let w=c.floorColor||{r:.65,g:.52,b:.25};return kt(w)},set floorColor(w){let M=hn(w);M&&(c.floorColor=M,window.savedColorSettings=window.savedColorSettings||{},window.savedColorSettings.Floor=M,wn("Floor",M),E())}};f.addColor(S,"mainColor").name("Main Structure"),f.addColor(S,"chairsColor").name("Chairs"),f.addColor(S,"floorColor").name("Floor"),f.add({randomize:()=>{En().then(()=>{E()})}},"randomize").name("Randomise Colors"),f.close();let b=Y.addFolder("Lighting"),x=b.addFolder("Exposure");x.add(C,"toneMapping",un()).name("Tone Mapping").onChange(w=>so(w)),x.add(C,"exposure",0,3,.1).name("Exposure").onChange(w=>lo(w)),x.close();let k=b.addFolder("Ambient");k.add(C,"ambientIntensity",0,2,.1).name("Intensity").onChange(w=>on(w)),k.addColor(C,"ambientColor").name("Color").onChange(w=>nn(w)),k.close();let F=b.addFolder("Direct Light");F.add(C,"directLightEnabled").name("Enable").onChange(w=>cn(w)),F.add(C,"directIntensity",0,5,.1).name("Intensity").onChange(w=>dn(w)),F.addColor(C,"directColor").name("Color").onChange(w=>fn(w)),F.close();let I=b.addFolder("Fog");I.add(C,"fogEnabled").name("Enable").onChange(w=>an(w)),I.addColor(C,"fogColor").name("Color").onChange(w=>rn(w)),I.add(C,"fogNear",1,50,1).name("Near").onChange(w=>sn(w)),I.add(C,"fogFar",20,100,5).name("Far").onChange(w=>ln(w)),I.close();let $=b.addFolder("Section Gradient");$.add(C,"section1FadeStart",0,100,5).name("Section 1 Fade %").onChange(w=>mn(w)),$.add(C,"section2FadeEnd",0,100,5).name("Section 2 Fade %").onChange(w=>pn(w)),$.close(),b.close();let q=Y.addFolder("Depth of Field");q.add(W,"enabled").name("Enable").onChange(w=>{let M=gt();M&&(M.enabled=w)}),q.add(W,"focus",.1,50,.1).name("Focus Distance").onChange(w=>{let M=gt();M&&(M.uniforms.focus.value=w)}),q.add(W,"aperture",0,.01,1e-4).name("Aperture").onChange(w=>{let M=gt();M&&(M.uniforms.aperture.value=w)}),q.add(W,"maxblur",0,.05,.001).name("Max Blur").onChange(w=>{let M=gt();M&&(M.uniforms.maxblur.value=w)}),q.open();let N=Y.addFolder("Camera"),he=N.addFolder("Position");he.add(y.position,"x",-20,20,.01).name("X").listen(),he.add(y.position,"y",-20,20,.01).name("Y").listen(),he.add(y.position,"z",-20,20,.01).name("Z").listen(),he.close();let z=N.addFolder("Rotation");z.add(y.rotation,"x",-Math.PI,Math.PI,.01).name("X").listen(),z.close(),N.close(),c.regenerate=E}function Ra(e){if(!J)return;let t=new FileReader;t.onload=o=>{new ge.TextureLoader().load(o.target.result,i=>{re&&(re.dispose(),re=null),B&&(B.pause(),B.src="",URL.revokeObjectURL(B.src),B=null),Z&&Z.dispose(),ce.enabled=!1,lt(i),i.rotation=0,st(i,J),Z=i;let a=ne(J);a&&setTimeout(()=>{Object.assign(a,ze),a.needsUpdate=!0},200)},void 0,()=>{})},t.readAsDataURL(e)}function Ia(e){if(!J)return;let t=document.createElement("video");t.src=URL.createObjectURL(e),t.crossOrigin="anonymous",t.loop=!0,t.muted=!0,t.playsInline=!0,t.addEventListener("loadedmetadata",()=>{t.play(),re&&re.dispose(),B&&(B.pause(),B.src="",URL.revokeObjectURL(B.src)),Z&&(Z.dispose(),Z=null),ce.enabled=!1;let o=new ge.VideoTexture(t);lt(o),o.minFilter=ge.LinearFilter,o.magFilter=ge.LinearFilter,o.rotation=0,st(o,J),re=o,B=t;let n=ne(J);n&&setTimeout(()=>{Object.assign(n,ze),n.needsUpdate=!0},200)}),t.addEventListener("error",()=>{})}function fr(){if(J){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){alert("Webcam access is not available in your browser.");return}navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(e=>{re&&(re.dispose(),re=null),B&&(B.pause(),B.srcObject=null,B=null),Z&&(Z.dispose(),Z=null),Ye&&(Ye.getTracks().forEach(o=>o.stop()),Ye=null),ce.enabled=!1;let t=document.createElement("video");t.srcObject=e,t.autoplay=!0,t.playsInline=!0,t.muted=!0,t.addEventListener("loadedmetadata",()=>{t.play();let o=new ge.VideoTexture(t);lt(o),o.minFilter=ge.LinearFilter,o.magFilter=ge.LinearFilter,o.rotation=0,st(o,J),re=o,B=t,Ye=e;let n=ne(J);n&&setTimeout(()=>{Object.assign(n,ze),n.needsUpdate=!0},200)}),t.addEventListener("error",()=>{alert("Error accessing webcam.")})}).catch(e=>{console.error("Error accessing webcam:",e),alert("Could not access webcam. Please check permissions.")})}}function ur(){Ye&&(Ye.getTracks().forEach(e=>e.stop()),Ye=null),re&&(re.dispose(),re=null),B&&(B.pause(),B.srcObject=null,B=null)}function bn(){let e=document.getElementById("drop-zone");function t(n){n.preventDefault(),n.stopPropagation()}function o(n){if(!J)return;let i=ne(J);i&&(n?(i.emissive=new ge.Color(38655),i.emissiveIntensity=.8):(Object.assign(i,ze),i.needsUpdate=!0))}document.addEventListener("dragenter",n=>{t(n),e.classList.add("drag-over"),o(!0)},!1),document.addEventListener("dragover",n=>{t(n),e.classList.add("drag-over"),o(!0)},!1),document.addEventListener("dragleave",n=>{t(n),n.clientX===0&&n.clientY===0&&(e.classList.remove("drag-over"),o(!1))},!1),document.addEventListener("drop",n=>{t(n),e.classList.remove("drag-over"),o(!1);let i=n.dataTransfer.files;if(i.length>0){let a=i[0];a.type.startsWith("image/")?Ra(a):a.type.startsWith("video/")&&Ia(a)}},!1)}var J,re,B,Z,Ye,Y,uo=oe(()=>{Ne();Lt();Pe();Ve();eo();Ce();La();no();gn();Ao(xa);J=null,re=null,B=null,Z=null,Ye=null;Y=null});import{GLTFLoader as mr}from"three/addons/loaders/GLTFLoader.js";import{init as pr,NavMeshQuery as za,importNavMesh as gr}from"@recast-navigation/core";import{threeToSoloNavMesh as hr}from"@recast-navigation/three";function Ha(){return Xe}async function Da(){if(!Bt)try{await pr(),Bt=!0,wr()}catch(e){console.error("Failed to initialize recast-navigation:",e),Bt=!0}}async function wr(){if(!Bt){await Da();return}try{let e=await fetch("assets/models/navmesh.bin");if(e.ok){let t=await e.arrayBuffer(),o=new Uint8Array(t),{navMesh:n}=gr(o);Xe=new za(n),Yt(Xe),console.log("Navmesh loaded from navmesh.bin"),ie&&xn();return}}catch{console.log("navmesh.bin not found, will generate from GLTF")}yr()}function yr(){new mr().load("assets/models/navmesh.gltf",async t=>{if(Ot=t.scene,Ot.scale.setScalar(1),Ot.visible=!1,Se(Ot,o=>{o.isMesh&&(vn.push(o),o.updateMatrixWorld())}),T.add(Ot),vn.length>0&&Bt){let{success:o,navMesh:n}=hr(vn,{cs:.05,ch:.05,walkableRadius:.2});o&&(Xe=new za(n),Yt(Xe),console.log("Navmesh generated from GLTF"))}},void 0,t=>{console.warn("Navmesh GLTF not found:",t)})}function xn(){if(!Xe||!ie)return;let e={x:y.position.x,y:y.position.y-fe,z:y.position.z},t=Xe.findClosestPoint(e,{halfExtents:$e});t.success&&(y.position.y=t.point.y+fe)}function Oa(){Da().catch(console.error)}var Bt,Ot,vn,Xe,Ba=oe(()=>{Ce();Lt();Ne();Xt();Pt();Bt=!1,Ot=null,vn=[],Xe=null});var Wa={};ye(Wa,{getScreenLight:()=>vr,initScreenLighting:()=>Mn,setColorSamplingEnabled:()=>Er,updateScreenLighting:()=>br});import*as Ee from"three";function Mn(e){return Sr=e,Te=new Ee.PointLight(16777215,2,30),Te.position.set(0,0,0),T.add(Te),Qe=new Ee.HemisphereLight(16777215,1710618,.8),Qe.position.set(0,5,0),T.add(Qe),be=new Ee.PointLight(16777215,1.5,25),be.position.set(0,0,0),T.add(be),{screenLight:Te,hemisphereLight:Qe,secondaryLight:be}}function $a(e){if(!e||!e.image)return null;let t=e.image,o=document.createElement("canvas"),n=o.getContext("2d"),i=64;o.width=i,o.height=i;try{n.drawImage(t,0,0,i,i);let r=n.getImageData(0,0,i,i).data,s=0,l=0,m=0,g=i*i;for(let u=0;u<r.length;u+=4)s+=r[u],l+=r[u+1],m+=r[u+2];return s/=g,l/=g,m/=g,new Ee.Color(s/255,l/255,m/255)}catch{return null}}function br(e){if(!Te||!Na||e-Aa<Cr)return;Aa=e;let t=null,o=Cn(),n=Sn();if(n&&n.image?t=$a(n):o&&(t=$a(o)),t){let i=t.clone();if(i.getHSL(Oe),Oe.s=Math.min(1,Oe.s*1.5),Oe.l=Math.min(1,Oe.l*1.2),i.setHSL(Oe.h,Oe.s,Oe.l),Te.color.copy(i),Te.intensity=3,Qe){let r=new Ee.Color().lerpColors(new Ee.Color(16777215),i,.6);Qe.color.copy(r),Qe.intensity=1.2}be&&(be.color.copy(i),be.intensity=2);let a=yn();if(a){let r=new Ee.Vector3;a.getWorldPosition(r),Te.position.copy(r),Te.position.z+=.5,be&&(be.position.copy(r),be.position.z+=.3,be.position.y+=.2)}}}function Er(e){Na=e}function vr(){return Te}var Te,Sr,Qe,be,Aa,Cr,Na,Oe,Tn=oe(()=>{Ce();uo();Te=null,Sr=null,Qe=null,be=null,Aa=0,Cr=100,Na=!0,Oe={h:0,s:0,l:0}});var Dt={};ye(Dt,{fbxMeshes:()=>mo,glbLights:()=>Ie,glbLightsGroup:()=>St,hotspots:()=>He,loadModel:()=>Tr,wisdomeModel:()=>ja});import*as L from"three";import{GLTFLoader as xr}from"three/addons/loaders/GLTFLoader.js";import{DRACOLoader as Mr}from"three/addons/loaders/DRACOLoader.js";function Tr(){let e=new xr,t=new Mr;t.setDecoderPath("https://cdn.jsdelivr.net/npm/three@0.181.0/examples/jsm/libs/draco/gltf/"),e.setDRACOLoader(t),e.load("assets/models/wisdome.glb",o=>{if(!o||!o.scene){console.error("GLB loaded but scene is missing");let d=document.getElementById("loading-overlay");d&&(d.innerHTML='<div style="color: #ff4444; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">Error: Model scene is missing.</div>');return}let n=o.scene;ja=n,n.scale.setScalar(1),n.position.set(0,0,0),qt(n),St=new L.Group,St.name="GLBLights";let i=()=>{Se(n,d=>{d.isLight&&(Ie.push(d),St.add(d))})};"requestIdleCallback"in window?requestIdleCallback(i,{timeout:100}):i(),Ie.length===0&&Se(n,d=>{(d instanceof L.Light||d instanceof L.DirectionalLight||d instanceof L.PointLight||d instanceof L.SpotLight||d instanceof L.RectAreaLight||d instanceof L.HemisphereLight)&&(Ie.includes(d)||(Ie.push(d),St.add(d)))}),Ie=Ie.filter(d=>!(d instanceof L.HemisphereLight)),Ie.length>0&&(T.add(St),Ie.forEach(d=>{d instanceof L.DirectionalLight?(d.intensity=3,d.position.set(2,15,5)):d instanceof L.PointLight?(d.intensity=0,d.visible=!1):d.intensity=0})),Se(n,d=>{d.name==="Hotspots"&&Se(d,h=>{if(h.name==="Hotspot.001"||h.name.includes("Hotspot")){let f=new L.Vector3;h.getWorldPosition(f),He.push({object:h,position:f,name:h.name,triggered:!1})}})}),Se(n,d=>{if(d.isMesh){let h=d.name.toLowerCase();if(h.includes("screen")||h.includes("display")||h.includes("monitor")||h.includes("panel")||h.includes("projection")||h.includes("canvas"))co(d),d.visible=!0;else{let f=ne(d),S=f?.color?f.color.clone():new L.Color(16777215);if(f){if(f.metalness!==void 0&&(f.metalness=Math.max(f.metalness||0,.1)),f.roughness!==void 0&&(f.roughness=Math.min(f.roughness||.5,.8)),f.map&&(f.map.colorSpace=L.SRGBColorSpace),f.isMeshBasicMaterial){let b=new L.MeshStandardMaterial({color:f.color,map:f.map,transparent:f.transparent,opacity:f.opacity,metalness:.1,roughness:.5});d.material=b,f=b}f.needsUpdate=!0}mo.push({mesh:d,name:d.name||"Unnamed",originalColor:S})}}});let a=!1;Se(n,d=>{d.isMesh&&d.name&&(d.name.toLowerCase().includes("screen")||d.name.toLowerCase().includes("display")||d.name.toLowerCase().includes("monitor")||d.name.toLowerCase().includes("panel")||d.name.toLowerCase().includes("projection")||d.name.toLowerCase().includes("canvas"))&&(a=!0)}),!a&&n&&n.children.length>0&&Se(n,d=>{d.isMesh&&!a&&(co(d),d.visible=!0,mo=mo.filter(h=>h.mesh!==d),a=!0)}),T.add(n);let r={x:0,y:5.4,z:-4.3},s={x:-2.9,y:0,z:3.121154018741333},l=Le,m=l&&l.y>1&&l.y<10?l:r,g=ke||s;y.position.set(m.x,m.y,m.z),y.rotation.set(g.x,g.y,g.z),y.updateMatrixWorld(),Q.set(g.x,g.y,g.z,"YXZ"),Do(!0),Ha()&&xn(),Oa(),bn();function p(){let d=document.getElementById("loading-overlay");d&&(d.classList.add("fade-out"),setTimeout(()=>{d.remove()},500));let h=document.getElementById("canvas-container"),f=document.getElementById("info-panel");h&&h.classList.add("loaded"),f&&f.classList.add("loaded")}Promise.all([Promise.resolve().then(()=>(Pe(),Qt)).then(d=>d.applySettingsToScene()),fo().catch(d=>(console.warn("Error loading default texture, continuing anyway:",d),null))]).then(()=>{setTimeout(()=>{let d=n.children.find(h=>{let f=h.name?.toLowerCase()||"";return f.includes("screen")||f.includes("monitor")||f.includes("panel")||f.includes("projection")||f.includes("canvas")});d&&Mn(d),p()},100)}).catch(d=>{console.error("Error during scene initialization:",d),setTimeout(p,1e3)})},void 0,o=>{console.error("Error loading 3D model:",o);let n=document.getElementById("loading-overlay");n&&(n.innerHTML='<div style="color: #ff4444; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">Error loading 3D model.</div>')})}var ja,mo,Ie,St,He,dt=oe(()=>{Ce();Ne();Pe();Pt();uo();Ba();Tn();ja=null,mo=[],Ie=[],St=null,He=[]});var Qt={};ye(Qt,{applyPageBackgrounds:()=>kn,applyPageColors:()=>Pn,applySettingsToScene:()=>Co,applyVignetteSettings:()=>Ir,bloomSettings:()=>G,cameraSettings:()=>me,canvasSettings:()=>yo,constants:()=>wo,currentCameraPosition:()=>Ke,currentCameraRotation:()=>Ze,dofSettings:()=>W,exportSettingsFile:()=>Ar,getRandomGeneratedColor:()=>zr,loadSettings:()=>So,moveSpeed:()=>qe,pageBackgroundSettings:()=>ee,pageColorSettings:()=>Fe,randomizeColors:()=>En,reloadFromJSON:()=>Or,resetToDefaultColors:()=>Br,saveSettings:()=>Rn,screenSettings:()=>yt,scrollSettings:()=>bt,setBloomSettings:()=>kr,setMoveSpeed:()=>Lr,startCameraPosition:()=>Le,startCameraRotation:()=>ke,textureRotationSettings:()=>ce});import"three";function Lr(e){qe=e}function kr(e,t,o){G.strength=e,G.radius=t,G.threshold=o}async function Pr(e=!1){try{let t="assets/js/core/default-settings.json",o=e?`${t}?t=${Date.now()}`:t,n=await fetch(o);if(!n.ok)return console.warn("Could not load default-settings.json, using hardcoded defaults"),!1;let i=await n.json();return i.constants&&(wo={...wo,...i.constants}),i.settings&&Rr(i.settings),!0}catch(t){return console.warn("Failed to load default settings from JSON:",t),!1}}function Rr(e){e.moveSpeed!==void 0&&(qe=e.moveSpeed),e.cameraSettings&&Object.assign(me,e.cameraSettings),e.startCameraPosition&&Object.assign(Le,e.startCameraPosition),e.startCameraRotation&&Object.assign(ke,e.startCameraRotation),e.colorSettings?window.savedColorSettings=e.colorSettings:window.savedColorSettings=null,e.lightSettings?window.savedLightSettings=e.lightSettings:window.savedLightSettings=null,e.bloomSettings&&Object.assign(G,e.bloomSettings),e.dofSettings&&Object.assign(W,e.dofSettings),e.pageColorSettings&&(e.pageColorSettings.vignette&&(Fe.vignette={...Fe.vignette,...e.pageColorSettings.vignette}),Object.assign(Fe,e.pageColorSettings),Fe.vignette||(Fe.vignette={enabled:!0,size:8,fadeWidth:2}),Pn()),e.scrollSettings&&Object.assign(bt,e.scrollSettings),e.canvasSettings&&Object.assign(yo,e.canvasSettings),e.screenSettings&&Object.assign(yt,e.screenSettings),e.textureRotationSettings&&Object.assign(ce,e.textureRotationSettings),e.pageBackgroundSettings&&(Object.assign(ee,e.pageBackgroundSettings),kn())}function Ga(e,t=.5){if(!e)return null;if(e.startsWith("rgba"))return e;if(e.startsWith("rgb")){let n=e.match(/\d+/g);if(n&&n.length>=3)return`rgba(${n[0]}, ${n[1]}, ${n[2]}, ${t})`}let o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(o){let n=parseInt(o[1],16),i=parseInt(o[2],16),a=parseInt(o[3],16);return`rgba(${n}, ${i}, ${a}, ${t})`}return e}function kn(){"requestIdleCallback"in window?requestIdleCallback(()=>{let e=document.querySelectorAll(".page-section");if(e.length>0&&e.length>1&&ee.team)for(let t=1;t<e.length;t++){let o=e[t];if(ee.team.backgroundColor&&ee.team.backgroundColor!=="#000000"){let n=Ga(ee.team.backgroundColor,.5);o.style.setProperty("background-color",n,"important")}else o.style.removeProperty("background-color");ee.team.backgroundImage?(o.style.setProperty("background-image",`url(${ee.team.backgroundImage})`,"important"),o.style.setProperty("background-size","cover","important"),o.style.setProperty("background-position","center","important"),o.style.setProperty("background-repeat","no-repeat","important")):o.style.removeProperty("background-image")}},{timeout:200}):setTimeout(()=>{let e=document.querySelectorAll(".page-section");if(e.length>0&&e.length>1&&ee.team)for(let t=1;t<e.length;t++){let o=e[t];if(ee.team.backgroundColor&&ee.team.backgroundColor!=="#000000"){let n=Ga(ee.team.backgroundColor,.5);o.style.setProperty("background-color",n,"important")}else o.style.removeProperty("background-color");ee.team.backgroundImage?(o.style.setProperty("background-image",`url(${ee.team.backgroundImage})`,"important"),o.style.setProperty("background-size","cover","important"),o.style.setProperty("background-position","center","important"),o.style.setProperty("background-repeat","no-repeat","important")):o.style.removeProperty("background-image")}},50)}function Ua(){let e=document.getElementById("canvas-container");if(!e)return;let t=Fe.vignette||{enabled:!0,size:8,fadeWidth:2};if(!t.enabled){e.style.maskImage="none",e.style.webkitMaskImage="none";return}let o=`${t.size}%`,n=`${t.size+t.fadeWidth}%`,i=`${t.size+t.fadeWidth*2}%`,a=`${100-t.size-t.fadeWidth*2}%`,r=`${100-t.size-t.fadeWidth}%`,s=`${100-t.size}%`,l=`linear-gradient(to right, transparent 0%, transparent ${o}, rgba(0, 0, 0, 0.5) ${n}, black ${i}, black ${a}, rgba(0, 0, 0, 0.5) ${r}, transparent ${s}, transparent 100%)`,m=`linear-gradient(to bottom, transparent 0%, transparent ${o}, rgba(0, 0, 0, 0.5) ${n}, black ${i}, black ${a}, rgba(0, 0, 0, 0.5) ${r}, transparent ${s}, transparent 100%)`;e.style.maskImage=`${l}, ${m}`,e.style.maskComposite="intersect",e.style.webkitMaskImage=`${l}, ${m}`,e.style.webkitMaskComposite="source-in"}function Pn(){Ua()}function Ir(){Ua()}async function So(e=!1){let t=await Pr(e);Pn(),kn()}function zr(){let e=Object.values(go).filter(t=>t!==null);return e.length===0?po.primary:e[Math.floor(Math.random()*e.length)]}function Hr(){let e=Math.floor(Math.random()*qa.length);return qa[e]}function ho(){let e=Math.floor(Math.random()*Va.length);return Va[e]}function Ln(){return ho()}function _a(e,t=.4){return{r:e.r*t,g:e.g*t,b:e.b*t}}function Dr(){let e=o=>{let n=Math.round(o.r*255),i=Math.round(o.g*255),a=Math.round(o.b*255);return`rgb(${n}, ${i}, ${a})`},t=o=>{let n=Math.round(o.r*255).toString(16).padStart(2,"0"),i=Math.round(o.g*255).toString(16).padStart(2,"0"),a=Math.round(o.b*255).toString(16).padStart(2,"0");return`#${n}${i}${a}`};Promise.resolve().then(()=>(dt(),Dt)).then(o=>{let n=null,i=null,a=null;if(o.fbxMeshes&&o.fbxMeshes.length>0){let m=o.fbxMeshes.find(p=>p.name==="Main_Structure");if(m){let p=ne(m.mesh);p&&p.color&&(n={r:p.color.r,g:p.color.g,b:p.color.b})}let g=o.fbxMeshes.find(p=>p.name==="Chairs");if(g){let p=ne(g.mesh);p&&p.color&&(i={r:p.color.r,g:p.color.g,b:p.color.b})}let u=o.fbxMeshes.find(p=>p.name==="Floor");if(u){let p=ne(u.mesh);p&&p.color&&(a={r:p.color.r,g:p.color.g,b:p.color.b})}}n||(n=window.savedColorSettings?.primary||window.savedColorSettings?.Main_Structure||Ln()),i||(i=window.savedColorSettings?.secondary||window.savedColorSettings?.Chairs||Ln()),a||(a=window.savedColorSettings?.tertiary||window.savedColorSettings?.Floor||Ln()),go.primary=n,go.secondary=i,go.tertiary=a,console.log("%c Color Palette ","background: #222; color: #fff; font-size: 14px; padding: 4px 8px;"),console.log(`  Primary:   ${t(n)}`),console.log(`  Secondary: ${t(i)}`),console.log(`  Tertiary:  ${t(a)}`);let r=n,s=_a(i,.6),l=_a(a,.6);Ct||(document.documentElement.style.setProperty("--color-primary",e(n)),document.documentElement.style.setProperty("--color-secondary",e(i)),document.documentElement.style.setProperty("--color-tertiary",e(a)),document.documentElement.style.setProperty("--bg-main-color",e(r)),document.documentElement.style.setProperty("--bg-floor-color",e(l)),document.documentElement.style.setProperty("--bg-chairs-color",e(s))),Promise.resolve().then(()=>(Ce(),Ho)).then(m=>{m.setSceneBackground(r)})})}async function Co(){window.savedColorSettings||(window.savedColorSettings={}),Promise.resolve().then(()=>(dt(),Dt)).then(e=>{if(e.fbxMeshes&&e.fbxMeshes.length>0){let n=function(){let i=Math.min(t+o,e.fbxMeshes.length);for(let a=t;a<i;a++){let r=e.fbxMeshes[a],s=ne(r.mesh);if(s){let l,m=Fr[r.name];r.name==="Main_Structure"?(l=Ct?po.primary:Hr(),window.savedColorSettings.primary=l,window.savedColorSettings[r.name]=l):r.name==="Chairs"?(l=Ct?po.secondary:ho(),window.savedColorSettings.secondary=l,window.savedColorSettings[r.name]=l):r.name==="Floor"?(l=Ct?po.tertiary:ho(),window.savedColorSettings.tertiary=l,window.savedColorSettings[r.name]=l):r.name==="Screen"?(l=ho(),window.savedColorSettings[r.name]=l):window.savedColorSettings[r.name]?l=window.savedColorSettings[r.name]:l=r.originalColor?{r:r.originalColor.r,g:r.originalColor.g,b:r.originalColor.b}:null,l&&(s.color.setRGB(l.r,l.g,l.b),s.needsUpdate=!0)}}t=i,t<e.fbxMeshes.length?"requestIdleCallback"in window?requestIdleCallback(n,{timeout:50}):setTimeout(n,0):setTimeout(()=>{Dr()},10)},t=0,o=5;n()}window.savedLightSettings&&e.glbLights&&("requestIdleCallback"in window?requestIdleCallback(()=>{e.glbLights.forEach((t,o)=>{let n=t.name||`light_${o}`;if(window.savedLightSettings[n]){let i=window.savedLightSettings[n];t.color.setRGB(i.r,i.g,i.b);let a=Math.max(0,Math.min(i.intensity??t.intensity,10));t.intensity=a}})},{timeout:100}):setTimeout(()=>{e.glbLights.forEach((t,o)=>{let n=t.name||`light_${o}`;if(window.savedLightSettings[n]){let i=window.savedLightSettings[n];t.color.setRGB(i.r,i.g,i.b);let a=Math.max(0,Math.min(i.intensity??t.intensity,10));t.intensity=a}})},50))}),Promise.resolve().then(()=>(eo(),Oo)).then(e=>{let t=e.getBloomPass();t&&(t.enabled=G.enabled!==!1,G.enabled?(t.strength=G.strength,t.radius=G.radius,t.threshold=G.threshold):t.strength=0);let o=e.getBokehPass();o&&(o.enabled=W.enabled!==!1,W.enabled&&(o.uniforms.focus.value=W.focus,o.uniforms.aperture.value=W.aperture,o.uniforms.maxblur.value=W.maxblur))})}async function Or(){await So(!0),await Co()}async function En(){Ct=!1,await Co()}async function Br(){Ct=!0,await Co()}function Rn(e,t){try{let o={};e&&Array.isArray(e)&&e.forEach((a,r)=>{let s=ne(a.mesh);if(s?.color){let l=a.name||`mesh_${r}`;o[l]={r:s.color.r,g:s.color.g,b:s.color.b}}});let n={};t&&Array.isArray(t)&&t.forEach((a,r)=>{let s=a.name||`light_${r}`;n[s]={r:a.color.r,g:a.color.g,b:a.color.b,intensity:a.intensity}});let i={moveSpeed:qe,cameraSettings:me,startCameraPosition:Le,startCameraRotation:ke,colorSettings:o,lightSettings:n,bloomSettings:G,dofSettings:W,pageColorSettings:Fe,scrollSettings:bt,canvasSettings:yo,screenSettings:yt,textureRotationSettings:ce,pageBackgroundSettings:ee}}catch(o){console.warn("Failed to collect settings:",o)}}function Ar(e,t){try{let o={};e.forEach((l,m)=>{let g=ne(l.mesh);if(g?.color){let u=l.name||`mesh_${m}`;o[u]={r:g.color.r,g:g.color.g,b:g.color.b}}});let n={};t.forEach((l,m)=>{let g=l.name||`light_${m}`;n[g]={r:l.color.r,g:l.color.g,b:l.color.b,intensity:l.intensity}});let i={version:"1.0.0",constants:wo,settings:{moveSpeed:qe,pageColorSettings:Fe,scrollSettings:bt,canvasSettings:yo,cameraSettings:me,startCameraPosition:Le,startCameraRotation:ke,bloomSettings:G,dofSettings:W,colorSettings:o,lightSettings:n,screenSettings:yt,textureRotationSettings:ce,pageBackgroundSettings:ee}},a=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),r=URL.createObjectURL(a),s=document.createElement("a");s.href=r,s.download="dome-dreaming-settings.json",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r)}catch(o){console.error("Failed to export settings file:",o)}}var wo,qe,me,Le,ke,Ke,Ze,G,W,Fe,bt,yo,yt,ce,ee,po,Fr,go,Ct,qa,Va,Pe=oe(()=>{Ne();wo={cameraHeight:1.6,navmeshSearchBox:{x:5,y:10,z:5},screenMaterialSettings:{emissive:[1,1,1],emissiveIntensity:1,color:[1,1,1],toneMapped:!1,transparent:!1,opacity:1}},qe=.04,me={sensitivity:.002,rotationSpeed:120},Le={x:0,y:5.4,z:-4.3},ke={x:-2.8,y:0,z:3.121154018741333},Ke={x:0,y:0,z:0},Ze={x:0,y:0,z:0},G={enabled:!0,strength:1.5,radius:.4,threshold:.85},W={enabled:!0,focus:12,aperture:.0014,maxblur:.05},Fe={backgroundColor:"#000000",textColor:"#ffffff",dotColor:"#ffffff",sidebarColor:"#333333",sidebarVisible:!0,headerIslandVisible:!1,blendMode:"normal",vignette:{enabled:!1,size:8,fadeWidth:2}},bt={enabled:!0,scrollTimeout:25,touchThreshold:30,snapThreshold:.5,initialSnapThreshold:1,gridColumns:16,gridRows:16},yo={rows:8},yt={defaultImage:"assets/img/jpg/background-dome-dreaming.jpg"},ce={enabled:!0,speed:.02},ee={canvas:{backgroundColor:"#000000",backgroundImage:null},about:{backgroundColor:"#463434",backgroundImage:null},team:{backgroundColor:"#000000",backgroundImage:null}};po={primary:{r:.4,g:.45,b:.5},secondary:{r:.55,g:.32,b:.38},tertiary:{r:.65,g:.52,b:.25}},Fr={Main_Structure:"primary",Chairs:"secondary",Floor:"tertiary"},go={primary:null,secondary:null,tertiary:null};Ct=!0,qa=[{r:.38,g:.42,b:.48},{r:.45,g:.48,b:.52},{r:.42,g:.45,b:.5},{r:.48,g:.45,b:.42}],Va=[{r:.55,g:.32,b:.38},{r:.65,g:.52,b:.25},{r:.45,g:.55,b:.42},{r:.6,g:.4,b:.32},{r:.4,g:.5,b:.58},{r:.48,g:.3,b:.45}]});Pe();Pe();Ve();var At=!1,Ya=0,$r=30,In=0,Nr=0,Hn=!1,Fn=0,Je=0;function Xa(e){let o=ft()*2;return Math.round(e/o)*o}function zn(){if(At)return;let e=window.pageYOffset||document.documentElement.scrollTop,t=Xa(e);Math.abs(e-t)>1&&(At=!0,window.scrollTo({top:t,behavior:"auto"}),setTimeout(()=>{At=!1},50))}function Wr(){if(At)return;let e=window.pageYOffset||document.documentElement.scrollTop,t=Xa(e),n=le()?5:1;Math.abs(e-t)>n&&zn()}function Qa(e){let t=Date.now();if(t-Ya<$r)return;let o=ft(),n=window.pageYOffset||document.documentElement.scrollTop,i=o*2;if(e!==0){let s=(Math.round(n/i)+e)*i,l=Math.max(document.body.scrollHeight-window.innerHeight,document.documentElement.scrollHeight-window.innerHeight),m=Math.max(0,Math.min(s,l));Math.abs(m-n)>1&&(Ya=t,window.scrollTo({top:m,behavior:"auto"}))}}function jr(e){if(document.body.classList.contains("dome-mode"))return;e.preventDefault();let t=e.deltaY,o=0;t>0?o=1:t<0&&(o=-1),o!==0&&Qa(o)}function Gr(e){if(document.body.classList.contains("dome-mode"))return;let t=e.target;t.closest("a")||t.closest("button")||t.tagName==="A"||t.tagName==="BUTTON"||e.touches.length===1&&(In=e.touches[0].clientY,Fn=In,Nr=Date.now(),Hn=!1,Je=0)}function qr(e){if(document.body.classList.contains("dome-mode"))return;let t=e.target;if(t.closest("a")||t.closest("button")||t.tagName==="A"||t.tagName==="BUTTON"||e.touches.length!==1)return;e.preventDefault();let o=e.touches[0].clientY,n=Fn-o,i=In-o;Math.abs(i)>10&&(Hn=!0),Je+=n,Fn=o;let s=ft()*2*.2;if(Math.abs(Je)>=s){let l=Je>0?1:-1;Qa(l),Je=Je%s}}function Vr(e){if(document.body.classList.contains("dome-mode"))return;let t=e.target;t.closest("a")||t.closest("button")||t.tagName==="A"||t.tagName==="BUTTON"||(e.preventDefault(),Hn=!1,Je=0)}function Dn(){if(!bt.enabled||document.body.classList.contains("dome-mode"))return;window.addEventListener("wheel",jr,{passive:!1}),document.addEventListener("touchstart",Gr,{passive:!1}),document.addEventListener("touchmove",qr,{passive:!1}),document.addEventListener("touchend",Vr,{passive:!1});let e=null;window.addEventListener("scroll",()=>{if(At)return;e&&clearTimeout(e),e=setTimeout(()=>{Wr(),e=null},30)},{passive:!0}),window.addEventListener("load",()=>{setTimeout(()=>{zn()},100)}),window.addEventListener("resize",()=>{setTimeout(()=>{zn()},100)})}var vt=null,Et=16,On=0,_r=0;function Ur(){let e=document.getElementById("dots");e&&e.remove(),vt=document.createElement("div"),vt.id="dots",document.body.appendChild(vt),Bn(),An()}function Bn(){let e=getComputedStyle(document.documentElement),t=document.documentElement.clientWidth||window.innerWidth,o=e.getPropertyValue("--col-width");o?On=parseFloat(o)||t/Et:On=t/Et;let n=e.getPropertyValue("--row-height"),i=parseFloat(n);_r=!isNaN(i)&&i>0?i:On}function An(){if(!vt)return;vt.innerHTML="";let t=16*Et,o=32,n=0;function i(){let a=Math.min(n+o,t);for(let r=n;r<a;r++){let s=Math.floor(r/Et),l=r%Et,m=document.createElement("div");m.className="dot",m.dataset.col=l+1,m.dataset.row=s+1,m.style.gridColumn=l+1,m.style.gridRow=s+1,m.style.pointerEvents="none";let g=l+1,u=s+1,p=g+(u-1)*Et;m.style.setProperty("--dot-delay",p),vt.appendChild(m)}n=a,n<t&&("requestIdleCallback"in window?requestIdleCallback(i,{timeout:50}):setTimeout(i,0))}i()}function $n(){Ur();let e,t=()=>{clearTimeout(e),e=setTimeout(()=>{Bn(),An()},150)};window.addEventListener("resize",t),window.addEventListener("orientationchange",()=>{setTimeout(()=>{Bn(),An()},300)})}function bo(e){document.querySelectorAll(".dashboard-block.active, .page-content .block.active").forEach(t=>{t.classList.remove("active")}),e.classList.add("active")}function Nn(){"requestIdleCallback"in window?requestIdleCallback(()=>{document.querySelectorAll(".dashboard-block").forEach(o=>{o.addEventListener("click",()=>{bo(o)})}),document.querySelectorAll(".page-content .block img").forEach(o=>{let n=o.closest(".block");n&&n.addEventListener("click",()=>{bo(n)})})},{timeout:200}):setTimeout(()=>{document.querySelectorAll(".dashboard-block").forEach(o=>{o.addEventListener("click",()=>{bo(o)})}),document.querySelectorAll(".page-content .block img").forEach(o=>{let n=o.closest(".block");n&&n.addEventListener("click",()=>{bo(n)})})},50)}Ve();function Wn(){let e=getComputedStyle(document.documentElement),t=parseFloat(e.getPropertyValue("--grid-rows"))||16,o=ft();document.querySelectorAll(".page-section").forEach(i=>{let a=i.querySelector(".block.responsive");if(!a)return;let r=i.style.height,s=i.style.minHeight,l=i.style.getPropertyValue("--section-grid-rows");i.style.height="auto",i.style.minHeight="auto",i.style.removeProperty("--section-grid-rows"),i.offsetHeight;let m=a.offsetHeight;i.style.height=r,i.style.minHeight=s,l&&i.style.setProperty("--section-grid-rows",l);let g=Math.ceil(m/o);g=Math.max(1,g),g=g+2,i.style.setProperty("--section-grid-rows",g.toString())})}function jn(){window.addEventListener("load",()=>{setTimeout(()=>{Wn()},100)});let e,t=()=>{clearTimeout(e),e=setTimeout(()=>{Wn()},100)};window.addEventListener("resize",t),window.addEventListener("orientationchange",t),window.visualViewport&&window.visualViewport.addEventListener("resize",t),(document.readyState==="complete"||document.readyState==="interactive")&&setTimeout(()=>{Wn()},100)}Ve();Ve();var A=null,tt=null,Gn=null,et=!1,Ka=!1;function Za(e){A=e}function Ja(e,t){Gn=e,tt=t}function qn(){let e=document.getElementById("keyboard-exit-btn"),t=document.body;function o(){e&&(t.classList.contains("dome-mode")?le()?(e.textContent="exit",e.style.display="flex"):e.style.display="none":(e.textContent="enter",e.style.display="flex",e.disabled=!1,e.style.pointerEvents="auto"))}function n(r=!1){if(t.classList.contains("dome-mode"))return;t.classList.add("dome-mode"),document.documentElement.style.overflow="hidden",o();let s=document.getElementById("canvas-container");if(s){let m=getComputedStyle(document.documentElement).getPropertyValue("--actual-vh");s.style.height=m||"100vh",s.style.width="100vw",setTimeout(()=>{window.dispatchEvent(new Event("resize"))},0)}let l=le();if(Ka=r&&!l,r&&A&&!l&&!(document.pointerLockElement===A||document.mozPointerLockElement===A||document.webkitPointerLockElement===A)){let g=setTimeout(()=>{if(!t.classList.contains("dome-mode")||et)return;let u=A.requestPointerLock||A.mozRequestPointerLock||A.webkitRequestPointerLock;if(u)try{u.call(A).catch(p=>{p.name!=="SecurityError"&&p.name!=="NotAllowedError"&&console.warn("Pointer lock request failed:",p)})}catch(p){p.name!=="SecurityError"&&p.name!=="NotAllowedError"&&console.warn("Pointer lock request failed:",p)}},100);window.pointerLockTimeout=g}setTimeout(()=>{window.setupCameraButton&&window.setupCameraButton()},150)}function i(){if(!et){if(et=!0,window.pointerLockTimeout&&(clearTimeout(window.pointerLockTimeout),window.pointerLockTimeout=null),A&&(document.pointerLockElement===A||document.mozPointerLockElement===A||document.webkitPointerLockElement===A))try{document.exitPointerLock()}catch(r){r.name!=="SecurityError"&&console.warn("Error exiting pointer lock:",r)}if(t.classList.contains("dome-mode")){t.classList.remove("dome-mode"),document.documentElement.style.overflow="auto";let r=document.getElementById("canvas-container");r&&(r.style.width=""),o(),setTimeout(()=>{window.setupCameraButton&&window.setupCameraButton(),setTimeout(()=>{et=!1},100)},0)}else et=!1}}window.enterDomeModeFromCanvas=()=>{n(!0)},window.enterDomeModeWithAudio=async()=>{if(n(!1),Gn)try{await Gn()}catch(r){console.warn("Could not start audio:",r)}},e&&(e.addEventListener("click",r=>{if(r.stopPropagation(),!t.classList.contains("dome-mode"))n(!0);else if(le()&&(i(),tt))try{tt()}catch(s){console.warn("Could not stop audio:",s)}}),e.addEventListener("touchend",r=>{if(r.stopPropagation(),r.preventDefault(),!t.classList.contains("dome-mode"))n(!0);else if(le()&&(i(),tt))try{tt()}catch(s){console.warn("Could not stop audio:",s)}})),o(),document.addEventListener("keydown",r=>{if(r.key==="Escape"&&t.classList.contains("dome-mode")&&(i(),tt))try{tt()}catch(s){console.warn("Could not stop audio:",s)}});function a(){if(et)return;let r=A&&(document.pointerLockElement===A||document.mozPointerLockElement===A||document.webkitPointerLockElement===A),s=le();!r&&t.classList.contains("dome-mode")&&!s&&Ka&&setTimeout(()=>{!et&&t.classList.contains("dome-mode")&&!(document.pointerLockElement===A||document.mozPointerLockElement===A||document.webkitPointerLockElement===A)&&i()},50)}document.addEventListener("pointerlockchange",a),document.addEventListener("mozpointerlockchange",a),document.addEventListener("webkitpointerlockchange",a)}var v=null;function ei(e){v=e}function ti(){document.querySelectorAll(".wasd-key-btn").forEach(t=>{let o=t.getAttribute("data-key");o&&(t.addEventListener("touchstart",n=>{n.preventDefault(),n.stopPropagation(),t.classList.add("active"),v&&(o==="w"&&(v.forward=!0),o==="s"&&(v.backward=!0),o==="a"&&(v.left=!0),o==="d"&&(v.right=!0),o==="q"&&(v.rotateLeft=!0),o==="e"&&(v.rotateRight=!0))}),t.addEventListener("touchend",n=>{n.preventDefault(),n.stopPropagation(),t.classList.remove("active"),v&&(o==="w"&&(v.forward=!1),o==="s"&&(v.backward=!1),o==="a"&&(v.left=!1),o==="d"&&(v.right=!1),o==="q"&&(v.rotateLeft=!1),o==="e"&&(v.rotateRight=!1))}),t.addEventListener("touchcancel",n=>{n.preventDefault(),n.stopPropagation(),t.classList.remove("active"),v&&(o==="w"&&(v.forward=!1),o==="s"&&(v.backward=!1),o==="a"&&(v.left=!1),o==="d"&&(v.right=!1),o==="q"&&(v.rotateLeft=!1),o==="e"&&(v.rotateRight=!1))}),t.addEventListener("mousedown",n=>{n.preventDefault(),n.stopPropagation(),t.classList.add("active"),v&&(o==="w"&&(v.forward=!0),o==="s"&&(v.backward=!0),o==="a"&&(v.left=!0),o==="d"&&(v.right=!0),o==="q"&&(v.rotateLeft=!0),o==="e"&&(v.rotateRight=!0))}),t.addEventListener("mouseup",n=>{n.preventDefault(),n.stopPropagation(),t.classList.remove("active"),v&&(o==="w"&&(v.forward=!1),o==="s"&&(v.backward=!1),o==="a"&&(v.left=!1),o==="d"&&(v.right=!1),o==="q"&&(v.rotateLeft=!1),o==="e"&&(v.rotateRight=!1))}),t.addEventListener("mouseleave",()=>{t.classList.remove("active"),v&&(o==="w"&&(v.forward=!1),o==="s"&&(v.backward=!1),o==="a"&&(v.left=!1),o==="d"&&(v.right=!1),o==="q"&&(v.rotateLeft=!1),o==="e"&&(v.rotateRight=!1))}),t.addEventListener("click",()=>{t.classList.remove("active")}))})}var Nt,Yr,de,Xr,oi,li,Vn,_n,ci,Un,di,$t,Yn,Xn,fi,ui,Eo,Qn,ot,vo,xo,Mo,To,Kn,ni,Zn,Jn,ai,ea=!1,Qr=null,Lo=0,ii=0,Kr=2e3;async function ri(){await new Promise(e=>{"scheduler"in window&&"postTask"in window.scheduler?window.scheduler.postTask(()=>e(),{priority:"user-blocking"}):"requestIdleCallback"in window?requestIdleCallback(()=>e(),{timeout:0}):setTimeout(()=>e(),0)}),await So(),await new Promise(e=>setTimeout(e,0)),"requestIdleCallback"in window?requestIdleCallback(()=>{Dn(),jn(),Nn()},{timeout:100}):setTimeout(()=>{Dn(),jn(),Nn()},0),"requestIdleCallback"in window?requestIdleCallback(()=>{$n()},{timeout:500}):setTimeout(()=>{$n()},50),"requestIdleCallback"in window?requestIdleCallback(()=>{si()},{timeout:100}):setTimeout(()=>{si()},0)}async function mi(){if(!ea)try{Nt=await import("three");let e=await Promise.resolve().then(()=>(Ce(),Ho)),t=await Promise.resolve().then(()=>(Pt(),ra)),o=await Promise.resolve().then(()=>(gn(),ka)),n=await Promise.resolve().then(()=>(eo(),Oo));Yr=e.scene,de=e.camera,Xr=e.renderer,oi=e.canvas,li=e.resetCamera,Vn=o.setupLighting,_n=n.initPostProcessing,ci=n.updatePostProcessing,Un=t.setupCameraControls,di=t.euler,Za(oi),ea=!0}catch(e){console.error("Error loading Three.js:",e)}}async function xt(){if(await mi(),!($t&&ot))try{let e=await Promise.resolve().then(()=>(dt(),Dt)),t=await Promise.resolve().then(()=>(Xt(),aa)),o=await Promise.resolve().then(()=>(uo(),Fa)),n=await Promise.resolve().then(()=>(Tn(),Wa)),i=await Promise.resolve().then(()=>(no(),pa));$t=e.loadModel,Yn=t.updateMovement,Xn=t.updateRotation,fi=e.fbxMeshes,ui=e.glbLights,Eo=o.getCurrentImageTexture,Qn=o.getCurrentVideoTexture,ot=o.connectWebcam,vo=o.loadImage,xo=o.loadVideo,Mo=o.disconnectWebcam,To=o.loadDefaultScreenTexture,Kn=n.updateScreenLighting,ni=t.touchMovement,Zn=i.updateListenerPosition,Jn=i.startAudio,ai=i.stopAudio,ei(ni),Ja(Jn,ai),window.loadModel=$t,window.connectWebcam=ot,window.loadImage=vo,window.loadVideo=xo,window.disconnectWebcam=Mo,window.loadDefaultScreenTexture=To}catch(e){console.error("Error loading 3D modules:",e)}}function si(){let e=null;function t(){return e||(e=document.createElement("input"),e.type="file",e.accept="image/*,video/*",e.style.display="none",document.body.appendChild(e),e.addEventListener("change",async u=>{let p=u.target.files?.[0];p&&((!vo||!xo)&&await xt(),p.type.startsWith("image/")?vo(p):p.type.startsWith("video/")&&xo(p)),e.value=""})),e}let o=document.getElementById("connect-webcam-link");o&&o.addEventListener("click",async u=>{u.preventDefault(),ot||await xt(),ot()});let n=document.getElementById("upload-file-link");n&&n.addEventListener("click",u=>{u.preventDefault(),t().click()});let i=document.getElementById("keyboard-upload-btn");i&&i.addEventListener("click",u=>{u.preventDefault(),u.stopPropagation(),t().click()}),window.resetToDefaults=async function(){try{(!Mo||!To)&&await xt(),Mo(),To(),li(Le,ke,di),Object.assign(Ke,Le),Object.assign(Ze,ke)}catch(u){console.error("Error during reset:",u)}};let a=!1;function r(){let u=document.getElementById("keyboard-reset-btn");if(u&&!a){let p=function(h){return h.preventDefault(),h.stopPropagation(),h.stopImmediatePropagation(),window.resetToDefaults&&window.resetToDefaults(),!1},d=u.cloneNode(!0);return u.parentNode.replaceChild(d,u),d.onclick=p,d.addEventListener("click",p,{capture:!0,passive:!1}),d.addEventListener("touchend",p,{capture:!0,passive:!1}),a=!0,!0}return!1}let s=async function(u){return u.preventDefault(),u.stopPropagation(),u.stopImmediatePropagation(),ot||await xt(),confirm("Do you want to connect your webcam to the screen?")&&ot(),!1};window.setupCameraButton=function(){let u=document.getElementById("keyboard-camera-btn");if(u){let p=u.cloneNode(!0);return u.parentNode.replaceChild(p,u),p.onclick=s,p.addEventListener("click",s,{capture:!0,passive:!1}),p.addEventListener("touchend",s,{capture:!0,passive:!1}),!0}return!1},r(),setupCameraButton(),setTimeout(()=>{document.getElementById("keyboard-reset-btn")||r(),document.getElementById("keyboard-camera-btn")||setupCameraButton()},500);let l=()=>{};window.addEventListener("resize",l),window.visualViewport&&window.visualViewport.addEventListener("resize",l),window.addEventListener("orientationchange",()=>{setTimeout(l,100)}),ti();let m=document.getElementById("enter-dome-link");m&&m.addEventListener("click",async u=>{u.preventDefault(),Jn||await xt(),window.enterDomeModeWithAudio&&window.enterDomeModeWithAudio()});let g=async()=>{await mi(),Vn&&Vn(),_n&&_n(),Un&&Un(),await xt(),$t&&($t(),Jr())};"requestIdleCallback"in window?requestIdleCallback(()=>g(),{timeout:2e3}):setTimeout(g,500)}function pi(e){if(Qr=requestAnimationFrame(pi),!ea||!de)return;let t=(e-Lo)/1e3;if(Lo=e,Yn&&Xn&&(Yn(),Xn(t)),Ke.x=de.position.x,Ke.y=de.position.y,Ke.z=de.position.z,Ze.x=de.rotation.x,Ze.y=de.rotation.y,Ze.z=de.rotation.z,e-ii>=Kr&&(Object.assign(Le,Ke),Object.assign(ke,Ze),Rn(fi,ui),ii=e),Eo&&Zr(t),Kn&&Kn(e),Zn&&Nt&&de){let n=new Nt.Vector3(0,0,-1);n.applyQuaternion(de.quaternion),Zn({x:de.position.x,y:de.position.y,z:de.position.z},{x:n.x,y:n.y,z:n.z})}ci()}function Zr(e){if(!ce.enabled||!Nt||!Eo)return;let t=Eo(),o=Qn?Qn():null,n=t||o;if(n)for((!n.center||n.center.x!==.5||n.center.y!==.5)&&(n.center?n.center.set(.5,.5):n.center=new Nt.Vector2(.5,.5)),n.rotation-=ce.speed*e;n.rotation<0;)n.rotation+=Math.PI*2}function Jr(){Lo=performance.now(),pi(Lo)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{ri(),qn()}):(ri(),qn());
