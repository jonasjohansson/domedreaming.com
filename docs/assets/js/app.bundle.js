var Li=Object.defineProperty;var K=(e,t)=>()=>(e&&(t=e(e=0)),t);var we=(e,t)=>{for(var o in t)Li(e,o,{get:t[o],enumerable:!0})};import*as Bo from"three";var de,Ge,He,It=K(()=>{de=1.6,Ge={x:5,y:10,z:5},He={emissive:new Bo.Color(16777215),emissiveIntensity:1,color:new Bo.Color(16777215),toneMapped:!1,transparent:!0,opacity:1}});var sa={};we(sa,{applyTextureToScreen:()=>ct,colorToHex:()=>ki,configureTexture:()=>dt,getMaterial:()=>ne,pruneObjectChildren:()=>_t,rgbToHex:()=>Ft,safeTraverse:()=>ye});import*as _ from"three";function ct(e,t){if(!t)return;let o=Array.isArray(t.material)?t.material[0]:t.material;if(!o){let n=new _.MeshStandardMaterial({map:e,...He,color:new _.Color(16777215),emissive:new _.Color(16777215),emissiveMap:e,emissiveIntensity:1});t.material=n;return}o.map&&o.map.dispose(),o.emissiveMap&&o.emissiveMap!==e&&o.emissiveMap.dispose(),o.map=e,o.emissiveMap=e,Object.assign(o,He),o.color.setRGB(1,1,1),o.emissive.setRGB(1,1,1),o.emissiveIntensity=1,o.needsUpdate=!0}function dt(e){e.flipY=!0,e.wrapS=_.RepeatWrapping,e.wrapT=_.RepeatWrapping,e.repeat.x=1,e.repeat.y=-1,e.colorSpace=_.SRGBColorSpace,e.center.set(.5,.5),e.minFilter=_.LinearMipmapLinearFilter,e.magFilter=_.LinearFilter,e.anisotropy=16,e.generateMipmaps=!0,e.needsUpdate=!0}function ne(e){return Array.isArray(e.material)?e.material[0]:e.material}function ki(e){return`#${Math.floor(e.r*255).toString(16).padStart(2,"0")}${Math.floor(e.g*255).toString(16).padStart(2,"0")}${Math.floor(e.b*255).toString(16).padStart(2,"0")}`}function Ft(e){let t=Math.round(e.r*255).toString(16).padStart(2,"0"),o=Math.round(e.g*255).toString(16).padStart(2,"0"),n=Math.round(e.b*255).toString(16).padStart(2,"0");return`#${t}${o}${n}`}function _t(e){!e||!e.children||(e.children=e.children.filter(Boolean),e.children.forEach(t=>_t(t)))}function ye(e,t){if(!e)return;let o=[e];for(;o.length;){let n=o.pop();if(n&&(t(n),n.children&&n.children.length))for(let i=n.children.length-1;i>=0;i--){let a=n.children[i];a&&typeof a.traverse=="function"?o.push(a):n.children.splice(i,1)}}}var Ss,Ne=K(()=>{It();Ss=[new _.Color(.4,.2,.6),new _.Color(.2,.5,.6),new _.Color(.7,.4,.2)]});var $o={};we($o,{camera:()=>y,canvas:()=>se,canvasContainer:()=>Oo,renderer:()=>B,resetCamera:()=>Ii,scene:()=>T,setResizeHandler:()=>Ao,setSceneBackground:()=>Ri});import*as ae from"three";function Ri(e){e&&typeof e=="object"?T.background=new ae.Color(e.r,e.g,e.b):typeof e=="string"&&(T.background=new ae.Color(e))}function la(){let e=Oo.getBoundingClientRect();return{width:e.width,height:e.height}}function Ao(e){window.removeEventListener("resize",Ut),Ut=e,window.addEventListener("resize",Ut)}function Ii(e,t,o){e&&y.position.set(e.x,e.y,e.z),t&&(y.rotation.set(t.x,t.y,t.z),y.updateMatrixWorld(),o&&o.set(t.x,t.y,t.z,"YXZ"))}var T,y,B,Oo,Yt,se,Ut,Se=K(()=>{T=new ae.Scene;T.background=new ae.Color(14211288);y=new ae.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);y.position.set(0,5.4,-4.3);y.rotation.set(-2.8,0,3.121154018741333);B=new ae.WebGLRenderer({antialias:!1,powerPreference:"high-performance",stencil:!1,depth:!0}),Oo=document.getElementById("canvas-container");Yt=la();B.setSize(Yt.width,Yt.height);B.setPixelRatio(Math.min(window.devicePixelRatio,1.5));y.aspect=Yt.width/Yt.height;y.updateProjectionMatrix();setTimeout(()=>{window.dispatchEvent(new Event("resize"))},100);B.shadowMap.enabled=!1;B.toneMapping=ae.NoToneMapping;B.outputColorSpace=ae.SRGBColorSpace;Oo.appendChild(B.domElement);se=B.domElement,Ut=()=>{let e=la();y.aspect=e.width/e.height,y.updateProjectionMatrix(),B.setSize(e.width,e.height),B.setPixelRatio(Math.min(window.devicePixelRatio,1.5))};window.addEventListener("resize",Ut)});var ca={};we(ca,{checkHotspots:()=>Di,constrainToNavmesh:()=>zi,setNavMeshQuery:()=>Qt,touchMovement:()=>We,updateMovement:()=>Fi,updateRotation:()=>Hi});import*as Xt from"three";function Qt(e){je=e}function Fi(){if(!ie)return;y.updateMatrixWorld();let e=new Xt.Vector3;e.setFromMatrixColumn(y.matrixWorld,2),e.multiplyScalar(-1).normalize();let t=new Xt.Vector3;t.setFromMatrixColumn(y.matrixWorld,0),t.normalize();let o=new Xt.Vector3,n=Ve;ue.w&&o.add(e.clone().multiplyScalar(n)),ue.s&&o.add(e.clone().multiplyScalar(-n)),ue.a&&o.add(t.clone().multiplyScalar(-n)),ue.d&&o.add(t.clone().multiplyScalar(n));let i=n*2;if(We.forward&&o.add(e.clone().multiplyScalar(i)),We.backward&&o.add(e.clone().multiplyScalar(-i)),We.left&&o.add(t.clone().multiplyScalar(-i)),We.right&&o.add(t.clone().multiplyScalar(i)),o.length()!==0)if(je){let a=y.position.clone();a.x+=o.x,a.z+=o.z;let r={x:a.x,y:a.y-de,z:a.z},s=je.findClosestPoint(r,{halfExtents:Ge});if(s.success)y.position.set(s.point.x,s.point.y+de,s.point.z);else{let l=je.findClosestPoint({x:a.x,y:y.position.y-de,z:y.position.z},{halfExtents:Ge});if(l.success)y.position.set(l.point.x,l.point.y+de,y.position.z);else{let m=je.findClosestPoint({x:y.position.x,y:y.position.y-de,z:a.z},{halfExtents:Ge});m.success&&y.position.set(y.position.x,m.point.y+de,m.point.z)}}}else y.position.add(o)}function zi(){if(!je)return;let e={x:y.position.x,y:y.position.y-de,z:y.position.z},t=je.findClosestPoint(e,{halfExtents:Ge});t.success&&(y.position.y=t.point.y+de)}function Hi(e){ue.q||ue.Q?qe(fe.rotationSpeed*(Math.PI/180)):ue.e||ue.E?qe(-fe.rotationSpeed*(Math.PI/180)):qe(0),ut!==0&&ie&&(Z.y+=ut*e,y.quaternion.setFromEuler(Z)),ie&&(We.rotateLeft&&(Z.y+=1.5*e,y.quaternion.setFromEuler(Z)),We.rotateRight&&(Z.y-=1.5*e,y.quaternion.setFromEuler(Z)))}function Di(){if(!ie||!De||De.length===0)return;let e=.4;for(let t=De.length-1;t>=0;t--){let o=De[t];if(!o||!o.object||o.triggered)continue;let n=y.position.x-o.position.x,i=y.position.z-o.position.z;if(Math.sqrt(n*n+i*i)<e){o.triggered=!0,o.object.parent&&o.object.parent.remove(o.object),De.splice(t,1),alert(""),console.log(`Hotspot ${o.name} triggered and removed`);break}}}var je,We,Kt=K(()=>{Se();It();Re();zt();ft();je=null,We={forward:!1,backward:!1,left:!1,right:!1,rotateLeft:!1,rotateRight:!1}});var ua={};we(ua,{euler:()=>Z,isPointerLocked:()=>Bi,isTouching:()=>Jt,keys:()=>ue,modelLoaded:()=>ie,qeRotationSpeed:()=>ut,setModelLoaded:()=>Go,setQeRotationSpeed:()=>qe,setupCameraControls:()=>Oi,touchStartX:()=>eo,touchStartY:()=>to});import*as da from"three";function Go(e){ie=e}function qe(e){ut=e}function Oi(){let e=!1,t=0,o=0;se.addEventListener("mousedown",a=>{ie&&(e=!0,t=a.clientX,o=a.clientY,se.style.cursor="grabbing")}),se.addEventListener("mousemove",a=>{if(!e||!ie)return;let r=a.clientX-t,s=a.clientY-o;Z.y-=r*fe.sensitivity,Z.x-=s*fe.sensitivity,y.quaternion.setFromEuler(Z),t=a.clientX,o=a.clientY}),se.addEventListener("mouseup",()=>{e=!1,se.style.cursor="default"}),se.addEventListener("mouseleave",()=>{e=!1,se.style.cursor="default"});let n=null;se.addEventListener("touchstart",a=>{if(ie&&(a.preventDefault(),a.touches.length===1&&n===null)){let r=a.touches[0];n=r.identifier,eo=r.clientX,to=r.clientY,Jt=!0}},{passive:!1}),se.addEventListener("touchmove",a=>{if(ie&&(a.preventDefault(),n!==null&&a.touches.length===1)){let r=Array.from(a.touches).find(s=>s.identifier===n);if(r){let s=r.clientX-eo,l=r.clientY-to;Z.y-=s*fe.sensitivity,Z.x-=l*fe.sensitivity,y.quaternion.setFromEuler(Z),eo=r.clientX,to=r.clientY}}},{passive:!1}),se.addEventListener("touchend",a=>{a.preventDefault();for(let r=0;r<a.changedTouches.length;r++)a.changedTouches[r].identifier===n&&(n=null,Jt=!1)},{passive:!1}),se.addEventListener("touchcancel",a=>{a.preventDefault();for(let r=0;r<a.changedTouches.length;r++)a.changedTouches[r].identifier===n&&(n=null,Jt=!1)},{passive:!1});function i(a,r){let s=a.toLowerCase();["q","w","a","s","d","e"].includes(s)&&document.querySelectorAll(`[data-key="${s}"]`).forEach(m=>{r?m.classList.add("active"):m.classList.remove("active")})}window.addEventListener("keydown",a=>{let r=a.key.toLowerCase();ue[r]=!0,i(a.key,!0),(a.key==="c"||a.key==="C")&&(console.log("Camera Position:",y.position),console.log("Camera Rotation:",y.rotation)),(a.key==="q"||a.key==="Q")&&qe(1.5),(a.key==="e"||a.key==="E")&&qe(-1.5)}),window.addEventListener("keyup",a=>{let r=a.key.toLowerCase();ue[r]=!1,i(a.key,!1),(a.key==="q"||a.key==="Q"||a.key==="e"||a.key==="E")&&(ut=0)})}var Bi,Jt,Z,ie,eo,to,ue,ut,zt=K(()=>{Se();Re();Kt();Bi=!1,Jt=!1,Z=new da.Euler(-2.85,0,3.121154018741333,"YXZ"),ie=!1,eo=0,to=0,ue={},ut=0});function xe(){return/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||"ontouchstart"in window||navigator.maxTouchPoints>0}function Ai(){return window.visualViewport&&window.visualViewport.height?window.visualViewport.height:document.documentElement.clientHeight||window.innerHeight}function mt(){let e=getComputedStyle(document.documentElement),t=e.getPropertyValue("--row-height"),o=parseFloat(t);if(!isNaN(o)&&o>0)return o;let n=parseFloat(e.getPropertyValue("--grid-rows"))||16;return Ai()/n}var _e=K(()=>{});var No={};we(No,{getBloomPass:()=>Vi,getBokehPass:()=>wt,initPostProcessing:()=>Wi,resizePostProcessing:()=>pa,updatePostProcessing:()=>qi});import*as ht from"three";import{EffectComposer as $i}from"three/addons/postprocessing/EffectComposer.js";import{RenderPass as Gi}from"three/addons/postprocessing/RenderPass.js";import{UnrealBloomPass as Ni}from"three/addons/postprocessing/UnrealBloomPass.js";import{BokehPass as ji}from"three/addons/postprocessing/BokehPass.js";import"three/addons/postprocessing/OutputPass.js";import"three/addons/postprocessing/FXAAPass.js";function Wi(){let t=document.getElementById("canvas-container").getBoundingClientRect(),o=new ht.Vector2(t.width,t.height),n=new ht.WebGLRenderTarget(o.width,o.height,{type:ht.HalfFloatType,samples:0});Be=new $i(B,n),fa=new Gi(T,y),Be.addPass(fa);let i=W.enabled!==!1?W.strength:0;pt=new Ni(o,i,W.radius,W.threshold),pt.enabled=W.enabled!==!1,Be.addPass(pt),gt=new ji(T,y,{focus:N.focus,aperture:N.aperture,maxblur:N.maxblur}),gt.enabled=N.enabled!==!1,Be.addPass(gt),Ao(()=>{let r=document.getElementById("canvas-container").getBoundingClientRect(),s=r.width,l=r.height;y.aspect=s/l,y.updateProjectionMatrix(),B.setSize(s,l),B.setPixelRatio(Math.min(window.devicePixelRatio,1.5)),pa()}),console.log("Post-processing initialized")}function qi(){Be?Be.render():B.render(T,y)}function pa(){if(Be){let t=document.getElementById("canvas-container").getBoundingClientRect(),o=t.width,n=t.height;Be.setSize(o,n),pt&&pt.setSize(o,n),gt&&gt.setSize(o,n),ma&&ma.setSize(o,n)}}function Vi(){return pt}function wt(){return gt}var Be,fa,pt,gt,ma,oo=K(()=>{Se();Re();Be=null,fa=null,pt=null,gt=null,ma=null});var Sa={};we(Sa,{audioSettings:()=>U,createPulseSynths:()=>ao,getActivePulseIndex:()=>_o,getTickIntensity:()=>Vo,initAudio:()=>ya,isAudioEnabled:()=>tn,isAudioInitialized:()=>Xi,setMasterVolume:()=>Zo,setReverbWet:()=>Jo,setScrambleTrigger:()=>Wo,setSpatialSpread:()=>en,setTotalPulseCount:()=>Uo,startAudio:()=>Xo,stopAudio:()=>Qo,updateListenerPosition:()=>Yi,updatePulseAudio:()=>Ko,updateTickIntensity:()=>Yo});function Wo(e){jo=e}function Vo(){return Ht}function _o(){return qo}function Uo(e){wa=e}function Yo(){Ht=Math.max(0,Ht-.15),Ht<=0&&(qo=-1)}async function Ui(){return J||(window.Tone?(J=window.Tone,J):new Promise((e,t)=>{let o=document.createElement("script");o.src="https://cdn.jsdelivr.net/npm/tone@14.7.77/build/Tone.js",o.onload=()=>{J=window.Tone,console.log("Tone.js loaded for spatial audio"),e(J)},o.onerror=t,document.head.appendChild(o)}))}async function ya(){if(Bt)return!0;try{return await Ui(),J?(await J.start(),console.log("Spatial audio context started"),Dt=new J.Reverb({decay:6,wet:U.reverbWet}).toDestination(),await Dt.generate(),no=new J.Gain(U.masterVolume).connect(Dt),Bt=!0,!0):!1}catch(e){return console.error("Error initializing spatial audio:",e),!1}}function ao(e){if(!J||!Bt){console.log("Cannot create synths - audio not initialized");return}Me.forEach(t=>{try{t.synth.dispose(),t.panner&&t.panner.dispose(),t.panner3d&&t.panner3d.dispose()}catch{}}),Me=[];for(let t=0;t<e;t++){let o=new J.Panner(0).connect(no),n=t%2===1,i;n?i=new J.Synth({oscillator:{type:"triangle"},envelope:{attack:.001,decay:.15,sustain:0,release:.1},volume:-6}).connect(o):i=new J.Synth({oscillator:{type:"triangle"},envelope:{attack:2,decay:.5,sustain:.7,release:2},volume:0}).connect(o),Me.push({synth:i,panner:o,playing:!1,frequency:n?ha[Math.floor(t/2)%ha.length]:ga[Math.floor(t/2)%ga.length],isTick:n,lastTickTime:0,tickInterval:6e4/U.tickBPM*(1+t*.25),x:0,y:0,z:0})}console.log(`Created ${e} spatial synths`),yt&&Me.forEach((t,o)=>{!t.playing&&!t.isTick?(t.synth.triggerAttack(t.frequency),t.playing=!0,console.log(`Started drone synth ${o} at ${t.frequency}Hz`)):t.isTick&&(t.playing=!0,t.lastTickTime=performance.now())})}async function Xo(){return console.log("Starting spatial audio..."),!Bt&&!await ya()?(console.error("Failed to initialize audio"),!1):(Me.length===0&&ao(8),yt=!0,U.enabled=!0,Me.forEach((e,t)=>{!e.playing&&!e.isTick?(e.synth.triggerAttack(e.frequency),e.playing=!0,console.log(`Started drone synth ${t} at ${e.frequency}Hz`)):e.isTick&&(e.playing=!0,e.lastTickTime=performance.now(),console.log(`Tick synth ${t} ready at ${e.frequency}Hz`))}),!0)}function Qo(){yt=!1,U.enabled=!1,Me.forEach(e=>{if(e.playing){try{e.synth.triggerRelease()}catch{}e.playing=!1}}),console.log("Spatial audio stopped")}function Ko(e,t){if(!yt||Me.length===0)return;let o=U.spatialSpread,{circleStep:n}=t,i=performance.now();e.forEach((a,r)=>{if(r>=Me.length)return;let s=Me[r],l=Math.cos(a.angle)*.8;if(s.panner&&(s.panner.pan.value=l),s.x=Math.cos(a.angle)*a.circle,s.y=a.circle,s.z=Math.sin(a.angle)*a.circle,s.isTick){let m=6e4/U.tickBPM*(1+r*.1);if(i-s.lastTickTime>=m){try{s.synth.triggerAttackRelease(s.frequency,"64n"),jo&&jo(),Ht=1,_i=i,qo=Math.floor(Math.random()*wa)}catch(p){console.error("Tick error:",p)}s.lastTickTime=i}}else{let p=Math.sin(a.angle*2)*2;s.synth.volume.value=-6+p}})}function Yi(e,t){if(!(!J||!yt))try{let o=J.Listener;o.positionX.value=e.x||0,o.positionY.value=e.y||0,o.positionZ.value=e.z||0,t&&(o.forwardX.value=t.x||0,o.forwardY.value=t.y||0,o.forwardZ.value=t.z||-1)}catch{}}function Zo(e){U.masterVolume=e,no&&no.gain.rampTo(e,.1)}function Jo(e){U.reverbWet=e,Dt&&Dt.wet.rampTo(e,.1)}function en(e){U.spatialSpread=e}function tn(){return yt}function Xi(){return Bt}var jo,_i,Ht,qo,wa,J,Bt,yt,Me,no,Dt,ga,ha,U,io=K(()=>{jo=null;_i=0,Ht=0,qo=-1;wa=8;J=null,Bt=!1,yt=!1,Me=[],no=null,Dt=null,ga=[55,65.41,73.42,82.41],ha=[440,523.25,659.25,783.99],U={enabled:!1,masterVolume:.5,reverbWet:.5,spatialSpread:15,tickBPM:60}});import*as lo from"three";function Ki(e,t,o,n,i,a,r,s,l,m,p){e.font=`${r}px OffBit, monospace`,e.fillStyle=s,e.textAlign="center",e.textBaseline="middle";let f=t.split(""),g=f.length*l,u=m?-1:1,h=a-g/2*u;for(let c of f){let S=o+Math.cos(h)*i,b=n+Math.sin(h)*i;e.save(),e.translate(S,b);let x=h+Math.PI/2;p&&(x+=Math.PI),e.rotate(x),e.fillText(c,0,0),e.restore(),h+=l*u}}function Ma(e,t,o,n,i,a,r,s,l=.08,m=!1,p=!1){let f=t.split(`
`),g=r*1.4,u=(f.length-1)*g;f.forEach((h,c)=>{let S=p?(c-(f.length-1)/2)*g:((f.length-1)/2-c)*g,b=i+S;Ki(e,h,o,n,b,a,r,s,l,m,p)})}function Ta(e,t,o,n,i,a,r,s,l,m,p,f){let g=t.split(""),u=g.length,h=i*a,S=i*(a+1)-h,b=d.textVerticalOffset||.5,x=h+S*b,L=2*Math.PI/s,F=(d.globalFontSize||100)/100,I=S*l/100*F*.8;e.font=`${I}px OffBit, monospace`,e.textAlign="center",e.textBaseline="middle";let $=p?-1:1;for(let q=0;q<u;q++){let G=g[q];if(G===" ")continue;let z=(r+q*$+s)%s*L-Math.PI/2+L/2,w=o+Math.cos(z)*x,M=n+Math.sin(z)*x;e.save(),e.translate(w,M);let Wt=z+Math.PI/2;f&&(Wt+=Math.PI),e.rotate(Wt),e.globalCompositeOperation="difference",d.textShadow&&(e.shadowColor=d.textShadowColor,e.shadowBlur=d.textShadowBlur,e.shadowOffsetX=2,e.shadowOffsetY=2),d.textOutline&&(e.strokeStyle=d.textOutlineColor,e.lineWidth=d.textOutlineWidth,e.strokeText(G,0,0)),e.fillStyle=m,e.shadowBlur=0,e.fillText(G,0,0),e.restore()}}function on(e,t,o){return{r:e.r+(t.r-e.r)*o,g:e.g+(t.g-e.g)*o,b:e.b+(t.b-e.b)*o}}function Zi(e,t,o,n,i,a,r,s,l=8){e.strokeStyle=s,e.lineWidth=.5;let m=(a+r)/2,p=(n+i)/2,g=(i-n)/l;for(let u=0;u<l;u++){let h=n+g*u+g/2;e.beginPath(),e.arc(t,o,h,a,r),e.stroke()}}function Ji(e,t,o,n,i,a,r,s,l=12){e.strokeStyle=s,e.lineWidth=.5;let m=(r-a)/l;for(let p=0;p<=l;p++){let f=a+m*p;e.beginPath(),e.moveTo(t+Math.cos(f)*n,o+Math.sin(f)*n),e.lineTo(t+Math.cos(f)*i,o+Math.sin(f)*i),e.stroke()}}function er(e,t,o,n,i,a,r,s,l=5){let m=(a+r)/2,p=(n+i)/2,f=Math.min(i-n,(r-a)*p)/2,g=t+Math.cos(m)*p,u=o+Math.sin(m)*p;e.strokeStyle=s,e.lineWidth=.5;for(let h=1;h<=l;h++){let c=f/l*h;e.beginPath(),e.arc(g,u,c,0,Math.PI*2),e.stroke()}}function tr(e,t,o,n,i,a,r,s,l=4){e.fillStyle=s;let m=(a+r)/2,p=r-a,f=i-n,g=Math.min(f,p*n)/(l*4);for(let u=0;u<l;u++)for(let h=0;h<l;h++){let c=n+f/l*(u+.5),S=a+p/l*(h+.5),b=t+Math.cos(S)*c,x=o+Math.sin(S)*c;e.beginPath(),e.arc(b,x,g,0,Math.PI*2),e.fill()}}function or(e,t,o,n,i,a,r,s,l=24){let m=(a+r)/2,p=(n+i)/2,f=Math.min(i-n,(r-a)*p)/2,g=t+Math.cos(m)*p,u=o+Math.sin(m)*p;e.strokeStyle=s,e.lineWidth=.5;for(let h=0;h<l;h++){let c=Math.PI*2/l*h;e.beginPath(),e.moveTo(g+Math.cos(c)*(f*.2),u+Math.sin(c)*(f*.2)),e.lineTo(g+Math.cos(c)*f,u+Math.sin(c)*f),e.stroke()}}function nr(e,t,o,n,i,a,r,s,l,m,p,f=0){let g=Math.sin(f)*.5+.5;switch(l){case"horizontal":Zi(e,t,o,n,i,a,r,s,6+m);break;case"radial":Ji(e,t,o,n,i,a,r,s,8+p%4);break;case"concentric":er(e,t,o,n,i,a,r,s,4+m%3);break;case"dots":tr(e,t,o,n,i,a,r,s,3+m%2);break;case"sunburst":or(e,t,o,n,i,a,r,s,16+m*2);break;case"diagonal":dr(e,t,o,n,i,a,r,s,5,p%2?1:-1);break;case"gradient":let u=.3+g*.5;cr(e,t,o,n,i,a,r,s,u,f);break;case"square":ba(e,t,o,n,i,a,r,s,!0);break;case"squareOutline":ba(e,t,o,n,i,a,r,s,!1);break;case"grayscale":ar(e,t,o,n,i,a,r,p%2?"horizontal":"vertical");break;case"rainbow":ir(e,t,o,n,i,a,r);break;case"checker":lr(e,t,o,n,i,a,r,s);break}}function ba(e,t,o,n,i,a,r,s,l=!0){let m=(a+r)/2,p=(n+i)/2,f=Math.min(i-n,(r-a)*p)*.7,g=t+Math.cos(m)*p,u=o+Math.sin(m)*p;e.save(),e.translate(g,u),e.rotate(m+Math.PI/2),l?(e.fillStyle=s,e.fillRect(-f/2,-f/2,f,f),e.fillStyle="#000000",e.fillRect(-f/4,-f/4,f/2,f/2)):(e.strokeStyle=s,e.lineWidth=2,e.strokeRect(-f/2,-f/2,f,f)),e.restore()}function ar(e,t,o,n,i,a,r,s="radial"){e.save(),e.beginPath(),e.arc(t,o,i,a,r),e.arc(t,o,n,r,a,!0),e.closePath(),e.clip();let l;if(s==="radial")l=e.createRadialGradient(t,o,n,t,o,i);else{let m=(a+r)/2,p=(n+i)/2,f=t+Math.cos(a)*p,g=o+Math.sin(a)*p,u=t+Math.cos(r)*p,h=o+Math.sin(r)*p;l=e.createLinearGradient(f,g,u,h)}l.addColorStop(0,"#ffffff"),l.addColorStop(.5,"#888888"),l.addColorStop(1,"#000000"),e.fillStyle=l,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.restore()}function ir(e,t,o,n,i,a,r){e.save(),e.beginPath(),e.arc(t,o,i,a,r),e.arc(t,o,n,r,a,!0),e.closePath(),e.clip();let s=7,l=["#ff0000","#ff8800","#ffff00","#00ff00","#00ffff","#0000ff","#ff00ff"],m=(r-a)/s;for(let p=0;p<s;p++){let f=a+p*m,g=f+m;e.fillStyle=l[p],e.beginPath(),e.moveTo(t,o),e.arc(t,o,i*1.1,f,g),e.closePath(),e.fill()}e.restore()}function rr(e,t,o,n,i,a,r,s,l=!0,m=.5){if(!t||!t.complete)return;e.save(),e.beginPath(),e.arc(o,n,a,r,s),e.arc(o,n,i,s,r,!0),e.closePath(),e.clip();let p=(r+s)/2,f=(i+a)/2,g=a-i,u=(s-r)*f,h=o+Math.cos(p)*f,c=n+Math.sin(p)*f,S=t.width/t.height,b=u/g,x,L;if(S>b?(L=g*1.4,x=L*S):(x=u*1.4,L=x/S),e.translate(h,c),e.rotate(p-Math.PI/2),e.scale(1,-1),l){let F=document.createElement("canvas"),I=Math.max(x,L)*1.5;F.width=I,F.height=I;let $=F.getContext("2d");$.drawImage(t,0,0,I,I);let q=$.getImageData(0,0,I,I),G=q.data,ge=m*255;for(let z=0;z<G.length;z+=4){let M=G[z]*.299+G[z+1]*.587+G[z+2]*.114>ge?255:0;G[z]=M,G[z+1]=M,G[z+2]=M}$.putImageData(q,0,0),e.drawImage(F,-x/2,-L/2,x,L)}else e.drawImage(t,-x/2,-L/2,x,L);e.restore()}function sr(e){return ro.has(e)?Promise.resolve(ro.get(e)):new Promise((t,o)=>{let n=new Image;e.startsWith("http")&&!e.includes(window.location.hostname)&&(n.crossOrigin="anonymous"),n.onload=()=>{ro.set(e,n),t(n)},n.onerror=()=>{console.warn(`Failed to load image: ${e}`),t(null)},n.src=e})}async function Pa(){let e=an.map(t=>sr(t).catch(()=>null));await Promise.all(e)}function lr(e,t,o,n,i,a,r,s){let l=(a+r)/2,m=(n+i)/2,p=Math.min(i-n,(r-a)*m)*.8,f=t+Math.cos(l)*m,g=o+Math.sin(l)*m;e.save(),e.translate(f,g),e.rotate(l+Math.PI/2);let u=p/4;for(let h=0;h<4;h++)for(let c=0;c<4;c++)e.fillStyle=(h+c)%2===0?s:"#000000",e.fillRect(-p/2+c*u,-p/2+h*u,u,u);e.restore()}function cr(e,t,o,n,i,a,r,s,l,m){let p=(a+r)/2,f=(n+i)/2,g=Math.sin(m)*.3,u=e.createRadialGradient(t+Math.cos(p)*f*g,o+Math.sin(p)*f*g,0,t,o,i),h=parseInt(s.slice(1,3),16),c=parseInt(s.slice(3,5),16),S=parseInt(s.slice(5,7),16);u.addColorStop(0,`rgba(${h}, ${c}, ${S}, ${l})`),u.addColorStop(1,`rgba(${h}, ${c}, ${S}, 0)`),e.fillStyle=u,e.beginPath(),e.arc(t,o,i,a,r),e.arc(t,o,n,r,a,!0),e.closePath(),e.fill()}function dr(e,t,o,n,i,a,r,s,l=6,m=1){let p=(a+r)/2,f=(n+i)/2,g=(r-a)*f,u=i-n;e.save(),e.beginPath(),e.arc(t,o,i,a,r),e.arc(t,o,n,r,a,!0),e.closePath(),e.clip(),e.strokeStyle=s,e.lineWidth=.5;let h=t+Math.cos(p)*f,c=o+Math.sin(p)*f,S=Math.max(g,u)*1.5,b=S/l;for(let x=-l;x<=l;x++)e.beginPath(),e.moveTo(h-S/2+x*b,c-S/2),e.lineTo(h-S/2+x*b+S*m,c+S/2),e.stroke();e.restore()}function La(e=1024,t={}){let{backgroundColor:o="#000000",lineWidth:n=d.lineWidth||2,tickWidth:i=d.tickWidth||1,numCircles:a=8,numRadialLines:r=36,showLabels:s=!0,labelColor:l="#ffffff",fontSize:m=e/40,mainColor:p={r:.4,g:.45,b:.5},chairsColor:f={r:.55,g:.32,b:.38},floorColor:g={r:.65,g:.52,b:.25},curvedTexts:u=[]}=t;d.mainColor=p,d.chairsColor=f,d.floorColor=g;let h=document.createElement("canvas");h.width=e,h.height=e;let c=h.getContext("2d",{alpha:!1,willReadFrequently:!1});d.antialias?(c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high"):c.imageSmoothingEnabled=!1,c.lineCap="round",c.lineJoin="round";let S=e/2,b=e/2,x=e/2-m*2;c.fillStyle=o,c.fillRect(0,0,e,e);let L=k=>{let R=(k%360+360)%360;return R<120?on(p,f,R/120):R<240?on(f,g,(R-120)/120):on(g,p,(R-240)/120)},F=x/a,I=2*Math.PI/r,$=Math.floor((p.r+f.g+g.b)*1e3),q=(k,R)=>{let D=Math.sin($+k*127+R*311)*1e4;return D-Math.floor(D)},G=[],ge=[];if(d.imageCellsEnabled){let k=Math.min(d.imageCellCount||12,an.length),R=new Set,D=d.imageThreshold,j=d.imageThresholdLevel||.5,oe=[...an].sort(()=>Math.random()-.5);for(let V=0;V<Math.min(d.imageCellCount||12,oe.length);V++){let Ee=ro.get(oe[V]);if(!Ee)continue;let ve=Math.random(),Q=1,he=1;ve>.7?(Q=3,he=4+Math.floor(Math.random()*2)):ve>.4?(Q=2+Math.floor(Math.random()*2),he=3+Math.floor(Math.random()*2)):(Q=2,he=2+Math.floor(Math.random()*2));let Ae=0,$e=!1;for(;Ae<100&&!$e;){let rt=1+Math.floor(Math.random()*Math.max(1,a-Q)),qt=Math.floor(Math.random()*r);if(rt+Q>a){Ae++;continue}let Vt=!0;for(let st=0;st<Q&&Vt;st++)for(let lt=0;lt<he&&Vt;lt++){let Rt=`${rt+st}-${(qt+lt)%r}`;R.has(Rt)&&(Vt=!1)}if(Vt){for(let Ho=0;Ho<Q;Ho++)for(let Do=0;Do<he;Do++){let Pi=`${rt+Ho}-${(qt+Do)%r}`;R.add(Pi)}let st=F*rt,lt=F*(rt+Q),Rt=qt*I-Math.PI/2,ra=Rt+he*I;rr(c,Ee,S,b,st,lt,Rt,ra,D,j),ge.push({imgIdx:V,ring:rt,sector:qt,ringSpan:Q,sectorSpan:he,innerRadius:st,outerRadius:lt,startAngle:Rt,endAngle:ra}),$e=!0}Ae++}}}let z=d.gridLineColor||"#ffffff";for(let k=1;k<=a;k++){let R=F*k;c.strokeStyle=z,c.lineWidth=n,c.beginPath(),c.arc(S,b,R,0,Math.PI*2),c.stroke()}let w=360/r,M=n*3;c.strokeStyle=z,c.lineWidth=n;for(let k=0;k<r;k++){let D=(k*w-90)*Math.PI/180,j=S+Math.cos(D)*M,oe=b+Math.sin(D)*M,V=S+Math.cos(D)*x,Ee=b+Math.sin(D)*x;c.beginPath(),c.moveTo(j,oe),c.lineTo(V,Ee),c.stroke()}let Wt=d.rimOffset||0,kt=x*(1-Wt),zo=i;for(let k=0;k<360;k+=1){let R=(k-90)*Math.PI/180,D,j;k%10===0?(D=m*.5,j=zo*1.5):k%5===0?(D=m*.3,j=zo):(D=m*.15,j=zo*.5),c.strokeStyle=z,c.lineWidth=j,c.beginPath(),c.moveTo(S+Math.cos(R)*kt,b+Math.sin(R)*kt),c.lineTo(S+Math.cos(R)*(kt+D),b+Math.sin(R)*(kt+D)),c.stroke()}if(s){let k=d.labelsFlipX,R=d.labelsFlipY;c.font=`${m}px OffBit, monospace`,c.textAlign="center",c.textBaseline="middle";for(let j=0;j<360;j+=10){let oe=(j-90)*Math.PI/180,V=kt+m*1,Ee=S+Math.cos(oe)*V,ve=b+Math.sin(oe)*V;c.fillStyle=l,c.font=`${m*.6}px OffBit, monospace`,c.save(),c.translate(Ee,ve);let Q=oe+Math.PI/2;R&&(Q+=Math.PI),c.rotate(Q),k&&c.scale(-1,1),c.fillText(j.toString(),0,0),c.restore()}let D=[0,90,180,270];for(let j of D){let oe=(j-90)*Math.PI/180;for(let V=1;V<a;V++){let ve=F*(a-V),Q=S+Math.cos(oe)*ve,he=b+Math.sin(oe)*ve,Ae=V*10;c.fillStyle=l,c.font=`${m*.35}px OffBit, monospace`,c.save(),c.translate(Q,he);let $e=oe+Math.PI/2;R&&($e+=Math.PI),c.rotate($e),k&&c.scale(-1,1),c.textAlign="center",c.textBaseline="middle",c.fillText(Ae.toString(),0,0),c.restore()}}c.textAlign="center"}let Mi=c.getImageData(0,0,e,e);for(let k of u){let{text:R="",row:D=7,startSector:j=0,textFontSize:oe=m,color:V=l,flipX:Ee=!1,flipY:ve=!1,cellMode:Q=!0}=k;if(Q)Ta(c,R,S,b,F,D,j,r,oe,V,Ee,ve);else{let he=x*(D/a),Ae=(j*(360/r)-90)*Math.PI/180,$e=k.letterSpacing||.08;Ma(c,R,S,b,he,Ae,oe,V,$e,Ee,ve)}}let Ti=d.dotSize||4;c.fillStyle=l,c.beginPath(),c.arc(S,b,Ti,0,Math.PI*2),c.fill();let it=new lo.CanvasTexture(h);return it.colorSpace=lo.SRGBColorSpace,it.needsUpdate=!0,it._polarGridCanvas=h,it._polarGridCtx=c,it._polarGridParams={centerX:S,centerY:b,maxRadius:x,circleStep:F,numCircles:a,numRadialLines:r,getColorAtAngle:L,cellPatterns:G,backgroundColor:o,baseImageWithoutText:Mi,curvedTexts:u,labelColor:l,fontSize:m},it}function ur(e,t,o,n){let i="";for(let a=0;a<e.length;a++){let r=e[a],s=t[a];if(!s||!s.active||r===" ")i+=r;else{let l=o-s.startTime;Math.min(l/n,1)>=1?(s.active=!1,i+=r):i+=xa[Math.floor(Math.random()*xa.length)]}}return i}function ka(){so++}function fr(e){let t={},o=d.textScrambleDuration;for(;so>0&&d.textScrambleEnabled;){so--;let n=["text1","text2","text3","text4","text5"],i=n[Math.floor(Math.random()*n.length)],a=va[i],r=d[`${i}Content`];a.chars.length!==r.length&&(a.chars=r.split("").map(()=>({active:!1,startTime:0})));let s=[];for(let l=0;l<r.length;l++)r[l]!==" "&&!a.chars[l].active&&s.push(l);if(s.length>0){let l=s[Math.floor(Math.random()*s.length)];a.chars[l].active=!0,a.chars[l].startTime=e}}return["text1","text2","text3","text4","text5"].forEach(n=>{let i=va[n],a=d[`${n}Content`];i.chars.length!==a.length&&(i.chars=a.split("").map(()=>({active:!1,startTime:0}))),t[n]=ur(a,i.chars,e,o)}),t}function mr(e,t,o,n){let{centerX:i,centerY:a,circleStep:r,numCircles:s,numRadialLines:l,curvedTexts:m,labelColor:p,fontSize:f}=t;m&&m.forEach((g,u)=>{let{row:h=7,startSector:c=0,textFontSize:S=f,color:b=p,flipX:x=!1,flipY:L=!1,cellMode:F=!0}=g,I=`text${u+1}`,$=n&&n[I]?n[I]:g.text||"",q=(c+o+l)%l;if(F)Ta(e,$,i,a,r,h,q,l,S,b,x,L);else{let G=t.maxRadius*(h/s),ge=(q*(360/l)-90)*Math.PI/180,z=g.letterSpacing||.08;Ma(e,$,i,a,G,ge,S,b,z,x,L)}})}function Ra(e,t){Ct=[];for(let o=0;o<e;o++)Ct.push({circle:Math.floor(Math.random()*t)+1,angle:Math.random()*Math.PI*2,speed:(.5+Math.random()*.5)*(Math.random()>.5?1:-1),size:.8+Math.random()*.4});Uo(e),ao(e)}function pr(e,t,o,n){let{centerX:i,centerY:a,circleStep:r}=t,s=n&&!xe(),l=Vo(),m=_o();Ct.forEach((p,f)=>{let g=r*p.circle,u=i+Math.cos(p.angle)*g,h=a+Math.sin(p.angle)*g,c=o*p.size,b=f===m?l:0,x=1+b*1.5,L=c*x,F=.9+b*.1;if(s){let I=L*(3+b*2),$=e.createRadialGradient(u,h,0,u,h,I);$.addColorStop(0,`rgba(255, 255, 255, ${F})`),$.addColorStop(.5,`rgba(255, 255, 255, ${.4+b*.3})`),$.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=$,e.beginPath(),e.arc(u,h,I,0,Math.PI*2),e.fill()}e.fillStyle="#ffffff",e.beginPath(),e.arc(u,h,L,0,Math.PI*2),e.fill(),e.fillStyle="#ffffff",e.beginPath(),e.arc(u,h,L*.5,0,Math.PI*2),e.fill()}),Yo()}function gr(e,t){for(let o of Ct)o.angle+=o.speed*t*e*.001,o.angle>Math.PI*2&&(o.angle-=Math.PI*2),o.angle<0&&(o.angle+=Math.PI*2)}function hr(e,t){let{centerX:o,centerY:n,circleStep:i}=e,a=[],r=10;for(let s of Ct){let l=i*s.circle,m=o+Math.cos(s.angle)*l,p=n+Math.sin(s.angle)*l,f=t*s.size*4;a.push({x:Math.floor(m-f-r),y:Math.floor(p-f-r),w:Math.ceil(f*2+r*2),h:Math.ceil(f*2+r*2)})}return a}function Ia(e){if(!e||!e._polarGridCanvas)return;Ye=e;let t=e._polarGridCanvas,o=e._polarGridCtx,n=e._polarGridParams;St=o.getImageData(0,0,t.width,t.height),Ra(d.pulseCount,n.numCircles);let i=performance.now(),a=0;function r(s){if(s-Ca<Qi){Ie=requestAnimationFrame(r);return}Ca=s;let l=d.pulsesEnabled,m=d.cellAnimationEnabled,p=d.textRotationEnabled,f=d.textScrambleEnabled;if(!l&&!m&&!p&&!f){o.putImageData(St,0,0),e.needsUpdate=!0,Ie=null;return}let g=s-i;if(i=s,a+=g*.001*d.cellAnimationSpeed,p){if(d.textStepRotation){let c=6e4/d.textRotationBPM;s-Ea>=c&&(Ue-=1,Ea=s,f&&so++)}else Ue+=d.textRotationSpeed*g*.001;for(;Ue>=n.numRadialLines;)Ue-=n.numRadialLines;for(;Ue<0;)Ue+=n.numRadialLines}let u=p||f;if(u||m)u&&n.baseImageWithoutText?o.putImageData(n.baseImageWithoutText,0,0):o.putImageData(St,0,0);else if(l&&nn.length>0)for(let c of nn)o.putImageData(St,c.x,c.y,c.x,c.y,c.w,c.h);if(m&&n.cellPatterns)for(let c of n.cellPatterns){let S=a*2+c.phase;c.pattern==="gradient"&&nr(o,n.centerX,n.centerY,c.innerRadius,c.outerRadius,c.startAngle,c.endAngle,c.colorHex,c.pattern,c.ring,c.sector,S)}if(u&&n.curvedTexts){let c=f?fr(s):null;mr(o,n,Ue,c)}l&&(gr(g,d.pulseSpeed),nn=hr(n,d.pulseSize),pr(o,n,d.pulseSize,d.pulseGlow),tn()&&Ko(Ct,n)),e.needsUpdate=!0,Ie=requestAnimationFrame(r)}Ie&&cancelAnimationFrame(Ie),Ie=requestAnimationFrame(r)}function rn(){Ie&&(cancelAnimationFrame(Ie),Ie=null),Ye&&St&&(Ye._polarGridCtx.putImageData(St,0,0),Ye.needsUpdate=!0)}function Fa(){Ye&&Ye._polarGridParams&&Ra(d.pulseCount,Ye._polarGridParams.numCircles)}var d,Ca,Qi,ro,an,Ct,Ie,Ye,St,nn,Ue,Ea,va,xa,so,za=K(()=>{io();_e();Ne();d={globalFontSize:100,text1Row:3,text1FlipX:!0,text1FlipY:!0,text1FontSize:100,text1StartSector:24,text1Content:"STHLM 7-9 MAY",text1CellMode:!0,text2Row:4,text2FlipX:!0,text2FlipY:!0,text2FontSize:100,text2StartSector:24,text2Content:"MALM\xD6  12 MAY",text2CellMode:!0,text3Row:5,text3FlipX:!0,text3FlipY:!0,text3FontSize:100,text3StartSector:24,text3Content:"DOME DREAMING",text3CellMode:!0,text4Row:6,text4FlipX:!0,text4FlipY:!0,text4FontSize:100,text4StartSector:28,text4Content:"FULLDOME FILM FESTIVAL",text4CellMode:!0,text5Row:7,text5FlipX:!0,text5FlipY:!0,text5FontSize:100,text5StartSector:27,text5Content:"OPEN CALL IS LIVE!",text5CellMode:!0,labelsFlipX:!1,labelsFlipY:!0,gridLineColor:"#ffffff",rimOffset:.02,lineWidth:2,tickWidth:1,antialias:!0,dotSize:4,pulsesEnabled:!1,pulseCount:4,pulseSpeed:.5,pulseSize:12,pulseGlow:!1,textRotationEnabled:!1,textRotationSpeed:-.3,textStepRotation:!0,textRotationBPM:30,textScrambleEnabled:!1,textScrambleChance:.08,textScrambleDuration:200,textOutline:!1,textOutlineColor:"#000000",textOutlineWidth:3,textShadow:!1,textShadowBlur:8,textShadowColor:"#000000",textVerticalOffset:.6,cellAnimationEnabled:!1,cellAnimationSpeed:.5,cellPatternDensity:.25,imageCellsEnabled:!0,imageCellCount:12,imageThreshold:!0,imageThresholdLevel:.5,mainColor:null,chairsColor:null,floorColor:null,regenerate:null},Ca=0,Qi=33;ro=new Map;an=["assets/img/jpg/wisdome-stockholm-visuals.jpg","assets/img/jpg/wisdome-malmo-visuals.jpg","assets/img/jpg/untold-garden.jpg","assets/img/jpg/tiny-massive.jpg","assets/img/jpg/akiko-nakayama.jpg","assets/img/jpg/nordic-lights.jpg","assets/img/jpg/the-new-infinity.jpg","assets/img/jpg/baltic-analog-lab.jpg","assets/img/jpg/visualia.jpg","assets/img/jpeg/nam-june-paik-magnet-tv.jpeg","assets/img/jpg/rhythm-in-light-mary-ellen-bute.jpg","assets/img/png/movie-drome.png"];Ct=[],Ie=null,Ye=null,St=null,nn=[],Ue=0,Ea=0,va={text1:{chars:[]},text2:{chars:[]},text3:{chars:[]},text4:{chars:[]},text5:{chars:[]}},xa="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%&*!?<>[]{}|/\\~";so=0});import*as fo from"three";function Sr(e){let t=[];for(let o=0;o<co;o++)t.push(new fo.Vector3(0,0,0));return Te={uBaseTexture:{value:e},uPulsePositions:{value:t},uTime:{value:0},uPulseCount:{value:0},uPulseIntensity:{value:1}},Te}function Ha(e){let t=Sr(e);return new fo.ShaderMaterial({uniforms:t,vertexShader:wr,fragmentShader:yr,transparent:!1})}function Cr(e,t){uo=[];let o=Math.min(e,co);for(let n=0;n<o;n++){let i=1+Math.floor(Math.random()*t),a=Math.random()*Math.PI*2,r=(.5+Math.random()*.5)*(Math.random()>.5?1:-1),s=.8+Math.random()*.4;uo.push({circle:i,angle:a,speed:r,size:s,numCircles:t})}Te&&(Te.uPulseCount.value=o)}function br(e,t){if(Te)for(let o=0;o<uo.length;o++){let n=uo[o];n.angle+=n.speed*t*e*.001,n.angle>Math.PI*2&&(n.angle-=Math.PI*2),n.angle<0&&(n.angle+=Math.PI*2);let i=n.circle/n.numCircles*.45,a=.5+Math.cos(n.angle)*i,r=.5+Math.sin(n.angle)*i,s=.015*n.size;Te.uPulsePositions.value[o].set(a,r,s)}}function Da(e={}){let{pulseCount:t=4,numCircles:o=8,pulseSpeed:n=.5,pulseIntensity:i=1}=e;Cr(t,o),Te&&(Te.uPulseIntensity.value=i);let a=performance.now();function r(s){let l=s-a;a=s,br(l,n),Te&&(Te.uTime.value=s*.001),Xe=requestAnimationFrame(r)}Xe&&cancelAnimationFrame(Xe),Xe=requestAnimationFrame(r)}function Ba(){Xe&&(cancelAnimationFrame(Xe),Xe=null)}var co,Te,Xe,uo,wr,yr,Oa=K(()=>{co=8,Te=null,Xe=null,uo=[],wr=`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,yr=`
uniform sampler2D uBaseTexture;
uniform vec3 uPulsePositions[${co}];  // xy = position (0-1 UV), z = size
uniform float uTime;
uniform int uPulseCount;
uniform float uPulseIntensity;

varying vec2 vUv;

void main() {
  // Sample base texture
  vec4 baseColor = texture2D(uBaseTexture, vUv);

  // Add pulse glow
  float pulseGlow = 0.0;

  for (int i = 0; i < ${co}; i++) {
    if (i >= uPulseCount) break;

    vec2 pulsePos = uPulsePositions[i].xy;
    float pulseSize = uPulsePositions[i].z;

    // Distance from pulse center
    float dist = distance(vUv, pulsePos);

    // Soft glow falloff
    float glow = smoothstep(pulseSize * 2.0, 0.0, dist);

    // Core intensity
    float core = smoothstep(pulseSize * 0.5, 0.0, dist);

    pulseGlow += glow * 0.5 + core * 0.8;
  }

  // Blend pulse glow with base
  vec3 finalColor = baseColor.rgb + vec3(pulseGlow * uPulseIntensity);

  gl_FragColor = vec4(finalColor, baseColor.a);
}
`});var Aa={};we(Aa,{getToneMappingOptions:()=>wn,lightingSettings:()=>C,setAmbientColor:()=>cn,setAmbientIntensity:()=>ln,setDirectColor:()=>hn,setDirectIntensity:()=>gn,setDirectLightEnabled:()=>pn,setExposure:()=>po,setFogColor:()=>un,setFogEnabled:()=>dn,setFogFar:()=>mn,setFogNear:()=>fn,setGradientEnd:()=>xr,setGradientStart:()=>vr,setSection1FadeStart:()=>yn,setSection2FadeEnd:()=>Sn,setToneMapping:()=>mo,setupLighting:()=>Er});import*as H from"three";function Er(){bt=new H.AmbientLight(C.ambientColor,C.ambientIntensity),T.add(bt),me=new H.DirectionalLight(C.directColor,C.directIntensity),me.position.set(5,10,5),C.directLightEnabled&&T.add(me),C.fogEnabled&&(T.fog=new H.Fog(C.fogColor,C.fogNear,C.fogFar)),mo(C.toneMapping),po(C.exposure)}function ln(e){C.ambientIntensity=e,bt&&(bt.intensity=e)}function cn(e){C.ambientColor=e,bt&&bt.color.set(e)}function dn(e){C.fogEnabled=e,e?T.fog=new H.Fog(C.fogColor,C.fogNear,C.fogFar):T.fog=null}function un(e){C.fogColor=e,T.fog&&T.fog.color.set(e)}function fn(e){C.fogNear=e,T.fog&&(T.fog.near=e)}function mn(e){C.fogFar=e,T.fog&&(T.fog.far=e)}function mo(e){C.toneMapping=e,B&&sn[e]!==void 0&&(B.toneMapping=sn[e])}function po(e){C.exposure=e,B&&(B.toneMappingExposure=e)}function pn(e){C.directLightEnabled=e,me&&(e&&!me.parent?T.add(me):!e&&me.parent&&T.remove(me))}function gn(e){C.directIntensity=e,me&&(me.intensity=e)}function hn(e){C.directColor=e,me&&me.color.set(e)}function wn(){return Object.keys(sn)}function vr(e){C.gradientStart=e,document.documentElement.style.setProperty("--bg-gradient-start",`${e}%`)}function xr(e){C.gradientEnd=e,document.documentElement.style.setProperty("--bg-gradient-end",`${e}%`)}function yn(e){C.section1FadeStart=e,document.documentElement.style.setProperty("--section1-fade-start",`${e}%`)}function Sn(e){C.section2FadeEnd=e,document.documentElement.style.setProperty("--section2-fade-end",`${e}%`)}var C,sn,me,bt,Cn=K(()=>{Se();C={ambientIntensity:.5,ambientColor:"#ffffff",fogEnabled:!1,fogColor:"#1a1a1a",fogNear:20,fogFar:60,toneMapping:"Linear",exposure:1,directLightEnabled:!0,directIntensity:1,directColor:"#ffffff",gradientStart:20,gradientEnd:80,section1FadeStart:70,section2FadeEnd:30},sn={None:H.NoToneMapping,Linear:H.LinearToneMapping,Reinhard:H.ReinhardToneMapping,Cineon:H.CineonToneMapping,"ACES Filmic":H.ACESFilmicToneMapping,AgX:H.AgXToneMapping,Neutral:H.NeutralToneMapping},me=null,bt=null});var ja={};we(ja,{connectWebcam:()=>Pr,disconnectWebcam:()=>Lr,getCurrentImageTexture:()=>Mn,getCurrentVideo:()=>Tr,getCurrentVideoTexture:()=>xn,getScreenObject:()=>vn,loadDefaultScreenTexture:()=>ho,loadImage:()=>Ga,loadVideo:()=>Na,regeneratePolarGridTexture:()=>E,setScreenObject:()=>go,setupDragAndDrop:()=>Tn,setupPolarGridGUI:()=>$a});import*as pe from"three";import Mr from"lil-gui";function go(e){X=e}function vn(){return X}function xn(){return re}function Tr(){return O}function Mn(){return ee}function ho(e=Et.defaultImage||"assets/media/background.png"){return X?(ee&&(ee.dispose(),ee=null),new Promise(async t=>{await Pa();let o=window.savedColorSettings||{},n=o.Main_Structure||{r:.4,g:.45,b:.5},i=o.Chairs||{r:.55,g:.32,b:.38},a=o.Floor||{r:.65,g:.52,b:.25},s=La(2048,{backgroundColor:"#000000",numCircles:8,numRadialLines:36,showLabels:!0,labelColor:"#ffffff",mainColor:n,chairsColor:i,floorColor:a,curvedTexts:[{text:d.text1Content,row:d.text1Row,startSector:d.text1StartSector,textFontSize:d.text1FontSize,color:"#ffffff",flipX:d.text1FlipX,flipY:d.text1FlipY,cellMode:d.text1CellMode},{text:d.text2Content,row:d.text2Row,startSector:d.text2StartSector,textFontSize:d.text2FontSize,color:"#ffffff",flipX:d.text2FlipX,flipY:d.text2FlipY,cellMode:d.text2CellMode},{text:d.text3Content,row:d.text3Row,startSector:d.text3StartSector,textFontSize:d.text3FontSize,color:"#ffffff",flipX:d.text3FlipX,flipY:d.text3FlipY,cellMode:d.text3CellMode},{text:d.text4Content,row:d.text4Row,startSector:d.text4StartSector,textFontSize:d.text4FontSize,color:"#ffffff",flipX:d.text4FlipX,flipY:d.text4FlipY,cellMode:d.text4CellMode},{text:d.text5Content,row:d.text5Row,startSector:d.text5StartSector,textFontSize:d.text5FontSize,color:"#ffffff",flipX:d.text5FlipX,flipY:d.text5FlipY,cellMode:d.text5CellMode}]});if(dt(s),s.rotation=0,d.pulsesEnabled){let l=Ha(s);X.material=l,Da({pulseCount:d.pulseCount,numCircles:8,pulseSpeed:d.pulseSpeed,pulseIntensity:1})}else ct(s,X);ee=s,$a(),t(s)})):Promise.resolve()}function E(){X&&(rn(),Ba(),ho())}function bn(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16)/255,g:parseInt(t[2],16)/255,b:parseInt(t[3],16)/255}:null}async function En(e,t){let o=await Promise.resolve().then(()=>(ft(),Ot)),{getMaterial:n}=await Promise.resolve().then(()=>(Ne(),sa));if(o.fbxMeshes){let i=o.fbxMeshes.find(a=>a.name===e);if(i){let a=n(i.mesh);a&&(a.color.setRGB(t.r,t.g,t.b),a.needsUpdate=!0)}}window.savedColorSettings||(window.savedColorSettings={}),window.savedColorSettings[e]=t}function $a(){if(Y)return;Y=new Mr({title:"Dome Dreaming"}),Y.domElement.style.position="fixed",Y.domElement.style.top="10px",Y.domElement.style.left="10px",Y.domElement.style.zIndex="99999",Y.domElement.style.display="none",window.addEventListener("keydown",w=>{if((w.metaKey||w.ctrlKey)&&w.key.toLowerCase()==="g"){w.preventDefault();let M=Y.domElement.style.display==="none";Y.domElement.style.display=M?"":"none"}});let e=Y.addFolder("Typography");e.add(d,"globalFontSize",50,200,5).name("Global Font Size %").onChange(()=>E());let t=e.addFolder("Text 1");t.add(d,"text1Content").name("Text").onChange(()=>E()),t.add(d,"text1Row",1,8,1).name("Row (Circle)").onChange(()=>E()),t.add(d,"text1StartSector",0,35,1).name("Start Sector").onChange(()=>E()),t.add(d,"text1FontSize",20,200,5).name("Font Size %").onChange(()=>E()),t.close();let o=e.addFolder("Text 2");o.add(d,"text2Content").name("Text").onChange(()=>E()),o.add(d,"text2Row",1,8,1).name("Row (Circle)").onChange(()=>E()),o.add(d,"text2StartSector",0,35,1).name("Start Sector").onChange(()=>E()),o.add(d,"text2FontSize",20,200,5).name("Font Size %").onChange(()=>E()),o.close();let n=e.addFolder("Text 3");n.add(d,"text3Content").name("Text").onChange(()=>E()),n.add(d,"text3Row",1,8,1).name("Row (Circle)").onChange(()=>E()),n.add(d,"text3StartSector",0,35,1).name("Start Sector").onChange(()=>E()),n.add(d,"text3FontSize",20,200,5).name("Font Size %").onChange(()=>E()),n.close();let i=e.addFolder("Text 4");i.add(d,"text4Content").name("Text").onChange(()=>E()),i.add(d,"text4Row",1,8,1).name("Row (Circle)").onChange(()=>E()),i.add(d,"text4StartSector",0,35,1).name("Start Sector").onChange(()=>E()),i.add(d,"text4FontSize",20,200,5).name("Font Size %").onChange(()=>E()),i.close();let a=e.addFolder("Text 5");a.add(d,"text5Content").name("Text").onChange(()=>E()),a.add(d,"text5Row",1,8,1).name("Row (Circle)").onChange(()=>E()),a.add(d,"text5StartSector",0,35,1).name("Start Sector").onChange(()=>E()),a.add(d,"text5FontSize",20,200,5).name("Font Size %").onChange(()=>E()),a.close();let r=e.addFolder("Style");r.add(d,"textOutline").name("Outline").onChange(()=>E()),r.addColor(d,"textOutlineColor").name("Outline Color").onChange(()=>E()),r.add(d,"textOutlineWidth",1,10,1).name("Outline Width").onChange(()=>E()),r.add(d,"textShadow").name("Shadow").onChange(()=>E()),r.add(d,"textShadowBlur",0,20,1).name("Shadow Blur").onChange(()=>E()),r.add(d,"textVerticalOffset",.1,.9,.05).name("Radial Position").onChange(()=>E()),r.close(),e.close();let s=Y.addFolder("Grid"),l=s.addFolder("Lines");l.addColor(d,"gridLineColor").name("Color").onChange(()=>E()),l.add(d,"lineWidth",.5,5,.5).name("Width").onChange(()=>E()),l.add(d,"tickWidth",.5,4,.5).name("Tick Width").onChange(()=>E()),l.add(d,"rimOffset",0,.2,.01).name("Rim Offset").onChange(()=>E()),l.add(d,"dotSize",1,20,1).name("Dot Size").onChange(()=>E()),l.close();let m=s.addFolder("Images");m.add(d,"imageCellsEnabled").name("Enable").onChange(()=>E()),m.add(d,"imageCellCount",1,12,1).name("Count").onChange(()=>E()),m.add(d,"imageThreshold").name("Threshold").onChange(()=>E()),m.add(d,"imageThresholdLevel",.2,.8,.05).name("Threshold Level").onChange(()=>E()),m.close();let p=s.addFolder("Rendering");p.add(d,"antialias").name("Antialiasing").onChange(()=>E()),p.close(),s.close();let f=Y.addFolder("Animation"),g=f.addFolder("Rotation");g.add(d,"textRotationEnabled").name("Rotate Text"),g.add(d,"textStepRotation").name("Step Mode (BPM)"),g.add(d,"textRotationBPM",10,120,5).name("Text BPM"),g.add(d,"textRotationSpeed",-2,2,.1).name("Continuous Speed"),g.add(le,"enabled").name("Rotate Grid"),g.add(le,"speed",-.1,.1,.005).name("Grid Speed"),g.close();let u=f.addFolder("Pulses");u.add(d,"pulsesEnabled").name("Enable").onChange(w=>{w&&ee?Ia(ee):rn()}),u.add(d,"pulseCount",1,20,1).name("Count").onChange(()=>Fa()),u.add(d,"pulseSpeed",.1,2,.1).name("Speed"),u.add(d,"pulseSize",4,30,1).name("Size"),u.add(d,"pulseGlow").name("Glow"),u.close(),f.close();let h=Y.addFolder("Audio");h.add(U,"enabled").name("Enable Sound").onChange(async w=>{w?await Xo():Qo()}),h.add(U,"masterVolume",0,1,.05).name("Volume").onChange(w=>Zo(w)),h.add(U,"tickBPM",20,180,5).name("Tick BPM"),h.add(U,"reverbWet",0,1,.05).name("Reverb").onChange(w=>Jo(w)),h.add(U,"spatialSpread",1,20,1).name("3D Spread").onChange(w=>en(w)),h.close();let c=Y.addFolder("Colors"),S={get mainColor(){let w=d.mainColor||{r:.4,g:.45,b:.5};return Ft(w)},set mainColor(w){let M=bn(w);M&&(d.mainColor=M,window.savedColorSettings=window.savedColorSettings||{},window.savedColorSettings.Main_Structure=M,En("Main_Structure",M),E())},get chairsColor(){let w=d.chairsColor||{r:.55,g:.32,b:.38};return Ft(w)},set chairsColor(w){let M=bn(w);M&&(d.chairsColor=M,window.savedColorSettings=window.savedColorSettings||{},window.savedColorSettings.Chairs=M,En("Chairs",M),E())},get floorColor(){let w=d.floorColor||{r:.65,g:.52,b:.25};return Ft(w)},set floorColor(w){let M=bn(w);M&&(d.floorColor=M,window.savedColorSettings=window.savedColorSettings||{},window.savedColorSettings.Floor=M,En("Floor",M),E())}};c.addColor(S,"mainColor").name("Main Structure"),c.addColor(S,"chairsColor").name("Chairs"),c.addColor(S,"floorColor").name("Floor"),c.add({randomize:()=>{Pn().then(()=>{E()})}},"randomize").name("Randomise Colors"),c.close();let b=Y.addFolder("Lighting"),x=b.addFolder("Exposure");x.add(C,"toneMapping",wn()).name("Tone Mapping").onChange(w=>mo(w)),x.add(C,"exposure",0,3,.1).name("Exposure").onChange(w=>po(w)),x.close();let L=b.addFolder("Ambient");L.add(C,"ambientIntensity",0,2,.1).name("Intensity").onChange(w=>ln(w)),L.addColor(C,"ambientColor").name("Color").onChange(w=>cn(w)),L.close();let F=b.addFolder("Direct Light");F.add(C,"directLightEnabled").name("Enable").onChange(w=>pn(w)),F.add(C,"directIntensity",0,5,.1).name("Intensity").onChange(w=>gn(w)),F.addColor(C,"directColor").name("Color").onChange(w=>hn(w)),F.close();let I=b.addFolder("Fog");I.add(C,"fogEnabled").name("Enable").onChange(w=>dn(w)),I.addColor(C,"fogColor").name("Color").onChange(w=>un(w)),I.add(C,"fogNear",1,50,1).name("Near").onChange(w=>fn(w)),I.add(C,"fogFar",20,100,5).name("Far").onChange(w=>mn(w)),I.close();let $=b.addFolder("Section Gradient");$.add(C,"section1FadeStart",0,100,5).name("Section 1 Fade %").onChange(w=>yn(w)),$.add(C,"section2FadeEnd",0,100,5).name("Section 2 Fade %").onChange(w=>Sn(w)),$.close(),b.close();let q=Y.addFolder("Depth of Field");q.add(N,"enabled").name("Enable").onChange(w=>{let M=wt();M&&(M.enabled=w)}),q.add(N,"focus",.1,50,.1).name("Focus Distance").onChange(w=>{let M=wt();M&&(M.uniforms.focus.value=w)}),q.add(N,"aperture",0,.01,1e-4).name("Aperture").onChange(w=>{let M=wt();M&&(M.uniforms.aperture.value=w)}),q.add(N,"maxblur",0,.05,.001).name("Max Blur").onChange(w=>{let M=wt();M&&(M.uniforms.maxblur.value=w)}),q.open();let G=Y.addFolder("Camera"),ge=G.addFolder("Position");ge.add(y.position,"x",-20,20,.01).name("X").listen(),ge.add(y.position,"y",-20,20,.01).name("Y").listen(),ge.add(y.position,"z",-20,20,.01).name("Z").listen(),ge.close();let z=G.addFolder("Rotation");z.add(y.rotation,"x",-Math.PI,Math.PI,.01).name("X").listen(),z.close(),G.close(),d.regenerate=E}function Ga(e){if(!X)return;let t=new FileReader;t.onload=o=>{new pe.TextureLoader().load(o.target.result,i=>{re&&(re.dispose(),re=null),O&&(O.pause(),O.src="",URL.revokeObjectURL(O.src),O=null),ee&&ee.dispose(),le.enabled=!1,dt(i),i.rotation=0,ct(i,X),ee=i;let a=ne(X);a&&setTimeout(()=>{Object.assign(a,He),a.needsUpdate=!0},200)},void 0,()=>{})},t.readAsDataURL(e)}function Na(e){if(!X)return;let t=document.createElement("video");t.src=URL.createObjectURL(e),t.crossOrigin="anonymous",t.loop=!0,t.muted=!0,t.playsInline=!0,t.addEventListener("loadedmetadata",()=>{t.play(),re&&re.dispose(),O&&(O.pause(),O.src="",URL.revokeObjectURL(O.src)),ee&&(ee.dispose(),ee=null),le.enabled=!1;let o=new pe.VideoTexture(t);dt(o),o.minFilter=pe.LinearFilter,o.magFilter=pe.LinearFilter,o.rotation=0,ct(o,X),re=o,O=t;let n=ne(X);n&&setTimeout(()=>{Object.assign(n,He),n.needsUpdate=!0},200)}),t.addEventListener("error",()=>{})}function Pr(){if(X){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){alert("Webcam access is not available in your browser.");return}navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(e=>{re&&(re.dispose(),re=null),O&&(O.pause(),O.srcObject=null,O=null),ee&&(ee.dispose(),ee=null),Qe&&(Qe.getTracks().forEach(o=>o.stop()),Qe=null),le.enabled=!1;let t=document.createElement("video");t.srcObject=e,t.autoplay=!0,t.playsInline=!0,t.muted=!0,t.addEventListener("loadedmetadata",()=>{t.play();let o=new pe.VideoTexture(t);dt(o),o.minFilter=pe.LinearFilter,o.magFilter=pe.LinearFilter,o.rotation=0,ct(o,X),re=o,O=t,Qe=e;let n=ne(X);n&&setTimeout(()=>{Object.assign(n,He),n.needsUpdate=!0},200)}),t.addEventListener("error",()=>{alert("Error accessing webcam.")})}).catch(e=>{console.error("Error accessing webcam:",e),alert("Could not access webcam. Please check permissions.")})}}function Lr(){Qe&&(Qe.getTracks().forEach(e=>e.stop()),Qe=null),re&&(re.dispose(),re=null),O&&(O.pause(),O.srcObject=null,O=null)}function Tn(){let e=document.getElementById("drop-zone");function t(n){n.preventDefault(),n.stopPropagation()}function o(n){if(!X)return;let i=ne(X);i&&(n?(i.emissive=new pe.Color(38655),i.emissiveIntensity=.8):(Object.assign(i,He),i.needsUpdate=!0))}document.addEventListener("dragenter",n=>{t(n),e.classList.add("drag-over"),o(!0)},!1),document.addEventListener("dragover",n=>{t(n),e.classList.add("drag-over"),o(!0)},!1),document.addEventListener("dragleave",n=>{t(n),n.clientX===0&&n.clientY===0&&(e.classList.remove("drag-over"),o(!1))},!1),document.addEventListener("drop",n=>{t(n),e.classList.remove("drag-over"),o(!1);let i=n.dataTransfer.files;if(i.length>0){let a=i[0];a.type.startsWith("image/")?Ga(a):a.type.startsWith("video/")&&Na(a)}},!1)}var X,re,O,ee,Qe,Y,wo=K(()=>{Ne();It();Re();_e();oo();Se();za();Oa();io();Cn();Wo(ka);X=null,re=null,O=null,ee=null,Qe=null;Y=null});import{GLTFLoader as kr}from"three/addons/loaders/GLTFLoader.js";import{init as Rr,NavMeshQuery as Wa,importNavMesh as Ir}from"@recast-navigation/core";import{threeToSoloNavMesh as Fr}from"@recast-navigation/three";function qa(){return Ke}async function Va(){if(!$t)try{await Rr(),$t=!0,zr()}catch(e){console.error("Failed to initialize recast-navigation:",e),$t=!0}}async function zr(){if(!$t){await Va();return}try{let e=await fetch("assets/models/navmesh.bin");if(e.ok){let t=await e.arrayBuffer(),o=new Uint8Array(t),{navMesh:n}=Ir(o);Ke=new Wa(n),Qt(Ke),console.log("Navmesh loaded from navmesh.bin"),ie&&kn();return}}catch{console.log("navmesh.bin not found, will generate from GLTF")}Hr()}function Hr(){new kr().load("assets/models/navmesh.gltf",async t=>{if(At=t.scene,At.scale.setScalar(1),At.visible=!1,ye(At,o=>{o.isMesh&&(Ln.push(o),o.updateMatrixWorld())}),T.add(At),Ln.length>0&&$t){let{success:o,navMesh:n}=Fr(Ln,{cs:.05,ch:.05,walkableRadius:.2});o&&(Ke=new Wa(n),Qt(Ke),console.log("Navmesh generated from GLTF"))}},void 0,t=>{console.warn("Navmesh GLTF not found:",t)})}function kn(){if(!Ke||!ie)return;let e={x:y.position.x,y:y.position.y-de,z:y.position.z},t=Ke.findClosestPoint(e,{halfExtents:Ge});t.success&&(y.position.y=t.point.y+de)}function _a(){Va().catch(console.error)}var $t,At,Ln,Ke,Ua=K(()=>{Se();It();Ne();Kt();zt();$t=!1,At=null,Ln=[],Ke=null});var Ka={};we(Ka,{getScreenLight:()=>$r,initScreenLighting:()=>Rn,setColorSamplingEnabled:()=>Ar,updateScreenLighting:()=>Or});import*as be from"three";function Rn(e){return Dr=e,Pe=new be.PointLight(16777215,2,30),Pe.position.set(0,0,0),T.add(Pe),Ze=new be.HemisphereLight(16777215,1710618,.8),Ze.position.set(0,5,0),T.add(Ze),Ce=new be.PointLight(16777215,1.5,25),Ce.position.set(0,0,0),T.add(Ce),{screenLight:Pe,hemisphereLight:Ze,secondaryLight:Ce}}function Xa(e){if(!e||!e.image)return null;let t=e.image,o=document.createElement("canvas"),n=o.getContext("2d"),i=64;o.width=i,o.height=i;try{n.drawImage(t,0,0,i,i);let r=n.getImageData(0,0,i,i).data,s=0,l=0,m=0,p=i*i;for(let f=0;f<r.length;f+=4)s+=r[f],l+=r[f+1],m+=r[f+2];return s/=p,l/=p,m/=p,new be.Color(s/255,l/255,m/255)}catch{return null}}function Or(e){if(!Pe||!Qa||e-Ya<Br)return;Ya=e;let t=null,o=Mn(),n=xn();if(n&&n.image?t=Xa(n):o&&(t=Xa(o)),t){let i=t.clone();if(i.getHSL(Oe),Oe.s=Math.min(1,Oe.s*1.5),Oe.l=Math.min(1,Oe.l*1.2),i.setHSL(Oe.h,Oe.s,Oe.l),Pe.color.copy(i),Pe.intensity=3,Ze){let r=new be.Color().lerpColors(new be.Color(16777215),i,.6);Ze.color.copy(r),Ze.intensity=1.2}Ce&&(Ce.color.copy(i),Ce.intensity=2);let a=vn();if(a){let r=new be.Vector3;a.getWorldPosition(r),Pe.position.copy(r),Pe.position.z+=.5,Ce&&(Ce.position.copy(r),Ce.position.z+=.3,Ce.position.y+=.2)}}}function Ar(e){Qa=e}function $r(){return Pe}var Pe,Dr,Ze,Ce,Ya,Br,Qa,Oe,In=K(()=>{Se();wo();Pe=null,Dr=null,Ze=null,Ce=null,Ya=0,Br=100,Qa=!0,Oe={h:0,s:0,l:0}});var Ot={};we(Ot,{fbxMeshes:()=>yo,glbLights:()=>Fe,glbLightsGroup:()=>vt,hotspots:()=>De,loadModel:()=>jr,wisdomeModel:()=>Za});import*as P from"three";import{GLTFLoader as Gr}from"three/addons/loaders/GLTFLoader.js";import{DRACOLoader as Nr}from"three/addons/loaders/DRACOLoader.js";function jr(){let e=new Gr,t=new Nr;t.setDecoderPath("https://cdn.jsdelivr.net/npm/three@0.181.0/examples/jsm/libs/draco/gltf/"),e.setDRACOLoader(t),e.load("assets/models/wisdome.glb",o=>{if(!o||!o.scene){console.error("GLB loaded but scene is missing");let u=document.getElementById("loading-overlay");u&&(u.innerHTML='<div style="color: #ff4444; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">Error: Model scene is missing.</div>');return}let n=o.scene;Za=n,n.scale.setScalar(1),n.position.set(0,0,0),_t(n),vt=new P.Group,vt.name="GLBLights";let i=()=>{ye(n,u=>{u.isLight&&(Fe.push(u),vt.add(u))})};"requestIdleCallback"in window?requestIdleCallback(i,{timeout:100}):i(),Fe.length===0&&ye(n,u=>{(u instanceof P.Light||u instanceof P.DirectionalLight||u instanceof P.PointLight||u instanceof P.SpotLight||u instanceof P.RectAreaLight||u instanceof P.HemisphereLight)&&(Fe.includes(u)||(Fe.push(u),vt.add(u)))}),Fe=Fe.filter(u=>!(u instanceof P.HemisphereLight)),Fe.length>0&&(T.add(vt),Fe.forEach(u=>{u instanceof P.DirectionalLight?(u.intensity=3,u.position.set(2,15,5)):u instanceof P.PointLight?(u.intensity=0,u.visible=!1):u.intensity=0})),ye(n,u=>{u.name==="Hotspots"&&ye(u,h=>{if(h.name==="Hotspot.001"||h.name.includes("Hotspot")){let c=new P.Vector3;h.getWorldPosition(c),De.push({object:h,position:c,name:h.name,triggered:!1})}})}),ye(n,u=>{if(u.isMesh){let h=u.name.toLowerCase();if(h.includes("screen")||h.includes("display")||h.includes("monitor")||h.includes("panel")||h.includes("projection")||h.includes("canvas"))go(u),u.visible=!0;else{let c=ne(u),S=c?.color?c.color.clone():new P.Color(16777215);if(c){if(c.metalness!==void 0&&(c.metalness=Math.max(c.metalness||0,.1)),c.roughness!==void 0&&(c.roughness=Math.min(c.roughness||.5,.8)),c.map&&(c.map.colorSpace=P.SRGBColorSpace),c.isMeshBasicMaterial){let b=new P.MeshStandardMaterial({color:c.color,map:c.map,transparent:c.transparent,opacity:c.opacity,metalness:.1,roughness:.5});u.material=b,c=b}c.needsUpdate=!0}yo.push({mesh:u,name:u.name||"Unnamed",originalColor:S})}}});let a=!1;ye(n,u=>{u.isMesh&&u.name&&(u.name.toLowerCase().includes("screen")||u.name.toLowerCase().includes("display")||u.name.toLowerCase().includes("monitor")||u.name.toLowerCase().includes("panel")||u.name.toLowerCase().includes("projection")||u.name.toLowerCase().includes("canvas"))&&(a=!0)}),!a&&n&&n.children.length>0&&ye(n,u=>{u.isMesh&&!a&&(go(u),u.visible=!0,yo=yo.filter(h=>h.mesh!==u),a=!0)}),T.add(n);let r={x:0,y:5.4,z:-4.3},s={x:-2.9,y:0,z:3.121154018741333},l=Le,m=l&&l.y>1&&l.y<10?l:r,p=ke||s;y.position.set(m.x,m.y,m.z),y.rotation.set(p.x,p.y,p.z),y.updateMatrixWorld(),Z.set(p.x,p.y,p.z,"YXZ"),Go(!0),qa()&&kn(),_a(),Tn();function g(){let u=document.getElementById("loading-overlay");u&&(u.classList.add("fade-out"),setTimeout(()=>{u.remove()},500));let h=document.getElementById("canvas-container"),c=document.getElementById("info-panel");h&&h.classList.add("loaded"),c&&c.classList.add("loaded")}Promise.all([Promise.resolve().then(()=>(Re(),Zt)).then(u=>u.applySettingsToScene()),ho().catch(u=>(console.warn("Error loading default texture, continuing anyway:",u),null))]).then(()=>{setTimeout(()=>{let u=n.children.find(h=>{let c=h.name?.toLowerCase()||"";return c.includes("screen")||c.includes("monitor")||c.includes("panel")||c.includes("projection")||c.includes("canvas")});u&&Rn(u),g()},100)}).catch(u=>{console.error("Error during scene initialization:",u),setTimeout(g,1e3)})},void 0,o=>{console.error("Error loading 3D model:",o);let n=document.getElementById("loading-overlay");n&&(n.innerHTML='<div style="color: #ff4444; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">Error loading 3D model.</div>')})}var Za,yo,Fe,vt,De,ft=K(()=>{Se();Ne();Re();zt();wo();Ua();In();Za=null,yo=[],Fe=[],vt=null,De=[]});var Zt={};we(Zt,{applyPageBackgrounds:()=>zn,applyPageColors:()=>Hn,applySettingsToScene:()=>Mo,applyVignetteSettings:()=>Ur,bloomSettings:()=>W,cameraSettings:()=>fe,canvasSettings:()=>vo,constants:()=>Eo,currentCameraPosition:()=>Je,currentCameraRotation:()=>et,dofSettings:()=>N,exportSettingsFile:()=>es,getRandomGeneratedColor:()=>Xr,loadSettings:()=>xo,moveSpeed:()=>Ve,pageBackgroundSettings:()=>te,pageColorSettings:()=>ze,randomizeColors:()=>Pn,reloadFromJSON:()=>Zr,resetToDefaultColors:()=>Jr,saveSettings:()=>Dn,screenSettings:()=>Et,scrollSettings:()=>Mt,setBloomSettings:()=>qr,setMoveSpeed:()=>Wr,startCameraPosition:()=>Le,startCameraRotation:()=>ke,textureRotationSettings:()=>le});import"three";function Wr(e){Ve=e}function qr(e,t,o){W.strength=e,W.radius=t,W.threshold=o}async function Vr(e=!1){try{let t="assets/js/core/default-settings.json",o=e?`${t}?t=${Date.now()}`:t,n=await fetch(o);if(!n.ok)return console.warn("Could not load default-settings.json, using hardcoded defaults"),!1;let i=await n.json();return i.constants&&(Eo={...Eo,...i.constants}),i.settings&&_r(i.settings),!0}catch(t){return console.warn("Failed to load default settings from JSON:",t),!1}}function _r(e){e.moveSpeed!==void 0&&(Ve=e.moveSpeed),e.cameraSettings&&Object.assign(fe,e.cameraSettings),e.startCameraPosition&&Object.assign(Le,e.startCameraPosition),e.startCameraRotation&&Object.assign(ke,e.startCameraRotation),e.colorSettings?window.savedColorSettings=e.colorSettings:window.savedColorSettings=null,e.lightSettings?window.savedLightSettings=e.lightSettings:window.savedLightSettings=null,e.bloomSettings&&Object.assign(W,e.bloomSettings),e.dofSettings&&Object.assign(N,e.dofSettings),e.pageColorSettings&&(e.pageColorSettings.vignette&&(ze.vignette={...ze.vignette,...e.pageColorSettings.vignette}),Object.assign(ze,e.pageColorSettings),ze.vignette||(ze.vignette={enabled:!0,size:8,fadeWidth:2}),Hn()),e.scrollSettings&&Object.assign(Mt,e.scrollSettings),e.canvasSettings&&Object.assign(vo,e.canvasSettings),e.screenSettings&&Object.assign(Et,e.screenSettings),e.textureRotationSettings&&Object.assign(le,e.textureRotationSettings),e.pageBackgroundSettings&&(Object.assign(te,e.pageBackgroundSettings),zn())}function Ja(e,t=.5){if(!e)return null;if(e.startsWith("rgba"))return e;if(e.startsWith("rgb")){let n=e.match(/\d+/g);if(n&&n.length>=3)return`rgba(${n[0]}, ${n[1]}, ${n[2]}, ${t})`}let o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(o){let n=parseInt(o[1],16),i=parseInt(o[2],16),a=parseInt(o[3],16);return`rgba(${n}, ${i}, ${a}, ${t})`}return e}function zn(){"requestIdleCallback"in window?requestIdleCallback(()=>{let e=document.querySelectorAll(".page-section");if(e.length>0&&e.length>1&&te.team)for(let t=1;t<e.length;t++){let o=e[t];if(te.team.backgroundColor&&te.team.backgroundColor!=="#000000"){let n=Ja(te.team.backgroundColor,.5);o.style.setProperty("background-color",n,"important")}else o.style.removeProperty("background-color");te.team.backgroundImage?(o.style.setProperty("background-image",`url(${te.team.backgroundImage})`,"important"),o.style.setProperty("background-size","cover","important"),o.style.setProperty("background-position","center","important"),o.style.setProperty("background-repeat","no-repeat","important")):o.style.removeProperty("background-image")}},{timeout:200}):setTimeout(()=>{let e=document.querySelectorAll(".page-section");if(e.length>0&&e.length>1&&te.team)for(let t=1;t<e.length;t++){let o=e[t];if(te.team.backgroundColor&&te.team.backgroundColor!=="#000000"){let n=Ja(te.team.backgroundColor,.5);o.style.setProperty("background-color",n,"important")}else o.style.removeProperty("background-color");te.team.backgroundImage?(o.style.setProperty("background-image",`url(${te.team.backgroundImage})`,"important"),o.style.setProperty("background-size","cover","important"),o.style.setProperty("background-position","center","important"),o.style.setProperty("background-repeat","no-repeat","important")):o.style.removeProperty("background-image")}},50)}function ni(){let e=document.getElementById("canvas-container");if(!e)return;let t=ze.vignette||{enabled:!0,size:8,fadeWidth:2};if(!t.enabled){e.style.maskImage="none",e.style.webkitMaskImage="none";return}let o=`${t.size}%`,n=`${t.size+t.fadeWidth}%`,i=`${t.size+t.fadeWidth*2}%`,a=`${100-t.size-t.fadeWidth*2}%`,r=`${100-t.size-t.fadeWidth}%`,s=`${100-t.size}%`,l=`linear-gradient(to right, transparent 0%, transparent ${o}, rgba(0, 0, 0, 0.5) ${n}, black ${i}, black ${a}, rgba(0, 0, 0, 0.5) ${r}, transparent ${s}, transparent 100%)`,m=`linear-gradient(to bottom, transparent 0%, transparent ${o}, rgba(0, 0, 0, 0.5) ${n}, black ${i}, black ${a}, rgba(0, 0, 0, 0.5) ${r}, transparent ${s}, transparent 100%)`;e.style.maskImage=`${l}, ${m}`,e.style.maskComposite="intersect",e.style.webkitMaskImage=`${l}, ${m}`,e.style.webkitMaskComposite="source-in"}function Hn(){ni()}function Ur(){ni()}async function xo(e=!1){let t=await Vr(e);Hn(),zn()}function Xr(){let e=Object.values(Co).filter(t=>t!==null);return e.length===0?So.primary:e[Math.floor(Math.random()*e.length)]}function Qr(){let e=Math.floor(Math.random()*ei.length);return ei[e]}function bo(){let e=Math.floor(Math.random()*ti.length);return ti[e]}function Fn(){return bo()}function oi(e,t=.4){return{r:e.r*t,g:e.g*t,b:e.b*t}}function Kr(){let e=o=>{let n=Math.round(o.r*255),i=Math.round(o.g*255),a=Math.round(o.b*255);return`rgb(${n}, ${i}, ${a})`},t=o=>{let n=Math.round(o.r*255).toString(16).padStart(2,"0"),i=Math.round(o.g*255).toString(16).padStart(2,"0"),a=Math.round(o.b*255).toString(16).padStart(2,"0");return`#${n}${i}${a}`};Promise.resolve().then(()=>(ft(),Ot)).then(o=>{let n=null,i=null,a=null;if(o.fbxMeshes&&o.fbxMeshes.length>0){let m=o.fbxMeshes.find(g=>g.name==="Main_Structure");if(m){let g=ne(m.mesh);g&&g.color&&(n={r:g.color.r,g:g.color.g,b:g.color.b})}let p=o.fbxMeshes.find(g=>g.name==="Chairs");if(p){let g=ne(p.mesh);g&&g.color&&(i={r:g.color.r,g:g.color.g,b:g.color.b})}let f=o.fbxMeshes.find(g=>g.name==="Floor");if(f){let g=ne(f.mesh);g&&g.color&&(a={r:g.color.r,g:g.color.g,b:g.color.b})}}n||(n=window.savedColorSettings?.primary||window.savedColorSettings?.Main_Structure||Fn()),i||(i=window.savedColorSettings?.secondary||window.savedColorSettings?.Chairs||Fn()),a||(a=window.savedColorSettings?.tertiary||window.savedColorSettings?.Floor||Fn()),Co.primary=n,Co.secondary=i,Co.tertiary=a,console.log("%c Color Palette ","background: #222; color: #fff; font-size: 14px; padding: 4px 8px;"),console.log(`  Primary:   ${t(n)}`),console.log(`  Secondary: ${t(i)}`),console.log(`  Tertiary:  ${t(a)}`);let r=n,s=oi(i,.6),l=oi(a,.6);xt||(document.documentElement.style.setProperty("--color-primary",e(n)),document.documentElement.style.setProperty("--color-secondary",e(i)),document.documentElement.style.setProperty("--color-tertiary",e(a)),document.documentElement.style.setProperty("--bg-main-color",e(r)),document.documentElement.style.setProperty("--bg-floor-color",e(l)),document.documentElement.style.setProperty("--bg-chairs-color",e(s))),Promise.resolve().then(()=>(Se(),$o)).then(m=>{m.setSceneBackground(r)})})}async function Mo(){window.savedColorSettings||(window.savedColorSettings={}),Promise.resolve().then(()=>(ft(),Ot)).then(e=>{if(e.fbxMeshes&&e.fbxMeshes.length>0){let n=function(){let i=Math.min(t+o,e.fbxMeshes.length);for(let a=t;a<i;a++){let r=e.fbxMeshes[a],s=ne(r.mesh);if(s){let l,m=Yr[r.name];r.name==="Main_Structure"?(l=xt?So.primary:Qr(),window.savedColorSettings.primary=l,window.savedColorSettings[r.name]=l):r.name==="Chairs"?(l=xt?So.secondary:bo(),window.savedColorSettings.secondary=l,window.savedColorSettings[r.name]=l):r.name==="Floor"?(l=xt?So.tertiary:bo(),window.savedColorSettings.tertiary=l,window.savedColorSettings[r.name]=l):r.name==="Screen"?(l=bo(),window.savedColorSettings[r.name]=l):window.savedColorSettings[r.name]?l=window.savedColorSettings[r.name]:l=r.originalColor?{r:r.originalColor.r,g:r.originalColor.g,b:r.originalColor.b}:null,l&&(s.color.setRGB(l.r,l.g,l.b),s.needsUpdate=!0)}}t=i,t<e.fbxMeshes.length?"requestIdleCallback"in window?requestIdleCallback(n,{timeout:50}):setTimeout(n,0):setTimeout(()=>{Kr()},10)},t=0,o=5;n()}window.savedLightSettings&&e.glbLights&&("requestIdleCallback"in window?requestIdleCallback(()=>{e.glbLights.forEach((t,o)=>{let n=t.name||`light_${o}`;if(window.savedLightSettings[n]){let i=window.savedLightSettings[n];t.color.setRGB(i.r,i.g,i.b);let a=Math.max(0,Math.min(i.intensity??t.intensity,10));t.intensity=a}})},{timeout:100}):setTimeout(()=>{e.glbLights.forEach((t,o)=>{let n=t.name||`light_${o}`;if(window.savedLightSettings[n]){let i=window.savedLightSettings[n];t.color.setRGB(i.r,i.g,i.b);let a=Math.max(0,Math.min(i.intensity??t.intensity,10));t.intensity=a}})},50))}),Promise.resolve().then(()=>(oo(),No)).then(e=>{let t=e.getBloomPass();t&&(t.enabled=W.enabled!==!1,W.enabled?(t.strength=W.strength,t.radius=W.radius,t.threshold=W.threshold):t.strength=0);let o=e.getBokehPass();o&&(o.enabled=N.enabled!==!1,N.enabled&&(o.uniforms.focus.value=N.focus,o.uniforms.aperture.value=N.aperture,o.uniforms.maxblur.value=N.maxblur))})}async function Zr(){await xo(!0),await Mo()}async function Pn(){xt=!1,await Mo()}async function Jr(){xt=!0,await Mo()}function Dn(e,t){try{let o={};e&&Array.isArray(e)&&e.forEach((a,r)=>{let s=ne(a.mesh);if(s?.color){let l=a.name||`mesh_${r}`;o[l]={r:s.color.r,g:s.color.g,b:s.color.b}}});let n={};t&&Array.isArray(t)&&t.forEach((a,r)=>{let s=a.name||`light_${r}`;n[s]={r:a.color.r,g:a.color.g,b:a.color.b,intensity:a.intensity}});let i={moveSpeed:Ve,cameraSettings:fe,startCameraPosition:Le,startCameraRotation:ke,colorSettings:o,lightSettings:n,bloomSettings:W,dofSettings:N,pageColorSettings:ze,scrollSettings:Mt,canvasSettings:vo,screenSettings:Et,textureRotationSettings:le,pageBackgroundSettings:te}}catch(o){console.warn("Failed to collect settings:",o)}}function es(e,t){try{let o={};e.forEach((l,m)=>{let p=ne(l.mesh);if(p?.color){let f=l.name||`mesh_${m}`;o[f]={r:p.color.r,g:p.color.g,b:p.color.b}}});let n={};t.forEach((l,m)=>{let p=l.name||`light_${m}`;n[p]={r:l.color.r,g:l.color.g,b:l.color.b,intensity:l.intensity}});let i={version:"1.0.0",constants:Eo,settings:{moveSpeed:Ve,pageColorSettings:ze,scrollSettings:Mt,canvasSettings:vo,cameraSettings:fe,startCameraPosition:Le,startCameraRotation:ke,bloomSettings:W,dofSettings:N,colorSettings:o,lightSettings:n,screenSettings:Et,textureRotationSettings:le,pageBackgroundSettings:te}},a=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),r=URL.createObjectURL(a),s=document.createElement("a");s.href=r,s.download="dome-dreaming-settings.json",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r)}catch(o){console.error("Failed to export settings file:",o)}}var Eo,Ve,fe,Le,ke,Je,et,W,N,ze,Mt,vo,Et,le,te,So,Yr,Co,xt,ei,ti,Re=K(()=>{Ne();Eo={cameraHeight:1.6,navmeshSearchBox:{x:5,y:10,z:5},screenMaterialSettings:{emissive:[1,1,1],emissiveIntensity:1,color:[1,1,1],toneMapped:!1,transparent:!1,opacity:1}},Ve=.04,fe={sensitivity:.002,rotationSpeed:120},Le={x:0,y:5.4,z:-4.3},ke={x:-2.8,y:0,z:3.121154018741333},Je={x:0,y:0,z:0},et={x:0,y:0,z:0},W={enabled:!1,strength:1.5,radius:.4,threshold:.85},N={enabled:!0,focus:12,aperture:.0014,maxblur:.05},ze={backgroundColor:"#000000",textColor:"#ffffff",dotColor:"#ffffff",sidebarColor:"#333333",sidebarVisible:!0,headerIslandVisible:!1,blendMode:"normal",vignette:{enabled:!1,size:8,fadeWidth:2}},Mt={enabled:!0,scrollTimeout:25,touchThreshold:30,snapThreshold:.5,initialSnapThreshold:1,gridColumns:16,gridRows:16},vo={rows:8},Et={defaultImage:"assets/img/jpg/background-dome-dreaming.jpg"},le={enabled:!0,speed:.02},te={canvas:{backgroundColor:"#000000",backgroundImage:null},about:{backgroundColor:"#463434",backgroundImage:null},team:{backgroundColor:"#000000",backgroundImage:null}};So={primary:{r:.4,g:.45,b:.5},secondary:{r:.55,g:.32,b:.38},tertiary:{r:.65,g:.52,b:.25}},Yr={Main_Structure:"primary",Chairs:"secondary",Floor:"tertiary"},Co={primary:null,secondary:null,tertiary:null};xt=!0,ei=[{r:.38,g:.42,b:.48},{r:.45,g:.48,b:.52},{r:.42,g:.45,b:.5},{r:.48,g:.45,b:.42}],ti=[{r:.55,g:.32,b:.38},{r:.65,g:.52,b:.25},{r:.45,g:.55,b:.42},{r:.6,g:.4,b:.32},{r:.4,g:.5,b:.58},{r:.48,g:.3,b:.45}]});Re();Re();_e();var Gt=!1,ai=0,ts=30,Bn=0,os=0,$n=!1,On=0,tt=0;function ii(e){let o=mt()*2;return Math.round(e/o)*o}function An(){if(Gt)return;let e=window.pageYOffset||document.documentElement.scrollTop,t=ii(e);Math.abs(e-t)>1&&(Gt=!0,window.scrollTo({top:t,behavior:"auto"}),setTimeout(()=>{Gt=!1},50))}function ns(){if(Gt)return;let e=window.pageYOffset||document.documentElement.scrollTop,t=ii(e),n=xe()?5:1;Math.abs(e-t)>n&&An()}function ri(e){let t=Date.now();if(t-ai<ts)return;let o=mt(),n=window.pageYOffset||document.documentElement.scrollTop,i=o*2;if(e!==0){let s=(Math.round(n/i)+e)*i,l=Math.max(document.body.scrollHeight-window.innerHeight,document.documentElement.scrollHeight-window.innerHeight),m=Math.max(0,Math.min(s,l));Math.abs(m-n)>1&&(ai=t,window.scrollTo({top:m,behavior:"auto"}))}}function as(e){if(document.body.classList.contains("dome-mode"))return;e.preventDefault();let t=e.deltaY,o=0;t>0?o=1:t<0&&(o=-1),o!==0&&ri(o)}function is(e){if(document.body.classList.contains("dome-mode"))return;let t=e.target;t.closest("a")||t.closest("button")||t.tagName==="A"||t.tagName==="BUTTON"||e.touches.length===1&&(Bn=e.touches[0].clientY,On=Bn,os=Date.now(),$n=!1,tt=0)}function rs(e){if(document.body.classList.contains("dome-mode"))return;let t=e.target;if(t.closest("a")||t.closest("button")||t.tagName==="A"||t.tagName==="BUTTON"||e.touches.length!==1)return;e.preventDefault();let o=e.touches[0].clientY,n=On-o,i=Bn-o;Math.abs(i)>10&&($n=!0),tt+=n,On=o;let s=mt()*2*.2;if(Math.abs(tt)>=s){let l=tt>0?1:-1;ri(l),tt=tt%s}}function ss(e){if(document.body.classList.contains("dome-mode"))return;let t=e.target;t.closest("a")||t.closest("button")||t.tagName==="A"||t.tagName==="BUTTON"||(e.preventDefault(),$n=!1,tt=0)}function Gn(){if(!Mt.enabled||document.body.classList.contains("dome-mode"))return;window.addEventListener("wheel",as,{passive:!1}),document.addEventListener("touchstart",is,{passive:!1}),document.addEventListener("touchmove",rs,{passive:!1}),document.addEventListener("touchend",ss,{passive:!1});let e=null;window.addEventListener("scroll",()=>{if(Gt)return;e&&clearTimeout(e),e=setTimeout(()=>{ns(),e=null},30)},{passive:!0}),window.addEventListener("load",()=>{setTimeout(()=>{An()},100)}),window.addEventListener("resize",()=>{setTimeout(()=>{An()},100)})}var Pt=null,Tt=16,Nn=0,ls=0;function cs(){let e=document.getElementById("dots");e&&e.remove(),Pt=document.createElement("div"),Pt.id="dots",document.body.appendChild(Pt),jn(),Wn()}function jn(){let e=getComputedStyle(document.documentElement),t=document.documentElement.clientWidth||window.innerWidth,o=e.getPropertyValue("--col-width");o?Nn=parseFloat(o)||t/Tt:Nn=t/Tt;let n=e.getPropertyValue("--row-height"),i=parseFloat(n);ls=!isNaN(i)&&i>0?i:Nn}function Wn(){if(!Pt)return;Pt.innerHTML="";let t=16*Tt,o=32,n=0;function i(){let a=Math.min(n+o,t);for(let r=n;r<a;r++){let s=Math.floor(r/Tt),l=r%Tt,m=document.createElement("div");m.className="dot",m.dataset.col=l+1,m.dataset.row=s+1,m.style.gridColumn=l+1,m.style.gridRow=s+1,m.style.pointerEvents="none";let p=l+1,f=s+1,g=p+(f-1)*Tt;m.style.setProperty("--dot-delay",g),Pt.appendChild(m)}n=a,n<t&&("requestIdleCallback"in window?requestIdleCallback(i,{timeout:50}):setTimeout(i,0))}i()}function qn(){cs();let e,t=()=>{clearTimeout(e),e=setTimeout(()=>{jn(),Wn()},150)};window.addEventListener("resize",t),window.addEventListener("orientationchange",()=>{setTimeout(()=>{jn(),Wn()},300)})}function To(e){document.querySelectorAll(".dashboard-block.active, .page-content .block.active").forEach(t=>{t.classList.remove("active")}),e.classList.add("active")}function Vn(){"requestIdleCallback"in window?requestIdleCallback(()=>{document.querySelectorAll(".dashboard-block").forEach(o=>{o.addEventListener("click",()=>{To(o)})}),document.querySelectorAll(".page-content .block img").forEach(o=>{let n=o.closest(".block");n&&n.addEventListener("click",()=>{To(n)})})},{timeout:200}):setTimeout(()=>{document.querySelectorAll(".dashboard-block").forEach(o=>{o.addEventListener("click",()=>{To(o)})}),document.querySelectorAll(".page-content .block img").forEach(o=>{let n=o.closest(".block");n&&n.addEventListener("click",()=>{To(n)})})},50)}_e();function _n(){let e=getComputedStyle(document.documentElement),t=parseFloat(e.getPropertyValue("--grid-rows"))||16,o=mt();document.querySelectorAll(".page-section").forEach(i=>{let a=i.querySelector(".block.responsive");if(!a)return;let r=i.style.height,s=i.style.minHeight,l=i.style.getPropertyValue("--section-grid-rows");i.style.height="auto",i.style.minHeight="auto",i.style.removeProperty("--section-grid-rows"),i.offsetHeight;let m=a.offsetHeight;i.style.height=r,i.style.minHeight=s,l&&i.style.setProperty("--section-grid-rows",l);let p=Math.ceil(m/o);p=Math.max(1,p),p=p+2,i.style.setProperty("--section-grid-rows",p.toString())})}function Un(){window.addEventListener("load",()=>{setTimeout(()=>{_n()},100)});let e,t=()=>{clearTimeout(e),e=setTimeout(()=>{_n()},100)};window.addEventListener("resize",t),window.addEventListener("orientationchange",t),window.visualViewport&&window.visualViewport.addEventListener("resize",t),(document.readyState==="complete"||document.readyState==="interactive")&&setTimeout(()=>{_n()},100)}_e();_e();var A=null,nt=null,Yn=null,ot=!1,si=!1;function li(e){A=e}function ci(e,t){Yn=e,nt=t}function Xn(){let e=document.getElementById("keyboard-exit-btn"),t=document.body;function o(){e&&(t.classList.contains("dome-mode")?xe()?(e.textContent="exit",e.style.display="flex"):e.style.display="none":(e.textContent="enter",e.style.display="flex",e.disabled=!1,e.style.pointerEvents="auto"))}function n(r=!1){if(t.classList.contains("dome-mode"))return;t.classList.add("dome-mode"),document.documentElement.style.overflow="hidden",o();let s=document.getElementById("canvas-container");if(s){let m=getComputedStyle(document.documentElement).getPropertyValue("--actual-vh");s.style.height=m||"100vh",s.style.width="100vw",setTimeout(()=>{window.dispatchEvent(new Event("resize"))},0)}let l=xe();if(si=r&&!l,r&&A&&!l&&!(document.pointerLockElement===A||document.mozPointerLockElement===A||document.webkitPointerLockElement===A)){let p=setTimeout(()=>{if(!t.classList.contains("dome-mode")||ot)return;let f=A.requestPointerLock||A.mozRequestPointerLock||A.webkitRequestPointerLock;if(f)try{f.call(A).catch(g=>{g.name!=="SecurityError"&&g.name!=="NotAllowedError"&&console.warn("Pointer lock request failed:",g)})}catch(g){g.name!=="SecurityError"&&g.name!=="NotAllowedError"&&console.warn("Pointer lock request failed:",g)}},100);window.pointerLockTimeout=p}setTimeout(()=>{window.setupCameraButton&&window.setupCameraButton()},150)}function i(){if(!ot){if(ot=!0,window.pointerLockTimeout&&(clearTimeout(window.pointerLockTimeout),window.pointerLockTimeout=null),A&&(document.pointerLockElement===A||document.mozPointerLockElement===A||document.webkitPointerLockElement===A))try{document.exitPointerLock()}catch(r){r.name!=="SecurityError"&&console.warn("Error exiting pointer lock:",r)}if(t.classList.contains("dome-mode")){t.classList.remove("dome-mode"),document.documentElement.style.overflow="auto";let r=document.getElementById("canvas-container");r&&(r.style.width=""),o(),setTimeout(()=>{window.setupCameraButton&&window.setupCameraButton(),setTimeout(()=>{ot=!1},100)},0)}else ot=!1}}window.enterDomeModeFromCanvas=()=>{n(!0)},window.enterDomeModeWithAudio=async()=>{if(n(!1),Yn)try{await Yn()}catch(r){console.warn("Could not start audio:",r)}},e&&(e.addEventListener("click",r=>{if(r.stopPropagation(),!t.classList.contains("dome-mode"))n(!0);else if(xe()&&(i(),nt))try{nt()}catch(s){console.warn("Could not stop audio:",s)}}),e.addEventListener("touchend",r=>{if(r.stopPropagation(),r.preventDefault(),!t.classList.contains("dome-mode"))n(!0);else if(xe()&&(i(),nt))try{nt()}catch(s){console.warn("Could not stop audio:",s)}})),o(),document.addEventListener("keydown",r=>{if(r.key==="Escape"&&t.classList.contains("dome-mode")&&(i(),nt))try{nt()}catch(s){console.warn("Could not stop audio:",s)}});function a(){if(ot)return;let r=A&&(document.pointerLockElement===A||document.mozPointerLockElement===A||document.webkitPointerLockElement===A),s=xe();!r&&t.classList.contains("dome-mode")&&!s&&si&&setTimeout(()=>{!ot&&t.classList.contains("dome-mode")&&!(document.pointerLockElement===A||document.mozPointerLockElement===A||document.webkitPointerLockElement===A)&&i()},50)}document.addEventListener("pointerlockchange",a),document.addEventListener("mozpointerlockchange",a),document.addEventListener("webkitpointerlockchange",a)}var v=null;function di(e){v=e}function ui(){document.querySelectorAll(".wasd-key-btn").forEach(t=>{let o=t.getAttribute("data-key");o&&(t.addEventListener("touchstart",n=>{n.preventDefault(),n.stopPropagation(),t.classList.add("active"),v&&(o==="w"&&(v.forward=!0),o==="s"&&(v.backward=!0),o==="a"&&(v.left=!0),o==="d"&&(v.right=!0),o==="q"&&(v.rotateLeft=!0),o==="e"&&(v.rotateRight=!0))}),t.addEventListener("touchend",n=>{n.preventDefault(),n.stopPropagation(),t.classList.remove("active"),v&&(o==="w"&&(v.forward=!1),o==="s"&&(v.backward=!1),o==="a"&&(v.left=!1),o==="d"&&(v.right=!1),o==="q"&&(v.rotateLeft=!1),o==="e"&&(v.rotateRight=!1))}),t.addEventListener("touchcancel",n=>{n.preventDefault(),n.stopPropagation(),t.classList.remove("active"),v&&(o==="w"&&(v.forward=!1),o==="s"&&(v.backward=!1),o==="a"&&(v.left=!1),o==="d"&&(v.right=!1),o==="q"&&(v.rotateLeft=!1),o==="e"&&(v.rotateRight=!1))}),t.addEventListener("mousedown",n=>{n.preventDefault(),n.stopPropagation(),t.classList.add("active"),v&&(o==="w"&&(v.forward=!0),o==="s"&&(v.backward=!0),o==="a"&&(v.left=!0),o==="d"&&(v.right=!0),o==="q"&&(v.rotateLeft=!0),o==="e"&&(v.rotateRight=!0))}),t.addEventListener("mouseup",n=>{n.preventDefault(),n.stopPropagation(),t.classList.remove("active"),v&&(o==="w"&&(v.forward=!1),o==="s"&&(v.backward=!1),o==="a"&&(v.left=!1),o==="d"&&(v.right=!1),o==="q"&&(v.rotateLeft=!1),o==="e"&&(v.rotateRight=!1))}),t.addEventListener("mouseleave",()=>{t.classList.remove("active"),v&&(o==="w"&&(v.forward=!1),o==="s"&&(v.backward=!1),o==="a"&&(v.left=!1),o==="d"&&(v.right=!1),o==="q"&&(v.rotateLeft=!1),o==="e"&&(v.rotateRight=!1))}),t.addEventListener("click",()=>{t.classList.remove("active")}))})}var jt,ds,ce,us,fi,yi,Qn,Kn,Si,Zn,Ci,Nt,Jn,ea,bi,Ei,Po,ta,at,Lo,ko,Ro,Io,oa,mi,na,aa,pi,ia=!1,fs=null,Fo=0,gi=0,ms=2e3;async function hi(){await new Promise(e=>{"scheduler"in window&&"postTask"in window.scheduler?window.scheduler.postTask(()=>e(),{priority:"user-blocking"}):"requestIdleCallback"in window?requestIdleCallback(()=>e(),{timeout:0}):setTimeout(()=>e(),0)}),await xo(),await new Promise(e=>setTimeout(e,0)),"requestIdleCallback"in window?requestIdleCallback(()=>{Gn(),Un(),Vn()},{timeout:100}):setTimeout(()=>{Gn(),Un(),Vn()},0),"requestIdleCallback"in window?requestIdleCallback(()=>{qn()},{timeout:500}):setTimeout(()=>{qn()},50),"requestIdleCallback"in window?requestIdleCallback(()=>{wi()},{timeout:100}):setTimeout(()=>{wi()},0)}async function vi(){if(!ia)try{jt=await import("three");let e=await Promise.resolve().then(()=>(Se(),$o)),t=await Promise.resolve().then(()=>(zt(),ua)),o=await Promise.resolve().then(()=>(Cn(),Aa)),n=await Promise.resolve().then(()=>(oo(),No));ds=e.scene,ce=e.camera,us=e.renderer,fi=e.canvas,yi=e.resetCamera,Qn=o.setupLighting,Kn=n.initPostProcessing,Si=n.updatePostProcessing,Zn=t.setupCameraControls,Ci=t.euler,li(fi),ia=!0}catch(e){console.error("Error loading Three.js:",e)}}async function Lt(){if(await vi(),!(Nt&&at))try{let e=await Promise.resolve().then(()=>(ft(),Ot)),t=await Promise.resolve().then(()=>(Kt(),ca)),o=await Promise.resolve().then(()=>(wo(),ja)),n=await Promise.resolve().then(()=>(In(),Ka)),i=await Promise.resolve().then(()=>(io(),Sa));Nt=e.loadModel,Jn=t.updateMovement,ea=t.updateRotation,bi=e.fbxMeshes,Ei=e.glbLights,Po=o.getCurrentImageTexture,ta=o.getCurrentVideoTexture,at=o.connectWebcam,Lo=o.loadImage,ko=o.loadVideo,Ro=o.disconnectWebcam,Io=o.loadDefaultScreenTexture,oa=n.updateScreenLighting,mi=t.touchMovement,na=i.updateListenerPosition,aa=i.startAudio,pi=i.stopAudio,di(mi),ci(aa,pi),window.loadModel=Nt,window.connectWebcam=at,window.loadImage=Lo,window.loadVideo=ko,window.disconnectWebcam=Ro,window.loadDefaultScreenTexture=Io}catch(e){console.error("Error loading 3D modules:",e)}}function wi(){let e=null;function t(){return e||(e=document.createElement("input"),e.type="file",e.accept="image/*,video/*",e.style.display="none",document.body.appendChild(e),e.addEventListener("change",async f=>{let g=f.target.files?.[0];g&&((!Lo||!ko)&&await Lt(),g.type.startsWith("image/")?Lo(g):g.type.startsWith("video/")&&ko(g)),e.value=""})),e}let o=document.getElementById("connect-webcam-link");o&&o.addEventListener("click",async f=>{f.preventDefault(),at||await Lt(),at()});let n=document.getElementById("upload-file-link");n&&n.addEventListener("click",f=>{f.preventDefault(),t().click()});let i=document.getElementById("keyboard-upload-btn");i&&i.addEventListener("click",f=>{f.preventDefault(),f.stopPropagation(),t().click()}),window.resetToDefaults=async function(){try{(!Ro||!Io)&&await Lt(),Ro(),Io(),yi(Le,ke,Ci),Object.assign(Je,Le),Object.assign(et,ke)}catch(f){console.error("Error during reset:",f)}};let a=!1;function r(){let f=document.getElementById("keyboard-reset-btn");if(f&&!a){let g=function(h){return h.preventDefault(),h.stopPropagation(),h.stopImmediatePropagation(),window.resetToDefaults&&window.resetToDefaults(),!1},u=f.cloneNode(!0);return f.parentNode.replaceChild(u,f),u.onclick=g,u.addEventListener("click",g,{capture:!0,passive:!1}),u.addEventListener("touchend",g,{capture:!0,passive:!1}),a=!0,!0}return!1}let s=async function(f){return f.preventDefault(),f.stopPropagation(),f.stopImmediatePropagation(),at||await Lt(),confirm("Do you want to connect your webcam to the screen?")&&at(),!1};window.setupCameraButton=function(){let f=document.getElementById("keyboard-camera-btn");if(f){let g=f.cloneNode(!0);return f.parentNode.replaceChild(g,f),g.onclick=s,g.addEventListener("click",s,{capture:!0,passive:!1}),g.addEventListener("touchend",s,{capture:!0,passive:!1}),!0}return!1},r(),setupCameraButton(),setTimeout(()=>{document.getElementById("keyboard-reset-btn")||r(),document.getElementById("keyboard-camera-btn")||setupCameraButton()},500);let l=()=>{};window.addEventListener("resize",l),window.visualViewport&&window.visualViewport.addEventListener("resize",l),window.addEventListener("orientationchange",()=>{setTimeout(l,100)}),ui();let m=document.getElementById("enter-dome-link");m&&m.addEventListener("click",async f=>{f.preventDefault(),aa||await Lt(),window.enterDomeModeWithAudio&&window.enterDomeModeWithAudio()});let p=async()=>{await vi(),Qn&&Qn(),Kn&&Kn(),Zn&&Zn(),await Lt(),Nt&&(Nt(),gs())};"requestIdleCallback"in window?requestIdleCallback(()=>p(),{timeout:2e3}):setTimeout(p,500)}function xi(e){if(fs=requestAnimationFrame(xi),!ia||!ce)return;let t=(e-Fo)/1e3;if(Fo=e,Jn&&ea&&(Jn(),ea(t)),Je.x=ce.position.x,Je.y=ce.position.y,Je.z=ce.position.z,et.x=ce.rotation.x,et.y=ce.rotation.y,et.z=ce.rotation.z,e-gi>=ms&&(Object.assign(Le,Je),Object.assign(ke,et),Dn(bi,Ei),gi=e),Po&&ps(t),oa&&oa(e),na&&jt&&ce){let n=new jt.Vector3(0,0,-1);n.applyQuaternion(ce.quaternion),na({x:ce.position.x,y:ce.position.y,z:ce.position.z},{x:n.x,y:n.y,z:n.z})}Si()}function ps(e){if(!le.enabled||!jt||!Po)return;let t=Po(),o=ta?ta():null,n=t||o;if(n)for((!n.center||n.center.x!==.5||n.center.y!==.5)&&(n.center?n.center.set(.5,.5):n.center=new jt.Vector2(.5,.5)),n.rotation-=le.speed*e;n.rotation<0;)n.rotation+=Math.PI*2}function gs(){Fo=performance.now(),xi(Fo)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{hi(),Xn()}):(hi(),Xn());
