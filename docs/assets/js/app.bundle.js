var si=Object.defineProperty;var ne=(e,t)=>()=>(e&&(t=e(e=0)),t);var we=(e,t)=>{for(var o in t)si(e,o,{get:t[o],enumerable:!0})};import*as Po from"three";var de,Ae,Fe,vt=ne(()=>{de=1.6,Ae={x:5,y:10,z:5},Fe={emissive:new Po.Color(16777215),emissiveIntensity:1,color:new Po.Color(16777215),toneMapped:!1,transparent:!0,opacity:1}});var Kn={};we(Kn,{applyTextureToScreen:()=>nt,colorToHex:()=>li,configureTexture:()=>at,getMaterial:()=>oe,pruneObjectChildren:()=>Nt,safeTraverse:()=>ye});import*as U from"three";function nt(e,t){if(!t)return;let o=Array.isArray(t.material)?t.material[0]:t.material;if(!o){let n=new U.MeshStandardMaterial({map:e,...Fe,color:new U.Color(16777215),emissive:new U.Color(16777215),emissiveMap:e,emissiveIntensity:1});t.material=n;return}o.map&&o.map.dispose(),o.emissiveMap&&o.emissiveMap!==e&&o.emissiveMap.dispose(),o.map=e,o.emissiveMap=e,Object.assign(o,Fe),o.color.setRGB(1,1,1),o.emissive.setRGB(1,1,1),o.emissiveIntensity=1,o.needsUpdate=!0}function at(e){e.flipY=!0,e.wrapS=U.RepeatWrapping,e.wrapT=U.RepeatWrapping,e.repeat.x=1,e.repeat.y=-1,e.colorSpace=U.SRGBColorSpace,e.center.set(.5,.5),e.minFilter=U.LinearMipmapLinearFilter,e.magFilter=U.LinearFilter,e.anisotropy=16,e.generateMipmaps=!0,e.needsUpdate=!0}function oe(e){return Array.isArray(e.material)?e.material[0]:e.material}function li(e){return`#${Math.floor(e.r*255).toString(16).padStart(2,"0")}${Math.floor(e.g*255).toString(16).padStart(2,"0")}${Math.floor(e.b*255).toString(16).padStart(2,"0")}`}function Nt(e){!e||!e.children||(e.children=e.children.filter(Boolean),e.children.forEach(t=>Nt(t)))}function ye(e,t){if(!e)return;let o=[e];for(;o.length;){let n=o.pop();if(n&&(t(n),n.children&&n.children.length))for(let i=n.children.length-1;i>=0;i--){let a=n.children[i];a&&typeof a.traverse=="function"?o.push(a):n.children.splice(i,1)}}}var Ur,it=ne(()=>{vt();Ur=[new U.Color(.4,.2,.6),new U.Color(.2,.5,.6),new U.Color(.7,.4,.2)]});var Io={};we(Io,{camera:()=>y,canvas:()=>se,canvasContainer:()=>ko,renderer:()=>B,resetCamera:()=>di,scene:()=>T,setResizeHandler:()=>Ro,setSceneBackground:()=>ci});import*as ae from"three";function ci(e){e&&typeof e=="object"?T.background=new ae.Color(e.r,e.g,e.b):typeof e=="string"&&(T.background=new ae.Color(e))}function Jn(){let e=ko.getBoundingClientRect();return{width:e.width,height:e.height}}function Ro(e){window.removeEventListener("resize",Wt),Wt=e,window.addEventListener("resize",Wt)}function di(e,t,o){e&&y.position.set(e.x,e.y,e.z),t&&(y.rotation.set(t.x,t.y,t.z),y.updateMatrixWorld(),o&&o.setFromQuaternion(y.quaternion))}var T,y,B,ko,jt,se,Wt,Se=ne(()=>{T=new ae.Scene;T.background=new ae.Color(14211288);y=new ae.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);y.position.set(0,5.4,-4.3);y.rotation.set(-2.9,0,3.121154018741333);B=new ae.WebGLRenderer({antialias:!1,powerPreference:"high-performance",stencil:!1,depth:!0}),ko=document.getElementById("canvas-container");jt=Jn();B.setSize(jt.width,jt.height);B.setPixelRatio(Math.min(window.devicePixelRatio,1.5));y.aspect=jt.width/jt.height;y.updateProjectionMatrix();setTimeout(()=>{window.dispatchEvent(new Event("resize"))},100);B.shadowMap.enabled=!1;B.toneMapping=ae.NoToneMapping;B.outputColorSpace=ae.SRGBColorSpace;ko.appendChild(B.domElement);se=B.domElement,Wt=()=>{let e=Jn();y.aspect=e.width/e.height,y.updateProjectionMatrix(),B.setSize(e.width,e.height),B.setPixelRatio(Math.min(window.devicePixelRatio,1.5))};window.addEventListener("resize",Wt)});var Zn={};we(Zn,{checkHotspots:()=>gi,constrainToNavmesh:()=>ui,setNavMeshQuery:()=>qt,touchMovement:()=>Ne,updateMovement:()=>fi,updateRotation:()=>mi});import*as Gt from"three";function qt(e){$e=e}function fi(){if(!ie)return;y.updateMatrixWorld();let e=new Gt.Vector3;e.setFromMatrixColumn(y.matrixWorld,2),e.multiplyScalar(-1).normalize();let t=new Gt.Vector3;t.setFromMatrixColumn(y.matrixWorld,0),t.normalize();let o=new Gt.Vector3,n=je;fe.w&&o.add(e.clone().multiplyScalar(n)),fe.s&&o.add(e.clone().multiplyScalar(-n)),fe.a&&o.add(t.clone().multiplyScalar(-n)),fe.d&&o.add(t.clone().multiplyScalar(n));let i=n*2;if(Ne.forward&&o.add(e.clone().multiplyScalar(i)),Ne.backward&&o.add(e.clone().multiplyScalar(-i)),Ne.left&&o.add(t.clone().multiplyScalar(-i)),Ne.right&&o.add(t.clone().multiplyScalar(i)),o.length()!==0)if($e){let a=y.position.clone();a.x+=o.x,a.z+=o.z;let r={x:a.x,y:a.y-de,z:a.z},c=$e.findClosestPoint(r,{halfExtents:Ae});if(c.success)y.position.set(c.point.x,c.point.y+de,c.point.z);else{let l=$e.findClosestPoint({x:a.x,y:y.position.y-de,z:y.position.z},{halfExtents:Ae});if(l.success)y.position.set(l.point.x,l.point.y+de,y.position.z);else{let m=$e.findClosestPoint({x:y.position.x,y:y.position.y-de,z:a.z},{halfExtents:Ae});m.success&&y.position.set(y.position.x,m.point.y+de,m.point.z)}}}else y.position.add(o)}function ui(){if(!$e)return;let e={x:y.position.x,y:y.position.y-de,z:y.position.z},t=$e.findClosestPoint(e,{halfExtents:Ae});t.success&&(y.position.y=t.point.y+de)}function mi(e){fe.q||fe.Q?We(ue.rotationSpeed*(Math.PI/180)):fe.e||fe.E?We(-ue.rotationSpeed*(Math.PI/180)):We(0),rt!==0&&ie&&(z.y+=rt*e,y.quaternion.setFromEuler(z)),ie&&(Ne.rotateLeft&&(z.y+=1.5*e,y.quaternion.setFromEuler(z)),Ne.rotateRight&&(z.y-=1.5*e,y.quaternion.setFromEuler(z)))}function gi(){if(!ie||!ze||ze.length===0)return;let e=.4;for(let t=ze.length-1;t>=0;t--){let o=ze[t];if(!o||!o.object||o.triggered)continue;let n=y.position.x-o.position.x,i=y.position.z-o.position.z;if(Math.sqrt(n*n+i*i)<e){o.triggered=!0,o.object.parent&&o.object.parent.remove(o.object),ze.splice(t,1),alert(""),console.log(`Hotspot ${o.name} triggered and removed`);break}}}var $e,Ne,Vt=ne(()=>{Se();vt();Pe();xt();st();$e=null,Ne={forward:!1,backward:!1,left:!1,right:!1,rotateLeft:!1,rotateRight:!1}});var ta={};we(ta,{euler:()=>z,isPointerLocked:()=>pi,isTouching:()=>Ut,keys:()=>fe,modelLoaded:()=>ie,qeRotationSpeed:()=>rt,setModelLoaded:()=>Fo,setQeRotationSpeed:()=>We,setupCameraControls:()=>hi,touchStartX:()=>Yt,touchStartY:()=>Xt});import*as ea from"three";function Fo(e){ie=e}function We(e){rt=e}function hi(){let e=!1,t=0,o=0;se.addEventListener("mousedown",a=>{ie&&(e=!0,t=a.clientX,o=a.clientY,z.setFromQuaternion(y.quaternion),se.style.cursor="grabbing")}),se.addEventListener("mousemove",a=>{if(!e||!ie)return;let r=a.clientX-t,c=a.clientY-o;z.y-=r*ue.sensitivity,z.x-=c*ue.sensitivity,z.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,z.x)),y.quaternion.setFromEuler(z),t=a.clientX,o=a.clientY}),se.addEventListener("mouseup",()=>{e=!1,se.style.cursor="default"}),se.addEventListener("mouseleave",()=>{e=!1,se.style.cursor="default"});let n=null;se.addEventListener("touchstart",a=>{if(ie&&(a.preventDefault(),a.touches.length===1&&n===null)){let r=a.touches[0];n=r.identifier,Yt=r.clientX,Xt=r.clientY,Ut=!0,z.setFromQuaternion(y.quaternion)}},{passive:!1}),se.addEventListener("touchmove",a=>{if(ie&&(a.preventDefault(),n!==null&&a.touches.length===1)){let r=Array.from(a.touches).find(c=>c.identifier===n);if(r){let c=r.clientX-Yt,l=r.clientY-Xt;z.y-=c*ue.sensitivity,z.x-=l*ue.sensitivity,z.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,z.x)),y.quaternion.setFromEuler(z),Yt=r.clientX,Xt=r.clientY}}},{passive:!1}),se.addEventListener("touchend",a=>{a.preventDefault();for(let r=0;r<a.changedTouches.length;r++)a.changedTouches[r].identifier===n&&(n=null,Ut=!1)},{passive:!1}),se.addEventListener("touchcancel",a=>{a.preventDefault();for(let r=0;r<a.changedTouches.length;r++)a.changedTouches[r].identifier===n&&(n=null,Ut=!1)},{passive:!1});function i(a,r){let c=a.toLowerCase();["q","w","a","s","d","e"].includes(c)&&document.querySelectorAll(`[data-key="${c}"]`).forEach(m=>{r?m.classList.add("active"):m.classList.remove("active")})}window.addEventListener("keydown",a=>{let r=a.key.toLowerCase();fe[r]=!0,i(a.key,!0),(a.key==="c"||a.key==="C")&&(console.log("Camera Position:",y.position),console.log("Camera Rotation:",y.rotation)),(a.key==="q"||a.key==="Q")&&We(1.5),(a.key==="e"||a.key==="E")&&We(-1.5)}),window.addEventListener("keyup",a=>{let r=a.key.toLowerCase();fe[r]=!1,i(a.key,!1),(a.key==="q"||a.key==="Q"||a.key==="e"||a.key==="E")&&(rt=0)})}var pi,Ut,z,ie,Yt,Xt,fe,rt,xt=ne(()=>{Se();Pe();Vt();pi=!1,Ut=!1,z=new ea.Euler(-2.85,0,3.121154018741333,"YXZ"),ie=!1,Yt=0,Xt=0,fe={},rt=0});var zo={};we(zo,{getBloomPass:()=>vi,getBokehPass:()=>ft,initPostProcessing:()=>Ci,resizePostProcessing:()=>aa,updatePostProcessing:()=>Ei});import*as dt from"three";import{EffectComposer as wi}from"three/addons/postprocessing/EffectComposer.js";import{RenderPass as yi}from"three/addons/postprocessing/RenderPass.js";import{UnrealBloomPass as Si}from"three/addons/postprocessing/UnrealBloomPass.js";import{BokehPass as bi}from"three/addons/postprocessing/BokehPass.js";import"three/addons/postprocessing/OutputPass.js";import"three/addons/postprocessing/FXAAPass.js";function Ci(){let t=document.getElementById("canvas-container").getBoundingClientRect(),o=new dt.Vector2(t.width,t.height),n=new dt.WebGLRenderTarget(o.width,o.height,{type:dt.HalfFloatType,samples:0});He=new wi(B,n),oa=new yi(T,y),He.addPass(oa);let i=q.enabled!==!1?q.strength:0;lt=new Si(o,i,q.radius,q.threshold),lt.enabled=q.enabled!==!1,He.addPass(lt),ct=new bi(T,y,{focus:j.focus,aperture:j.aperture,maxblur:j.maxblur}),ct.enabled=j.enabled!==!1,He.addPass(ct),Ro(()=>{let r=document.getElementById("canvas-container").getBoundingClientRect(),c=r.width,l=r.height;y.aspect=c/l,y.updateProjectionMatrix(),B.setSize(c,l),B.setPixelRatio(Math.min(window.devicePixelRatio,1.5)),aa()}),console.log("Post-processing initialized")}function Ei(){He?He.render():B.render(T,y)}function aa(){if(He){let t=document.getElementById("canvas-container").getBoundingClientRect(),o=t.width,n=t.height;He.setSize(o,n),lt&&lt.setSize(o,n),ct&&ct.setSize(o,n),na&&na.setSize(o,n)}}function vi(){return lt}function ft(){return ct}var He,oa,lt,ct,na,Qt=ne(()=>{Se();Pe();He=null,oa=null,lt=null,ct=null,na=null});var ca={};we(ca,{audioSettings:()=>Y,createPulseSynths:()=>Jt,getActivePulseIndex:()=>Ao,getTickIntensity:()=>Bo,initAudio:()=>la,isAudioEnabled:()=>Uo,isAudioInitialized:()=>Li,setMasterVolume:()=>qo,setReverbWet:()=>Vo,setScrambleTrigger:()=>Do,setSpatialSpread:()=>_o,setTotalPulseCount:()=>$o,startAudio:()=>Wo,stopAudio:()=>jo,updateListenerPosition:()=>Ti,updatePulseAudio:()=>Go,updateTickIntensity:()=>No});function Do(e){Ho=e}function Bo(){return Mt}function Ao(){return Oo}function $o(e){sa=e}function No(){Mt=Math.max(0,Mt-.15),Mt<=0&&(Oo=-1)}async function Mi(){return K||(window.Tone?(K=window.Tone,K):new Promise((e,t)=>{let o=document.createElement("script");o.src="https://cdn.jsdelivr.net/npm/tone@14.7.77/build/Tone.js",o.onload=()=>{K=window.Tone,console.log("Tone.js loaded for spatial audio"),e(K)},o.onerror=t,document.head.appendChild(o)}))}async function la(){if(Lt)return!0;try{return await Mi(),K?(await K.start(),console.log("Spatial audio context started"),Tt=new K.Reverb({decay:6,wet:Y.reverbWet}).toDestination(),await Tt.generate(),Kt=new K.Gain(Y.masterVolume).connect(Tt),Lt=!0,!0):!1}catch(e){return console.error("Error initializing spatial audio:",e),!1}}function Jt(e){if(!K||!Lt){console.log("Cannot create synths - audio not initialized");return}xe.forEach(t=>{try{t.synth.dispose(),t.panner&&t.panner.dispose(),t.panner3d&&t.panner3d.dispose()}catch{}}),xe=[];for(let t=0;t<e;t++){let o=new K.Panner(0).connect(Kt),n=t%2===1,i;n?i=new K.Synth({oscillator:{type:"triangle"},envelope:{attack:.001,decay:.15,sustain:0,release:.1},volume:-6}).connect(o):i=new K.Synth({oscillator:{type:"triangle"},envelope:{attack:2,decay:.5,sustain:.7,release:2},volume:0}).connect(o),xe.push({synth:i,panner:o,playing:!1,frequency:n?ra[Math.floor(t/2)%ra.length]:ia[Math.floor(t/2)%ia.length],isTick:n,lastTickTime:0,tickInterval:6e4/Y.tickBPM*(1+t*.25),x:0,y:0,z:0})}console.log(`Created ${e} spatial synths`),ut&&xe.forEach((t,o)=>{!t.playing&&!t.isTick?(t.synth.triggerAttack(t.frequency),t.playing=!0,console.log(`Started drone synth ${o} at ${t.frequency}Hz`)):t.isTick&&(t.playing=!0,t.lastTickTime=performance.now())})}async function Wo(){return console.log("Starting spatial audio..."),!Lt&&!await la()?(console.error("Failed to initialize audio"),!1):(xe.length===0&&Jt(8),ut=!0,Y.enabled=!0,xe.forEach((e,t)=>{!e.playing&&!e.isTick?(e.synth.triggerAttack(e.frequency),e.playing=!0,console.log(`Started drone synth ${t} at ${e.frequency}Hz`)):e.isTick&&(e.playing=!0,e.lastTickTime=performance.now(),console.log(`Tick synth ${t} ready at ${e.frequency}Hz`))}),!0)}function jo(){ut=!1,Y.enabled=!1,xe.forEach(e=>{if(e.playing){try{e.synth.triggerRelease()}catch{}e.playing=!1}}),console.log("Spatial audio stopped")}function Go(e,t){if(!ut||xe.length===0)return;let o=Y.spatialSpread,{circleStep:n}=t,i=performance.now();e.forEach((a,r)=>{if(r>=xe.length)return;let c=xe[r],l=Math.cos(a.angle)*.8;if(c.panner&&(c.panner.pan.value=l),c.x=Math.cos(a.angle)*a.circle,c.y=a.circle,c.z=Math.sin(a.angle)*a.circle,c.isTick){let m=6e4/Y.tickBPM*(1+r*.1);if(i-c.lastTickTime>=m){try{c.synth.triggerAttackRelease(c.frequency,"64n"),Ho&&Ho(),Mt=1,xi=i,Oo=Math.floor(Math.random()*sa)}catch(p){console.error("Tick error:",p)}c.lastTickTime=i}}else{let p=Math.sin(a.angle*2)*2;c.synth.volume.value=-6+p}})}function Ti(e,t){if(!(!K||!ut))try{let o=K.Listener;o.positionX.value=e.x||0,o.positionY.value=e.y||0,o.positionZ.value=e.z||0,t&&(o.forwardX.value=t.x||0,o.forwardY.value=t.y||0,o.forwardZ.value=t.z||-1)}catch{}}function qo(e){Y.masterVolume=e,Kt&&Kt.gain.rampTo(e,.1)}function Vo(e){Y.reverbWet=e,Tt&&Tt.wet.rampTo(e,.1)}function _o(e){Y.spatialSpread=e}function Uo(){return ut}function Li(){return Lt}var Ho,xi,Mt,Oo,sa,K,Lt,ut,xe,Kt,Tt,ia,ra,Y,Zt=ne(()=>{Ho=null;xi=0,Mt=0,Oo=-1;sa=8;K=null,Lt=!1,ut=!1,xe=[],Kt=null,Tt=null,ia=[55,65.41,73.42,82.41],ra=[440,523.25,659.25,783.99],Y={enabled:!1,masterVolume:.5,reverbWet:.5,spatialSpread:15,tickBPM:60}});import*as oo from"three";function ki(e,t,o,n,i,a,r,c,l,m,p){e.font=`${r}px OffBit, monospace`,e.fillStyle=c,e.textAlign="center",e.textBaseline="middle";let h=t.split(""),f=h.length*l,s=m?-1:1,g=a-f/2*s;for(let d of h){let S=o+Math.cos(g)*i,C=n+Math.sin(g)*i;e.save(),e.translate(S,C);let v=g+Math.PI/2;p&&(v+=Math.PI),e.rotate(v),e.fillText(d,0,0),e.restore(),g+=l*s}}function ha(e,t,o,n,i,a,r,c,l=.08,m=!1,p=!1){let h=t.split(`
`),f=r*1.4,s=(h.length-1)*f;h.forEach((g,d)=>{let S=p?(d-(h.length-1)/2)*f:((h.length-1)/2-d)*f,C=i+S;ki(e,g,o,n,C,a,r,c,l,m,p)})}function wa(e,t,o,n,i,a,r,c,l,m,p,h){let f=t.split(""),s=f.length,g=i*a,S=i*(a+1)-g,C=u.textVerticalOffset||.5,v=g+S*C,P=2*Math.PI/c,F=(u.globalFontSize||100)/100,I=S*l/100*F*.8;e.font=`${I}px OffBit, monospace`,e.textAlign="center",e.textBaseline="middle";let N=p?-1:1;for(let V=0;V<s;V++){let W=f[V];if(W===" ")continue;let H=(r+V*N+c)%c*P-Math.PI/2+P/2,w=o+Math.cos(H)*v,x=n+Math.sin(H)*v;e.save(),e.translate(w,x);let Bt=H+Math.PI/2;h&&(Bt+=Math.PI),e.rotate(Bt),e.globalCompositeOperation="difference",u.textShadow&&(e.shadowColor=u.textShadowColor,e.shadowBlur=u.textShadowBlur,e.shadowOffsetX=2,e.shadowOffsetY=2),u.textOutline&&(e.strokeStyle=u.textOutlineColor,e.lineWidth=u.textOutlineWidth,e.strokeText(W,0,0)),e.fillStyle=m,e.shadowBlur=0,e.fillText(W,0,0),e.restore()}}function Yo(e,t,o){return{r:e.r+(t.r-e.r)*o,g:e.g+(t.g-e.g)*o,b:e.b+(t.b-e.b)*o}}function Ri(e,t,o,n,i,a,r,c,l=8){e.strokeStyle=c,e.lineWidth=.5;let m=(a+r)/2,p=(n+i)/2,f=(i-n)/l;for(let s=0;s<l;s++){let g=n+f*s+f/2;e.beginPath(),e.arc(t,o,g,a,r),e.stroke()}}function Ii(e,t,o,n,i,a,r,c,l=12){e.strokeStyle=c,e.lineWidth=.5;let m=(r-a)/l;for(let p=0;p<=l;p++){let h=a+m*p;e.beginPath(),e.moveTo(t+Math.cos(h)*n,o+Math.sin(h)*n),e.lineTo(t+Math.cos(h)*i,o+Math.sin(h)*i),e.stroke()}}function Fi(e,t,o,n,i,a,r,c,l=5){let m=(a+r)/2,p=(n+i)/2,h=Math.min(i-n,(r-a)*p)/2,f=t+Math.cos(m)*p,s=o+Math.sin(m)*p;e.strokeStyle=c,e.lineWidth=.5;for(let g=1;g<=l;g++){let d=h/l*g;e.beginPath(),e.arc(f,s,d,0,Math.PI*2),e.stroke()}}function zi(e,t,o,n,i,a,r,c,l=4){e.fillStyle=c;let m=(a+r)/2,p=r-a,h=i-n,f=Math.min(h,p*n)/(l*4);for(let s=0;s<l;s++)for(let g=0;g<l;g++){let d=n+h/l*(s+.5),S=a+p/l*(g+.5),C=t+Math.cos(S)*d,v=o+Math.sin(S)*d;e.beginPath(),e.arc(C,v,f,0,Math.PI*2),e.fill()}}function Hi(e,t,o,n,i,a,r,c,l=24){let m=(a+r)/2,p=(n+i)/2,h=Math.min(i-n,(r-a)*p)/2,f=t+Math.cos(m)*p,s=o+Math.sin(m)*p;e.strokeStyle=c,e.lineWidth=.5;for(let g=0;g<l;g++){let d=Math.PI*2/l*g;e.beginPath(),e.moveTo(f+Math.cos(d)*(h*.2),s+Math.sin(d)*(h*.2)),e.lineTo(f+Math.cos(d)*h,s+Math.sin(d)*h),e.stroke()}}function Di(e,t,o,n,i,a,r,c,l,m,p,h=0){let f=Math.sin(h)*.5+.5;switch(l){case"horizontal":Ri(e,t,o,n,i,a,r,c,6+m);break;case"radial":Ii(e,t,o,n,i,a,r,c,8+p%4);break;case"concentric":Fi(e,t,o,n,i,a,r,c,4+m%3);break;case"dots":zi(e,t,o,n,i,a,r,c,3+m%2);break;case"sunburst":Hi(e,t,o,n,i,a,r,c,16+m*2);break;case"diagonal":ji(e,t,o,n,i,a,r,c,5,p%2?1:-1);break;case"gradient":let s=.3+f*.5;Wi(e,t,o,n,i,a,r,c,s,h);break;case"square":fa(e,t,o,n,i,a,r,c,!0);break;case"squareOutline":fa(e,t,o,n,i,a,r,c,!1);break;case"grayscale":Oi(e,t,o,n,i,a,r,p%2?"horizontal":"vertical");break;case"rainbow":Bi(e,t,o,n,i,a,r);break;case"checker":Ni(e,t,o,n,i,a,r,c);break}}function fa(e,t,o,n,i,a,r,c,l=!0){let m=(a+r)/2,p=(n+i)/2,h=Math.min(i-n,(r-a)*p)*.7,f=t+Math.cos(m)*p,s=o+Math.sin(m)*p;e.save(),e.translate(f,s),e.rotate(m+Math.PI/2),l?(e.fillStyle=c,e.fillRect(-h/2,-h/2,h,h),e.fillStyle="#000000",e.fillRect(-h/4,-h/4,h/2,h/2)):(e.strokeStyle=c,e.lineWidth=2,e.strokeRect(-h/2,-h/2,h,h)),e.restore()}function Oi(e,t,o,n,i,a,r,c="radial"){e.save(),e.beginPath(),e.arc(t,o,i,a,r),e.arc(t,o,n,r,a,!0),e.closePath(),e.clip();let l;if(c==="radial")l=e.createRadialGradient(t,o,n,t,o,i);else{let m=(a+r)/2,p=(n+i)/2,h=t+Math.cos(a)*p,f=o+Math.sin(a)*p,s=t+Math.cos(r)*p,g=o+Math.sin(r)*p;l=e.createLinearGradient(h,f,s,g)}l.addColorStop(0,"#ffffff"),l.addColorStop(.5,"#888888"),l.addColorStop(1,"#000000"),e.fillStyle=l,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.restore()}function Bi(e,t,o,n,i,a,r){e.save(),e.beginPath(),e.arc(t,o,i,a,r),e.arc(t,o,n,r,a,!0),e.closePath(),e.clip();let c=7,l=["#ff0000","#ff8800","#ffff00","#00ff00","#00ffff","#0000ff","#ff00ff"],m=(r-a)/c;for(let p=0;p<c;p++){let h=a+p*m,f=h+m;e.fillStyle=l[p],e.beginPath(),e.moveTo(t,o),e.arc(t,o,i*1.1,h,f),e.closePath(),e.fill()}e.restore()}function Ai(e,t,o,n,i,a,r,c,l=!0,m=.5){if(!t||!t.complete)return;e.save(),e.beginPath(),e.arc(o,n,a,r,c),e.arc(o,n,i,c,r,!0),e.closePath(),e.clip();let p=(r+c)/2,h=(i+a)/2,f=a-i,s=(c-r)*h,g=o+Math.cos(p)*h,d=n+Math.sin(p)*h,S=t.width/t.height,C=s/f,v,P;if(S>C?(P=f*1.4,v=P*S):(v=s*1.4,P=v/S),e.translate(g,d),e.rotate(p-Math.PI/2),e.scale(1,-1),l){let F=document.createElement("canvas"),I=Math.max(v,P)*1.5;F.width=I,F.height=I;let N=F.getContext("2d");N.drawImage(t,0,0,I,I);let V=N.getImageData(0,0,I,I),W=V.data,pe=m*255;for(let H=0;H<W.length;H+=4){let x=W[H]*.299+W[H+1]*.587+W[H+2]*.114>pe?255:0;W[H]=x,W[H+1]=x,W[H+2]=x}N.putImageData(V,0,0),e.drawImage(F,-v/2,-P/2,v,P)}else e.drawImage(t,-v/2,-P/2,v,P);e.restore()}function $i(e){return eo.has(e)?Promise.resolve(eo.get(e)):new Promise((t,o)=>{let n=new Image;e.startsWith("http")&&!e.includes(window.location.hostname)&&(n.crossOrigin="anonymous"),n.onload=()=>{eo.set(e,n),t(n)},n.onerror=()=>{console.warn(`Failed to load image: ${e}`),t(null)},n.src=e})}async function ya(){let e=Xo.map(t=>$i(t).catch(()=>null));await Promise.all(e)}function Ni(e,t,o,n,i,a,r,c){let l=(a+r)/2,m=(n+i)/2,p=Math.min(i-n,(r-a)*m)*.8,h=t+Math.cos(l)*m,f=o+Math.sin(l)*m;e.save(),e.translate(h,f),e.rotate(l+Math.PI/2);let s=p/4;for(let g=0;g<4;g++)for(let d=0;d<4;d++)e.fillStyle=(g+d)%2===0?c:"#000000",e.fillRect(-p/2+d*s,-p/2+g*s,s,s);e.restore()}function Wi(e,t,o,n,i,a,r,c,l,m){let p=(a+r)/2,h=(n+i)/2,f=Math.sin(m)*.3,s=e.createRadialGradient(t+Math.cos(p)*h*f,o+Math.sin(p)*h*f,0,t,o,i),g=parseInt(c.slice(1,3),16),d=parseInt(c.slice(3,5),16),S=parseInt(c.slice(5,7),16);s.addColorStop(0,`rgba(${g}, ${d}, ${S}, ${l})`),s.addColorStop(1,`rgba(${g}, ${d}, ${S}, 0)`),e.fillStyle=s,e.beginPath(),e.arc(t,o,i,a,r),e.arc(t,o,n,r,a,!0),e.closePath(),e.fill()}function ji(e,t,o,n,i,a,r,c,l=6,m=1){let p=(a+r)/2,h=(n+i)/2,f=(r-a)*h,s=i-n;e.save(),e.beginPath(),e.arc(t,o,i,a,r),e.arc(t,o,n,r,a,!0),e.closePath(),e.clip(),e.strokeStyle=c,e.lineWidth=.5;let g=t+Math.cos(p)*h,d=o+Math.sin(p)*h,S=Math.max(f,s)*1.5,C=S/l;for(let v=-l;v<=l;v++)e.beginPath(),e.moveTo(g-S/2+v*C,d-S/2),e.lineTo(g-S/2+v*C+S*m,d+S/2),e.stroke();e.restore()}function Sa(e=1024,t={}){let{backgroundColor:o="#000000",lineWidth:n=u.lineWidth||2,tickWidth:i=u.tickWidth||1,numCircles:a=8,numRadialLines:r=36,showLabels:c=!0,labelColor:l="#ffffff",fontSize:m=e/40,mainColor:p={r:.4,g:.45,b:.5},chairsColor:h={r:.55,g:.32,b:.38},floorColor:f={r:.65,g:.52,b:.25},curvedTexts:s=[]}=t;u.mainColor=p,u.chairsColor=h,u.floorColor=f;let g=document.createElement("canvas");g.width=e,g.height=e;let d=g.getContext("2d",{alpha:!1,willReadFrequently:!1});u.antialias?(d.imageSmoothingEnabled=!0,d.imageSmoothingQuality="high"):d.imageSmoothingEnabled=!1,d.lineCap="round",d.lineJoin="round";let S=e/2,C=e/2,v=e/2-m*2;d.fillStyle=o,d.fillRect(0,0,e,e);let P=k=>{let R=(k%360+360)%360;return R<120?Yo(p,h,R/120):R<240?Yo(h,f,(R-120)/120):Yo(f,p,(R-240)/120)},F=v/a,I=2*Math.PI/r,N=Math.floor((p.r+h.g+f.b)*1e3),V=(k,R)=>{let O=Math.sin(N+k*127+R*311)*1e4;return O-Math.floor(O)},W=[],pe=[];if(u.imageCellsEnabled){let k=Math.min(u.imageCellCount||12,Xo.length),R=new Set,O=u.imageThreshold,G=u.imageThresholdLevel||.5,te=[...Xo].sort(()=>Math.random()-.5);for(let _=0;_<Math.min(u.imageCellCount||12,te.length);_++){let Ee=eo.get(te[_]);if(!Ee)continue;let ve=Math.random(),Q=1,he=1;ve>.7?(Q=3,he=4+Math.floor(Math.random()*2)):ve>.4?(Q=2+Math.floor(Math.random()*2),he=3+Math.floor(Math.random()*2)):(Q=2,he=2+Math.floor(Math.random()*2));let Oe=0,Be=!1;for(;Oe<100&&!Be;){let et=1+Math.floor(Math.random()*Math.max(1,a-Q)),At=Math.floor(Math.random()*r);if(et+Q>a){Oe++;continue}let $t=!0;for(let tt=0;tt<Q&&$t;tt++)for(let ot=0;ot<he&&$t;ot++){let Et=`${et+tt}-${(At+ot)%r}`;R.has(Et)&&($t=!1)}if($t){for(let To=0;To<Q;To++)for(let Lo=0;Lo<he;Lo++){let ri=`${et+To}-${(At+Lo)%r}`;R.add(ri)}let tt=F*et,ot=F*(et+Q),Et=At*I-Math.PI/2,Qn=Et+he*I;Ai(d,Ee,S,C,tt,ot,Et,Qn,O,G),pe.push({imgIdx:_,ring:et,sector:At,ringSpan:Q,sectorSpan:he,innerRadius:tt,outerRadius:ot,startAngle:Et,endAngle:Qn}),Be=!0}Oe++}}}let H=u.gridLineColor||"#ffffff";for(let k=1;k<=a;k++){let R=F*k;d.strokeStyle=H,d.lineWidth=n,d.beginPath(),d.arc(S,C,R,0,Math.PI*2),d.stroke()}let w=360/r,x=n*3;d.strokeStyle=H,d.lineWidth=n;for(let k=0;k<r;k++){let O=(k*w-90)*Math.PI/180,G=S+Math.cos(O)*x,te=C+Math.sin(O)*x,_=S+Math.cos(O)*v,Ee=C+Math.sin(O)*v;d.beginPath(),d.moveTo(G,te),d.lineTo(_,Ee),d.stroke()}let Bt=u.rimOffset||0,Ct=v*(1-Bt),Mo=i;for(let k=0;k<360;k+=1){let R=(k-90)*Math.PI/180,O,G;k%10===0?(O=m*.5,G=Mo*1.5):k%5===0?(O=m*.3,G=Mo):(O=m*.15,G=Mo*.5),d.strokeStyle=H,d.lineWidth=G,d.beginPath(),d.moveTo(S+Math.cos(R)*Ct,C+Math.sin(R)*Ct),d.lineTo(S+Math.cos(R)*(Ct+O),C+Math.sin(R)*(Ct+O)),d.stroke()}if(c){let k=u.labelsFlipX,R=u.labelsFlipY;d.font=`${m}px OffBit, monospace`,d.textAlign="center",d.textBaseline="middle";for(let G=0;G<360;G+=10){let te=(G-90)*Math.PI/180,_=Ct+m*1,Ee=S+Math.cos(te)*_,ve=C+Math.sin(te)*_;d.fillStyle=l,d.font=`${m*.6}px OffBit, monospace`,d.save(),d.translate(Ee,ve);let Q=te+Math.PI/2;R&&(Q+=Math.PI),d.rotate(Q),k&&d.scale(-1,1),d.fillText(G.toString(),0,0),d.restore()}let O=[0,90,180,270];for(let G of O){let te=(G-90)*Math.PI/180;for(let _=1;_<a;_++){let ve=F*(a-_),Q=S+Math.cos(te)*ve,he=C+Math.sin(te)*ve,Oe=_*10;d.fillStyle=l,d.font=`${m*.35}px OffBit, monospace`,d.save(),d.translate(Q,he);let Be=te+Math.PI/2;R&&(Be+=Math.PI),d.rotate(Be),k&&d.scale(-1,1),d.textAlign="center",d.textBaseline="middle",d.fillText(Oe.toString(),0,0),d.restore()}}d.textAlign="center"}let ai=d.getImageData(0,0,e,e);for(let k of s){let{text:R="",row:O=7,startSector:G=0,textFontSize:te=m,color:_=l,flipX:Ee=!1,flipY:ve=!1,cellMode:Q=!0}=k;if(Q)wa(d,R,S,C,F,O,G,r,te,_,Ee,ve);else{let he=v*(O/a),Oe=(G*(360/r)-90)*Math.PI/180,Be=k.letterSpacing||.08;ha(d,R,S,C,he,Oe,te,_,Be,Ee,ve)}}let ii=u.dotSize||4;d.fillStyle=l,d.beginPath(),d.arc(S,C,ii,0,Math.PI*2),d.fill();let Ze=new oo.CanvasTexture(g);return Ze.colorSpace=oo.SRGBColorSpace,Ze.needsUpdate=!0,Ze._polarGridCanvas=g,Ze._polarGridCtx=d,Ze._polarGridParams={centerX:S,centerY:C,maxRadius:v,circleStep:F,numCircles:a,numRadialLines:r,getColorAtAngle:P,cellPatterns:W,backgroundColor:o,baseImageWithoutText:ai,curvedTexts:s,labelColor:l,fontSize:m},Ze}function Gi(e,t,o,n){let i="";for(let a=0;a<e.length;a++){let r=e[a],c=t[a];if(!c||!c.active||r===" ")i+=r;else{let l=o-c.startTime;Math.min(l/n,1)>=1?(c.active=!1,i+=r):i+=ga[Math.floor(Math.random()*ga.length)]}}return i}function ba(){to++}function qi(e){let t={},o=u.textScrambleDuration;for(;to>0&&u.textScrambleEnabled;){to--;let n=["text1","text2","text3","text4","text5"],i=n[Math.floor(Math.random()*n.length)],a=ma[i],r=u[`${i}Content`];a.chars.length!==r.length&&(a.chars=r.split("").map(()=>({active:!1,startTime:0})));let c=[];for(let l=0;l<r.length;l++)r[l]!==" "&&!a.chars[l].active&&c.push(l);if(c.length>0){let l=c[Math.floor(Math.random()*c.length)];a.chars[l].active=!0,a.chars[l].startTime=e}}return["text1","text2","text3","text4","text5"].forEach(n=>{let i=ma[n],a=u[`${n}Content`];i.chars.length!==a.length&&(i.chars=a.split("").map(()=>({active:!1,startTime:0}))),t[n]=Gi(a,i.chars,e,o)}),t}function Vi(e,t,o,n){let{centerX:i,centerY:a,circleStep:r,numCircles:c,numRadialLines:l,curvedTexts:m,labelColor:p,fontSize:h}=t;m&&m.forEach((f,s)=>{let{row:g=7,startSector:d=0,textFontSize:S=h,color:C=p,flipX:v=!1,flipY:P=!1,cellMode:F=!0}=f,I=`text${s+1}`,N=n&&n[I]?n[I]:f.text||"",V=(d+o+l)%l;if(F)wa(e,N,i,a,r,g,V,l,S,C,v,P);else{let W=t.maxRadius*(g/c),pe=(V*(360/l)-90)*Math.PI/180,H=f.letterSpacing||.08;ha(e,N,i,a,W,pe,S,C,H,v,P)}})}function Ca(e,t){kt=[];for(let o=0;o<e;o++)kt.push({circle:Math.floor(Math.random()*t)+1,angle:Math.random()*Math.PI*2,speed:(.5+Math.random()*.5)*(Math.random()>.5?1:-1),size:.8+Math.random()*.4});$o(e),Jt(e)}function _i(e,t,o,n){let{centerX:i,centerY:a,circleStep:r}=t,c=n&&!pa,l=Bo(),m=Ao();kt.forEach((p,h)=>{let f=r*p.circle,s=i+Math.cos(p.angle)*f,g=a+Math.sin(p.angle)*f,d=o*p.size,C=h===m?l:0,v=1+C*1.5,P=d*v,F=.9+C*.1;if(c){let I=P*(3+C*2),N=e.createRadialGradient(s,g,0,s,g,I);N.addColorStop(0,`rgba(255, 255, 255, ${F})`),N.addColorStop(.5,`rgba(255, 255, 255, ${.4+C*.3})`),N.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=N,e.beginPath(),e.arc(s,g,I,0,Math.PI*2),e.fill()}e.fillStyle="#ffffff",e.beginPath(),e.arc(s,g,P,0,Math.PI*2),e.fill(),e.fillStyle="#ffffff",e.beginPath(),e.arc(s,g,P*.5,0,Math.PI*2),e.fill()}),No()}function Ui(e,t){for(let o of kt)o.angle+=o.speed*t*e*.001,o.angle>Math.PI*2&&(o.angle-=Math.PI*2),o.angle<0&&(o.angle+=Math.PI*2)}function Qo(e){if(!e||!e._polarGridCanvas)return;qe=e;let t=e._polarGridCanvas,o=e._polarGridCtx,n=e._polarGridParams;Pt=o.getImageData(0,0,t.width,t.height),Ca(u.pulseCount,n.numCircles);let i=performance.now(),a=0;function r(c){if(pa&&c-da<Pi){ke=requestAnimationFrame(r);return}da=c;let l=u.pulsesEnabled,m=u.cellAnimationEnabled,p=u.textRotationEnabled,h=u.textScrambleEnabled;if(!l&&!m&&!p&&!h){o.putImageData(Pt,0,0),e.needsUpdate=!0,ke=null;return}let f=c-i;if(i=c,a+=f*.001*u.cellAnimationSpeed,p){if(u.textStepRotation){let g=6e4/u.textRotationBPM;c-ua>=g&&(Ge-=1,ua=c,h&&to++)}else Ge+=u.textRotationSpeed*f*.001;for(;Ge>=n.numRadialLines;)Ge-=n.numRadialLines;for(;Ge<0;)Ge+=n.numRadialLines}let s=p||h;if(s&&n.baseImageWithoutText?o.putImageData(n.baseImageWithoutText,0,0):o.putImageData(Pt,0,0),m&&n.cellPatterns)for(let g of n.cellPatterns){let d=a*2+g.phase;g.pattern==="gradient"&&Di(o,n.centerX,n.centerY,g.innerRadius,g.outerRadius,g.startAngle,g.endAngle,g.colorHex,g.pattern,g.ring,g.sector,d)}if(s&&n.curvedTexts){let g=h?qi(c):null;Vi(o,n,Ge,g)}l&&(Ui(f,u.pulseSpeed),_i(o,n,u.pulseSize,u.pulseGlow),Uo()&&Go(kt,n)),e.needsUpdate=!0,ke=requestAnimationFrame(r)}ke&&cancelAnimationFrame(ke),ke=requestAnimationFrame(r)}function Ko(){ke&&(cancelAnimationFrame(ke),ke=null),qe&&Pt&&(qe._polarGridCtx.putImageData(Pt,0,0),qe.needsUpdate=!0)}function Ea(){qe&&qe._polarGridParams&&Ca(u.pulseCount,qe._polarGridParams.numCircles)}var u,pa,da,Pi,eo,Xo,kt,ke,qe,Pt,Ge,ua,ma,ga,to,va=ne(()=>{Zt();u={globalFontSize:100,text1Row:3,text1FlipX:!0,text1FlipY:!0,text1FontSize:100,text1StartSector:24,text1Content:"STHLM 7-9 MAY",text1CellMode:!0,text2Row:4,text2FlipX:!0,text2FlipY:!0,text2FontSize:100,text2StartSector:23,text2Content:"MALM\xD6 12 MAY",text2CellMode:!0,text3Row:5,text3FlipX:!0,text3FlipY:!0,text3FontSize:100,text3StartSector:24,text3Content:"DOME DREAMING",text3CellMode:!0,text4Row:6,text4FlipX:!0,text4FlipY:!0,text4FontSize:100,text4StartSector:28,text4Content:"FULLDOME FILM FESTIVAL",text4CellMode:!0,text5Row:7,text5FlipX:!0,text5FlipY:!0,text5FontSize:100,text5StartSector:27,text5Content:"OPEN CALL IS LIVE!",text5CellMode:!0,labelsFlipX:!1,labelsFlipY:!0,gridLineColor:"#ffffff",rimOffset:.02,lineWidth:2,tickWidth:1,antialias:!0,dotSize:4,pulsesEnabled:!0,pulseCount:8,pulseSpeed:.5,pulseSize:12,pulseGlow:!0,textRotationEnabled:!1,textRotationSpeed:-.3,textStepRotation:!0,textRotationBPM:30,textScrambleEnabled:!0,textScrambleChance:.08,textScrambleDuration:200,textOutline:!1,textOutlineColor:"#000000",textOutlineWidth:3,textShadow:!1,textShadowBlur:8,textShadowColor:"#000000",textVerticalOffset:.6,cellAnimationEnabled:!0,cellAnimationSpeed:.5,cellPatternDensity:.25,imageCellsEnabled:!0,imageCellCount:12,imageThreshold:!0,imageThresholdLevel:.5,mainColor:null,chairsColor:null,floorColor:null,regenerate:null},pa=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||"ontouchstart"in window||navigator.maxTouchPoints>0,da=0,Pi=33;eo=new Map;Xo=["assets/img/jpg/wisdome-stockholm-visuals.jpg","assets/img/jpg/wisdome-malmo-visuals.jpg","assets/img/jpg/untold-garden.jpg","assets/img/jpg/tiny-massive.jpg","assets/img/jpg/akiko-nakayama.jpg","assets/img/jpg/nordic-lights.jpg","assets/img/jpg/the-new-infinity.jpg","assets/img/jpg/baltic-analog-lab.jpg","assets/img/jpg/visualia.jpg","assets/img/jpeg/nam-june-paik-magnet-tv.jpeg","assets/img/jpg/rhythm-in-light-mary-ellen-bute.jpg","assets/img/png/movie-drome.png"];kt=[],ke=null,qe=null,Pt=null,Ge=0,ua=0,ma={text1:{chars:[]},text2:{chars:[]},text3:{chars:[]},text4:{chars:[]},text5:{chars:[]}},ga="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%&*!?<>[]{}|/\\~";to=0});var xa={};we(xa,{getToneMappingOptions:()=>cn,lightingSettings:()=>b,setAmbientColor:()=>en,setAmbientIntensity:()=>Zo,setDirectColor:()=>ln,setDirectIntensity:()=>sn,setDirectLightEnabled:()=>rn,setExposure:()=>ao,setFogColor:()=>on,setFogEnabled:()=>tn,setFogFar:()=>an,setFogNear:()=>nn,setGradientEnd:()=>Qi,setGradientStart:()=>Xi,setSection1FadeStart:()=>dn,setSection2FadeEnd:()=>fn,setToneMapping:()=>no,setupLighting:()=>Yi});import*as D from"three";function Yi(){mt=new D.AmbientLight(b.ambientColor,b.ambientIntensity),T.add(mt),me=new D.DirectionalLight(b.directColor,b.directIntensity),me.position.set(5,10,5),b.directLightEnabled&&T.add(me),b.fogEnabled&&(T.fog=new D.Fog(b.fogColor,b.fogNear,b.fogFar)),no(b.toneMapping),ao(b.exposure)}function Zo(e){b.ambientIntensity=e,mt&&(mt.intensity=e)}function en(e){b.ambientColor=e,mt&&mt.color.set(e)}function tn(e){b.fogEnabled=e,e?T.fog=new D.Fog(b.fogColor,b.fogNear,b.fogFar):T.fog=null}function on(e){b.fogColor=e,T.fog&&T.fog.color.set(e)}function nn(e){b.fogNear=e,T.fog&&(T.fog.near=e)}function an(e){b.fogFar=e,T.fog&&(T.fog.far=e)}function no(e){b.toneMapping=e,B&&Jo[e]!==void 0&&(B.toneMapping=Jo[e])}function ao(e){b.exposure=e,B&&(B.toneMappingExposure=e)}function rn(e){b.directLightEnabled=e,me&&(e&&!me.parent?T.add(me):!e&&me.parent&&T.remove(me))}function sn(e){b.directIntensity=e,me&&(me.intensity=e)}function ln(e){b.directColor=e,me&&me.color.set(e)}function cn(){return Object.keys(Jo)}function Xi(e){b.gradientStart=e,document.documentElement.style.setProperty("--bg-gradient-start",`${e}%`)}function Qi(e){b.gradientEnd=e,document.documentElement.style.setProperty("--bg-gradient-end",`${e}%`)}function dn(e){b.section1FadeStart=e,document.documentElement.style.setProperty("--section1-fade-start",`${e}%`)}function fn(e){b.section2FadeEnd=e,document.documentElement.style.setProperty("--section2-fade-end",`${e}%`)}var b,Jo,me,mt,un=ne(()=>{Se();b={ambientIntensity:.5,ambientColor:"#ffffff",fogEnabled:!1,fogColor:"#1a1a1a",fogNear:20,fogFar:60,toneMapping:"Linear",exposure:1,directLightEnabled:!0,directIntensity:1,directColor:"#ffffff",gradientStart:20,gradientEnd:80,section1FadeStart:70,section2FadeEnd:30},Jo={None:D.NoToneMapping,Linear:D.LinearToneMapping,Reinhard:D.ReinhardToneMapping,Cineon:D.CineonToneMapping,"ACES Filmic":D.ACESFilmicToneMapping,AgX:D.AgXToneMapping,Neutral:D.NeutralToneMapping},me=null,mt=null});var Pa={};we(Pa,{connectWebcam:()=>Zi,disconnectWebcam:()=>er,getCurrentImageTexture:()=>yn,getCurrentVideo:()=>Ji,getCurrentVideoTexture:()=>wn,getScreenObject:()=>hn,loadDefaultScreenTexture:()=>ro,loadImage:()=>Ta,loadVideo:()=>La,regeneratePolarGridTexture:()=>E,setScreenObject:()=>io,setupDragAndDrop:()=>Sn,setupPolarGridGUI:()=>Ma});import*as ge from"three";import Ki from"lil-gui";function io(e){Z=e}function hn(){return Z}function wn(){return re}function Ji(){return A}function yn(){return J}function ro(e=gt.defaultImage||"assets/media/background.png"){return Z?(J&&(J.dispose(),J=null),new Promise(async t=>{await ya();let o=window.savedColorSettings||{},n=o.Main_Structure||{r:.4,g:.45,b:.5},i=o.Chairs||{r:.55,g:.32,b:.38},a=o.Floor||{r:.65,g:.52,b:.25},c=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||"ontouchstart"in window||navigator.maxTouchPoints>0?2048:4096,l=Sa(c,{backgroundColor:"#000000",numCircles:8,numRadialLines:36,showLabels:!0,labelColor:"#ffffff",mainColor:n,chairsColor:i,floorColor:a,curvedTexts:[{text:u.text1Content,row:u.text1Row,startSector:u.text1StartSector,textFontSize:u.text1FontSize,color:"#ffffff",flipX:u.text1FlipX,flipY:u.text1FlipY,cellMode:u.text1CellMode},{text:u.text2Content,row:u.text2Row,startSector:u.text2StartSector,textFontSize:u.text2FontSize,color:"#ffffff",flipX:u.text2FlipX,flipY:u.text2FlipY,cellMode:u.text2CellMode},{text:u.text3Content,row:u.text3Row,startSector:u.text3StartSector,textFontSize:u.text3FontSize,color:"#ffffff",flipX:u.text3FlipX,flipY:u.text3FlipY,cellMode:u.text3CellMode},{text:u.text4Content,row:u.text4Row,startSector:u.text4StartSector,textFontSize:u.text4FontSize,color:"#ffffff",flipX:u.text4FlipX,flipY:u.text4FlipY,cellMode:u.text4CellMode},{text:u.text5Content,row:u.text5Row,startSector:u.text5StartSector,textFontSize:u.text5FontSize,color:"#ffffff",flipX:u.text5FlipX,flipY:u.text5FlipY,cellMode:u.text5CellMode}]});at(l),l.rotation=0,nt(l,Z),J=l,Ma(),u.pulsesEnabled&&Qo(l),t(l)})):Promise.resolve()}function E(){Z&&(Ko(),ro())}function mn(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16)/255,g:parseInt(t[2],16)/255,b:parseInt(t[3],16)/255}:null}function gn(e){let t=Math.round(e.r*255).toString(16).padStart(2,"0"),o=Math.round(e.g*255).toString(16).padStart(2,"0"),n=Math.round(e.b*255).toString(16).padStart(2,"0");return`#${t}${o}${n}`}async function pn(e,t){let o=await Promise.resolve().then(()=>(st(),Rt)),{getMaterial:n}=await Promise.resolve().then(()=>(it(),Kn));if(o.fbxMeshes){let i=o.fbxMeshes.find(a=>a.name===e);if(i){let a=n(i.mesh);a&&(a.color.setRGB(t.r,t.g,t.b),a.needsUpdate=!0)}}window.savedColorSettings||(window.savedColorSettings={}),window.savedColorSettings[e]=t}function Ma(){if(X)return;X=new Ki({title:"Dome Dreaming"}),X.domElement.style.position="fixed",X.domElement.style.top="10px",X.domElement.style.left="10px",X.domElement.style.zIndex="99999",X.domElement.style.display="none",window.addEventListener("keydown",w=>{if((w.metaKey||w.ctrlKey)&&w.key.toLowerCase()==="g"){w.preventDefault();let x=X.domElement.style.display==="none";X.domElement.style.display=x?"":"none"}});let e=X.addFolder("Typography");e.add(u,"globalFontSize",50,200,5).name("Global Font Size %").onChange(()=>E());let t=e.addFolder("Text 1");t.add(u,"text1Content").name("Text").onChange(()=>E()),t.add(u,"text1Row",1,8,1).name("Row (Circle)").onChange(()=>E()),t.add(u,"text1StartSector",0,35,1).name("Start Sector").onChange(()=>E()),t.add(u,"text1FontSize",20,200,5).name("Font Size %").onChange(()=>E()),t.close();let o=e.addFolder("Text 2");o.add(u,"text2Content").name("Text").onChange(()=>E()),o.add(u,"text2Row",1,8,1).name("Row (Circle)").onChange(()=>E()),o.add(u,"text2StartSector",0,35,1).name("Start Sector").onChange(()=>E()),o.add(u,"text2FontSize",20,200,5).name("Font Size %").onChange(()=>E()),o.close();let n=e.addFolder("Text 3");n.add(u,"text3Content").name("Text").onChange(()=>E()),n.add(u,"text3Row",1,8,1).name("Row (Circle)").onChange(()=>E()),n.add(u,"text3StartSector",0,35,1).name("Start Sector").onChange(()=>E()),n.add(u,"text3FontSize",20,200,5).name("Font Size %").onChange(()=>E()),n.close();let i=e.addFolder("Text 4");i.add(u,"text4Content").name("Text").onChange(()=>E()),i.add(u,"text4Row",1,8,1).name("Row (Circle)").onChange(()=>E()),i.add(u,"text4StartSector",0,35,1).name("Start Sector").onChange(()=>E()),i.add(u,"text4FontSize",20,200,5).name("Font Size %").onChange(()=>E()),i.close();let a=e.addFolder("Text 5");a.add(u,"text5Content").name("Text").onChange(()=>E()),a.add(u,"text5Row",1,8,1).name("Row (Circle)").onChange(()=>E()),a.add(u,"text5StartSector",0,35,1).name("Start Sector").onChange(()=>E()),a.add(u,"text5FontSize",20,200,5).name("Font Size %").onChange(()=>E()),a.close();let r=e.addFolder("Style");r.add(u,"textOutline").name("Outline").onChange(()=>E()),r.addColor(u,"textOutlineColor").name("Outline Color").onChange(()=>E()),r.add(u,"textOutlineWidth",1,10,1).name("Outline Width").onChange(()=>E()),r.add(u,"textShadow").name("Shadow").onChange(()=>E()),r.add(u,"textShadowBlur",0,20,1).name("Shadow Blur").onChange(()=>E()),r.add(u,"textVerticalOffset",.1,.9,.05).name("Radial Position").onChange(()=>E()),r.close(),e.close();let c=X.addFolder("Grid"),l=c.addFolder("Lines");l.addColor(u,"gridLineColor").name("Color").onChange(()=>E()),l.add(u,"lineWidth",.5,5,.5).name("Width").onChange(()=>E()),l.add(u,"tickWidth",.5,4,.5).name("Tick Width").onChange(()=>E()),l.add(u,"rimOffset",0,.2,.01).name("Rim Offset").onChange(()=>E()),l.add(u,"dotSize",1,20,1).name("Dot Size").onChange(()=>E()),l.close();let m=c.addFolder("Images");m.add(u,"imageCellsEnabled").name("Enable").onChange(()=>E()),m.add(u,"imageCellCount",1,12,1).name("Count").onChange(()=>E()),m.add(u,"imageThreshold").name("Threshold").onChange(()=>E()),m.add(u,"imageThresholdLevel",.2,.8,.05).name("Threshold Level").onChange(()=>E()),m.close();let p=c.addFolder("Rendering");p.add(u,"antialias").name("Antialiasing").onChange(()=>E()),p.close(),c.close();let h=X.addFolder("Animation"),f=h.addFolder("Rotation");f.add(u,"textRotationEnabled").name("Rotate Text"),f.add(u,"textStepRotation").name("Step Mode (BPM)"),f.add(u,"textRotationBPM",10,120,5).name("Text BPM"),f.add(u,"textRotationSpeed",-2,2,.1).name("Continuous Speed"),f.add(le,"enabled").name("Rotate Grid"),f.add(le,"speed",-.1,.1,.005).name("Grid Speed"),f.close();let s=h.addFolder("Pulses");s.add(u,"pulsesEnabled").name("Enable").onChange(w=>{w&&J?Qo(J):Ko()}),s.add(u,"pulseCount",1,20,1).name("Count").onChange(()=>Ea()),s.add(u,"pulseSpeed",.1,2,.1).name("Speed"),s.add(u,"pulseSize",4,30,1).name("Size"),s.add(u,"pulseGlow").name("Glow"),s.close(),h.close();let g=X.addFolder("Audio");g.add(Y,"enabled").name("Enable Sound").onChange(async w=>{w?await Wo():jo()}),g.add(Y,"masterVolume",0,1,.05).name("Volume").onChange(w=>qo(w)),g.add(Y,"tickBPM",20,180,5).name("Tick BPM"),g.add(Y,"reverbWet",0,1,.05).name("Reverb").onChange(w=>Vo(w)),g.add(Y,"spatialSpread",1,20,1).name("3D Spread").onChange(w=>_o(w)),g.close();let d=X.addFolder("Colors"),S={get mainColor(){let w=u.mainColor||{r:.4,g:.45,b:.5};return gn(w)},set mainColor(w){let x=mn(w);x&&(u.mainColor=x,window.savedColorSettings=window.savedColorSettings||{},window.savedColorSettings.Main_Structure=x,pn("Main_Structure",x),E())},get chairsColor(){let w=u.chairsColor||{r:.55,g:.32,b:.38};return gn(w)},set chairsColor(w){let x=mn(w);x&&(u.chairsColor=x,window.savedColorSettings=window.savedColorSettings||{},window.savedColorSettings.Chairs=x,pn("Chairs",x),E())},get floorColor(){let w=u.floorColor||{r:.65,g:.52,b:.25};return gn(w)},set floorColor(w){let x=mn(w);x&&(u.floorColor=x,window.savedColorSettings=window.savedColorSettings||{},window.savedColorSettings.Floor=x,pn("Floor",x),E())}};d.addColor(S,"mainColor").name("Main Structure"),d.addColor(S,"chairsColor").name("Chairs"),d.addColor(S,"floorColor").name("Floor"),d.add({randomize:()=>{bn().then(()=>{E()})}},"randomize").name("Randomise Colors"),d.close();let C=X.addFolder("Lighting"),v=C.addFolder("Exposure");v.add(b,"toneMapping",cn()).name("Tone Mapping").onChange(w=>no(w)),v.add(b,"exposure",0,3,.1).name("Exposure").onChange(w=>ao(w)),v.close();let P=C.addFolder("Ambient");P.add(b,"ambientIntensity",0,2,.1).name("Intensity").onChange(w=>Zo(w)),P.addColor(b,"ambientColor").name("Color").onChange(w=>en(w)),P.close();let F=C.addFolder("Direct Light");F.add(b,"directLightEnabled").name("Enable").onChange(w=>rn(w)),F.add(b,"directIntensity",0,5,.1).name("Intensity").onChange(w=>sn(w)),F.addColor(b,"directColor").name("Color").onChange(w=>ln(w)),F.close();let I=C.addFolder("Fog");I.add(b,"fogEnabled").name("Enable").onChange(w=>tn(w)),I.addColor(b,"fogColor").name("Color").onChange(w=>on(w)),I.add(b,"fogNear",1,50,1).name("Near").onChange(w=>nn(w)),I.add(b,"fogFar",20,100,5).name("Far").onChange(w=>an(w)),I.close();let N=C.addFolder("Section Gradient");N.add(b,"section1FadeStart",0,100,5).name("Section 1 Fade %").onChange(w=>dn(w)),N.add(b,"section2FadeEnd",0,100,5).name("Section 2 Fade %").onChange(w=>fn(w)),N.close(),C.close();let V=X.addFolder("Depth of Field");V.add(j,"enabled").name("Enable").onChange(w=>{let x=ft();x&&(x.enabled=w)}),V.add(j,"focus",.1,50,.1).name("Focus Distance").onChange(w=>{let x=ft();x&&(x.uniforms.focus.value=w)}),V.add(j,"aperture",0,.01,1e-4).name("Aperture").onChange(w=>{let x=ft();x&&(x.uniforms.aperture.value=w)}),V.add(j,"maxblur",0,.05,.001).name("Max Blur").onChange(w=>{let x=ft();x&&(x.uniforms.maxblur.value=w)}),V.open();let W=X.addFolder("Camera"),pe=W.addFolder("Position");pe.add(y.position,"x",-20,20,.01).name("X").listen(),pe.add(y.position,"y",-20,20,.01).name("Y").listen(),pe.add(y.position,"z",-20,20,.01).name("Z").listen(),pe.close();let H=W.addFolder("Rotation");H.add(y.rotation,"x",-Math.PI,Math.PI,.01).name("X").listen(),H.close(),W.close(),u.regenerate=E}function Ta(e){if(!Z)return;let t=new FileReader;t.onload=o=>{new ge.TextureLoader().load(o.target.result,i=>{re&&(re.dispose(),re=null),A&&(A.pause(),A.src="",URL.revokeObjectURL(A.src),A=null),J&&J.dispose(),le.enabled=!1,at(i),i.rotation=0,nt(i,Z),J=i;let a=oe(Z);a&&setTimeout(()=>{Object.assign(a,Fe),a.needsUpdate=!0},200)},void 0,()=>{})},t.readAsDataURL(e)}function La(e){if(!Z)return;let t=document.createElement("video");t.src=URL.createObjectURL(e),t.crossOrigin="anonymous",t.loop=!0,t.muted=!0,t.playsInline=!0,t.addEventListener("loadedmetadata",()=>{t.play(),re&&re.dispose(),A&&(A.pause(),A.src="",URL.revokeObjectURL(A.src)),J&&(J.dispose(),J=null),le.enabled=!1;let o=new ge.VideoTexture(t);at(o),o.minFilter=ge.LinearFilter,o.magFilter=ge.LinearFilter,o.rotation=0,nt(o,Z),re=o,A=t;let n=oe(Z);n&&setTimeout(()=>{Object.assign(n,Fe),n.needsUpdate=!0},200)}),t.addEventListener("error",()=>{})}function Zi(){if(Z){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){alert("Webcam access is not available in your browser.");return}navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(e=>{re&&(re.dispose(),re=null),A&&(A.pause(),A.srcObject=null,A=null),J&&(J.dispose(),J=null),Ve&&(Ve.getTracks().forEach(o=>o.stop()),Ve=null),le.enabled=!1;let t=document.createElement("video");t.srcObject=e,t.autoplay=!0,t.playsInline=!0,t.muted=!0,t.addEventListener("loadedmetadata",()=>{t.play();let o=new ge.VideoTexture(t);at(o),o.minFilter=ge.LinearFilter,o.magFilter=ge.LinearFilter,o.rotation=0,nt(o,Z),re=o,A=t,Ve=e;let n=oe(Z);n&&setTimeout(()=>{Object.assign(n,Fe),n.needsUpdate=!0},200)}),t.addEventListener("error",()=>{alert("Error accessing webcam.")})}).catch(e=>{console.error("Error accessing webcam:",e),alert("Could not access webcam. Please check permissions.")})}}function er(){Ve&&(Ve.getTracks().forEach(e=>e.stop()),Ve=null),re&&(re.dispose(),re=null),A&&(A.pause(),A.srcObject=null,A=null)}function Sn(){let e=document.getElementById("drop-zone");function t(n){n.preventDefault(),n.stopPropagation()}function o(n){if(!Z)return;let i=oe(Z);i&&(n?(i.emissive=new ge.Color(38655),i.emissiveIntensity=.8):(Object.assign(i,Fe),i.needsUpdate=!0))}document.addEventListener("dragenter",n=>{t(n),e.classList.add("drag-over"),o(!0)},!1),document.addEventListener("dragover",n=>{t(n),e.classList.add("drag-over"),o(!0)},!1),document.addEventListener("dragleave",n=>{t(n),n.clientX===0&&n.clientY===0&&(e.classList.remove("drag-over"),o(!1))},!1),document.addEventListener("drop",n=>{t(n),e.classList.remove("drag-over"),o(!1);let i=n.dataTransfer.files;if(i.length>0){let a=i[0];a.type.startsWith("image/")?Ta(a):a.type.startsWith("video/")&&La(a)}},!1)}var Z,re,A,J,Ve,X,so=ne(()=>{it();vt();Pe();Qt();Se();va();Zt();un();Do(ba);Z=null,re=null,A=null,J=null,Ve=null;X=null});import{GLTFLoader as tr}from"three/addons/loaders/GLTFLoader.js";import{init as or,NavMeshQuery as ka,importNavMesh as nr}from"@recast-navigation/core";import{threeToSoloNavMesh as ar}from"@recast-navigation/three";function Ra(){return _e}async function Ia(){if(!Ft)try{await or(),Ft=!0,ir()}catch(e){console.error("Failed to initialize recast-navigation:",e),Ft=!0}}async function ir(){if(!Ft){await Ia();return}try{let e=await fetch("assets/models/navmesh.bin");if(e.ok){let t=await e.arrayBuffer(),o=new Uint8Array(t),{navMesh:n}=nr(o);_e=new ka(n),qt(_e),console.log("Navmesh loaded from navmesh.bin"),ie&&En();return}}catch{console.log("navmesh.bin not found, will generate from GLTF")}rr()}function rr(){new tr().load("assets/models/navmesh.gltf",async t=>{if(It=t.scene,It.scale.setScalar(1),It.visible=!1,ye(It,o=>{o.isMesh&&(Cn.push(o),o.updateMatrixWorld())}),T.add(It),Cn.length>0&&Ft){let{success:o,navMesh:n}=ar(Cn,{cs:.05,ch:.05,walkableRadius:.2});o&&(_e=new ka(n),qt(_e),console.log("Navmesh generated from GLTF"))}},void 0,t=>{console.warn("Navmesh GLTF not found:",t)})}function En(){if(!_e||!ie)return;let e={x:y.position.x,y:y.position.y-de,z:y.position.z},t=_e.findClosestPoint(e,{halfExtents:Ae});t.success&&(y.position.y=t.point.y+de)}function Fa(){Ia().catch(console.error)}var Ft,It,Cn,_e,za=ne(()=>{Se();vt();it();Vt();xt();Ft=!1,It=null,Cn=[],_e=null});var Ba={};we(Ba,{getScreenLight:()=>fr,initScreenLighting:()=>vn,setColorSamplingEnabled:()=>dr,updateScreenLighting:()=>cr});import*as Ce from"three";function vn(e){return sr=e,Me=new Ce.PointLight(16777215,2,30),Me.position.set(0,0,0),T.add(Me),Ue=new Ce.HemisphereLight(16777215,1710618,.8),Ue.position.set(0,5,0),T.add(Ue),be=new Ce.PointLight(16777215,1.5,25),be.position.set(0,0,0),T.add(be),{screenLight:Me,hemisphereLight:Ue,secondaryLight:be}}function Da(e){if(!e||!e.image)return null;let t=e.image,o=document.createElement("canvas"),n=o.getContext("2d"),i=64;o.width=i,o.height=i;try{n.drawImage(t,0,0,i,i);let r=n.getImageData(0,0,i,i).data,c=0,l=0,m=0,p=i*i;for(let h=0;h<r.length;h+=4)c+=r[h],l+=r[h+1],m+=r[h+2];return c/=p,l/=p,m/=p,new Ce.Color(c/255,l/255,m/255)}catch{return null}}function cr(e){if(!Me||!Oa||e-Ha<lr)return;Ha=e;let t=null,o=yn(),n=wn();if(n&&n.image?t=Da(n):o&&(t=Da(o)),t){let i=t.clone();if(i.getHSL(De),De.s=Math.min(1,De.s*1.5),De.l=Math.min(1,De.l*1.2),i.setHSL(De.h,De.s,De.l),Me.color.copy(i),Me.intensity=3,Ue){let r=new Ce.Color().lerpColors(new Ce.Color(16777215),i,.6);Ue.color.copy(r),Ue.intensity=1.2}be&&(be.color.copy(i),be.intensity=2);let a=hn();if(a){let r=new Ce.Vector3;a.getWorldPosition(r),Me.position.copy(r),Me.position.z+=.5,be&&(be.position.copy(r),be.position.z+=.3,be.position.y+=.2)}}}function dr(e){Oa=e}function fr(){return Me}var Me,sr,Ue,be,Ha,lr,Oa,De,xn=ne(()=>{Se();so();Me=null,sr=null,Ue=null,be=null,Ha=0,lr=100,Oa=!0,De={h:0,s:0,l:0}});var Rt={};we(Rt,{fbxMeshes:()=>lo,glbLights:()=>Re,glbLightsGroup:()=>pt,hotspots:()=>ze,loadModel:()=>gr,wisdomeModel:()=>Aa});import*as L from"three";import{GLTFLoader as ur}from"three/addons/loaders/GLTFLoader.js";import{DRACOLoader as mr}from"three/addons/loaders/DRACOLoader.js";function gr(){let e=new ur,t=new mr;t.setDecoderPath("https://cdn.jsdelivr.net/npm/three@0.181.0/examples/jsm/libs/draco/gltf/"),e.setDRACOLoader(t),e.load("assets/models/wisdome.glb",o=>{if(!o||!o.scene){console.error("GLB loaded but scene is missing");let s=document.getElementById("loading-overlay");s&&(s.innerHTML='<div style="color: #ff4444; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">Error: Model scene is missing.</div>');return}let n=o.scene;Aa=n,n.scale.setScalar(1),n.position.set(0,0,0),Nt(n),pt=new L.Group,pt.name="GLBLights";let i=()=>{ye(n,s=>{s.isLight&&(Re.push(s),pt.add(s))})};"requestIdleCallback"in window?requestIdleCallback(i,{timeout:100}):i(),Re.length===0&&ye(n,s=>{(s instanceof L.Light||s instanceof L.DirectionalLight||s instanceof L.PointLight||s instanceof L.SpotLight||s instanceof L.RectAreaLight||s instanceof L.HemisphereLight)&&(Re.includes(s)||(Re.push(s),pt.add(s)))}),Re=Re.filter(s=>!(s instanceof L.HemisphereLight)),Re.length>0&&(T.add(pt),Re.forEach(s=>{s instanceof L.DirectionalLight?(s.intensity=3,s.position.set(2,15,5)):s instanceof L.PointLight?(s.intensity=0,s.visible=!1):s.intensity=0})),ye(n,s=>{s.name==="Hotspots"&&ye(s,g=>{if(g.name==="Hotspot.001"||g.name.includes("Hotspot")){let d=new L.Vector3;g.getWorldPosition(d),ze.push({object:g,position:d,name:g.name,triggered:!1})}})}),ye(n,s=>{if(s.isMesh){let g=s.name.toLowerCase();if(g.includes("screen")||g.includes("display")||g.includes("monitor")||g.includes("panel")||g.includes("projection")||g.includes("canvas"))io(s),s.visible=!0;else{let d=oe(s),S=d?.color?d.color.clone():new L.Color(16777215);if(d){if(d.metalness!==void 0&&(d.metalness=Math.max(d.metalness||0,.1)),d.roughness!==void 0&&(d.roughness=Math.min(d.roughness||.5,.8)),d.map&&(d.map.colorSpace=L.SRGBColorSpace),d.isMeshBasicMaterial){let C=new L.MeshStandardMaterial({color:d.color,map:d.map,transparent:d.transparent,opacity:d.opacity,metalness:.1,roughness:.5});s.material=C,d=C}d.needsUpdate=!0}lo.push({mesh:s,name:s.name||"Unnamed",originalColor:S})}}});let a=!1;ye(n,s=>{s.isMesh&&s.name&&(s.name.toLowerCase().includes("screen")||s.name.toLowerCase().includes("display")||s.name.toLowerCase().includes("monitor")||s.name.toLowerCase().includes("panel")||s.name.toLowerCase().includes("projection")||s.name.toLowerCase().includes("canvas"))&&(a=!0)}),!a&&n&&n.children.length>0&&ye(n,s=>{s.isMesh&&!a&&(io(s),s.visible=!0,lo=lo.filter(g=>g.mesh!==s),a=!0)}),T.add(n);let r={x:0,y:5.4,z:-4.3},c={x:-2.9,y:0,z:3.121154018741333},l=Te,m=l&&l.y>1&&l.y<10?l:r,p=Le||c;y.position.set(m.x,m.y,m.z),y.rotation.set(p.x,p.y,p.z),y.updateMatrixWorld(),z.setFromQuaternion(y.quaternion),Fo(!0),Ra()&&En(),Fa(),Sn();function f(){let s=document.getElementById("loading-overlay");s&&(s.classList.add("fade-out"),setTimeout(()=>{s.remove()},500));let g=document.getElementById("canvas-container"),d=document.getElementById("info-panel");g&&g.classList.add("loaded"),d&&d.classList.add("loaded")}Promise.all([Promise.resolve().then(()=>(Pe(),_t)).then(s=>s.applySettingsToScene()),ro().catch(s=>(console.warn("Error loading default texture, continuing anyway:",s),null))]).then(()=>{setTimeout(()=>{let s=n.children.find(g=>{let d=g.name?.toLowerCase()||"";return d.includes("screen")||d.includes("monitor")||d.includes("panel")||d.includes("projection")||d.includes("canvas")});s&&vn(s),f()},100)}).catch(s=>{console.error("Error during scene initialization:",s),setTimeout(f,1e3)})},void 0,o=>{console.error("Error loading 3D model:",o);let n=document.getElementById("loading-overlay");n&&(n.innerHTML='<div style="color: #ff4444; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">Error loading 3D model.</div>')})}var Aa,lo,Re,pt,ze,st=ne(()=>{Se();it();Pe();xt();so();za();xn();Aa=null,lo=[],Re=[],pt=null,ze=[]});var _t={};we(_t,{applyPageBackgrounds:()=>Tn,applyPageColors:()=>Ln,applySettingsToScene:()=>ho,applyVignetteSettings:()=>Sr,bloomSettings:()=>q,cameraSettings:()=>ue,canvasSettings:()=>go,constants:()=>mo,currentCameraPosition:()=>Ye,currentCameraRotation:()=>Xe,dofSettings:()=>j,exportSettingsFile:()=>Lr,getRandomGeneratedColor:()=>Cr,loadSettings:()=>po,moveSpeed:()=>je,pageBackgroundSettings:()=>ee,pageColorSettings:()=>Ie,randomizeColors:()=>bn,reloadFromJSON:()=>Mr,resetToDefaultColors:()=>Tr,saveSettings:()=>Pn,screenSettings:()=>gt,scrollSettings:()=>ht,setBloomSettings:()=>hr,setMoveSpeed:()=>pr,startCameraPosition:()=>Te,startCameraRotation:()=>Le,textureRotationSettings:()=>le});import"three";function pr(e){je=e}function hr(e,t,o){q.strength=e,q.radius=t,q.threshold=o}async function wr(e=!1){try{let t="assets/js/core/default-settings.json",o=e?`${t}?t=${Date.now()}`:t,n=await fetch(o);if(!n.ok)return console.warn("Could not load default-settings.json, using hardcoded defaults"),!1;let i=await n.json();return i.constants&&(mo={...mo,...i.constants}),i.settings&&yr(i.settings),!0}catch(t){return console.warn("Failed to load default settings from JSON:",t),!1}}function yr(e){e.moveSpeed!==void 0&&(je=e.moveSpeed),e.cameraSettings&&Object.assign(ue,e.cameraSettings),e.startCameraPosition&&Object.assign(Te,e.startCameraPosition),e.startCameraRotation&&Object.assign(Le,e.startCameraRotation),e.colorSettings?window.savedColorSettings=e.colorSettings:window.savedColorSettings=null,e.lightSettings?window.savedLightSettings=e.lightSettings:window.savedLightSettings=null,e.bloomSettings&&Object.assign(q,e.bloomSettings),e.dofSettings&&Object.assign(j,e.dofSettings),e.pageColorSettings&&(e.pageColorSettings.vignette&&(Ie.vignette={...Ie.vignette,...e.pageColorSettings.vignette}),Object.assign(Ie,e.pageColorSettings),Ie.vignette||(Ie.vignette={enabled:!0,size:8,fadeWidth:2}),Ln()),e.scrollSettings&&Object.assign(ht,e.scrollSettings),e.canvasSettings&&Object.assign(go,e.canvasSettings),e.screenSettings&&Object.assign(gt,e.screenSettings),e.textureRotationSettings&&Object.assign(le,e.textureRotationSettings),e.pageBackgroundSettings&&(Object.assign(ee,e.pageBackgroundSettings),Tn())}function $a(e,t=.5){if(!e)return null;if(e.startsWith("rgba"))return e;if(e.startsWith("rgb")){let n=e.match(/\d+/g);if(n&&n.length>=3)return`rgba(${n[0]}, ${n[1]}, ${n[2]}, ${t})`}let o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(o){let n=parseInt(o[1],16),i=parseInt(o[2],16),a=parseInt(o[3],16);return`rgba(${n}, ${i}, ${a}, ${t})`}return e}function Tn(){"requestIdleCallback"in window?requestIdleCallback(()=>{let e=document.querySelectorAll(".page-section");if(e.length>0&&e.length>1&&ee.team)for(let t=1;t<e.length;t++){let o=e[t];if(ee.team.backgroundColor&&ee.team.backgroundColor!=="#000000"){let n=$a(ee.team.backgroundColor,.5);o.style.setProperty("background-color",n,"important")}else o.style.removeProperty("background-color");ee.team.backgroundImage?(o.style.setProperty("background-image",`url(${ee.team.backgroundImage})`,"important"),o.style.setProperty("background-size","cover","important"),o.style.setProperty("background-position","center","important"),o.style.setProperty("background-repeat","no-repeat","important")):o.style.removeProperty("background-image")}},{timeout:200}):setTimeout(()=>{let e=document.querySelectorAll(".page-section");if(e.length>0&&e.length>1&&ee.team)for(let t=1;t<e.length;t++){let o=e[t];if(ee.team.backgroundColor&&ee.team.backgroundColor!=="#000000"){let n=$a(ee.team.backgroundColor,.5);o.style.setProperty("background-color",n,"important")}else o.style.removeProperty("background-color");ee.team.backgroundImage?(o.style.setProperty("background-image",`url(${ee.team.backgroundImage})`,"important"),o.style.setProperty("background-size","cover","important"),o.style.setProperty("background-position","center","important"),o.style.setProperty("background-repeat","no-repeat","important")):o.style.removeProperty("background-image")}},50)}function Ga(){let e=document.getElementById("canvas-container");if(!e)return;let t=Ie.vignette||{enabled:!0,size:8,fadeWidth:2};if(!t.enabled){e.style.maskImage="none",e.style.webkitMaskImage="none";return}let o=`${t.size}%`,n=`${t.size+t.fadeWidth}%`,i=`${t.size+t.fadeWidth*2}%`,a=`${100-t.size-t.fadeWidth*2}%`,r=`${100-t.size-t.fadeWidth}%`,c=`${100-t.size}%`,l=`linear-gradient(to right, transparent 0%, transparent ${o}, rgba(0, 0, 0, 0.5) ${n}, black ${i}, black ${a}, rgba(0, 0, 0, 0.5) ${r}, transparent ${c}, transparent 100%)`,m=`linear-gradient(to bottom, transparent 0%, transparent ${o}, rgba(0, 0, 0, 0.5) ${n}, black ${i}, black ${a}, rgba(0, 0, 0, 0.5) ${r}, transparent ${c}, transparent 100%)`;e.style.maskImage=`${l}, ${m}`,e.style.maskComposite="intersect",e.style.webkitMaskImage=`${l}, ${m}`,e.style.webkitMaskComposite="source-in"}function Ln(){Ga()}function Sr(){Ga()}async function po(e=!1){let t=await wr(e);Ln(),Tn()}function Cr(){let e=Object.values(fo).filter(t=>t!==null);return e.length===0?co.primary:e[Math.floor(Math.random()*e.length)]}function Er(){let e=Math.floor(Math.random()*Na.length);return Na[e]}function uo(){let e=Math.floor(Math.random()*Wa.length);return Wa[e]}function Mn(){return uo()}function ja(e,t=.4){return{r:e.r*t,g:e.g*t,b:e.b*t}}function vr(){let e=o=>{let n=Math.round(o.r*255),i=Math.round(o.g*255),a=Math.round(o.b*255);return`rgb(${n}, ${i}, ${a})`},t=o=>{let n=Math.round(o.r*255).toString(16).padStart(2,"0"),i=Math.round(o.g*255).toString(16).padStart(2,"0"),a=Math.round(o.b*255).toString(16).padStart(2,"0");return`#${n}${i}${a}`};Promise.resolve().then(()=>(st(),Rt)).then(o=>{let n=null,i=null,a=null;if(o.fbxMeshes&&o.fbxMeshes.length>0){let m=o.fbxMeshes.find(f=>f.name==="Main_Structure");if(m){let f=oe(m.mesh);f&&f.color&&(n={r:f.color.r,g:f.color.g,b:f.color.b})}let p=o.fbxMeshes.find(f=>f.name==="Chairs");if(p){let f=oe(p.mesh);f&&f.color&&(i={r:f.color.r,g:f.color.g,b:f.color.b})}let h=o.fbxMeshes.find(f=>f.name==="Floor");if(h){let f=oe(h.mesh);f&&f.color&&(a={r:f.color.r,g:f.color.g,b:f.color.b})}}n||(n=window.savedColorSettings?.primary||window.savedColorSettings?.Main_Structure||Mn()),i||(i=window.savedColorSettings?.secondary||window.savedColorSettings?.Chairs||Mn()),a||(a=window.savedColorSettings?.tertiary||window.savedColorSettings?.Floor||Mn()),fo.primary=n,fo.secondary=i,fo.tertiary=a,console.log("%c Color Palette ","background: #222; color: #fff; font-size: 14px; padding: 4px 8px;"),console.log(`  Primary:   ${t(n)}`),console.log(`  Secondary: ${t(i)}`),console.log(`  Tertiary:  ${t(a)}`);let r=n,c=ja(i,.6),l=ja(a,.6);document.documentElement.style.setProperty("--color-primary",e(n)),document.documentElement.style.setProperty("--color-secondary",e(i)),document.documentElement.style.setProperty("--color-tertiary",e(a)),document.documentElement.style.setProperty("--bg-main-color",e(r)),document.documentElement.style.setProperty("--bg-floor-color",e(l)),document.documentElement.style.setProperty("--bg-chairs-color",e(c)),Promise.resolve().then(()=>(Se(),Io)).then(m=>{m.setSceneBackground(r)}),xr([r,c,l])})}function xr(e){let t=n=>{let i=Math.round(n.r*255),a=Math.round(n.g*255),r=Math.round(n.b*255);return`rgb(${i}, ${a}, ${r})`};document.querySelectorAll("a:not(:has(img))").forEach((n,i)=>{let a=e[i%e.length];n.style.backgroundColor=t(a)})}async function ho(){window.savedColorSettings||(window.savedColorSettings={}),Promise.resolve().then(()=>(st(),Rt)).then(e=>{if(e.fbxMeshes&&e.fbxMeshes.length>0){let n=function(){let i=Math.min(t+o,e.fbxMeshes.length);for(let a=t;a<i;a++){let r=e.fbxMeshes[a],c=oe(r.mesh);if(c){let l,m=br[r.name];r.name==="Main_Structure"?(l=zt?co.primary:Er(),window.savedColorSettings.primary=l,window.savedColorSettings[r.name]=l):r.name==="Chairs"?(l=zt?co.secondary:uo(),window.savedColorSettings.secondary=l,window.savedColorSettings[r.name]=l):r.name==="Floor"?(l=zt?co.tertiary:uo(),window.savedColorSettings.tertiary=l,window.savedColorSettings[r.name]=l):r.name==="Screen"?(l=uo(),window.savedColorSettings[r.name]=l):window.savedColorSettings[r.name]?l=window.savedColorSettings[r.name]:l=r.originalColor?{r:r.originalColor.r,g:r.originalColor.g,b:r.originalColor.b}:null,l&&(c.color.setRGB(l.r,l.g,l.b),c.needsUpdate=!0)}}t=i,t<e.fbxMeshes.length?"requestIdleCallback"in window?requestIdleCallback(n,{timeout:50}):setTimeout(n,0):setTimeout(()=>{vr()},10)},t=0,o=5;n()}window.savedLightSettings&&e.glbLights&&("requestIdleCallback"in window?requestIdleCallback(()=>{e.glbLights.forEach((t,o)=>{let n=t.name||`light_${o}`;if(window.savedLightSettings[n]){let i=window.savedLightSettings[n];t.color.setRGB(i.r,i.g,i.b);let a=Math.max(0,Math.min(i.intensity??t.intensity,10));t.intensity=a}})},{timeout:100}):setTimeout(()=>{e.glbLights.forEach((t,o)=>{let n=t.name||`light_${o}`;if(window.savedLightSettings[n]){let i=window.savedLightSettings[n];t.color.setRGB(i.r,i.g,i.b);let a=Math.max(0,Math.min(i.intensity??t.intensity,10));t.intensity=a}})},50))}),Promise.resolve().then(()=>(Qt(),zo)).then(e=>{let t=e.getBloomPass();t&&(t.enabled=q.enabled!==!1,q.enabled?(t.strength=q.strength,t.radius=q.radius,t.threshold=q.threshold):t.strength=0);let o=e.getBokehPass();o&&(o.enabled=j.enabled!==!1,j.enabled&&(o.uniforms.focus.value=j.focus,o.uniforms.aperture.value=j.aperture,o.uniforms.maxblur.value=j.maxblur))})}async function Mr(){await po(!0),await ho()}async function bn(){zt=!1,await ho()}async function Tr(){zt=!0,await ho()}function Pn(e,t){try{let o={};e&&Array.isArray(e)&&e.forEach((a,r)=>{let c=oe(a.mesh);if(c?.color){let l=a.name||`mesh_${r}`;o[l]={r:c.color.r,g:c.color.g,b:c.color.b}}});let n={};t&&Array.isArray(t)&&t.forEach((a,r)=>{let c=a.name||`light_${r}`;n[c]={r:a.color.r,g:a.color.g,b:a.color.b,intensity:a.intensity}});let i={moveSpeed:je,cameraSettings:ue,startCameraPosition:Te,startCameraRotation:Le,colorSettings:o,lightSettings:n,bloomSettings:q,dofSettings:j,pageColorSettings:Ie,scrollSettings:ht,canvasSettings:go,screenSettings:gt,textureRotationSettings:le,pageBackgroundSettings:ee}}catch(o){console.warn("Failed to collect settings:",o)}}function Lr(e,t){try{let o={};e.forEach((l,m)=>{let p=oe(l.mesh);if(p?.color){let h=l.name||`mesh_${m}`;o[h]={r:p.color.r,g:p.color.g,b:p.color.b}}});let n={};t.forEach((l,m)=>{let p=l.name||`light_${m}`;n[p]={r:l.color.r,g:l.color.g,b:l.color.b,intensity:l.intensity}});let i={version:"1.0.0",constants:mo,settings:{moveSpeed:je,pageColorSettings:Ie,scrollSettings:ht,canvasSettings:go,cameraSettings:ue,startCameraPosition:Te,startCameraRotation:Le,bloomSettings:q,dofSettings:j,colorSettings:o,lightSettings:n,screenSettings:gt,textureRotationSettings:le,pageBackgroundSettings:ee}},a=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),r=URL.createObjectURL(a),c=document.createElement("a");c.href=r,c.download="dome-dreaming-settings.json",document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(r)}catch(o){console.error("Failed to export settings file:",o)}}var mo,je,ue,Te,Le,Ye,Xe,q,j,Ie,ht,go,gt,le,ee,co,br,fo,zt,Na,Wa,Pe=ne(()=>{it();mo={cameraHeight:1.6,navmeshSearchBox:{x:5,y:10,z:5},screenMaterialSettings:{emissive:[1,1,1],emissiveIntensity:1,color:[1,1,1],toneMapped:!1,transparent:!1,opacity:1}},je=.04,ue={sensitivity:.002,rotationSpeed:120},Te={x:0,y:5.4,z:-4.3},Le={x:-2.9,y:0,z:3.121154018741333},Ye={x:0,y:0,z:0},Xe={x:0,y:0,z:0},q={enabled:!0,strength:1.5,radius:.4,threshold:.85},j={enabled:!0,focus:12,aperture:.0014,maxblur:.05},Ie={backgroundColor:"#000000",textColor:"#ffffff",dotColor:"#ffffff",sidebarColor:"#333333",sidebarVisible:!0,headerIslandVisible:!1,blendMode:"normal",vignette:{enabled:!1,size:8,fadeWidth:2}},ht={enabled:!0,scrollTimeout:25,touchThreshold:30,snapThreshold:.5,initialSnapThreshold:1,gridColumns:16,gridRows:16},go={rows:8},gt={defaultImage:"assets/img/jpg/background-dome-dreaming.jpg"},le={enabled:!0,speed:.02},ee={canvas:{backgroundColor:"#000000",backgroundImage:null},about:{backgroundColor:"#463434",backgroundImage:null},team:{backgroundColor:"#000000",backgroundImage:null}};co={primary:{r:.4,g:.45,b:.5},secondary:{r:.55,g:.32,b:.38},tertiary:{r:.65,g:.52,b:.25}},br={Main_Structure:"primary",Chairs:"secondary",Floor:"tertiary"},fo={primary:null,secondary:null,tertiary:null};zt=!0,Na=[{r:.38,g:.42,b:.48},{r:.45,g:.48,b:.52},{r:.42,g:.45,b:.5},{r:.48,g:.45,b:.42}],Wa=[{r:.55,g:.32,b:.38},{r:.65,g:.52,b:.25},{r:.45,g:.55,b:.42},{r:.6,g:.4,b:.32},{r:.4,g:.5,b:.58},{r:.48,g:.3,b:.45}]});Pe();Pe();function Pr(){return window.visualViewport&&window.visualViewport.height?window.visualViewport.height:document.documentElement.clientHeight||window.innerHeight}function wt(){let e=getComputedStyle(document.documentElement),t=e.getPropertyValue("--row-height"),o=parseFloat(t);if(!isNaN(o)&&o>0)return o;let n=parseFloat(e.getPropertyValue("--grid-rows"))||16;return Pr()/n}var Ht=!1,qa=0,kr=30,kn=0,Rr=0,Fn=!1,Rn=0,Qe=0;function Va(e){let o=wt()*2;return Math.round(e/o)*o}function In(){if(Ht)return;let e=window.pageYOffset||document.documentElement.scrollTop,t=Va(e);Math.abs(e-t)>1&&(Ht=!0,window.scrollTo({top:t,behavior:"auto"}),setTimeout(()=>{Ht=!1},50))}function Ir(){if(Ht)return;let e=window.pageYOffset||document.documentElement.scrollTop,t=Va(e),n=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?5:1;Math.abs(e-t)>n&&In()}function _a(e){let t=Date.now();if(t-qa<kr)return;let o=wt(),n=window.pageYOffset||document.documentElement.scrollTop,i=o*2;if(e!==0){let c=(Math.round(n/i)+e)*i,l=Math.max(document.body.scrollHeight-window.innerHeight,document.documentElement.scrollHeight-window.innerHeight),m=Math.max(0,Math.min(c,l));Math.abs(m-n)>1&&(qa=t,window.scrollTo({top:m,behavior:"auto"}))}}function Fr(e){if(document.body.classList.contains("dome-mode"))return;e.preventDefault();let t=e.deltaY,o=0;t>0?o=1:t<0&&(o=-1),o!==0&&_a(o)}function zr(e){if(document.body.classList.contains("dome-mode"))return;let t=e.target;t.closest("a")||t.closest("button")||t.tagName==="A"||t.tagName==="BUTTON"||e.touches.length===1&&(kn=e.touches[0].clientY,Rn=kn,Rr=Date.now(),Fn=!1,Qe=0)}function Hr(e){if(document.body.classList.contains("dome-mode"))return;let t=e.target;if(t.closest("a")||t.closest("button")||t.tagName==="A"||t.tagName==="BUTTON"||e.touches.length!==1)return;e.preventDefault();let o=e.touches[0].clientY,n=Rn-o,i=kn-o;Math.abs(i)>10&&(Fn=!0),Qe+=n,Rn=o;let c=wt()*2*.2;if(Math.abs(Qe)>=c){let l=Qe>0?1:-1;_a(l),Qe=Qe%c}}function Dr(e){if(document.body.classList.contains("dome-mode"))return;let t=e.target;t.closest("a")||t.closest("button")||t.tagName==="A"||t.tagName==="BUTTON"||(e.preventDefault(),Fn=!1,Qe=0)}function zn(){if(!ht.enabled||document.body.classList.contains("dome-mode"))return;window.addEventListener("wheel",Fr,{passive:!1}),document.addEventListener("touchstart",zr,{passive:!1}),document.addEventListener("touchmove",Hr,{passive:!1}),document.addEventListener("touchend",Dr,{passive:!1});let e=null;window.addEventListener("scroll",()=>{if(Ht)return;e&&clearTimeout(e),e=setTimeout(()=>{Ir(),e=null},30)},{passive:!0}),window.addEventListener("load",()=>{setTimeout(()=>{In()},100)}),window.addEventListener("resize",()=>{setTimeout(()=>{In()},100)})}var St=null,yt=16,Hn=0,Or=0;function Br(){let e=document.getElementById("dots");e&&e.remove(),St=document.createElement("div"),St.id="dots",document.body.appendChild(St),Dn(),On()}function Dn(){let e=getComputedStyle(document.documentElement),t=document.documentElement.clientWidth||window.innerWidth,o=e.getPropertyValue("--col-width");o?Hn=parseFloat(o)||t/yt:Hn=t/yt;let n=e.getPropertyValue("--row-height"),i=parseFloat(n);Or=!isNaN(i)&&i>0?i:Hn}function On(){if(!St)return;St.innerHTML="";let t=16*yt,o=32,n=0;function i(){let a=Math.min(n+o,t);for(let r=n;r<a;r++){let c=Math.floor(r/yt),l=r%yt,m=document.createElement("div");m.className="dot",m.dataset.col=l+1,m.dataset.row=c+1,m.style.gridColumn=l+1,m.style.gridRow=c+1,m.style.pointerEvents="none";let p=l+1,h=c+1,f=p+(h-1)*yt;m.style.setProperty("--dot-delay",f),St.appendChild(m)}n=a,n<t&&("requestIdleCallback"in window?requestIdleCallback(i,{timeout:50}):setTimeout(i,0))}i()}function Bn(){Br();let e,t=()=>{clearTimeout(e),e=setTimeout(()=>{Dn(),On()},150)};window.addEventListener("resize",t),window.addEventListener("orientationchange",()=>{setTimeout(()=>{Dn(),On()},300)})}function wo(e){document.querySelectorAll(".dashboard-block.active, .page-content .block.active").forEach(t=>{t.classList.remove("active")}),e.classList.add("active")}function An(){"requestIdleCallback"in window?requestIdleCallback(()=>{document.querySelectorAll(".dashboard-block").forEach(o=>{o.addEventListener("click",()=>{wo(o)})}),document.querySelectorAll(".page-content .block img").forEach(o=>{let n=o.closest(".block");n&&n.addEventListener("click",()=>{wo(n)})})},{timeout:200}):setTimeout(()=>{document.querySelectorAll(".dashboard-block").forEach(o=>{o.addEventListener("click",()=>{wo(o)})}),document.querySelectorAll(".page-content .block img").forEach(o=>{let n=o.closest(".block");n&&n.addEventListener("click",()=>{wo(n)})})},50)}function $n(){let e=getComputedStyle(document.documentElement),t=parseFloat(e.getPropertyValue("--grid-rows"))||16,o=wt();document.querySelectorAll(".page-section").forEach(i=>{let a=i.querySelector(".block.responsive");if(!a)return;let r=i.style.height,c=i.style.minHeight,l=i.style.getPropertyValue("--section-grid-rows");i.style.height="auto",i.style.minHeight="auto",i.style.removeProperty("--section-grid-rows"),i.offsetHeight;let m=a.offsetHeight;i.style.height=r,i.style.minHeight=c,l&&i.style.setProperty("--section-grid-rows",l);let p=Math.ceil(m/o);p=Math.max(1,p),p=p+2,i.style.setProperty("--section-grid-rows",p.toString())})}function Nn(){window.addEventListener("load",()=>{setTimeout(()=>{$n()},100)});let e,t=()=>{clearTimeout(e),e=setTimeout(()=>{$n()},100)};window.addEventListener("resize",t),window.addEventListener("orientationchange",t),window.visualViewport&&window.visualViewport.addEventListener("resize",t),(document.readyState==="complete"||document.readyState==="interactive")&&setTimeout(()=>{$n()},100)}var Ot,Ar,ce,$r,$,Ka,Wn,jn,Ja,Gn,Za,Dt,qn,Vn,ei,ti,yo,_n,Je,So,bo,Co,Eo,Un,M,Yn,vo,Ke,Xn=!1,Nr=null,xo=0,Ua=0,Wr=2e3;async function Ya(){await new Promise(e=>{"scheduler"in window&&"postTask"in window.scheduler?window.scheduler.postTask(()=>e(),{priority:"user-blocking"}):"requestIdleCallback"in window?requestIdleCallback(()=>e(),{timeout:0}):setTimeout(()=>e(),0)}),await po(),await new Promise(e=>setTimeout(e,0)),"requestIdleCallback"in window?requestIdleCallback(()=>{zn(),Nn(),An()},{timeout:100}):setTimeout(()=>{zn(),Nn(),An()},0),"requestIdleCallback"in window?requestIdleCallback(()=>{Bn()},{timeout:500}):setTimeout(()=>{Bn()},50),"requestIdleCallback"in window?requestIdleCallback(()=>{Xa()},{timeout:100}):setTimeout(()=>{Xa()},0)}async function oi(){if(!Xn)try{Ot=await import("three");let e=await Promise.resolve().then(()=>(Se(),Io)),t=await Promise.resolve().then(()=>(xt(),ta)),o=await Promise.resolve().then(()=>(un(),xa)),n=await Promise.resolve().then(()=>(Qt(),zo));Ar=e.scene,ce=e.camera,$r=e.renderer,$=e.canvas,Ka=e.resetCamera,Wn=o.setupLighting,jn=n.initPostProcessing,Ja=n.updatePostProcessing,Gn=t.setupCameraControls,Za=t.euler,Xn=!0}catch(e){console.error("Error loading Three.js:",e)}}async function bt(){if(await oi(),!(Dt&&Je))try{let e=await Promise.resolve().then(()=>(st(),Rt)),t=await Promise.resolve().then(()=>(Vt(),Zn)),o=await Promise.resolve().then(()=>(so(),Pa)),n=await Promise.resolve().then(()=>(xn(),Ba)),i=await Promise.resolve().then(()=>(Zt(),ca));Dt=e.loadModel,qn=t.updateMovement,Vn=t.updateRotation,ei=e.fbxMeshes,ti=e.glbLights,yo=o.getCurrentImageTexture,_n=o.getCurrentVideoTexture,Je=o.connectWebcam,So=o.loadImage,bo=o.loadVideo,Co=o.disconnectWebcam,Eo=o.loadDefaultScreenTexture,Un=n.updateScreenLighting,M=t.touchMovement,Yn=i.updateListenerPosition,vo=i.startAudio,Ke=i.stopAudio,window.loadModel=Dt,window.connectWebcam=Je,window.loadImage=So,window.loadVideo=bo,window.disconnectWebcam=Co,window.loadDefaultScreenTexture=Eo}catch(e){console.error("Error loading 3D modules:",e)}}function Xa(){let e=null;function t(){return e||(e=document.createElement("input"),e.type="file",e.accept="image/*,video/*",e.style.display="none",document.body.appendChild(e),e.addEventListener("change",async f=>{let s=f.target.files?.[0];s&&((!So||!bo)&&await bt(),s.type.startsWith("image/")?So(s):s.type.startsWith("video/")&&bo(s)),e.value=""})),e}let o=document.getElementById("connect-webcam-link");o&&o.addEventListener("click",async f=>{f.preventDefault(),Je||await bt(),Je()});let n=document.getElementById("upload-file-link");n&&n.addEventListener("click",f=>{f.preventDefault(),t().click()});let i=document.getElementById("keyboard-upload-btn");i&&i.addEventListener("click",f=>{f.preventDefault(),f.stopPropagation(),t().click()}),window.resetToDefaults=async function(){try{(!Co||!Eo)&&await bt(),Co(),Eo(),Ka(Te,Le,Za),Object.assign(Ye,Te),Object.assign(Xe,Le)}catch(f){console.error("Error during reset:",f)}};let a=!1;function r(){let f=document.getElementById("keyboard-reset-btn");if(f&&!a){let s=function(d){return d.preventDefault(),d.stopPropagation(),d.stopImmediatePropagation(),window.resetToDefaults&&window.resetToDefaults(),!1},g=f.cloneNode(!0);return f.parentNode.replaceChild(g,f),g.onclick=s,g.addEventListener("click",s,{capture:!0,passive:!1}),g.addEventListener("touchend",s,{capture:!0,passive:!1}),a=!0,!0}return!1}let c=async function(f){return f.preventDefault(),f.stopPropagation(),f.stopImmediatePropagation(),Je||await bt(),confirm("Do you want to connect your webcam to the screen?")&&Je(),!1};window.setupCameraButton=function(){let f=document.getElementById("keyboard-camera-btn");if(f){let s=f.cloneNode(!0);return f.parentNode.replaceChild(s,f),s.onclick=c,s.addEventListener("click",c,{capture:!0,passive:!1}),s.addEventListener("touchend",c,{capture:!0,passive:!1}),!0}return!1},r(),setupCameraButton(),setTimeout(()=>{document.getElementById("keyboard-reset-btn")||r(),document.getElementById("keyboard-camera-btn")||setupCameraButton()},500);let l=()=>{};window.addEventListener("resize",l),window.visualViewport&&window.visualViewport.addEventListener("resize",l),window.addEventListener("orientationchange",()=>{setTimeout(l,100)}),document.querySelectorAll(".wasd-key-btn").forEach(f=>{let s=f.getAttribute("data-key");s&&(f.addEventListener("touchstart",g=>{g.preventDefault(),g.stopPropagation(),f.classList.add("active"),s==="w"&&(M.forward=!0),s==="s"&&(M.backward=!0),s==="a"&&(M.left=!0),s==="d"&&(M.right=!0),s==="q"&&(M.rotateLeft=!0),s==="e"&&(M.rotateRight=!0)}),f.addEventListener("touchend",g=>{g.preventDefault(),g.stopPropagation(),f.classList.remove("active"),s==="w"&&(M.forward=!1),s==="s"&&(M.backward=!1),s==="a"&&(M.left=!1),s==="d"&&(M.right=!1),s==="q"&&(M.rotateLeft=!1),s==="e"&&(M.rotateRight=!1)}),f.addEventListener("touchcancel",g=>{g.preventDefault(),g.stopPropagation(),f.classList.remove("active"),s==="w"&&(M.forward=!1),s==="s"&&(M.backward=!1),s==="a"&&(M.left=!1),s==="d"&&(M.right=!1),s==="q"&&(M.rotateLeft=!1),s==="e"&&(M.rotateRight=!1)}),f.addEventListener("mousedown",g=>{g.preventDefault(),g.stopPropagation(),f.classList.add("active"),s==="w"&&(M.forward=!0),s==="s"&&(M.backward=!0),s==="a"&&(M.left=!0),s==="d"&&(M.right=!0),s==="q"&&(M.rotateLeft=!0),s==="e"&&(M.rotateRight=!0)}),f.addEventListener("mouseup",g=>{g.preventDefault(),g.stopPropagation(),f.classList.remove("active"),s==="w"&&(M.forward=!1),s==="s"&&(M.backward=!1),s==="a"&&(M.left=!1),s==="d"&&(M.right=!1),s==="q"&&(M.rotateLeft=!1),s==="e"&&(M.rotateRight=!1)}),f.addEventListener("mouseleave",g=>{f.classList.remove("active"),s==="w"&&(M.forward=!1),s==="s"&&(M.backward=!1),s==="a"&&(M.left=!1),s==="d"&&(M.right=!1),s==="q"&&(M.rotateLeft=!1),s==="e"&&(M.rotateRight=!1)}),f.addEventListener("click",g=>{f.classList.remove("active")}))});let p=document.getElementById("enter-dome-link");p&&p.addEventListener("click",async f=>{f.preventDefault(),vo||await bt(),window.enterDomeModeWithAudio&&window.enterDomeModeWithAudio()});let h=async()=>{await oi(),Wn&&Wn(),jn&&jn(),Gn&&Gn(),await bt(),Dt&&(Dt(),Gr())};"requestIdleCallback"in window?requestIdleCallback(()=>h(),{timeout:2e3}):setTimeout(h,500)}function ni(e){if(Nr=requestAnimationFrame(ni),!Xn||!ce)return;let t=(e-xo)/1e3;if(xo=e,qn&&Vn&&(qn(),Vn(t)),Ye.x=ce.position.x,Ye.y=ce.position.y,Ye.z=ce.position.z,Xe.x=ce.rotation.x,Xe.y=ce.rotation.y,Xe.z=ce.rotation.z,e-Ua>=Wr&&(Object.assign(Te,Ye),Object.assign(Le,Xe),Pn(ei,ti),Ua=e),yo&&jr(t),Un&&Un(e),Yn&&Ot&&ce){let n=new Ot.Vector3(0,0,-1);n.applyQuaternion(ce.quaternion),Yn({x:ce.position.x,y:ce.position.y,z:ce.position.z},{x:n.x,y:n.y,z:n.z})}Ja()}function jr(e){if(!le.enabled||!Ot||!yo)return;let t=yo(),o=_n?_n():null,n=t||o;if(n)for((!n.center||n.center.x!==.5||n.center.y!==.5)&&(n.center?n.center.set(.5,.5):n.center=new Ot.Vector2(.5,.5)),n.rotation-=le.speed*e;n.rotation<0;)n.rotation+=Math.PI*2}function Gr(){xo=performance.now(),ni(xo)}function Qa(){let e=document.getElementById("keyboard-exit-btn"),t=document.body,o=!1,n=!1;function i(){return/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||"ontouchstart"in window||navigator.maxTouchPoints>0}function a(){e&&(t.classList.contains("dome-mode")?i()?(e.textContent="exit",e.style.display="flex"):e.style.display="none":(e.textContent="enter",e.style.display="flex",e.disabled=!1,e.style.pointerEvents="auto"))}function r(m=!1){if(t.classList.contains("dome-mode"))return;t.classList.add("dome-mode"),document.documentElement.style.overflow="hidden",a();let p=document.getElementById("canvas-container");if(p){let f=getComputedStyle(document.documentElement).getPropertyValue("--actual-vh");p.style.height=f||"100vh",p.style.width="100vw",setTimeout(()=>{window.dispatchEvent(new Event("resize"))},0)}let h=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||"ontouchstart"in window||navigator.maxTouchPoints>0;if(n=m&&!h,m&&$&&!h&&!(document.pointerLockElement===$||document.mozPointerLockElement===$||document.webkitPointerLockElement===$)){let s=setTimeout(()=>{if(!t.classList.contains("dome-mode")||o)return;let g=$.requestPointerLock||$.mozRequestPointerLock||$.webkitRequestPointerLock;if(g)try{g.call($).catch(d=>{d.name!=="SecurityError"&&d.name!=="NotAllowedError"&&console.warn("Pointer lock request failed:",d)})}catch(d){d.name!=="SecurityError"&&d.name!=="NotAllowedError"&&console.warn("Pointer lock request failed:",d)}},100);window.pointerLockTimeout=s}setTimeout(()=>{window.setupCameraButton&&window.setupCameraButton()},150)}function c(){if(!o){if(o=!0,window.pointerLockTimeout&&(clearTimeout(window.pointerLockTimeout),window.pointerLockTimeout=null),$&&(document.pointerLockElement===$||document.mozPointerLockElement===$||document.webkitPointerLockElement===$))try{document.exitPointerLock()}catch(m){m.name!=="SecurityError"&&console.warn("Error exiting pointer lock:",m)}if(t.classList.contains("dome-mode")){t.classList.remove("dome-mode"),document.documentElement.style.overflow="auto";let m=document.getElementById("canvas-container");m&&(m.style.width=""),a(),setTimeout(()=>{window.setupCameraButton&&window.setupCameraButton(),setTimeout(()=>{o=!1},100)},0)}else o=!1}}window.enterDomeModeFromCanvas=()=>{r(!0)},window.enterDomeModeWithAudio=async()=>{if(r(!1),vo)try{await vo()}catch(m){console.warn("Could not start audio:",m)}},e&&(e.addEventListener("click",m=>{if(m.stopPropagation(),!t.classList.contains("dome-mode"))r(!0);else if(i()&&(c(),Ke))try{Ke()}catch(p){console.warn("Could not stop audio:",p)}}),e.addEventListener("touchend",m=>{if(m.stopPropagation(),m.preventDefault(),!t.classList.contains("dome-mode"))r(!0);else if(i()&&(c(),Ke))try{Ke()}catch(p){console.warn("Could not stop audio:",p)}})),a(),document.addEventListener("keydown",m=>{if(m.key==="Escape"&&t.classList.contains("dome-mode")&&(c(),Ke))try{Ke()}catch(p){console.warn("Could not stop audio:",p)}});function l(){if(o)return;let m=$&&(document.pointerLockElement===$||document.mozPointerLockElement===$||document.webkitPointerLockElement===$),p=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||"ontouchstart"in window||navigator.maxTouchPoints>0;!m&&t.classList.contains("dome-mode")&&!p&&n&&setTimeout(()=>{!o&&t.classList.contains("dome-mode")&&!(document.pointerLockElement===$||document.mozPointerLockElement===$||document.webkitPointerLockElement===$)&&c()},50)}document.addEventListener("pointerlockchange",l),document.addEventListener("mozpointerlockchange",l),document.addEventListener("webkitpointerlockchange",l)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{Ya(),Qa()}):(Ya(),Qa());
