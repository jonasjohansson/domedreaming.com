var Fi=Object.defineProperty;var K=(e,t)=>()=>(e&&(t=e(e=0)),t);var we=(e,t)=>{for(var o in t)Fi(e,o,{get:t[o],enumerable:!0})};import*as No from"three";var ue,Ge,He,Ft=K(()=>{ue=1.6,Ge={x:5,y:10,z:5},He={emissive:new No.Color(16777215),emissiveIntensity:1,color:new No.Color(16777215),toneMapped:!1,transparent:!0,opacity:1}});var da={};we(da,{applyTextureToScreen:()=>dt,colorToHex:()=>zi,configureTexture:()=>ut,getMaterial:()=>ne,pruneObjectChildren:()=>Jt,rgbToHex:()=>zt,safeTraverse:()=>ye});import*as _ from"three";function dt(e,t){if(!t)return;let o=Array.isArray(t.material)?t.material[0]:t.material;if(!o){let n=new _.MeshStandardMaterial({map:e,...He,color:new _.Color(16777215),emissive:new _.Color(16777215),emissiveMap:e,emissiveIntensity:1});t.material=n;return}o.map&&o.map.dispose(),o.emissiveMap&&o.emissiveMap!==e&&o.emissiveMap.dispose(),o.map=e,o.emissiveMap=e,Object.assign(o,He),o.color.setRGB(1,1,1),o.emissive.setRGB(1,1,1),o.emissiveIntensity=1,o.needsUpdate=!0}function ut(e){e.flipY=!0,e.wrapS=_.RepeatWrapping,e.wrapT=_.RepeatWrapping,e.repeat.x=1,e.repeat.y=-1,e.colorSpace=_.SRGBColorSpace,e.center.set(.5,.5),e.minFilter=_.LinearMipmapLinearFilter,e.magFilter=_.LinearFilter,e.anisotropy=16,e.generateMipmaps=!0,e.needsUpdate=!0}function ne(e){return Array.isArray(e.material)?e.material[0]:e.material}function zi(e){return`#${Math.floor(e.r*255).toString(16).padStart(2,"0")}${Math.floor(e.g*255).toString(16).padStart(2,"0")}${Math.floor(e.b*255).toString(16).padStart(2,"0")}`}function zt(e){let t=Math.round(e.r*255).toString(16).padStart(2,"0"),o=Math.round(e.g*255).toString(16).padStart(2,"0"),n=Math.round(e.b*255).toString(16).padStart(2,"0");return`#${t}${o}${n}`}function Jt(e){!e||!e.children||(e.children=e.children.filter(Boolean),e.children.forEach(t=>Jt(t)))}function ye(e,t){if(!e)return;let o=[e];for(;o.length;){let n=o.pop();if(n&&(t(n),n.children&&n.children.length))for(let i=n.children.length-1;i>=0;i--){let a=n.children[i];a&&typeof a.traverse=="function"?o.push(a):n.children.splice(i,1)}}}var vs,Ne=K(()=>{Ft();vs=[new _.Color(.4,.2,.6),new _.Color(.2,.5,.6),new _.Color(.7,.4,.2)]});var Vo={};we(Vo,{camera:()=>y,canvas:()=>le,canvasContainer:()=>Wo,renderer:()=>O,resetCamera:()=>Ai,scene:()=>T,setResizeHandler:()=>qo,setSceneBackground:()=>Hi});import*as ie from"three";function Hi(e){e&&typeof e=="object"?T.background=new ie.Color(e.r,e.g,e.b):typeof e=="string"&&(T.background=new ie.Color(e))}function ua(){let e=Wo.getBoundingClientRect();return{width:e.width,height:e.height}}function qo(e){window.removeEventListener("resize",Zt),Zt=e,window.addEventListener("resize",Zt)}function Ai(e,t,o){e&&y.position.set(e.x,e.y,e.z),t&&(y.rotation.set(t.x,t.y,t.z),y.updateMatrixWorld(),o&&o.set(t.x,t.y,t.z,"YXZ"))}var T,y,O,Wo,eo,le,Zt,Se=K(()=>{T=new ie.Scene;T.background=new ie.Color(14211288);y=new ie.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);y.position.set(0,5.4,-4.3);y.rotation.set(-2.8,0,3.121154018741333);O=new ie.WebGLRenderer({antialias:!1,powerPreference:"high-performance",stencil:!1,depth:!0}),Wo=document.getElementById("canvas-container");eo=ua();O.setSize(eo.width,eo.height);O.setPixelRatio(Math.min(window.devicePixelRatio,1.5));y.aspect=eo.width/eo.height;y.updateProjectionMatrix();setTimeout(()=>{window.dispatchEvent(new Event("resize"))},100);O.shadowMap.enabled=!1;O.toneMapping=ie.NoToneMapping;O.outputColorSpace=ie.SRGBColorSpace;Wo.appendChild(O.domElement);le=O.domElement,Zt=()=>{let e=ua();y.aspect=e.width/e.height,y.updateProjectionMatrix(),O.setSize(e.width,e.height),O.setPixelRatio(Math.min(window.devicePixelRatio,1.5))};window.addEventListener("resize",Zt)});var fa={};we(fa,{checkHotspots:()=>$i,constrainToNavmesh:()=>Bi,setNavMeshQuery:()=>oo,touchMovement:()=>qe,updateMovement:()=>Di,updateRotation:()=>Oi});import*as to from"three";function oo(e){We=e}function Di(){if(!re)return;y.updateMatrixWorld();let e=new to.Vector3;e.setFromMatrixColumn(y.matrixWorld,2),e.multiplyScalar(-1).normalize();let t=new to.Vector3;t.setFromMatrixColumn(y.matrixWorld,0),t.normalize();let o=new to.Vector3,n=Ue;fe.w&&o.add(e.clone().multiplyScalar(n)),fe.s&&o.add(e.clone().multiplyScalar(-n)),fe.a&&o.add(t.clone().multiplyScalar(-n)),fe.d&&o.add(t.clone().multiplyScalar(n));let i=n*2;if(qe.forward&&o.add(e.clone().multiplyScalar(i)),qe.backward&&o.add(e.clone().multiplyScalar(-i)),qe.left&&o.add(t.clone().multiplyScalar(-i)),qe.right&&o.add(t.clone().multiplyScalar(i)),o.length()!==0)if(We){let a=y.position.clone();a.x+=o.x,a.z+=o.z;let r={x:a.x,y:a.y-ue,z:a.z},s=We.findClosestPoint(r,{halfExtents:Ge});if(s.success)y.position.set(s.point.x,s.point.y+ue,s.point.z);else{let l=We.findClosestPoint({x:a.x,y:y.position.y-ue,z:y.position.z},{halfExtents:Ge});if(l.success)y.position.set(l.point.x,l.point.y+ue,y.position.z);else{let m=We.findClosestPoint({x:y.position.x,y:y.position.y-ue,z:a.z},{halfExtents:Ge});m.success&&y.position.set(y.position.x,m.point.y+ue,m.point.z)}}}else y.position.add(o)}function Bi(){if(!We)return;let e={x:y.position.x,y:y.position.y-ue,z:y.position.z},t=We.findClosestPoint(e,{halfExtents:Ge});t.success&&(y.position.y=t.point.y+ue)}function Oi(e){fe.q||fe.Q?Ve(me.rotationSpeed*(Math.PI/180)):fe.e||fe.E?Ve(-me.rotationSpeed*(Math.PI/180)):Ve(0),ft!==0&&re&&(J.y+=ft*e,y.quaternion.setFromEuler(J)),re&&(qe.rotateLeft&&(J.y+=1.5*e,y.quaternion.setFromEuler(J)),qe.rotateRight&&(J.y-=1.5*e,y.quaternion.setFromEuler(J)))}function $i(){if(!re||!Ae||Ae.length===0)return;let e=.4;for(let t=Ae.length-1;t>=0;t--){let o=Ae[t];if(!o||!o.object||o.triggered)continue;let n=y.position.x-o.position.x,i=y.position.z-o.position.z;if(Math.sqrt(n*n+i*i)<e){o.triggered=!0,o.object.parent&&o.object.parent.remove(o.object),Ae.splice(t,1),alert(""),console.log(`Hotspot ${o.name} triggered and removed`);break}}}var We,qe,no=K(()=>{Se();Ft();Re();Ht();mt();We=null,qe={forward:!1,backward:!1,left:!1,right:!1,rotateLeft:!1,rotateRight:!1}});var pa={};we(pa,{euler:()=>J,isPointerLocked:()=>ji,isTouching:()=>io,keys:()=>fe,modelLoaded:()=>re,qeRotationSpeed:()=>ft,setModelLoaded:()=>Uo,setQeRotationSpeed:()=>Ve,setupCameraControls:()=>Gi,touchStartX:()=>ro,touchStartY:()=>so});import*as ma from"three";function Uo(e){re=e}function Ve(e){ft=e}function Gi(){let e=!1,t=0,o=0;le.addEventListener("mousedown",a=>{re&&(e=!0,t=a.clientX,o=a.clientY,le.style.cursor="grabbing")}),le.addEventListener("mousemove",a=>{if(!e||!re)return;let r=a.clientX-t,s=a.clientY-o;J.y-=r*me.sensitivity,J.x-=s*me.sensitivity,y.quaternion.setFromEuler(J),t=a.clientX,o=a.clientY}),le.addEventListener("mouseup",()=>{e=!1,le.style.cursor="default"}),le.addEventListener("mouseleave",()=>{e=!1,le.style.cursor="default"});let n=null;le.addEventListener("touchstart",a=>{if(re&&(a.preventDefault(),a.touches.length===1&&n===null)){let r=a.touches[0];n=r.identifier,ro=r.clientX,so=r.clientY,io=!0}},{passive:!1}),le.addEventListener("touchmove",a=>{if(re&&(a.preventDefault(),n!==null&&a.touches.length===1)){let r=Array.from(a.touches).find(s=>s.identifier===n);if(r){let s=r.clientX-ro,l=r.clientY-so;J.y-=s*me.sensitivity,J.x-=l*me.sensitivity,y.quaternion.setFromEuler(J),ro=r.clientX,so=r.clientY}}},{passive:!1}),le.addEventListener("touchend",a=>{a.preventDefault();for(let r=0;r<a.changedTouches.length;r++)a.changedTouches[r].identifier===n&&(n=null,io=!1)},{passive:!1}),le.addEventListener("touchcancel",a=>{a.preventDefault();for(let r=0;r<a.changedTouches.length;r++)a.changedTouches[r].identifier===n&&(n=null,io=!1)},{passive:!1});function i(a,r){let s=a.toLowerCase();["q","w","a","s","d","e"].includes(s)&&document.querySelectorAll(`[data-key="${s}"]`).forEach(m=>{r?m.classList.add("active"):m.classList.remove("active")})}window.addEventListener("keydown",a=>{let r=a.key.toLowerCase();fe[r]=!0,i(a.key,!0),(a.key==="c"||a.key==="C")&&(console.log("Camera Position:",y.position),console.log("Camera Rotation:",y.rotation)),(a.key==="q"||a.key==="Q")&&Ve(1.5),(a.key==="e"||a.key==="E")&&Ve(-1.5)}),window.addEventListener("keyup",a=>{let r=a.key.toLowerCase();fe[r]=!1,i(a.key,!1),(a.key==="q"||a.key==="Q"||a.key==="e"||a.key==="E")&&(ft=0)})}var ji,io,J,re,ro,so,fe,ft,Ht=K(()=>{Se();Re();no();ji=!1,io=!1,J=new ma.Euler(-2.85,0,3.121154018741333,"YXZ"),re=!1,ro=0,so=0,fe={},ft=0});function Me(){return/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||"ontouchstart"in window||navigator.maxTouchPoints>0}function ga(){return window.visualViewport&&window.visualViewport.height?window.visualViewport.height:document.documentElement.clientHeight||window.innerHeight}function _o(){let e=ga();document.documentElement.style.setProperty("--actual-vh",`${e}px`)}function pt(){let e=getComputedStyle(document.documentElement),t=e.getPropertyValue("--row-height"),o=parseFloat(t);if(!isNaN(o)&&o>0)return o;let n=parseFloat(e.getPropertyValue("--grid-rows"))||16;return ga()/n}var _e=K(()=>{});var Yo={};we(Yo,{getBloomPass:()=>Yi,getBokehPass:()=>yt,initPostProcessing:()=>Ui,resizePostProcessing:()=>ya,updatePostProcessing:()=>_i});import*as wt from"three";import{EffectComposer as Ni}from"three/addons/postprocessing/EffectComposer.js";import{RenderPass as Wi}from"three/addons/postprocessing/RenderPass.js";import{UnrealBloomPass as qi}from"three/addons/postprocessing/UnrealBloomPass.js";import{BokehPass as Vi}from"three/addons/postprocessing/BokehPass.js";import"three/addons/postprocessing/OutputPass.js";import"three/addons/postprocessing/FXAAPass.js";function Ui(){let t=document.getElementById("canvas-container").getBoundingClientRect(),o=new wt.Vector2(t.width,t.height),n=new wt.WebGLRenderTarget(o.width,o.height,{type:wt.HalfFloatType,samples:0});De=new Ni(O,n),ha=new Wi(T,y),De.addPass(ha);let i=q.enabled!==!1?q.strength:0;gt=new qi(o,i,q.radius,q.threshold),gt.enabled=q.enabled!==!1,De.addPass(gt),ht=new Vi(T,y,{focus:G.focus,aperture:G.aperture,maxblur:G.maxblur}),ht.enabled=G.enabled!==!1,De.addPass(ht),qo(()=>{let r=document.getElementById("canvas-container").getBoundingClientRect(),s=r.width,l=r.height;y.aspect=s/l,y.updateProjectionMatrix(),O.setSize(s,l),O.setPixelRatio(Math.min(window.devicePixelRatio,1.5)),ya()}),console.log("Post-processing initialized")}function _i(){De?De.render():O.render(T,y)}function ya(){if(De){let t=document.getElementById("canvas-container").getBoundingClientRect(),o=t.width,n=t.height;De.setSize(o,n),gt&&gt.setSize(o,n),ht&&ht.setSize(o,n),wa&&wa.setSize(o,n)}}function Yi(){return gt}function yt(){return ht}var De,ha,gt,ht,wa,lo=K(()=>{Se();Re();De=null,ha=null,gt=null,ht=null,wa=null});var Ea={};we(Ea,{audioSettings:()=>V,createPulseSynths:()=>uo,getActivePulseIndex:()=>$t,getTickIntensity:()=>Ot,initAudio:()=>va,isAudioEnabled:()=>nn,isAudioInitialized:()=>Ji,setMasterVolume:()=>en,setReverbWet:()=>tn,setScrambleTrigger:()=>Qo,setSpatialSpread:()=>on,setTotalPulseCount:()=>Jo,startAudio:()=>fo,stopAudio:()=>Zo,updateListenerPosition:()=>Ki,updatePulseAudio:()=>Gt,updateTickIntensity:()=>jt});function Qo(e){Xo=e}function Ot(){return At}function $t(){return Ko}function Jo(e){ba=e}function jt(){At=Math.max(0,At-.15),At<=0&&(Ko=-1)}async function Qi(){return Y||(window.Tone?(Y=window.Tone,Y):new Promise((e,t)=>{let o=document.createElement("script");o.src="https://cdn.jsdelivr.net/npm/tone@14.7.77/build/Tone.js",o.onload=()=>{Y=window.Tone,console.log("Tone.js loaded for spatial audio"),e(Y)},o.onerror=t,document.head.appendChild(o)}))}async function va(){if(Bt)return!0;try{return await Qi(),Y?(await Y.start(),console.log("Spatial audio context started"),Dt=new Y.Reverb({decay:6,wet:V.reverbWet}).toDestination(),await Dt.generate(),co=new Y.Gain(V.masterVolume).connect(Dt),Bt=!0,!0):!1}catch(e){return console.error("Error initializing spatial audio:",e),!1}}function uo(e){if(!Y||!Bt){console.log("Cannot create synths - audio not initialized");return}Te.forEach(t=>{try{t.synth.dispose(),t.panner&&t.panner.dispose(),t.panner3d&&t.panner3d.dispose()}catch{}}),Te=[];for(let t=0;t<e;t++){let o=new Y.Panner(0).connect(co),n=t%2===1,i;if(n)i=new Y.Synth({oscillator:{type:"sine"},envelope:{attack:.005,decay:.2,sustain:0,release:.1},volume:0}).connect(o);else{let a=new Y.Tremolo({frequency:.08+t*.02,depth:.4,spread:0}).connect(o).start();i=new Y.Synth({oscillator:{type:"sine"},envelope:{attack:4,decay:2,sustain:.5,release:4},volume:-24}).connect(a),i._tremolo=a}Te.push({synth:i,panner:o,playing:!1,frequency:n?Ca[Math.floor(t/2)%Ca.length]:Sa[Math.floor(t/2)%Sa.length],isTick:n,lastTickTime:0,tickInterval:6e4/V.tickBPM*(1+t*.25),x:0,y:0,z:0})}console.log(`Created ${e} spatial synths`),St&&Te.forEach((t,o)=>{!t.playing&&!t.isTick?(t.synth.triggerAttack(t.frequency),t.playing=!0,console.log(`Started drone synth ${o} at ${t.frequency}Hz`)):t.isTick&&(t.playing=!0,t.lastTickTime=performance.now())})}async function fo(){return console.log("Starting spatial audio..."),!Bt&&!await va()?(console.error("Failed to initialize audio"),!1):(Te.length===0&&uo(8),St=!0,V.enabled=!0,Te.forEach((e,t)=>{!e.playing&&!e.isTick?(e.synth.triggerAttack(e.frequency),e.playing=!0,console.log(`Started drone synth ${t} at ${e.frequency}Hz`)):e.isTick&&(e.playing=!0,e.lastTickTime=performance.now(),console.log(`Tick synth ${t} ready at ${e.frequency}Hz`))}),!0)}function Zo(){St=!1,V.enabled=!1,Te.forEach(e=>{if(e.playing){try{e.synth.triggerRelease()}catch{}e.playing=!1}}),console.log("Spatial audio stopped")}function Gt(e,t){if(!St||Te.length===0)return;let o=V.spatialSpread,{circleStep:n}=t,i=performance.now();e.forEach((a,r)=>{if(r>=Te.length)return;let s=Te[r],l=Math.cos(a.angle)*.8;if(s.panner&&(s.panner.pan.value=l),s.x=Math.cos(a.angle)*a.circle,s.y=a.circle,s.z=Math.sin(a.angle)*a.circle,s.isTick){let m=6e4/V.tickBPM*(1+r*.1);if(i-s.lastTickTime>=m){try{s.synth.triggerAttackRelease(s.frequency,"8n"),console.log(`Tick ${r} at ${s.frequency}Hz`),Xo&&Xo(),At=1,Xi=i,Ko=Math.floor(Math.random()*ba)}catch(p){console.error("Tick error:",p)}s.lastTickTime=i}}else{let p=Math.sin(a.angle*2)*2;s.synth.volume.value=-6+p}})}function Ki(e,t){if(!(!Y||!St))try{let o=Y.Listener;o.positionX.value=e.x||0,o.positionY.value=e.y||0,o.positionZ.value=e.z||0,t&&(o.forwardX.value=t.x||0,o.forwardY.value=t.y||0,o.forwardZ.value=t.z||-1)}catch{}}function en(e){V.masterVolume=e,co&&co.gain.rampTo(e,.1)}function tn(e){V.reverbWet=e,Dt&&Dt.wet.rampTo(e,.1)}function on(e){V.spatialSpread=e}function nn(){return St}function Ji(){return Bt}var Xo,Xi,At,Ko,ba,Y,Bt,St,Te,co,Dt,Sa,Ca,V,Nt=K(()=>{Xo=null;Xi=0,At=0,Ko=-1;ba=8;Y=null,Bt=!1,St=!1,Te=[],co=null,Dt=null,Sa=[220,261.63,293.66,329.63],Ca=[440,523.25,659.25,783.99],V={enabled:!0,masterVolume:.5,reverbWet:.5,spatialSpread:15,tickBPM:60}});import*as go from"three";function er(e,t,o,n,i,a,r,s,l,m,p){e.font=`${r}px OffBit, monospace`,e.fillStyle=s,e.textAlign="center",e.textBaseline="middle";let f=t.split(""),g=f.length*l,u=m?-1:1,h=a-g/2*u;for(let c of f){let S=o+Math.cos(h)*i,E=n+Math.sin(h)*i;e.save(),e.translate(S,E);let x=h+Math.PI/2;p&&(x+=Math.PI),e.rotate(x),e.fillText(c,0,0),e.restore(),h+=l*u}}function La(e,t,o,n,i,a,r,s,l=.08,m=!1,p=!1){let f=t.split(`
`),g=r*1.4,u=(f.length-1)*g;f.forEach((h,c)=>{let S=p?(c-(f.length-1)/2)*g:((f.length-1)/2-c)*g,E=i+S;er(e,h,o,n,E,a,r,s,l,m,p)})}function Ra(e,t,o,n,i,a,r,s,l,m,p,f){let g=t.split(""),u=g.length,h=i*a,S=i*(a+1)-h,E=d.textVerticalOffset||.5,x=h+S*E,k=2*Math.PI/s,z=(d.globalFontSize||100)/100,F=S*l/100*z*.8;e.font=`${F}px OffBit, monospace`,e.textAlign="center",e.textBaseline="middle";let H=p?-1:1;for(let te=0;te<u;te++){let A=g[te];if(A===" ")continue;let I=(r+te*H+s)%s*k-Math.PI/2+k/2,Oe=o+Math.cos(I)*x,w=n+Math.sin(I)*x;e.save(),e.translate(Oe,w);let M=I+Math.PI/2;f&&(M+=Math.PI),e.rotate(M),e.globalCompositeOperation="difference",d.textShadow&&(e.shadowColor=d.textShadowColor,e.shadowBlur=d.textShadowBlur,e.shadowOffsetX=2,e.shadowOffsetY=2),d.textOutline&&(e.strokeStyle=d.textOutlineColor,e.lineWidth=d.textOutlineWidth,e.strokeText(A,0,0)),e.fillStyle=m,e.shadowBlur=0,e.fillText(A,0,0),e.restore()}}function an(e,t,o){return{r:e.r+(t.r-e.r)*o,g:e.g+(t.g-e.g)*o,b:e.b+(t.b-e.b)*o}}function tr(e,t,o,n,i,a,r,s,l=8){e.strokeStyle=s,e.lineWidth=.5;let m=(a+r)/2,p=(n+i)/2,g=(i-n)/l;for(let u=0;u<l;u++){let h=n+g*u+g/2;e.beginPath(),e.arc(t,o,h,a,r),e.stroke()}}function or(e,t,o,n,i,a,r,s,l=12){e.strokeStyle=s,e.lineWidth=.5;let m=(r-a)/l;for(let p=0;p<=l;p++){let f=a+m*p;e.beginPath(),e.moveTo(t+Math.cos(f)*n,o+Math.sin(f)*n),e.lineTo(t+Math.cos(f)*i,o+Math.sin(f)*i),e.stroke()}}function nr(e,t,o,n,i,a,r,s,l=5){let m=(a+r)/2,p=(n+i)/2,f=Math.min(i-n,(r-a)*p)/2,g=t+Math.cos(m)*p,u=o+Math.sin(m)*p;e.strokeStyle=s,e.lineWidth=.5;for(let h=1;h<=l;h++){let c=f/l*h;e.beginPath(),e.arc(g,u,c,0,Math.PI*2),e.stroke()}}function ar(e,t,o,n,i,a,r,s,l=4){e.fillStyle=s;let m=(a+r)/2,p=r-a,f=i-n,g=Math.min(f,p*n)/(l*4);for(let u=0;u<l;u++)for(let h=0;h<l;h++){let c=n+f/l*(u+.5),S=a+p/l*(h+.5),E=t+Math.cos(S)*c,x=o+Math.sin(S)*c;e.beginPath(),e.arc(E,x,g,0,Math.PI*2),e.fill()}}function ir(e,t,o,n,i,a,r,s,l=24){let m=(a+r)/2,p=(n+i)/2,f=Math.min(i-n,(r-a)*p)/2,g=t+Math.cos(m)*p,u=o+Math.sin(m)*p;e.strokeStyle=s,e.lineWidth=.5;for(let h=0;h<l;h++){let c=Math.PI*2/l*h;e.beginPath(),e.moveTo(g+Math.cos(c)*(f*.2),u+Math.sin(c)*(f*.2)),e.lineTo(g+Math.cos(c)*f,u+Math.sin(c)*f),e.stroke()}}function rr(e,t,o,n,i,a,r,s,l,m,p,f=0){let g=Math.sin(f)*.5+.5;switch(l){case"horizontal":tr(e,t,o,n,i,a,r,s,6+m);break;case"radial":or(e,t,o,n,i,a,r,s,8+p%4);break;case"concentric":nr(e,t,o,n,i,a,r,s,4+m%3);break;case"dots":ar(e,t,o,n,i,a,r,s,3+m%2);break;case"sunburst":ir(e,t,o,n,i,a,r,s,16+m*2);break;case"diagonal":mr(e,t,o,n,i,a,r,s,5,p%2?1:-1);break;case"gradient":let u=.3+g*.5;fr(e,t,o,n,i,a,r,s,u,f);break;case"square":Ma(e,t,o,n,i,a,r,s,!0);break;case"squareOutline":Ma(e,t,o,n,i,a,r,s,!1);break;case"grayscale":sr(e,t,o,n,i,a,r,p%2?"horizontal":"vertical");break;case"rainbow":lr(e,t,o,n,i,a,r);break;case"checker":ur(e,t,o,n,i,a,r,s);break}}function Ma(e,t,o,n,i,a,r,s,l=!0){let m=(a+r)/2,p=(n+i)/2,f=Math.min(i-n,(r-a)*p)*.7,g=t+Math.cos(m)*p,u=o+Math.sin(m)*p;e.save(),e.translate(g,u),e.rotate(m+Math.PI/2),l?(e.fillStyle=s,e.fillRect(-f/2,-f/2,f,f),e.fillStyle="#000000",e.fillRect(-f/4,-f/4,f/2,f/2)):(e.strokeStyle=s,e.lineWidth=2,e.strokeRect(-f/2,-f/2,f,f)),e.restore()}function sr(e,t,o,n,i,a,r,s="radial"){e.save(),e.beginPath(),e.arc(t,o,i,a,r),e.arc(t,o,n,r,a,!0),e.closePath(),e.clip();let l;if(s==="radial")l=e.createRadialGradient(t,o,n,t,o,i);else{let m=(a+r)/2,p=(n+i)/2,f=t+Math.cos(a)*p,g=o+Math.sin(a)*p,u=t+Math.cos(r)*p,h=o+Math.sin(r)*p;l=e.createLinearGradient(f,g,u,h)}l.addColorStop(0,"#ffffff"),l.addColorStop(.5,"#888888"),l.addColorStop(1,"#000000"),e.fillStyle=l,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.restore()}function lr(e,t,o,n,i,a,r){e.save(),e.beginPath(),e.arc(t,o,i,a,r),e.arc(t,o,n,r,a,!0),e.closePath(),e.clip();let s=7,l=["#ff0000","#ff8800","#ffff00","#00ff00","#00ffff","#0000ff","#ff00ff"],m=(r-a)/s;for(let p=0;p<s;p++){let f=a+p*m,g=f+m;e.fillStyle=l[p],e.beginPath(),e.moveTo(t,o),e.arc(t,o,i*1.1,f,g),e.closePath(),e.fill()}e.restore()}function cr(e,t,o,n,i,a,r,s,l=!0,m=.5){if(!t||!t.complete)return;e.save(),e.beginPath(),e.arc(o,n,a,r,s),e.arc(o,n,i,s,r,!0),e.closePath(),e.clip();let p=(r+s)/2,f=(i+a)/2,g=a-i,u=(s-r)*f,h=o+Math.cos(p)*f,c=n+Math.sin(p)*f,S=t.width/t.height,E=u/g,x,k;if(S>E?(k=g*1.4,x=k*S):(x=u*1.4,k=x/S),e.translate(h,c),e.rotate(p-Math.PI/2),e.scale(1,-1),l){let z=document.createElement("canvas"),F=Math.max(x,k)*1.5;z.width=F,z.height=F;let H=z.getContext("2d");H.drawImage(t,0,0,F,F);let te=H.getImageData(0,0,F,F),A=te.data,ve=m*255;for(let I=0;I<A.length;I+=4){let w=A[I]*.299+A[I+1]*.587+A[I+2]*.114>ve?255:0;A[I]=w,A[I+1]=w,A[I+2]=w}H.putImageData(te,0,0),e.drawImage(z,-x/2,-k/2,x,k)}else e.drawImage(t,-x/2,-k/2,x,k);e.restore()}function dr(e){return mo.has(e)?Promise.resolve(mo.get(e)):new Promise((t,o)=>{let n=new Image;e.startsWith("http")&&!e.includes(window.location.hostname)&&(n.crossOrigin="anonymous"),n.onload=()=>{mo.set(e,n),t(n)},n.onerror=()=>{console.warn(`Failed to load image: ${e}`),t(null)},n.src=e})}async function Ia(){let e=sn.map(t=>dr(t).catch(()=>null));await Promise.all(e)}function ur(e,t,o,n,i,a,r,s){let l=(a+r)/2,m=(n+i)/2,p=Math.min(i-n,(r-a)*m)*.8,f=t+Math.cos(l)*m,g=o+Math.sin(l)*m;e.save(),e.translate(f,g),e.rotate(l+Math.PI/2);let u=p/4;for(let h=0;h<4;h++)for(let c=0;c<4;c++)e.fillStyle=(h+c)%2===0?s:"#000000",e.fillRect(-p/2+c*u,-p/2+h*u,u,u);e.restore()}function fr(e,t,o,n,i,a,r,s,l,m){let p=(a+r)/2,f=(n+i)/2,g=Math.sin(m)*.3,u=e.createRadialGradient(t+Math.cos(p)*f*g,o+Math.sin(p)*f*g,0,t,o,i),h=parseInt(s.slice(1,3),16),c=parseInt(s.slice(3,5),16),S=parseInt(s.slice(5,7),16);u.addColorStop(0,`rgba(${h}, ${c}, ${S}, ${l})`),u.addColorStop(1,`rgba(${h}, ${c}, ${S}, 0)`),e.fillStyle=u,e.beginPath(),e.arc(t,o,i,a,r),e.arc(t,o,n,r,a,!0),e.closePath(),e.fill()}function mr(e,t,o,n,i,a,r,s,l=6,m=1){let p=(a+r)/2,f=(n+i)/2,g=(r-a)*f,u=i-n;e.save(),e.beginPath(),e.arc(t,o,i,a,r),e.arc(t,o,n,r,a,!0),e.closePath(),e.clip(),e.strokeStyle=s,e.lineWidth=.5;let h=t+Math.cos(p)*f,c=o+Math.sin(p)*f,S=Math.max(g,u)*1.5,E=S/l;for(let x=-l;x<=l;x++)e.beginPath(),e.moveTo(h-S/2+x*E,c-S/2),e.lineTo(h-S/2+x*E+S*m,c+S/2),e.stroke();e.restore()}function Fa(e=1024,t={}){let{backgroundColor:o="#000000",lineWidth:n=d.lineWidth||2,tickWidth:i=d.tickWidth||1,numCircles:a=8,numRadialLines:r=36,showLabels:s=!0,labelColor:l="#ffffff",fontSize:m=e/40,mainColor:p={r:.4,g:.45,b:.5},chairsColor:f={r:.55,g:.32,b:.38},floorColor:g={r:.65,g:.52,b:.25},curvedTexts:u=[]}=t;d.mainColor=p,d.chairsColor=f,d.floorColor=g;let h=document.createElement("canvas");h.width=e,h.height=e;let c=h.getContext("2d",{alpha:!1,willReadFrequently:!1});d.antialias?(c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high"):c.imageSmoothingEnabled=!1,c.lineCap="round",c.lineJoin="round";let S=e/2,E=e/2,x=e/2-m*2;c.fillStyle=o,c.fillRect(0,0,e,e);let k=L=>{let R=(L%360+360)%360;return R<120?an(p,f,R/120):R<240?an(f,g,(R-120)/120):an(g,p,(R-240)/120)},z=x/a,F=2*Math.PI/r,H=Math.floor((p.r+f.g+g.b)*1e3),te=(L,R)=>{let B=Math.sin(H+L*127+R*311)*1e4;return B-Math.floor(B)},A=[],ve=[];if(d.imageCellsEnabled){let L=Math.min(d.imageCellCount||12,sn.length),R=new Set,B=d.imageThreshold,W=d.imageThresholdLevel||.5,oe=[...sn].sort(()=>Math.random()-.5);for(let U=0;U<Math.min(d.imageCellCount||12,oe.length);U++){let Ee=mo.get(oe[U]);if(!Ee)continue;let xe=Math.random(),Q=1,he=1;xe>.7?(Q=3,he=4+Math.floor(Math.random()*2)):xe>.4?(Q=2+Math.floor(Math.random()*2),he=3+Math.floor(Math.random()*2)):(Q=2,he=2+Math.floor(Math.random()*2));let $e=0,je=!1;for(;$e<100&&!je;){let st=1+Math.floor(Math.random()*Math.max(1,a-Q)),Qt=Math.floor(Math.random()*r);if(st+Q>a){$e++;continue}let Kt=!0;for(let lt=0;lt<Q&&Kt;lt++)for(let ct=0;ct<he&&Kt;ct++){let It=`${st+lt}-${(Qt+ct)%r}`;R.has(It)&&(Kt=!1)}if(Kt){for(let jo=0;jo<Q;jo++)for(let Go=0;Go<he;Go++){let Ii=`${st+jo}-${(Qt+Go)%r}`;R.add(Ii)}let lt=z*st,ct=z*(st+Q),It=Qt*F-Math.PI/2,ca=It+he*F;cr(c,Ee,S,E,lt,ct,It,ca,B,W),ve.push({imgIdx:U,ring:st,sector:Qt,ringSpan:Q,sectorSpan:he,innerRadius:lt,outerRadius:ct,startAngle:It,endAngle:ca}),je=!0}$e++}}}let I=d.gridLineColor||"#ffffff";for(let L=1;L<=a;L++){let R=z*L;c.strokeStyle=I,c.lineWidth=n,c.beginPath(),c.arc(S,E,R,0,Math.PI*2),c.stroke()}let Oe=360/r,w=n*3;c.strokeStyle=I,c.lineWidth=n;for(let L=0;L<r;L++){let B=(L*Oe-90)*Math.PI/180,W=S+Math.cos(B)*w,oe=E+Math.sin(B)*w,U=S+Math.cos(B)*x,Ee=E+Math.sin(B)*x;c.beginPath(),c.moveTo(W,oe),c.lineTo(U,Ee),c.stroke()}let M=d.rimOffset||0,Rt=x*(1-M),$o=i;for(let L=0;L<360;L+=1){let R=(L-90)*Math.PI/180,B,W;L%10===0?(B=m*.5,W=$o*1.5):L%5===0?(B=m*.3,W=$o):(B=m*.15,W=$o*.5),c.strokeStyle=I,c.lineWidth=W,c.beginPath(),c.moveTo(S+Math.cos(R)*Rt,E+Math.sin(R)*Rt),c.lineTo(S+Math.cos(R)*(Rt+B),E+Math.sin(R)*(Rt+B)),c.stroke()}if(s){let L=d.labelsFlipX,R=d.labelsFlipY;c.font=`${m}px OffBit, monospace`,c.textAlign="center",c.textBaseline="middle";for(let W=0;W<360;W+=10){let oe=(W-90)*Math.PI/180,U=Rt+m*1,Ee=S+Math.cos(oe)*U,xe=E+Math.sin(oe)*U;c.fillStyle=l,c.font=`${m*.6}px OffBit, monospace`,c.save(),c.translate(Ee,xe);let Q=oe+Math.PI/2;R&&(Q+=Math.PI),c.rotate(Q),L&&c.scale(-1,1),c.fillText(W.toString(),0,0),c.restore()}let B=[0,90,180,270];for(let W of B){let oe=(W-90)*Math.PI/180;for(let U=1;U<a;U++){let xe=z*(a-U),Q=S+Math.cos(oe)*xe,he=E+Math.sin(oe)*xe,$e=U*10;c.fillStyle=l,c.font=`${m*.35}px OffBit, monospace`,c.save(),c.translate(Q,he);let je=oe+Math.PI/2;R&&(je+=Math.PI),c.rotate(je),L&&c.scale(-1,1),c.textAlign="center",c.textBaseline="middle",c.fillText($e.toString(),0,0),c.restore()}}c.textAlign="center"}let Li=c.getImageData(0,0,e,e);for(let L of u){let{text:R="",row:B=7,startSector:W=0,textFontSize:oe=m,color:U=l,flipX:Ee=!1,flipY:xe=!1,cellMode:Q=!0}=L;if(Q)Ra(c,R,S,E,z,B,W,r,oe,U,Ee,xe);else{let he=x*(B/a),$e=(W*(360/r)-90)*Math.PI/180,je=L.letterSpacing||.08;La(c,R,S,E,he,$e,oe,U,je,Ee,xe)}}let Ri=d.dotSize||4;c.fillStyle=l,c.beginPath(),c.arc(S,E,Ri,0,Math.PI*2),c.fill();let rt=new go.CanvasTexture(h);return rt.colorSpace=go.SRGBColorSpace,rt.needsUpdate=!0,rt._polarGridCanvas=h,rt._polarGridCtx=c,rt._polarGridParams={centerX:S,centerY:E,maxRadius:x,circleStep:z,numCircles:a,numRadialLines:r,getColorAtAngle:k,cellPatterns:A,backgroundColor:o,baseImageWithoutText:Li,curvedTexts:u,labelColor:l,fontSize:m},rt}function pr(e,t,o,n){let i="";for(let a=0;a<e.length;a++){let r=e[a],s=t[a];if(!s||!s.active||r===" ")i+=r;else{let l=o-s.startTime;Math.min(l/n,1)>=1?(s.active=!1,i+=r):i+=ka[Math.floor(Math.random()*ka.length)]}}return i}function za(){po++}function gr(e){let t={},o=d.textScrambleDuration;for(;po>0&&d.textScrambleEnabled;){po--;let n=["text1","text2","text3","text4","text5"],i=n[Math.floor(Math.random()*n.length)],a=Pa[i],r=d[`${i}Content`];a.chars.length!==r.length&&(a.chars=r.split("").map(()=>({active:!1,startTime:0})));let s=[];for(let l=0;l<r.length;l++)r[l]!==" "&&!a.chars[l].active&&s.push(l);if(s.length>0){let l=s[Math.floor(Math.random()*s.length)];a.chars[l].active=!0,a.chars[l].startTime=e}}return["text1","text2","text3","text4","text5"].forEach(n=>{let i=Pa[n],a=d[`${n}Content`];i.chars.length!==a.length&&(i.chars=a.split("").map(()=>({active:!1,startTime:0}))),t[n]=pr(a,i.chars,e,o)}),t}function hr(e,t,o,n){let{centerX:i,centerY:a,circleStep:r,numCircles:s,numRadialLines:l,curvedTexts:m,labelColor:p,fontSize:f}=t;m&&m.forEach((g,u)=>{let{row:h=7,startSector:c=0,textFontSize:S=f,color:E=p,flipX:x=!1,flipY:k=!1,cellMode:z=!0}=g,F=`text${u+1}`,H=n&&n[F]?n[F]:g.text||"",te=(c+o+l)%l;if(z)Ra(e,H,i,a,r,h,te,l,S,E,x,k);else{let A=t.maxRadius*(h/s),ve=(te*(360/l)-90)*Math.PI/180,I=g.letterSpacing||.08;La(e,H,i,a,A,ve,S,E,I,x,k)}})}function Ha(e,t){bt=[];for(let o=0;o<e;o++)bt.push({circle:Math.floor(Math.random()*t)+1,angle:Math.random()*Math.PI*2,speed:(.5+Math.random()*.5)*(Math.random()>.5?1:-1),size:.8+Math.random()*.4});Jo(e),uo(e)}function wr(e,t,o,n){let{centerX:i,centerY:a,circleStep:r}=t,s=n&&!Me(),l=Ot(),m=$t();bt.forEach((p,f)=>{let g=r*p.circle,u=i+Math.cos(p.angle)*g,h=a+Math.sin(p.angle)*g,c=o*p.size,E=f===m?l:0,x=1+E*1.5,k=c*x,z=.9+E*.1;if(s){let F=k*(3+E*2),H=e.createRadialGradient(u,h,0,u,h,F);H.addColorStop(0,`rgba(255, 255, 255, ${z})`),H.addColorStop(.5,`rgba(255, 255, 255, ${.4+E*.3})`),H.addColorStop(1,"rgba(255, 255, 255, 0)"),e.fillStyle=H,e.beginPath(),e.arc(u,h,F,0,Math.PI*2),e.fill()}e.fillStyle="#ffffff",e.beginPath(),e.arc(u,h,k,0,Math.PI*2),e.fill(),e.fillStyle="#ffffff",e.beginPath(),e.arc(u,h,k*.5,0,Math.PI*2),e.fill()}),jt()}function yr(e,t){for(let o of bt)o.angle+=o.speed*t*e*.001,o.angle>Math.PI*2&&(o.angle-=Math.PI*2),o.angle<0&&(o.angle+=Math.PI*2)}function Sr(e,t){let{centerX:o,centerY:n,circleStep:i}=e,a=[],r=10;for(let s of bt){let l=i*s.circle,m=o+Math.cos(s.angle)*l,p=n+Math.sin(s.angle)*l,f=t*s.size*4;a.push({x:Math.floor(m-f-r),y:Math.floor(p-f-r),w:Math.ceil(f*2+r*2),h:Math.ceil(f*2+r*2)})}return a}function ho(e){if(!e||!e._polarGridCanvas)return;Xe=e;let t=e._polarGridCanvas,o=e._polarGridCtx,n=e._polarGridParams;Ct=o.getImageData(0,0,t.width,t.height),Ha(d.pulseCount,n.numCircles);let i=performance.now(),a=0;function r(s){if(s-xa<Zi){Ie=requestAnimationFrame(r);return}xa=s;let l=d.pulsesEnabled,m=d.cellAnimationEnabled,p=d.textRotationEnabled,f=d.textScrambleEnabled;if(!l&&!m&&!p&&!f){o.putImageData(Ct,0,0),e.needsUpdate=!0,Ie=null;return}let g=s-i;if(i=s,a+=g*.001*d.cellAnimationSpeed,p){if(d.textStepRotation){let c=6e4/d.textRotationBPM;s-Ta>=c&&(Ye-=1,Ta=s,f&&po++)}else Ye+=d.textRotationSpeed*g*.001;for(;Ye>=n.numRadialLines;)Ye-=n.numRadialLines;for(;Ye<0;)Ye+=n.numRadialLines}let u=p||f;if(u||m)u&&n.baseImageWithoutText?o.putImageData(n.baseImageWithoutText,0,0):o.putImageData(Ct,0,0);else if(l&&rn.length>0)for(let c of rn)o.putImageData(Ct,c.x,c.y,c.x,c.y,c.w,c.h);if(m&&n.cellPatterns)for(let c of n.cellPatterns){let S=a*2+c.phase;c.pattern==="gradient"&&rr(o,n.centerX,n.centerY,c.innerRadius,c.outerRadius,c.startAngle,c.endAngle,c.colorHex,c.pattern,c.ring,c.sector,S)}if(u&&n.curvedTexts){let c=f?gr(s):null;hr(o,n,Ye,c)}l&&(yr(g,d.pulseSpeed),rn=Sr(n,d.pulseSize),wr(o,n,d.pulseSize,d.pulseGlow),nn()&&Gt(bt,n)),e.needsUpdate=!0,Ie=requestAnimationFrame(r)}Ie&&cancelAnimationFrame(Ie),Ie=requestAnimationFrame(r)}function ln(){Ie&&(cancelAnimationFrame(Ie),Ie=null),Xe&&Ct&&(Xe._polarGridCtx.putImageData(Ct,0,0),Xe.needsUpdate=!0)}function Aa(){Xe&&Xe._polarGridParams&&Ha(d.pulseCount,Xe._polarGridParams.numCircles)}var d,xa,Zi,mo,sn,bt,Ie,Xe,Ct,rn,Ye,Ta,Pa,ka,po,Da=K(()=>{Nt();_e();Ne();d={globalFontSize:100,text1Row:3,text1FlipX:!0,text1FlipY:!0,text1FontSize:100,text1StartSector:24,text1Content:"STHLM 7-9 MAY",text1CellMode:!0,text2Row:4,text2FlipX:!0,text2FlipY:!0,text2FontSize:100,text2StartSector:24,text2Content:"MALM\xD6  12 MAY",text2CellMode:!0,text3Row:5,text3FlipX:!0,text3FlipY:!0,text3FontSize:100,text3StartSector:24,text3Content:"DOME DREAMING",text3CellMode:!0,text4Row:6,text4FlipX:!0,text4FlipY:!0,text4FontSize:100,text4StartSector:28,text4Content:"FULLDOME FILM FESTIVAL",text4CellMode:!0,text5Row:7,text5FlipX:!0,text5FlipY:!0,text5FontSize:100,text5StartSector:27,text5Content:"OPEN CALL IS LIVE!",text5CellMode:!0,labelsFlipX:!1,labelsFlipY:!0,gridLineColor:"#ffffff",rimOffset:.02,lineWidth:2,tickWidth:1,antialias:!0,dotSize:4,pulsesEnabled:!0,pulseCount:4,pulseSpeed:.5,pulseSize:12,pulseGlow:!1,textRotationEnabled:!1,textRotationSpeed:-.3,textStepRotation:!0,textRotationBPM:30,textScrambleEnabled:!0,textScrambleChance:.08,textScrambleDuration:200,textOutline:!1,textOutlineColor:"#000000",textOutlineWidth:3,textShadow:!1,textShadowBlur:8,textShadowColor:"#000000",textVerticalOffset:.6,cellAnimationEnabled:!1,cellAnimationSpeed:.5,cellPatternDensity:.25,imageCellsEnabled:!0,imageCellCount:12,imageThreshold:!0,imageThresholdLevel:.5,mainColor:null,chairsColor:null,floorColor:null,regenerate:null},xa=0,Zi=33;mo=new Map;sn=["assets/img/jpg/wisdome-stockholm-visuals.jpg","assets/img/jpg/wisdome-malmo-visuals.jpg","assets/img/jpg/untold-garden.jpg","assets/img/jpg/tiny-massive.jpg","assets/img/jpg/akiko-nakayama.jpg","assets/img/jpg/nordic-lights.jpg","assets/img/jpg/the-new-infinity.jpg","assets/img/jpg/baltic-analog-lab.jpg","assets/img/jpg/visualia.jpg","assets/img/jpeg/nam-june-paik-magnet-tv.jpeg","assets/img/jpg/rhythm-in-light-mary-ellen-bute.jpg","assets/img/png/movie-drome.png"];bt=[],Ie=null,Xe=null,Ct=null,rn=[],Ye=0,Ta=0,Pa={text1:{chars:[]},text2:{chars:[]},text3:{chars:[]},text4:{chars:[]},text5:{chars:[]}},ka="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%&*!?<>[]{}|/\\~";po=0});import*as yo from"three";function vr(e){let t=[];for(let o=0;o<wo;o++)t.push(new yo.Vector3(0,0,0));return ae={uBaseTexture:{value:e},uPulsePositions:{value:t},uTime:{value:0},uPulseCount:{value:0},uPulseIntensity:{value:1},uRotation:{value:0},uTickIntensity:{value:0},uActivePulse:{value:-1}},ae}function Ba(e){ae&&ae.uRotation&&(ae.uRotation.value=e)}function Oa(e){let t=vr(e);return new yo.ShaderMaterial({uniforms:t,vertexShader:Cr,fragmentShader:br,transparent:!1})}function Er(e,t){Wt=[];let o=Math.min(e,wo);for(let n=0;n<o;n++){let i=1+Math.floor(Math.random()*t),a=Math.random()*Math.PI*2,r=(.5+Math.random()*.5)*(Math.random()>.5?1:-1),s=.8+Math.random()*.4;Wt.push({circle:i,angle:a,speed:r,size:s,numCircles:t})}ae&&(ae.uPulseCount.value=o)}function xr(e,t){if(ae)for(let o=0;o<Wt.length;o++){let n=Wt[o];n.angle+=n.speed*t*e*.001,n.angle>Math.PI*2&&(n.angle-=Math.PI*2),n.angle<0&&(n.angle+=Math.PI*2);let i=n.circle/n.numCircles*.45,a=.5+Math.cos(n.angle)*i,r=.5+Math.sin(n.angle)*i,s=.015*n.size;ae.uPulsePositions.value[o].set(a,r,s)}}function $a(e={}){let{pulseCount:t=4,numCircles:o=8,pulseSpeed:n=.5,pulseIntensity:i=1}=e;Er(t,o),ae&&(ae.uPulseIntensity.value=i);let a=performance.now();function r(s){let l=s-a;a=s,xr(l,n),ae&&(ae.uTime.value=s*.001,ae.uTickIntensity.value=Ot(),ae.uActivePulse.value=$t()),Gt(Wt,{circleStep:1/o}),jt(),Qe=requestAnimationFrame(r)}Qe&&cancelAnimationFrame(Qe),Qe=requestAnimationFrame(r)}function ja(){Qe&&(cancelAnimationFrame(Qe),Qe=null)}var wo,ae,Qe,Wt,Cr,br,Ga=K(()=>{Nt();wo=8,ae=null,Qe=null,Wt=[],Cr=`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,br=`
uniform sampler2D uBaseTexture;
uniform vec3 uPulsePositions[${wo}];  // xy = position (0-1 UV), z = size
uniform float uTime;
uniform int uPulseCount;
uniform float uPulseIntensity;
uniform float uRotation;  // Texture rotation in radians
uniform float uTickIntensity;  // 0-1, for pulse pulsation on ticks
uniform int uActivePulse;  // Which pulse reacts to tick (-1 = none)

varying vec2 vUv;

// Rotate UV around center (0.5, 0.5)
vec2 rotateUV(vec2 uv, float angle) {
  vec2 center = vec2(0.5, 0.5);
  vec2 centered = uv - center;
  float s = sin(angle);
  float c = cos(angle);
  vec2 rotated = vec2(centered.x * c - centered.y * s, centered.x * s + centered.y * c);
  return rotated + center;
}

void main() {
  // Flip UV to match texture configuration (flipY and repeat.y = -1)
  vec2 flippedUv = vec2(vUv.x, 1.0 - vUv.y);

  // Apply rotation
  vec2 rotatedUv = rotateUV(flippedUv, uRotation);

  // Sample base texture with rotated UVs
  vec4 baseColor = texture2D(uBaseTexture, rotatedUv);

  // Add pulse glow
  float pulseGlow = 0.0;

  for (int i = 0; i < ${wo}; i++) {
    if (i >= uPulseCount) break;

    vec2 pulsePos = uPulsePositions[i].xy;
    float pulseSize = uPulsePositions[i].z;

    // Apply pulsation to active pulse on ticks
    float pulsation = 1.0;
    if (i == uActivePulse) {
      pulsation = 1.0 + uTickIntensity * 2.0;  // Up to 3x size on tick
    }
    float adjustedSize = pulseSize * pulsation;

    // Distance from pulse center (use flipped UV to match texture)
    float dist = distance(flippedUv, pulsePos);

    // Soft glow falloff - larger on tick
    float glow = smoothstep(adjustedSize * 2.0, 0.0, dist);

    // Core intensity
    float core = smoothstep(adjustedSize * 0.5, 0.0, dist);

    // Boost intensity for active pulse
    float intensityBoost = (i == uActivePulse) ? (1.0 + uTickIntensity * 0.5) : 1.0;
    pulseGlow += (glow * 0.5 + core * 0.8) * intensityBoost;
  }

  // Blend pulse glow with base
  vec3 finalColor = baseColor.rgb + vec3(pulseGlow * uPulseIntensity);

  gl_FragColor = vec4(finalColor, baseColor.a);
}
`});var Na={};we(Na,{getToneMappingOptions:()=>Sn,lightingSettings:()=>C,setAmbientColor:()=>un,setAmbientIntensity:()=>dn,setDirectColor:()=>yn,setDirectIntensity:()=>wn,setDirectLightEnabled:()=>hn,setExposure:()=>Co,setFogColor:()=>mn,setFogEnabled:()=>fn,setFogFar:()=>gn,setFogNear:()=>pn,setGradientEnd:()=>Pr,setGradientStart:()=>Tr,setSection1FadeStart:()=>Cn,setSection2FadeEnd:()=>bn,setToneMapping:()=>So,setupLighting:()=>Mr});import*as D from"three";function Mr(){vt=new D.AmbientLight(C.ambientColor,C.ambientIntensity),T.add(vt),pe=new D.DirectionalLight(C.directColor,C.directIntensity),pe.position.set(5,10,5),C.directLightEnabled&&T.add(pe),C.fogEnabled&&(T.fog=new D.Fog(C.fogColor,C.fogNear,C.fogFar)),So(C.toneMapping),Co(C.exposure)}function dn(e){C.ambientIntensity=e,vt&&(vt.intensity=e)}function un(e){C.ambientColor=e,vt&&vt.color.set(e)}function fn(e){C.fogEnabled=e,e?T.fog=new D.Fog(C.fogColor,C.fogNear,C.fogFar):T.fog=null}function mn(e){C.fogColor=e,T.fog&&T.fog.color.set(e)}function pn(e){C.fogNear=e,T.fog&&(T.fog.near=e)}function gn(e){C.fogFar=e,T.fog&&(T.fog.far=e)}function So(e){C.toneMapping=e,O&&cn[e]!==void 0&&(O.toneMapping=cn[e])}function Co(e){C.exposure=e,O&&(O.toneMappingExposure=e)}function hn(e){C.directLightEnabled=e,pe&&(e&&!pe.parent?T.add(pe):!e&&pe.parent&&T.remove(pe))}function wn(e){C.directIntensity=e,pe&&(pe.intensity=e)}function yn(e){C.directColor=e,pe&&pe.color.set(e)}function Sn(){return Object.keys(cn)}function Tr(e){C.gradientStart=e,document.documentElement.style.setProperty("--bg-gradient-start",`${e}%`)}function Pr(e){C.gradientEnd=e,document.documentElement.style.setProperty("--bg-gradient-end",`${e}%`)}function Cn(e){C.section1FadeStart=e,document.documentElement.style.setProperty("--section1-fade-start",`${e}%`)}function bn(e){C.section2FadeEnd=e,document.documentElement.style.setProperty("--section2-fade-end",`${e}%`)}var C,cn,pe,vt,vn=K(()=>{Se();C={ambientIntensity:1,ambientColor:"#ffffff",fogEnabled:!1,fogColor:"#1a1a1a",fogNear:20,fogFar:60,toneMapping:"Linear",exposure:1.5,directLightEnabled:!0,directIntensity:1.5,directColor:"#ffffff",gradientStart:20,gradientEnd:80,section1FadeStart:70,section2FadeEnd:30},cn={None:D.NoToneMapping,Linear:D.LinearToneMapping,Reinhard:D.ReinhardToneMapping,Cineon:D.CineonToneMapping,"ACES Filmic":D.ACESFilmicToneMapping,AgX:D.AgXToneMapping,Neutral:D.NeutralToneMapping},pe=null,vt=null});var Ua={};we(Ua,{connectWebcam:()=>Rr,disconnectWebcam:()=>Ir,getCurrentImageTexture:()=>Pn,getCurrentVideo:()=>Lr,getCurrentVideoTexture:()=>Tn,getScreenObject:()=>Mn,loadDefaultScreenTexture:()=>vo,loadImage:()=>qa,loadVideo:()=>Va,regeneratePolarGridTexture:()=>b,setScreenObject:()=>bo,setupDragAndDrop:()=>kn,setupPolarGridGUI:()=>Wa,updateShaderRotation:()=>Ba});import*as ge from"three";import kr from"lil-gui";function bo(e){X=e}function Mn(){return X}function Tn(){return se}function Lr(){return $}function Pn(){return Z}function vo(e=Et.defaultImage||"assets/media/background.png"){return X?(Z&&(Z.dispose(),Z=null),new Promise(async t=>{await Ia();let o=window.savedColorSettings||{},n=o.Main_Structure||{r:.4,g:.45,b:.5},i=o.Chairs||{r:.55,g:.32,b:.38},a=o.Floor||{r:.65,g:.52,b:.25},s=Fa(2048,{backgroundColor:"#000000",numCircles:8,numRadialLines:36,showLabels:!0,labelColor:"#ffffff",mainColor:n,chairsColor:i,floorColor:a,curvedTexts:[{text:d.text1Content,row:d.text1Row,startSector:d.text1StartSector,textFontSize:d.text1FontSize,color:"#ffffff",flipX:d.text1FlipX,flipY:d.text1FlipY,cellMode:d.text1CellMode},{text:d.text2Content,row:d.text2Row,startSector:d.text2StartSector,textFontSize:d.text2FontSize,color:"#ffffff",flipX:d.text2FlipX,flipY:d.text2FlipY,cellMode:d.text2CellMode},{text:d.text3Content,row:d.text3Row,startSector:d.text3StartSector,textFontSize:d.text3FontSize,color:"#ffffff",flipX:d.text3FlipX,flipY:d.text3FlipY,cellMode:d.text3CellMode},{text:d.text4Content,row:d.text4Row,startSector:d.text4StartSector,textFontSize:d.text4FontSize,color:"#ffffff",flipX:d.text4FlipX,flipY:d.text4FlipY,cellMode:d.text4CellMode},{text:d.text5Content,row:d.text5Row,startSector:d.text5StartSector,textFontSize:d.text5FontSize,color:"#ffffff",flipX:d.text5FlipX,flipY:d.text5FlipY,cellMode:d.text5CellMode}]});if(ut(s),s.rotation=0,d.pulsesEnabled){let l=Oa(s);X.material=l,$a({pulseCount:d.pulseCount,numCircles:8,pulseSpeed:d.pulseSpeed,pulseIntensity:1}),(d.textRotationEnabled||d.textScrambleEnabled)&&ho(s)}else dt(s,X),(d.textRotationEnabled||d.textScrambleEnabled)&&ho(s);Z=s,Wa(),t(s)})):Promise.resolve()}function b(){X&&(ln(),ja(),vo())}function En(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16)/255,g:parseInt(t[2],16)/255,b:parseInt(t[3],16)/255}:null}async function xn(e,t){let o=await Promise.resolve().then(()=>(mt(),qt)),{getMaterial:n}=await Promise.resolve().then(()=>(Ne(),da));if(o.fbxMeshes){let i=o.fbxMeshes.find(a=>a.name===e);if(i){let a=n(i.mesh);a&&(a.color.setRGB(t.r,t.g,t.b),a.needsUpdate=!0)}}window.savedColorSettings||(window.savedColorSettings={}),window.savedColorSettings[e]=t}function Wa(){if(N)return;N=new kr({title:"Dome Dreaming"}),N.domElement.style.position="fixed",N.domElement.style.top="10px",N.domElement.style.left="10px",N.domElement.style.zIndex="99999",N.domElement.style.display="none",window.addEventListener("keydown",w=>{if((w.metaKey||w.ctrlKey)&&w.key.toLowerCase()==="g"){w.preventDefault();let M=N.domElement.style.display==="none";N.domElement.style.display=M?"":"none"}});let e={help:()=>{alert(`Dome Dreaming GUI Controls

Toggle GUI: Cmd/Ctrl + G
Navigate: Click and drag to look around
Move: Arrow keys or WASD

Adjust settings in the folders below.`)},credits:()=>{alert(`Dome Dreaming

Created by Jonas Johansson
Built with Three.js
AI assistance by Claude (Anthropic)

domedreaming.com`)}};N.add(e,"help").name("\u{1F4D6} HELP"),N.add(e,"credits").name("\u2728 CREDITS");let t=N.addFolder("Typography");t.add(d,"globalFontSize",50,200,5).name("Global Font Size %").onChange(()=>b());let o=t.addFolder("Text 1");o.add(d,"text1Content").name("Text").onChange(()=>b()),o.add(d,"text1Row",1,8,1).name("Row (Circle)").onChange(()=>b()),o.add(d,"text1StartSector",0,35,1).name("Start Sector").onChange(()=>b()),o.add(d,"text1FontSize",20,200,5).name("Font Size %").onChange(()=>b()),o.close();let n=t.addFolder("Text 2");n.add(d,"text2Content").name("Text").onChange(()=>b()),n.add(d,"text2Row",1,8,1).name("Row (Circle)").onChange(()=>b()),n.add(d,"text2StartSector",0,35,1).name("Start Sector").onChange(()=>b()),n.add(d,"text2FontSize",20,200,5).name("Font Size %").onChange(()=>b()),n.close();let i=t.addFolder("Text 3");i.add(d,"text3Content").name("Text").onChange(()=>b()),i.add(d,"text3Row",1,8,1).name("Row (Circle)").onChange(()=>b()),i.add(d,"text3StartSector",0,35,1).name("Start Sector").onChange(()=>b()),i.add(d,"text3FontSize",20,200,5).name("Font Size %").onChange(()=>b()),i.close();let a=t.addFolder("Text 4");a.add(d,"text4Content").name("Text").onChange(()=>b()),a.add(d,"text4Row",1,8,1).name("Row (Circle)").onChange(()=>b()),a.add(d,"text4StartSector",0,35,1).name("Start Sector").onChange(()=>b()),a.add(d,"text4FontSize",20,200,5).name("Font Size %").onChange(()=>b()),a.close();let r=t.addFolder("Text 5");r.add(d,"text5Content").name("Text").onChange(()=>b()),r.add(d,"text5Row",1,8,1).name("Row (Circle)").onChange(()=>b()),r.add(d,"text5StartSector",0,35,1).name("Start Sector").onChange(()=>b()),r.add(d,"text5FontSize",20,200,5).name("Font Size %").onChange(()=>b()),r.close();let s=t.addFolder("Style");s.add(d,"textOutline").name("Outline").onChange(()=>b()),s.addColor(d,"textOutlineColor").name("Outline Color").onChange(()=>b()),s.add(d,"textOutlineWidth",1,10,1).name("Outline Width").onChange(()=>b()),s.add(d,"textShadow").name("Shadow").onChange(()=>b()),s.add(d,"textShadowBlur",0,20,1).name("Shadow Blur").onChange(()=>b()),s.add(d,"textVerticalOffset",.1,.9,.05).name("Radial Position").onChange(()=>b()),s.close(),t.close();let l=N.addFolder("Grid"),m=l.addFolder("Lines");m.addColor(d,"gridLineColor").name("Color").onChange(()=>b()),m.add(d,"lineWidth",.5,5,.5).name("Width").onChange(()=>b()),m.add(d,"tickWidth",.5,4,.5).name("Tick Width").onChange(()=>b()),m.add(d,"rimOffset",0,.2,.01).name("Rim Offset").onChange(()=>b()),m.add(d,"dotSize",1,20,1).name("Dot Size").onChange(()=>b()),m.close();let p=l.addFolder("Images");p.add(d,"imageCellsEnabled").name("Enable").onChange(()=>b()),p.add(d,"imageCellCount",1,12,1).name("Count").onChange(()=>b()),p.add(d,"imageThreshold").name("Threshold").onChange(()=>b()),p.add(d,"imageThresholdLevel",.2,.8,.05).name("Threshold Level").onChange(()=>b()),p.close();let f=l.addFolder("Rendering");f.add(d,"antialias").name("Antialiasing").onChange(()=>b()),f.close(),l.close();let g=N.addFolder("Animation"),u=g.addFolder("Rotation");u.add(d,"textRotationEnabled").name("Rotate Text"),u.add(d,"textStepRotation").name("Step Mode (BPM)"),u.add(d,"textRotationBPM",10,120,5).name("Text BPM"),u.add(d,"textRotationSpeed",-2,2,.1).name("Continuous Speed"),u.add(ce,"enabled").name("Rotate Grid"),u.add(ce,"speed",-.1,.1,.005).name("Grid Speed"),u.close();let h=g.addFolder("Pulses");h.add(d,"pulsesEnabled").name("Enable").onChange(w=>{w&&Z?ho(Z):ln()}),h.add(d,"pulseCount",1,20,1).name("Count").onChange(()=>Aa()),h.add(d,"pulseSpeed",.1,2,.1).name("Speed"),h.add(d,"pulseSize",4,30,1).name("Size"),h.add(d,"pulseGlow").name("Glow"),h.close(),g.close();let c=N.addFolder("Audio");c.add(V,"enabled").name("Enable Sound").onChange(async w=>{w?await fo():Zo()}),c.add(V,"masterVolume",0,1,.05).name("Volume").onChange(w=>en(w)),c.add(V,"tickBPM",20,180,5).name("Tick BPM"),c.add(V,"reverbWet",0,1,.05).name("Reverb").onChange(w=>tn(w)),c.add(V,"spatialSpread",1,20,1).name("3D Spread").onChange(w=>on(w)),c.close(),V.enabled&&setTimeout(async()=>{try{await fo()}catch{console.log("Audio auto-start requires user interaction")}},100);let S=N.addFolder("Colors"),E={get mainColor(){let w=d.mainColor||{r:.4,g:.45,b:.5};return zt(w)},set mainColor(w){let M=En(w);M&&(d.mainColor=M,window.savedColorSettings=window.savedColorSettings||{},window.savedColorSettings.Main_Structure=M,xn("Main_Structure",M),b())},get chairsColor(){let w=d.chairsColor||{r:.55,g:.32,b:.38};return zt(w)},set chairsColor(w){let M=En(w);M&&(d.chairsColor=M,window.savedColorSettings=window.savedColorSettings||{},window.savedColorSettings.Chairs=M,xn("Chairs",M),b())},get floorColor(){let w=d.floorColor||{r:.65,g:.52,b:.25};return zt(w)},set floorColor(w){let M=En(w);M&&(d.floorColor=M,window.savedColorSettings=window.savedColorSettings||{},window.savedColorSettings.Floor=M,xn("Floor",M),b())}};S.addColor(E,"mainColor").name("Main Structure"),S.addColor(E,"chairsColor").name("Chairs"),S.addColor(E,"floorColor").name("Floor"),S.add({randomize:()=>{Ln().then(()=>{b()})}},"randomize").name("Randomise Colors"),S.close();let x=N.addFolder("Lighting"),k=x.addFolder("Exposure");k.add(C,"toneMapping",Sn()).name("Tone Mapping").onChange(w=>So(w)),k.add(C,"exposure",0,3,.1).name("Exposure").onChange(w=>Co(w)),k.close();let z=x.addFolder("Ambient");z.add(C,"ambientIntensity",0,2,.1).name("Intensity").onChange(w=>dn(w)),z.addColor(C,"ambientColor").name("Color").onChange(w=>un(w)),z.close();let F=x.addFolder("Direct Light");F.add(C,"directLightEnabled").name("Enable").onChange(w=>hn(w)),F.add(C,"directIntensity",0,5,.1).name("Intensity").onChange(w=>wn(w)),F.addColor(C,"directColor").name("Color").onChange(w=>yn(w)),F.close();let H=x.addFolder("Fog");H.add(C,"fogEnabled").name("Enable").onChange(w=>fn(w)),H.addColor(C,"fogColor").name("Color").onChange(w=>mn(w)),H.add(C,"fogNear",1,50,1).name("Near").onChange(w=>pn(w)),H.add(C,"fogFar",20,100,5).name("Far").onChange(w=>gn(w)),H.close();let te=x.addFolder("Section Gradient");te.add(C,"section1FadeStart",0,100,5).name("Section 1 Fade %").onChange(w=>Cn(w)),te.add(C,"section2FadeEnd",0,100,5).name("Section 2 Fade %").onChange(w=>bn(w)),te.close(),x.close();let A=N.addFolder("Depth of Field");A.add(G,"enabled").name("Enable").onChange(w=>{let M=yt();M&&(M.enabled=w)}),A.add(G,"focus",.1,50,.1).name("Focus Distance").onChange(w=>{let M=yt();M&&(M.uniforms.focus.value=w)}),A.add(G,"aperture",0,.01,1e-4).name("Aperture").onChange(w=>{let M=yt();M&&(M.uniforms.aperture.value=w)}),A.add(G,"maxblur",0,.05,.001).name("Max Blur").onChange(w=>{let M=yt();M&&(M.uniforms.maxblur.value=w)}),A.open();let ve=N.addFolder("Camera"),I=ve.addFolder("Position");I.add(y.position,"x",-20,20,.01).name("X").listen(),I.add(y.position,"y",-20,20,.01).name("Y").listen(),I.add(y.position,"z",-20,20,.01).name("Z").listen(),I.close();let Oe=ve.addFolder("Rotation");Oe.add(y.rotation,"x",-Math.PI,Math.PI,.01).name("X").listen(),Oe.close(),ve.close(),d.regenerate=b}function qa(e){if(!X)return;let t=new FileReader;t.onload=o=>{new ge.TextureLoader().load(o.target.result,i=>{se&&(se.dispose(),se=null),$&&($.pause(),$.src="",URL.revokeObjectURL($.src),$=null),Z&&Z.dispose(),ce.enabled=!1,ut(i),i.rotation=0,dt(i,X),Z=i;let a=ne(X);a&&setTimeout(()=>{Object.assign(a,He),a.needsUpdate=!0},200)},void 0,()=>{})},t.readAsDataURL(e)}function Va(e){if(!X)return;let t=document.createElement("video");t.src=URL.createObjectURL(e),t.crossOrigin="anonymous",t.loop=!0,t.muted=!0,t.playsInline=!0,t.addEventListener("loadedmetadata",()=>{t.play(),se&&se.dispose(),$&&($.pause(),$.src="",URL.revokeObjectURL($.src)),Z&&(Z.dispose(),Z=null),ce.enabled=!1;let o=new ge.VideoTexture(t);ut(o),o.minFilter=ge.LinearFilter,o.magFilter=ge.LinearFilter,o.rotation=0,dt(o,X),se=o,$=t;let n=ne(X);n&&setTimeout(()=>{Object.assign(n,He),n.needsUpdate=!0},200)}),t.addEventListener("error",()=>{})}function Rr(){if(X){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){alert("Webcam access is not available in your browser.");return}navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(e=>{se&&(se.dispose(),se=null),$&&($.pause(),$.srcObject=null,$=null),Z&&(Z.dispose(),Z=null),Ke&&(Ke.getTracks().forEach(o=>o.stop()),Ke=null),ce.enabled=!1;let t=document.createElement("video");t.srcObject=e,t.autoplay=!0,t.playsInline=!0,t.muted=!0,t.addEventListener("loadedmetadata",()=>{t.play();let o=new ge.VideoTexture(t);ut(o),o.minFilter=ge.LinearFilter,o.magFilter=ge.LinearFilter,o.rotation=0,dt(o,X),se=o,$=t,Ke=e;let n=ne(X);n&&setTimeout(()=>{Object.assign(n,He),n.needsUpdate=!0},200)}),t.addEventListener("error",()=>{alert("Error accessing webcam.")})}).catch(e=>{console.error("Error accessing webcam:",e),alert("Could not access webcam. Please check permissions.")})}}function Ir(){Ke&&(Ke.getTracks().forEach(e=>e.stop()),Ke=null),se&&(se.dispose(),se=null),$&&($.pause(),$.srcObject=null,$=null)}function kn(){let e=document.getElementById("drop-zone");function t(n){n.preventDefault(),n.stopPropagation()}function o(n){if(!X)return;let i=ne(X);i&&(n?(i.emissive=new ge.Color(38655),i.emissiveIntensity=.8):(Object.assign(i,He),i.needsUpdate=!0))}document.addEventListener("dragenter",n=>{t(n),e.classList.add("drag-over"),o(!0)},!1),document.addEventListener("dragover",n=>{t(n),e.classList.add("drag-over"),o(!0)},!1),document.addEventListener("dragleave",n=>{t(n),n.clientX===0&&n.clientY===0&&(e.classList.remove("drag-over"),o(!1))},!1),document.addEventListener("drop",n=>{t(n),e.classList.remove("drag-over"),o(!1);let i=n.dataTransfer.files;if(i.length>0){let a=i[0];a.type.startsWith("image/")?qa(a):a.type.startsWith("video/")&&Va(a)}},!1)}var X,se,$,Z,Ke,N,Eo=K(()=>{Ne();Ft();Re();_e();lo();Se();Da();Ga();Nt();vn();Qo(za);X=null,se=null,$=null,Z=null,Ke=null;N=null});import{GLTFLoader as Fr}from"three/addons/loaders/GLTFLoader.js";import{init as zr,NavMeshQuery as _a,importNavMesh as Hr}from"@recast-navigation/core";import{threeToSoloNavMesh as Ar}from"@recast-navigation/three";function Ya(){return Je}async function Xa(){if(!Ut)try{await zr(),Ut=!0,Dr()}catch(e){console.error("Failed to initialize recast-navigation:",e),Ut=!0}}async function Dr(){if(!Ut){await Xa();return}try{let e=await fetch("assets/models/navmesh.bin");if(e.ok){let t=await e.arrayBuffer(),o=new Uint8Array(t),{navMesh:n}=Hr(o);Je=new _a(n),oo(Je),console.log("Navmesh loaded from navmesh.bin"),re&&In();return}}catch{console.log("navmesh.bin not found, will generate from GLTF")}Br()}function Br(){new Fr().load("assets/models/navmesh.gltf",async t=>{if(Vt=t.scene,Vt.scale.setScalar(1),Vt.visible=!1,ye(Vt,o=>{o.isMesh&&(Rn.push(o),o.updateMatrixWorld())}),T.add(Vt),Rn.length>0&&Ut){let{success:o,navMesh:n}=Ar(Rn,{cs:.05,ch:.05,walkableRadius:.2});o&&(Je=new _a(n),oo(Je),console.log("Navmesh generated from GLTF"))}},void 0,t=>{console.warn("Navmesh GLTF not found:",t)})}function In(){if(!Je||!re)return;let e={x:y.position.x,y:y.position.y-ue,z:y.position.z},t=Je.findClosestPoint(e,{halfExtents:Ge});t.success&&(y.position.y=t.point.y+ue)}function Qa(){Xa().catch(console.error)}var Ut,Vt,Rn,Je,Ka=K(()=>{Se();Ft();Ne();no();Ht();Ut=!1,Vt=null,Rn=[],Je=null});var ti={};we(ti,{getScreenLight:()=>Nr,initScreenLighting:()=>Fn,setColorSamplingEnabled:()=>Gr,updateScreenLighting:()=>jr});import*as be from"three";function Fn(e){return Or=e,Pe=new be.PointLight(16777215,2,30),Pe.position.set(0,0,0),T.add(Pe),Ze=new be.HemisphereLight(16777215,1710618,.8),Ze.position.set(0,5,0),T.add(Ze),Ce=new be.PointLight(16777215,1.5,25),Ce.position.set(0,0,0),T.add(Ce),{screenLight:Pe,hemisphereLight:Ze,secondaryLight:Ce}}function Za(e){if(!e||!e.image)return null;let t=e.image,o=document.createElement("canvas"),n=o.getContext("2d"),i=64;o.width=i,o.height=i;try{n.drawImage(t,0,0,i,i);let r=n.getImageData(0,0,i,i).data,s=0,l=0,m=0,p=i*i;for(let f=0;f<r.length;f+=4)s+=r[f],l+=r[f+1],m+=r[f+2];return s/=p,l/=p,m/=p,new be.Color(s/255,l/255,m/255)}catch{return null}}function jr(e){if(!Pe||!ei||e-Ja<$r)return;Ja=e;let t=null,o=Pn(),n=Tn();if(n&&n.image?t=Za(n):o&&(t=Za(o)),t){let i=t.clone();if(i.getHSL(Be),Be.s=Math.min(1,Be.s*1.5),Be.l=Math.min(1,Be.l*1.2),i.setHSL(Be.h,Be.s,Be.l),Pe.color.copy(i),Pe.intensity=3,Ze){let r=new be.Color().lerpColors(new be.Color(16777215),i,.6);Ze.color.copy(r),Ze.intensity=1.2}Ce&&(Ce.color.copy(i),Ce.intensity=2);let a=Mn();if(a){let r=new be.Vector3;a.getWorldPosition(r),Pe.position.copy(r),Pe.position.z+=.5,Ce&&(Ce.position.copy(r),Ce.position.z+=.3,Ce.position.y+=.2)}}}function Gr(e){ei=e}function Nr(){return Pe}var Pe,Or,Ze,Ce,Ja,$r,ei,Be,zn=K(()=>{Se();Eo();Pe=null,Or=null,Ze=null,Ce=null,Ja=0,$r=100,ei=!0,Be={h:0,s:0,l:0}});var qt={};we(qt,{fbxMeshes:()=>xo,glbLights:()=>Fe,glbLightsGroup:()=>xt,hotspots:()=>Ae,loadModel:()=>Vr,wisdomeModel:()=>oi});import*as P from"three";import{GLTFLoader as Wr}from"three/addons/loaders/GLTFLoader.js";import{DRACOLoader as qr}from"three/addons/loaders/DRACOLoader.js";function Vr(){let e=new Wr,t=new qr;t.setDecoderPath("https://cdn.jsdelivr.net/npm/three@0.181.0/examples/jsm/libs/draco/gltf/"),e.setDRACOLoader(t),e.load("assets/models/wisdome.glb",o=>{if(!o||!o.scene){console.error("GLB loaded but scene is missing");let u=document.getElementById("loading-overlay");u&&(u.innerHTML='<div style="color: #ff4444; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">Error: Model scene is missing.</div>');return}let n=o.scene;oi=n,n.scale.setScalar(1),n.position.set(0,0,0),Jt(n),xt=new P.Group,xt.name="GLBLights";let i=()=>{ye(n,u=>{u.isLight&&(Fe.push(u),xt.add(u))})};"requestIdleCallback"in window?requestIdleCallback(i,{timeout:100}):i(),Fe.length===0&&ye(n,u=>{(u instanceof P.Light||u instanceof P.DirectionalLight||u instanceof P.PointLight||u instanceof P.SpotLight||u instanceof P.RectAreaLight||u instanceof P.HemisphereLight)&&(Fe.includes(u)||(Fe.push(u),xt.add(u)))}),Fe=Fe.filter(u=>!(u instanceof P.HemisphereLight)),Fe.length>0&&(T.add(xt),Fe.forEach(u=>{u instanceof P.DirectionalLight?(u.intensity=3,u.position.set(2,15,5)):u instanceof P.PointLight?(u.intensity=0,u.visible=!1):u.intensity=0})),ye(n,u=>{u.name==="Hotspots"&&ye(u,h=>{if(h.name==="Hotspot.001"||h.name.includes("Hotspot")){let c=new P.Vector3;h.getWorldPosition(c),Ae.push({object:h,position:c,name:h.name,triggered:!1})}})}),ye(n,u=>{if(u.isMesh){let h=u.name.toLowerCase();if(h.includes("screen")||h.includes("display")||h.includes("monitor")||h.includes("panel")||h.includes("projection")||h.includes("canvas"))bo(u),u.visible=!0;else{let c=ne(u),S=c?.color?c.color.clone():new P.Color(16777215);if(c){if(c.metalness!==void 0&&(c.metalness=Math.max(c.metalness||0,.1)),c.roughness!==void 0&&(c.roughness=Math.min(c.roughness||.5,.8)),c.map&&(c.map.colorSpace=P.SRGBColorSpace),c.isMeshBasicMaterial){let E=new P.MeshStandardMaterial({color:c.color,map:c.map,transparent:c.transparent,opacity:c.opacity,metalness:.1,roughness:.5});u.material=E,c=E}c.needsUpdate=!0}xo.push({mesh:u,name:u.name||"Unnamed",originalColor:S})}}});let a=!1;ye(n,u=>{u.isMesh&&u.name&&(u.name.toLowerCase().includes("screen")||u.name.toLowerCase().includes("display")||u.name.toLowerCase().includes("monitor")||u.name.toLowerCase().includes("panel")||u.name.toLowerCase().includes("projection")||u.name.toLowerCase().includes("canvas"))&&(a=!0)}),!a&&n&&n.children.length>0&&ye(n,u=>{u.isMesh&&!a&&(bo(u),u.visible=!0,xo=xo.filter(h=>h.mesh!==u),a=!0)}),T.add(n);let r={x:0,y:5.4,z:-4.3},s={x:-2.9,y:0,z:3.121154018741333},l=ke,m=l&&l.y>1&&l.y<10?l:r,p=Le||s;y.position.set(m.x,m.y,m.z),y.rotation.set(p.x,p.y,p.z),y.updateMatrixWorld(),J.set(p.x,p.y,p.z,"YXZ"),Uo(!0),Ya()&&In(),Qa(),kn();function g(){let u=document.getElementById("loading-overlay");u&&(u.classList.add("fade-out"),setTimeout(()=>{u.remove()},500));let h=document.getElementById("canvas-container"),c=document.getElementById("info-panel");h&&h.classList.add("loaded"),c&&c.classList.add("loaded")}Promise.all([Promise.resolve().then(()=>(Re(),ao)).then(u=>u.applySettingsToScene()),vo().catch(u=>(console.warn("Error loading default texture, continuing anyway:",u),null))]).then(()=>{setTimeout(()=>{let u=n.children.find(h=>{let c=h.name?.toLowerCase()||"";return c.includes("screen")||c.includes("monitor")||c.includes("panel")||c.includes("projection")||c.includes("canvas")});u&&Fn(u),g()},100)}).catch(u=>{console.error("Error during scene initialization:",u),setTimeout(g,1e3)})},void 0,o=>{console.error("Error loading 3D model:",o);let n=document.getElementById("loading-overlay");n&&(n.innerHTML='<div style="color: #ff4444; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">Error loading 3D model.</div>')})}var oi,xo,Fe,xt,Ae,mt=K(()=>{Se();Ne();Re();Ht();Eo();Ka();zn();oi=null,xo=[],Fe=[],xt=null,Ae=[]});var ao={};we(ao,{applyPageBackgrounds:()=>An,applyPageColors:()=>Dn,applySettingsToScene:()=>Io,applyVignetteSettings:()=>Qr,bloomSettings:()=>q,cameraSettings:()=>me,canvasSettings:()=>Lo,constants:()=>ko,currentCameraPosition:()=>et,currentCameraRotation:()=>tt,dofSettings:()=>G,exportSettingsFile:()=>ns,getRandomGeneratedColor:()=>Jr,loadSettings:()=>Ro,moveSpeed:()=>Ue,pageBackgroundSettings:()=>ee,pageColorSettings:()=>ze,randomizeColors:()=>Ln,reloadFromJSON:()=>ts,resetToDefaultColors:()=>os,saveSettings:()=>Bn,screenSettings:()=>Et,scrollSettings:()=>Tt,setBloomSettings:()=>_r,setMoveSpeed:()=>Ur,startCameraPosition:()=>ke,startCameraRotation:()=>Le,textureRotationSettings:()=>ce});import"three";function Ur(e){Ue=e}function _r(e,t,o){q.strength=e,q.radius=t,q.threshold=o}async function Yr(e=!1){try{let t="assets/js/core/default-settings.json",o=e?`${t}?t=${Date.now()}`:t,n=await fetch(o);if(!n.ok)return console.warn("Could not load default-settings.json, using hardcoded defaults"),!1;let i=await n.json();return i.constants&&(ko={...ko,...i.constants}),i.settings&&Xr(i.settings),!0}catch(t){return console.warn("Failed to load default settings from JSON:",t),!1}}function Xr(e){e.moveSpeed!==void 0&&(Ue=e.moveSpeed),e.cameraSettings&&Object.assign(me,e.cameraSettings),e.startCameraPosition&&Object.assign(ke,e.startCameraPosition),e.startCameraRotation&&Object.assign(Le,e.startCameraRotation),e.colorSettings?window.savedColorSettings=e.colorSettings:window.savedColorSettings=null,e.lightSettings?window.savedLightSettings=e.lightSettings:window.savedLightSettings=null,e.bloomSettings&&Object.assign(q,e.bloomSettings),e.dofSettings&&Object.assign(G,e.dofSettings),e.pageColorSettings&&(e.pageColorSettings.vignette&&(ze.vignette={...ze.vignette,...e.pageColorSettings.vignette}),Object.assign(ze,e.pageColorSettings),ze.vignette||(ze.vignette={enabled:!0,size:8,fadeWidth:2}),Dn()),e.scrollSettings&&Object.assign(Tt,e.scrollSettings),e.canvasSettings&&Object.assign(Lo,e.canvasSettings),e.screenSettings&&Object.assign(Et,e.screenSettings),e.textureRotationSettings&&Object.assign(ce,e.textureRotationSettings),e.pageBackgroundSettings&&(Object.assign(ee,e.pageBackgroundSettings),An())}function ni(e,t=.5){if(!e)return null;if(e.startsWith("rgba"))return e;if(e.startsWith("rgb")){let n=e.match(/\d+/g);if(n&&n.length>=3)return`rgba(${n[0]}, ${n[1]}, ${n[2]}, ${t})`}let o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(o){let n=parseInt(o[1],16),i=parseInt(o[2],16),a=parseInt(o[3],16);return`rgba(${n}, ${i}, ${a}, ${t})`}return e}function An(){"requestIdleCallback"in window?requestIdleCallback(()=>{let e=document.querySelectorAll(".page-section");if(e.length>0&&e.length>1&&ee.team)for(let t=1;t<e.length;t++){let o=e[t];if(ee.team.backgroundColor&&ee.team.backgroundColor!=="#000000"){let n=ni(ee.team.backgroundColor,.5);o.style.setProperty("background-color",n,"important")}else o.style.removeProperty("background-color");ee.team.backgroundImage?(o.style.setProperty("background-image",`url(${ee.team.backgroundImage})`,"important"),o.style.setProperty("background-size","cover","important"),o.style.setProperty("background-position","center","important"),o.style.setProperty("background-repeat","no-repeat","important")):o.style.removeProperty("background-image")}},{timeout:200}):setTimeout(()=>{let e=document.querySelectorAll(".page-section");if(e.length>0&&e.length>1&&ee.team)for(let t=1;t<e.length;t++){let o=e[t];if(ee.team.backgroundColor&&ee.team.backgroundColor!=="#000000"){let n=ni(ee.team.backgroundColor,.5);o.style.setProperty("background-color",n,"important")}else o.style.removeProperty("background-color");ee.team.backgroundImage?(o.style.setProperty("background-image",`url(${ee.team.backgroundImage})`,"important"),o.style.setProperty("background-size","cover","important"),o.style.setProperty("background-position","center","important"),o.style.setProperty("background-repeat","no-repeat","important")):o.style.removeProperty("background-image")}},50)}function si(){let e=document.getElementById("canvas-container");if(!e)return;let t=ze.vignette||{enabled:!0,size:8,fadeWidth:2};if(!t.enabled){e.style.maskImage="none",e.style.webkitMaskImage="none";return}let o=`${t.size}%`,n=`${t.size+t.fadeWidth}%`,i=`${t.size+t.fadeWidth*2}%`,a=`${100-t.size-t.fadeWidth*2}%`,r=`${100-t.size-t.fadeWidth}%`,s=`${100-t.size}%`,l=`linear-gradient(to right, transparent 0%, transparent ${o}, rgba(0, 0, 0, 0.5) ${n}, black ${i}, black ${a}, rgba(0, 0, 0, 0.5) ${r}, transparent ${s}, transparent 100%)`,m=`linear-gradient(to bottom, transparent 0%, transparent ${o}, rgba(0, 0, 0, 0.5) ${n}, black ${i}, black ${a}, rgba(0, 0, 0, 0.5) ${r}, transparent ${s}, transparent 100%)`;e.style.maskImage=`${l}, ${m}`,e.style.maskComposite="intersect",e.style.webkitMaskImage=`${l}, ${m}`,e.style.webkitMaskComposite="source-in"}function Dn(){si()}function Qr(){si()}async function Ro(e=!1){let t=await Yr(e);Dn(),An()}function Jr(){let e=Object.values(To).filter(t=>t!==null);return e.length===0?Mo.primary:e[Math.floor(Math.random()*e.length)]}function Zr(){let e=Math.floor(Math.random()*ai.length);return ai[e]}function Po(){let e=Math.floor(Math.random()*ii.length);return ii[e]}function Hn(){return Po()}function ri(e,t=.4){return{r:e.r*t,g:e.g*t,b:e.b*t}}function es(){let e=o=>{let n=Math.round(o.r*255),i=Math.round(o.g*255),a=Math.round(o.b*255);return`rgb(${n}, ${i}, ${a})`},t=o=>{let n=Math.round(o.r*255).toString(16).padStart(2,"0"),i=Math.round(o.g*255).toString(16).padStart(2,"0"),a=Math.round(o.b*255).toString(16).padStart(2,"0");return`#${n}${i}${a}`};Promise.resolve().then(()=>(mt(),qt)).then(o=>{let n=null,i=null,a=null;if(o.fbxMeshes&&o.fbxMeshes.length>0){let m=o.fbxMeshes.find(g=>g.name==="Main_Structure");if(m){let g=ne(m.mesh);g&&g.color&&(n={r:g.color.r,g:g.color.g,b:g.color.b})}let p=o.fbxMeshes.find(g=>g.name==="Chairs");if(p){let g=ne(p.mesh);g&&g.color&&(i={r:g.color.r,g:g.color.g,b:g.color.b})}let f=o.fbxMeshes.find(g=>g.name==="Floor");if(f){let g=ne(f.mesh);g&&g.color&&(a={r:g.color.r,g:g.color.g,b:g.color.b})}}n||(n=window.savedColorSettings?.primary||window.savedColorSettings?.Main_Structure||Hn()),i||(i=window.savedColorSettings?.secondary||window.savedColorSettings?.Chairs||Hn()),a||(a=window.savedColorSettings?.tertiary||window.savedColorSettings?.Floor||Hn()),To.primary=n,To.secondary=i,To.tertiary=a,console.log("%c Color Palette ","background: #222; color: #fff; font-size: 14px; padding: 4px 8px;"),console.log(`  Primary:   ${t(n)}`),console.log(`  Secondary: ${t(i)}`),console.log(`  Tertiary:  ${t(a)}`);let r=n,s=ri(i,.6),l=ri(a,.6);Mt||(document.documentElement.style.setProperty("--color-primary",e(n)),document.documentElement.style.setProperty("--color-secondary",e(i)),document.documentElement.style.setProperty("--color-tertiary",e(a)),document.documentElement.style.setProperty("--bg-main-color",e(r)),document.documentElement.style.setProperty("--bg-floor-color",e(l)),document.documentElement.style.setProperty("--bg-chairs-color",e(s))),Promise.resolve().then(()=>(Se(),Vo)).then(m=>{m.setSceneBackground(r)})})}async function Io(){window.savedColorSettings||(window.savedColorSettings={}),Promise.resolve().then(()=>(mt(),qt)).then(e=>{if(e.fbxMeshes&&e.fbxMeshes.length>0){let n=function(){let i=Math.min(t+o,e.fbxMeshes.length);for(let a=t;a<i;a++){let r=e.fbxMeshes[a],s=ne(r.mesh);if(s){let l,m=Kr[r.name];r.name==="Main_Structure"?(l=Mt?Mo.primary:Zr(),window.savedColorSettings.primary=l,window.savedColorSettings[r.name]=l):r.name==="Chairs"?(l=Mt?Mo.secondary:Po(),window.savedColorSettings.secondary=l,window.savedColorSettings[r.name]=l):r.name==="Floor"?(l=Mt?Mo.tertiary:Po(),window.savedColorSettings.tertiary=l,window.savedColorSettings[r.name]=l):r.name==="Screen"?(l=Po(),window.savedColorSettings[r.name]=l):window.savedColorSettings[r.name]?l=window.savedColorSettings[r.name]:l=r.originalColor?{r:r.originalColor.r,g:r.originalColor.g,b:r.originalColor.b}:null,l&&(s.color.setRGB(l.r,l.g,l.b),s.needsUpdate=!0)}}t=i,t<e.fbxMeshes.length?"requestIdleCallback"in window?requestIdleCallback(n,{timeout:50}):setTimeout(n,0):setTimeout(()=>{es()},10)},t=0,o=5;n()}window.savedLightSettings&&e.glbLights&&("requestIdleCallback"in window?requestIdleCallback(()=>{e.glbLights.forEach((t,o)=>{let n=t.name||`light_${o}`;if(window.savedLightSettings[n]){let i=window.savedLightSettings[n];t.color.setRGB(i.r,i.g,i.b);let a=Math.max(0,Math.min(i.intensity??t.intensity,10));t.intensity=a}})},{timeout:100}):setTimeout(()=>{e.glbLights.forEach((t,o)=>{let n=t.name||`light_${o}`;if(window.savedLightSettings[n]){let i=window.savedLightSettings[n];t.color.setRGB(i.r,i.g,i.b);let a=Math.max(0,Math.min(i.intensity??t.intensity,10));t.intensity=a}})},50))}),Promise.resolve().then(()=>(lo(),Yo)).then(e=>{let t=e.getBloomPass();t&&(t.enabled=q.enabled!==!1,q.enabled?(t.strength=q.strength,t.radius=q.radius,t.threshold=q.threshold):t.strength=0);let o=e.getBokehPass();o&&(o.enabled=G.enabled!==!1,G.enabled&&(o.uniforms.focus.value=G.focus,o.uniforms.aperture.value=G.aperture,o.uniforms.maxblur.value=G.maxblur))})}async function ts(){await Ro(!0),await Io()}async function Ln(){Mt=!1,await Io()}async function os(){Mt=!0,await Io()}function Bn(e,t){try{let o={};e&&Array.isArray(e)&&e.forEach((a,r)=>{let s=ne(a.mesh);if(s?.color){let l=a.name||`mesh_${r}`;o[l]={r:s.color.r,g:s.color.g,b:s.color.b}}});let n={};t&&Array.isArray(t)&&t.forEach((a,r)=>{let s=a.name||`light_${r}`;n[s]={r:a.color.r,g:a.color.g,b:a.color.b,intensity:a.intensity}});let i={moveSpeed:Ue,cameraSettings:me,startCameraPosition:ke,startCameraRotation:Le,colorSettings:o,lightSettings:n,bloomSettings:q,dofSettings:G,pageColorSettings:ze,scrollSettings:Tt,canvasSettings:Lo,screenSettings:Et,textureRotationSettings:ce,pageBackgroundSettings:ee}}catch(o){console.warn("Failed to collect settings:",o)}}function ns(e,t){try{let o={};e.forEach((l,m)=>{let p=ne(l.mesh);if(p?.color){let f=l.name||`mesh_${m}`;o[f]={r:p.color.r,g:p.color.g,b:p.color.b}}});let n={};t.forEach((l,m)=>{let p=l.name||`light_${m}`;n[p]={r:l.color.r,g:l.color.g,b:l.color.b,intensity:l.intensity}});let i={version:"1.0.0",constants:ko,settings:{moveSpeed:Ue,pageColorSettings:ze,scrollSettings:Tt,canvasSettings:Lo,cameraSettings:me,startCameraPosition:ke,startCameraRotation:Le,bloomSettings:q,dofSettings:G,colorSettings:o,lightSettings:n,screenSettings:Et,textureRotationSettings:ce,pageBackgroundSettings:ee}},a=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),r=URL.createObjectURL(a),s=document.createElement("a");s.href=r,s.download="dome-dreaming-settings.json",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r)}catch(o){console.error("Failed to export settings file:",o)}}var ko,Ue,me,ke,Le,et,tt,q,G,ze,Tt,Lo,Et,ce,ee,Mo,Kr,To,Mt,ai,ii,Re=K(()=>{Ne();ko={cameraHeight:1.6,navmeshSearchBox:{x:5,y:10,z:5},screenMaterialSettings:{emissive:[1,1,1],emissiveIntensity:1,color:[1,1,1],toneMapped:!1,transparent:!1,opacity:1}},Ue=.04,me={sensitivity:.002,rotationSpeed:120},ke={x:0,y:5.4,z:-4.3},Le={x:-2.82,y:0,z:3.121154018741333},et={x:0,y:0,z:0},tt={x:0,y:0,z:0},q={enabled:!1,strength:1.5,radius:.4,threshold:.85},G={enabled:!0,focus:12,aperture:.0014,maxblur:.05},ze={backgroundColor:"#000000",textColor:"#ffffff",dotColor:"#ffffff",sidebarColor:"#333333",sidebarVisible:!0,headerIslandVisible:!1,blendMode:"normal",vignette:{enabled:!1,size:8,fadeWidth:2}},Tt={enabled:!0,scrollTimeout:25,touchThreshold:30,snapThreshold:.5,initialSnapThreshold:1,gridColumns:16,gridRows:16},Lo={rows:8},Et={defaultImage:"assets/img/jpg/background-dome-dreaming.jpg"},ce={enabled:!0,speed:.02},ee={canvas:{backgroundColor:"#000000",backgroundImage:null},about:{backgroundColor:"#463434",backgroundImage:null},team:{backgroundColor:"#000000",backgroundImage:null}};Mo={primary:{r:.4,g:.45,b:.5},secondary:{r:.55,g:.32,b:.38},tertiary:{r:.65,g:.52,b:.25}},Kr={Main_Structure:"primary",Chairs:"secondary",Floor:"tertiary"},To={primary:null,secondary:null,tertiary:null};Mt=!0,ai=[{r:.38,g:.42,b:.48},{r:.45,g:.48,b:.52},{r:.42,g:.45,b:.5},{r:.48,g:.45,b:.42}],ii=[{r:.55,g:.32,b:.38},{r:.65,g:.52,b:.25},{r:.45,g:.55,b:.42},{r:.6,g:.4,b:.32},{r:.4,g:.5,b:.58},{r:.48,g:.3,b:.45}]});Re();Re();_e();var _t=!1,li=0,as=30,On=0,is=0,Gn=!1,$n=0,ot=0;function ci(e){let o=pt()*2;return Math.round(e/o)*o}function jn(){if(_t)return;let e=window.pageYOffset||document.documentElement.scrollTop,t=ci(e);Math.abs(e-t)>1&&(_t=!0,window.scrollTo({top:t,behavior:"auto"}),setTimeout(()=>{_t=!1},50))}function rs(){if(_t)return;let e=window.pageYOffset||document.documentElement.scrollTop,t=ci(e),n=Me()?5:1;Math.abs(e-t)>n&&jn()}function di(e){let t=Date.now();if(t-li<as)return;let o=pt(),n=window.pageYOffset||document.documentElement.scrollTop,i=o*2;if(e!==0){let s=(Math.round(n/i)+e)*i,l=Math.max(document.body.scrollHeight-window.innerHeight,document.documentElement.scrollHeight-window.innerHeight),m=Math.max(0,Math.min(s,l));Math.abs(m-n)>1&&(li=t,window.scrollTo({top:m,behavior:"auto"}))}}function ss(e){if(document.body.classList.contains("dome-mode"))return;e.preventDefault();let t=e.deltaY,o=0;t>0?o=1:t<0&&(o=-1),o!==0&&di(o)}function ls(e){if(document.body.classList.contains("dome-mode"))return;let t=e.target;t.closest("a")||t.closest("button")||t.tagName==="A"||t.tagName==="BUTTON"||e.touches.length===1&&(On=e.touches[0].clientY,$n=On,is=Date.now(),Gn=!1,ot=0)}function cs(e){if(document.body.classList.contains("dome-mode"))return;let t=e.target;if(t.closest("a")||t.closest("button")||t.tagName==="A"||t.tagName==="BUTTON"||e.touches.length!==1)return;e.preventDefault();let o=e.touches[0].clientY,n=$n-o,i=On-o;Math.abs(i)>10&&(Gn=!0),ot+=n,$n=o;let s=pt()*2*.2;if(Math.abs(ot)>=s){let l=ot>0?1:-1;di(l),ot=ot%s}}function ds(e){if(document.body.classList.contains("dome-mode"))return;let t=e.target;t.closest("a")||t.closest("button")||t.tagName==="A"||t.tagName==="BUTTON"||(e.preventDefault(),Gn=!1,ot=0)}function Nn(){if(!Tt.enabled||document.body.classList.contains("dome-mode"))return;window.addEventListener("wheel",ss,{passive:!1}),document.addEventListener("touchstart",ls,{passive:!1}),document.addEventListener("touchmove",cs,{passive:!1}),document.addEventListener("touchend",ds,{passive:!1});let e=null;window.addEventListener("scroll",()=>{if(_t)return;e&&clearTimeout(e),e=setTimeout(()=>{rs(),e=null},30)},{passive:!0}),window.addEventListener("load",()=>{setTimeout(()=>{jn()},100)}),window.addEventListener("resize",()=>{setTimeout(()=>{jn()},100)})}var kt=null,Pt=16,Wn=0,us=0;function fs(){let e=document.getElementById("dots");e&&e.remove(),kt=document.createElement("div"),kt.id="dots",document.body.appendChild(kt),qn(),Vn()}function qn(){let e=getComputedStyle(document.documentElement),t=document.documentElement.clientWidth||window.innerWidth,o=e.getPropertyValue("--col-width");o?Wn=parseFloat(o)||t/Pt:Wn=t/Pt;let n=e.getPropertyValue("--row-height"),i=parseFloat(n);us=!isNaN(i)&&i>0?i:Wn}function Vn(){if(!kt)return;kt.innerHTML="";let t=16*Pt,o=32,n=0;function i(){let a=Math.min(n+o,t);for(let r=n;r<a;r++){let s=Math.floor(r/Pt),l=r%Pt,m=document.createElement("div");m.className="dot",m.dataset.col=l+1,m.dataset.row=s+1,m.style.gridColumn=l+1,m.style.gridRow=s+1,m.style.pointerEvents="none";let p=l+1,f=s+1,g=p+(f-1)*Pt;m.style.setProperty("--dot-delay",g),kt.appendChild(m)}n=a,n<t&&("requestIdleCallback"in window?requestIdleCallback(i,{timeout:50}):setTimeout(i,0))}i()}function Un(){fs();let e,t=()=>{clearTimeout(e),e=setTimeout(()=>{qn(),Vn()},150)};window.addEventListener("resize",t),window.addEventListener("orientationchange",()=>{setTimeout(()=>{qn(),Vn()},300)})}function Fo(e){document.querySelectorAll(".dashboard-block.active, .page-content .block.active").forEach(t=>{t.classList.remove("active")}),e.classList.add("active")}function _n(){"requestIdleCallback"in window?requestIdleCallback(()=>{document.querySelectorAll(".dashboard-block").forEach(o=>{o.addEventListener("click",()=>{Fo(o)})}),document.querySelectorAll(".page-content .block img").forEach(o=>{let n=o.closest(".block");n&&n.addEventListener("click",()=>{Fo(n)})})},{timeout:200}):setTimeout(()=>{document.querySelectorAll(".dashboard-block").forEach(o=>{o.addEventListener("click",()=>{Fo(o)})}),document.querySelectorAll(".page-content .block img").forEach(o=>{let n=o.closest(".block");n&&n.addEventListener("click",()=>{Fo(n)})})},50)}_e();function Yn(){let e=getComputedStyle(document.documentElement),t=parseFloat(e.getPropertyValue("--grid-rows"))||16,o=pt();document.querySelectorAll(".page-section").forEach(i=>{let a=i.querySelector(".block.responsive");if(!a)return;let r=i.style.height,s=i.style.minHeight,l=i.style.getPropertyValue("--section-grid-rows");i.style.height="auto",i.style.minHeight="auto",i.style.removeProperty("--section-grid-rows"),i.offsetHeight;let m=a.offsetHeight;i.style.height=r,i.style.minHeight=s,l&&i.style.setProperty("--section-grid-rows",l);let p=Math.ceil(m/o);p=Math.max(1,p),p=p+2,i.style.setProperty("--section-grid-rows",p.toString())})}function Xn(){window.addEventListener("load",()=>{setTimeout(()=>{Yn()},100)});let e,t=()=>{clearTimeout(e),e=setTimeout(()=>{Yn()},100)};window.addEventListener("resize",t),window.addEventListener("orientationchange",t),window.visualViewport&&window.visualViewport.addEventListener("resize",t),(document.readyState==="complete"||document.readyState==="interactive")&&setTimeout(()=>{Yn()},100)}_e();_e();var j=null,at=null,Qn=null,nt=!1,ui=!1;function fi(e){j=e}function mi(e,t){Qn=e,at=t}function Kn(){let e=document.getElementById("keyboard-exit-btn"),t=document.body;function o(){e&&(t.classList.contains("dome-mode")?Me()?(e.textContent="exit",e.style.display="flex"):e.style.display="none":(e.textContent="enter",e.style.display="flex",e.disabled=!1,e.style.pointerEvents="auto"))}function n(r=!1){if(t.classList.contains("dome-mode"))return;t.classList.add("dome-mode"),document.documentElement.style.overflow="hidden",o();let s=document.getElementById("canvas-container");if(s){let m=getComputedStyle(document.documentElement).getPropertyValue("--actual-vh");s.style.height=m||"100vh",s.style.width="100vw",setTimeout(()=>{window.dispatchEvent(new Event("resize"))},0)}let l=Me();if(ui=r&&!l,r&&j&&!l&&!(document.pointerLockElement===j||document.mozPointerLockElement===j||document.webkitPointerLockElement===j)){let p=setTimeout(()=>{if(!t.classList.contains("dome-mode")||nt)return;let f=j.requestPointerLock||j.mozRequestPointerLock||j.webkitRequestPointerLock;if(f)try{f.call(j).catch(g=>{g.name!=="SecurityError"&&g.name!=="NotAllowedError"&&console.warn("Pointer lock request failed:",g)})}catch(g){g.name!=="SecurityError"&&g.name!=="NotAllowedError"&&console.warn("Pointer lock request failed:",g)}},100);window.pointerLockTimeout=p}setTimeout(()=>{window.setupCameraButton&&window.setupCameraButton()},150)}function i(){if(!nt){if(nt=!0,window.pointerLockTimeout&&(clearTimeout(window.pointerLockTimeout),window.pointerLockTimeout=null),j&&(document.pointerLockElement===j||document.mozPointerLockElement===j||document.webkitPointerLockElement===j))try{document.exitPointerLock()}catch(r){r.name!=="SecurityError"&&console.warn("Error exiting pointer lock:",r)}if(t.classList.contains("dome-mode")){t.classList.remove("dome-mode"),document.documentElement.style.overflow="auto";let r=document.getElementById("canvas-container");r&&(r.style.width=""),o(),setTimeout(()=>{window.setupCameraButton&&window.setupCameraButton(),setTimeout(()=>{nt=!1},100)},0)}else nt=!1}}window.enterDomeModeFromCanvas=()=>{n(!0)},window.enterDomeModeWithAudio=async()=>{if(n(!1),Qn)try{await Qn()}catch(r){console.warn("Could not start audio:",r)}},e&&(e.addEventListener("click",r=>{if(r.stopPropagation(),!t.classList.contains("dome-mode"))n(!0);else if(Me()&&(i(),at))try{at()}catch(s){console.warn("Could not stop audio:",s)}}),e.addEventListener("touchend",r=>{if(r.stopPropagation(),r.preventDefault(),!t.classList.contains("dome-mode"))n(!0);else if(Me()&&(i(),at))try{at()}catch(s){console.warn("Could not stop audio:",s)}})),o(),document.addEventListener("keydown",r=>{if(r.key==="Escape"&&t.classList.contains("dome-mode")&&(i(),at))try{at()}catch(s){console.warn("Could not stop audio:",s)}});function a(){if(nt)return;let r=j&&(document.pointerLockElement===j||document.mozPointerLockElement===j||document.webkitPointerLockElement===j),s=Me();!r&&t.classList.contains("dome-mode")&&!s&&ui&&setTimeout(()=>{!nt&&t.classList.contains("dome-mode")&&!(document.pointerLockElement===j||document.mozPointerLockElement===j||document.webkitPointerLockElement===j)&&i()},50)}document.addEventListener("pointerlockchange",a),document.addEventListener("mozpointerlockchange",a),document.addEventListener("webkitpointerlockchange",a)}var v=null;function pi(e){v=e}function gi(){document.querySelectorAll(".wasd-key-btn").forEach(t=>{let o=t.getAttribute("data-key");o&&(t.addEventListener("touchstart",n=>{n.preventDefault(),n.stopPropagation(),t.classList.add("active"),v&&(o==="w"&&(v.forward=!0),o==="s"&&(v.backward=!0),o==="a"&&(v.left=!0),o==="d"&&(v.right=!0),o==="q"&&(v.rotateLeft=!0),o==="e"&&(v.rotateRight=!0))}),t.addEventListener("touchend",n=>{n.preventDefault(),n.stopPropagation(),t.classList.remove("active"),v&&(o==="w"&&(v.forward=!1),o==="s"&&(v.backward=!1),o==="a"&&(v.left=!1),o==="d"&&(v.right=!1),o==="q"&&(v.rotateLeft=!1),o==="e"&&(v.rotateRight=!1))}),t.addEventListener("touchcancel",n=>{n.preventDefault(),n.stopPropagation(),t.classList.remove("active"),v&&(o==="w"&&(v.forward=!1),o==="s"&&(v.backward=!1),o==="a"&&(v.left=!1),o==="d"&&(v.right=!1),o==="q"&&(v.rotateLeft=!1),o==="e"&&(v.rotateRight=!1))}),t.addEventListener("mousedown",n=>{n.preventDefault(),n.stopPropagation(),t.classList.add("active"),v&&(o==="w"&&(v.forward=!0),o==="s"&&(v.backward=!0),o==="a"&&(v.left=!0),o==="d"&&(v.right=!0),o==="q"&&(v.rotateLeft=!0),o==="e"&&(v.rotateRight=!0))}),t.addEventListener("mouseup",n=>{n.preventDefault(),n.stopPropagation(),t.classList.remove("active"),v&&(o==="w"&&(v.forward=!1),o==="s"&&(v.backward=!1),o==="a"&&(v.left=!1),o==="d"&&(v.right=!1),o==="q"&&(v.rotateLeft=!1),o==="e"&&(v.rotateRight=!1))}),t.addEventListener("mouseleave",()=>{t.classList.remove("active"),v&&(o==="w"&&(v.forward=!1),o==="s"&&(v.backward=!1),o==="a"&&(v.left=!1),o==="d"&&(v.right=!1),o==="q"&&(v.rotateLeft=!1),o==="e"&&(v.rotateRight=!1))}),t.addEventListener("click",()=>{t.classList.remove("active")}))})}var Xt,ms,de,ps,hi,vi,Jn,Zn,Ei,ea,xi,Yt,ta,oa,Mi,Ti,zo,na,it,Ho,Ao,Do,Bo,aa,wi,ia,ra,yi,sa,la=!1,gs=null,Oo=0,Si=0,hs=2e3;async function Ci(){await new Promise(e=>{"scheduler"in window&&"postTask"in window.scheduler?window.scheduler.postTask(()=>e(),{priority:"user-blocking"}):"requestIdleCallback"in window?requestIdleCallback(()=>e(),{timeout:0}):setTimeout(()=>e(),0)}),await Ro(),await new Promise(e=>setTimeout(e,0)),_o(),"requestIdleCallback"in window?requestIdleCallback(()=>{Nn(),Xn(),_n()},{timeout:100}):setTimeout(()=>{Nn(),Xn(),_n()},0),"requestIdleCallback"in window?requestIdleCallback(()=>{Un()},{timeout:500}):setTimeout(()=>{Un()},50),"requestIdleCallback"in window?requestIdleCallback(()=>{bi()},{timeout:100}):setTimeout(()=>{bi()},0)}async function Pi(){if(!la)try{Xt=await import("three");let e=await Promise.resolve().then(()=>(Se(),Vo)),t=await Promise.resolve().then(()=>(Ht(),pa)),o=await Promise.resolve().then(()=>(vn(),Na)),n=await Promise.resolve().then(()=>(lo(),Yo));ms=e.scene,de=e.camera,ps=e.renderer,hi=e.canvas,vi=e.resetCamera,Jn=o.setupLighting,Zn=n.initPostProcessing,Ei=n.updatePostProcessing,ea=t.setupCameraControls,xi=t.euler,fi(hi),la=!0}catch(e){console.error("Error loading Three.js:",e)}}async function Lt(){if(await Pi(),!(Yt&&it))try{let e=await Promise.resolve().then(()=>(mt(),qt)),t=await Promise.resolve().then(()=>(no(),fa)),o=await Promise.resolve().then(()=>(Eo(),Ua)),n=await Promise.resolve().then(()=>(zn(),ti)),i=await Promise.resolve().then(()=>(Nt(),Ea));Yt=e.loadModel,ta=t.updateMovement,oa=t.updateRotation,Mi=e.fbxMeshes,Ti=e.glbLights,zo=o.getCurrentImageTexture,na=o.getCurrentVideoTexture,it=o.connectWebcam,Ho=o.loadImage,Ao=o.loadVideo,Do=o.disconnectWebcam,Bo=o.loadDefaultScreenTexture,sa=o.updateShaderRotation,aa=n.updateScreenLighting,wi=t.touchMovement,ia=i.updateListenerPosition,ra=i.startAudio,yi=i.stopAudio,pi(wi),mi(ra,yi),window.loadModel=Yt,window.connectWebcam=it,window.loadImage=Ho,window.loadVideo=Ao,window.disconnectWebcam=Do,window.loadDefaultScreenTexture=Bo}catch(e){console.error("Error loading 3D modules:",e)}}function bi(){let e=null;function t(){return e||(e=document.createElement("input"),e.type="file",e.accept="image/*,video/*",e.style.display="none",document.body.appendChild(e),e.addEventListener("change",async f=>{let g=f.target.files?.[0];g&&((!Ho||!Ao)&&await Lt(),g.type.startsWith("image/")?Ho(g):g.type.startsWith("video/")&&Ao(g)),e.value=""})),e}let o=document.getElementById("connect-webcam-link");o&&o.addEventListener("click",async f=>{f.preventDefault(),it||await Lt(),it()});let n=document.getElementById("upload-file-link");n&&n.addEventListener("click",f=>{f.preventDefault(),t().click()});let i=document.getElementById("keyboard-upload-btn");i&&i.addEventListener("click",f=>{f.preventDefault(),f.stopPropagation(),t().click()}),window.resetToDefaults=async function(){try{(!Do||!Bo)&&await Lt(),Do(),Bo(),vi(ke,Le,xi),Object.assign(et,ke),Object.assign(tt,Le)}catch(f){console.error("Error during reset:",f)}};let a=!1;function r(){let f=document.getElementById("keyboard-reset-btn");if(f&&!a){let g=function(h){return h.preventDefault(),h.stopPropagation(),h.stopImmediatePropagation(),window.resetToDefaults&&window.resetToDefaults(),!1},u=f.cloneNode(!0);return f.parentNode.replaceChild(u,f),u.onclick=g,u.addEventListener("click",g,{capture:!0,passive:!1}),u.addEventListener("touchend",g,{capture:!0,passive:!1}),a=!0,!0}return!1}let s=async function(f){return f.preventDefault(),f.stopPropagation(),f.stopImmediatePropagation(),it||await Lt(),confirm("Do you want to connect your webcam to the screen?")&&it(),!1};window.setupCameraButton=function(){let f=document.getElementById("keyboard-camera-btn");if(f){let g=f.cloneNode(!0);return f.parentNode.replaceChild(g,f),g.onclick=s,g.addEventListener("click",s,{capture:!0,passive:!1}),g.addEventListener("touchend",s,{capture:!0,passive:!1}),!0}return!1},r(),setupCameraButton(),setTimeout(()=>{document.getElementById("keyboard-reset-btn")||r(),document.getElementById("keyboard-camera-btn")||setupCameraButton()},500);let l=()=>{_o()};window.addEventListener("resize",l),window.visualViewport&&window.visualViewport.addEventListener("resize",l),window.addEventListener("orientationchange",()=>{setTimeout(l,100)}),gi();let m=document.getElementById("enter-dome-link");m&&m.addEventListener("click",async f=>{f.preventDefault(),ra||await Lt(),window.enterDomeModeWithAudio&&window.enterDomeModeWithAudio()});let p=async()=>{await Pi(),Jn&&Jn(),Zn&&Zn(),ea&&ea(),await Lt(),Yt&&(Yt(),ys())};"requestIdleCallback"in window?requestIdleCallback(()=>p(),{timeout:2e3}):setTimeout(p,500)}function ki(e){if(gs=requestAnimationFrame(ki),!la||!de)return;let t=(e-Oo)/1e3;if(Oo=e,ta&&oa&&(ta(),oa(t)),et.x=de.position.x,et.y=de.position.y,et.z=de.position.z,tt.x=de.rotation.x,tt.y=de.rotation.y,tt.z=de.rotation.z,e-Si>=hs&&(Object.assign(ke,et),Object.assign(Le,tt),Bn(Mi,Ti),Si=e),zo&&ws(t),aa&&aa(e),ia&&Xt&&de){let n=new Xt.Vector3(0,0,-1);n.applyQuaternion(de.quaternion),ia({x:de.position.x,y:de.position.y,z:de.position.z},{x:n.x,y:n.y,z:n.z})}Ei()}function ws(e){if(!ce.enabled||!Xt||!zo)return;let t=zo(),o=na?na():null,n=t||o;if(n){for((!n.center||n.center.x!==.5||n.center.y!==.5)&&(n.center?n.center.set(.5,.5):n.center=new Xt.Vector2(.5,.5)),n.rotation-=ce.speed*e;n.rotation<0;)n.rotation+=Math.PI*2;sa&&sa(n.rotation)}}function ys(){Oo=performance.now(),ki(Oo)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{Ci(),Kn()}):(Ci(),Kn());
