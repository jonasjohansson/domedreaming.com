import*as c from"three";import{EffectComposer as Ot}from"three/addons/postprocessing/EffectComposer.js";import{RenderPass as Gt}from"three/addons/postprocessing/RenderPass.js";import{UnrealBloomPass as qt}from"three/addons/postprocessing/UnrealBloomPass.js";import"three/addons/postprocessing/OutputPass.js";import"three/addons/postprocessing/FXAAPass.js";import{GLTFLoader as wt}from"three/addons/loaders/GLTFLoader.js";import{DRACOLoader as Ut}from"three/addons/loaders/DRACOLoader.js";import{init as Yt,importNavMesh as Xt,NavMeshQuery as yt}from"@recast-navigation/core";import{threeToSoloNavMesh as Qt}from"@recast-navigation/three";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function o(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(i){if(i.ep)return;i.ep=!0;const s=o(i);fetch(i.href,s)}})();const O=new c.Scene;O.background=new c.Color(1710618);const d=new c.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);d.position.set(0,5.4,-4.3);d.rotation.set(-3,0,3.121154018741333);const I=new c.WebGLRenderer({antialias:!1,powerPreference:"high-performance",stencil:!1,depth:!0}),vt=document.getElementById("canvas-container");function bt(){const e=vt.getBoundingClientRect();return{width:e.width,height:e.height}}const et=bt();I.setSize(et.width,et.height);I.setPixelRatio(Math.min(window.devicePixelRatio,1.5));I.shadowMap.enabled=!1;I.toneMapping=c.NoToneMapping;I.outputColorSpace=c.SRGBColorSpace;vt.appendChild(I.domElement);const y=I.domElement;let Ce=()=>{const e=bt();d.aspect=e.width/e.height,d.updateProjectionMatrix(),I.setSize(e.width,e.height),I.setPixelRatio(Math.min(window.devicePixelRatio,1.5))};window.addEventListener("resize",Ce);function Zt(e){window.removeEventListener("resize",Ce),Ce=e,window.addEventListener("resize",Ce)}function tt(){const e=new c.AmbientLight(16777215,.2);O.add(e),O.fog=new c.Fog(1710618,20,60)}const Jt="modulepreload",Kt=function(e){return"/"+e},nt={},Lt=function(n,o,t){let i=Promise.resolve();if(o&&o.length>0){let m=function(p){return Promise.all(p.map(L=>Promise.resolve(L).then(r=>({status:"fulfilled",value:r}),r=>({status:"rejected",reason:r}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");i=m(o.map(p=>{if(p=Kt(p),p in nt)return;nt[p]=!0;const L=p.endsWith(".css"),r=L?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${r}`))return;const f=document.createElement("link");if(f.rel=L?"stylesheet":Jt,L||(f.as="script"),f.crossOrigin="",f.href=p,l&&f.setAttribute("nonce",l),document.head.appendChild(f),L)return new Promise((g,u)=>{f.addEventListener("load",g),f.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${p}`)))})}))}function s(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return i.then(a=>{for(const l of a||[])l.status==="rejected"&&s(l.reason);return n().catch(s)})},j=1.6,Pe={x:5,y:10,z:5},re={emissive:new c.Color(16777215),emissiveIntensity:1,color:new c.Color(16777215),toneMapped:!1,transparent:!1,opacity:1};function ze(e,n){if(!n)return;const o=Array.isArray(n.material)?n.material[0]:n.material;if(!o){n.material=new c.MeshStandardMaterial({map:e,emissiveMap:e,...re});return}o.map&&o.map.dispose(),o.emissiveMap&&o.emissiveMap.dispose(),o.map=e,o.emissiveMap=e,Object.assign(o,re),o.needsUpdate=!0}function $e(e){e.flipY=!0,e.wrapS=c.RepeatWrapping,e.wrapT=c.RepeatWrapping,e.repeat.x=-1,e.colorSpace=c.SRGBColorSpace,e.center.set(.5,.5),e.needsUpdate=!0}function ae(e){return Array.isArray(e.material)?e.material[0]:e.material}function Et(e){!e||!e.children||(e.children=e.children.filter(Boolean),e.children.forEach(n=>Et(n)))}function _(e,n){if(!e)return;const o=[e];for(;o.length;){const t=o.pop();if(t&&(n(t),t.children&&t.children.length))for(let i=t.children.length-1;i>=0;i--){const s=t.children[i];s&&typeof s.traverse=="function"?o.push(s):t.children.splice(i,1)}}}let ot={cameraHeight:1.6,navmeshSearchBox:{x:5,y:10,z:5},screenMaterialSettings:{emissive:[1,1,1],emissiveIntensity:1,color:[1,1,1],toneMapped:!1,transparent:!1,opacity:1},ledCount:384,ledRadius:.03},Ze=.02,oe={sensitivity:.002,rotationSpeed:120},He={x:0,y:5.4,z:-4.3},Ae={x:-3,y:0,z:3.121154018741333},Ee={x:0,y:0,z:0},Se={x:0,y:0,z:0},q={enabled:!0,strength:1.5,radius:.4,threshold:.85},v={pulseSpeed:2,pulseWidth:.3,baseIntensity:0,maxIntensity:4,mirrored:!1,rimVisible:!1,hueStart:.5,hueRange:.3,saturation:1,lightness:.5},R={backgroundColor:"#000000",textColor:"#ffffff",dotColor:"#ffffff",sidebarColor:"#333333",sidebarVisible:!0,headerIslandVisible:!1,blendMode:"normal",vignette:{enabled:!1,size:8,fadeWidth:2}},Je={enabled:!0,scrollTimeout:25,touchThreshold:30,snapThreshold:.5,initialSnapThreshold:1,gridColumns:15,gridRows:10},St={rows:8},Ke={defaultImage:"assets/img/background-text.jpg"},Z={enabled:!0,speed:.02},D={canvas:{backgroundColor:"#000000",backgroundImage:null},about:{backgroundColor:"#463434",backgroundImage:null},team:{backgroundColor:"#000000",backgroundImage:null}};async function en(e=!1){try{const n=new URL(import.meta.url),o=new URL("./default-settings.json",n),t=e?`${o}?t=${Date.now()}`:o,i=await fetch(t);if(!i.ok)return console.warn("Could not load data.json, using hardcoded defaults"),!1;const s=await i.json();return s.constants&&(ot={...ot,...s.constants}),s.settings&&Mt(s.settings),!0}catch(n){return console.warn("Failed to load default settings from JSON:",n),!1}}function Mt(e){e.moveSpeed!==void 0&&(Ze=e.moveSpeed),e.cameraSettings&&Object.assign(oe,e.cameraSettings),e.startCameraPosition&&Object.assign(He,e.startCameraPosition),e.startCameraRotation&&Object.assign(Ae,e.startCameraRotation),e.colorSettings?window.savedColorSettings=e.colorSettings:window.savedColorSettings=null,e.lightSettings?window.savedLightSettings=e.lightSettings:window.savedLightSettings=null,e.bloomSettings&&Object.assign(q,e.bloomSettings),e.ledStripSettings&&Object.assign(v,e.ledStripSettings),e.pageColorSettings&&(e.pageColorSettings.vignette&&(R.vignette={...R.vignette,...e.pageColorSettings.vignette}),Object.assign(R,e.pageColorSettings),R.vignette||(R.vignette={enabled:!0,size:8,fadeWidth:2}),ke()),e.scrollSettings&&Object.assign(Je,e.scrollSettings),e.canvasSettings&&Object.assign(St,e.canvasSettings),e.screenSettings&&Object.assign(Ke,e.screenSettings),e.textureRotationSettings&&Object.assign(Z,e.textureRotationSettings),e.pageBackgroundSettings&&(Object.assign(D,e.pageBackgroundSettings),xt())}function tn(e,n=.5){if(!e)return null;if(e.startsWith("rgba"))return e;if(e.startsWith("rgb")){const t=e.match(/\d+/g);if(t&&t.length>=3)return`rgba(${t[0]}, ${t[1]}, ${t[2]}, ${n})`}const o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(o){const t=parseInt(o[1],16),i=parseInt(o[2],16),s=parseInt(o[3],16);return`rgba(${t}, ${i}, ${s}, ${n})`}return e}function xt(){const e=document.querySelector(".canvas-wrapper");e&&(D.canvas.backgroundColor?e.style.setProperty("background-color",D.canvas.backgroundColor,"important"):e.style.removeProperty("background-color"),D.canvas.backgroundImage?(e.style.setProperty("background-image",`url(${D.canvas.backgroundImage})`,"important"),e.style.setProperty("background-size","cover","important"),e.style.setProperty("background-position","center","important"),e.style.setProperty("background-repeat","no-repeat","important")):e.style.setProperty("background-image","none","important"));const n=document.querySelectorAll(".page-section");if(n.length>0&&n.length>1&&D.team)for(let o=1;o<n.length;o++){const t=n[o];if(D.team.backgroundColor&&D.team.backgroundColor!=="#000000"){const i=tn(D.team.backgroundColor,.5);t.style.setProperty("background-color",i,"important")}else t.style.removeProperty("background-color");D.team.backgroundImage?(t.style.setProperty("background-image",`url(${D.team.backgroundImage})`,"important"),t.style.setProperty("background-size","cover","important"),t.style.setProperty("background-position","center","important"),t.style.setProperty("background-repeat","no-repeat","important")):t.style.removeProperty("background-image")}}function nn(){const e=document.getElementById("canvas-container");if(!e)return;const n=R.vignette||{enabled:!0,size:8,fadeWidth:2};if(!n.enabled){e.style.maskImage="none",e.style.webkitMaskImage="none";return}const o=`${n.size}%`,t=`${n.size+n.fadeWidth}%`,i=`${n.size+n.fadeWidth*2}%`,s=`${100-n.size-n.fadeWidth*2}%`,a=`${100-n.size-n.fadeWidth}%`,l=`${100-n.size}%`,m=`linear-gradient(to right, transparent 0%, transparent ${o}, rgba(0, 0, 0, 0.5) ${t}, black ${i}, black ${s}, rgba(0, 0, 0, 0.5) ${a}, transparent ${l}, transparent 100%)`,p=`linear-gradient(to bottom, transparent 0%, transparent ${o}, rgba(0, 0, 0, 0.5) ${t}, black ${i}, black ${s}, rgba(0, 0, 0, 0.5) ${a}, transparent ${l}, transparent 100%)`;e.style.maskImage=`${m}, ${p}`,e.style.maskComposite="intersect",e.style.webkitMaskImage=`${m}, ${p}`,e.style.webkitMaskComposite="source-in"}function ke(){document.documentElement.style.setProperty("--color-bg",R.backgroundColor),document.documentElement.style.setProperty("--color-text",R.textColor),document.documentElement.style.setProperty("--color-dot",R.dotColor),document.body.style.backgroundColor=R.backgroundColor;const e=document.querySelector(".canvas-wrapper");e&&R.blendMode&&(e.style.mixBlendMode=R.blendMode),nn()}async function on(e=!1){const n=await en(e);if(!n&&!e)try{const o=localStorage.getItem("domeDreamingSettings");if(!o){ke();return}const t=JSON.parse(o);Mt(t),console.log("Loaded settings from localStorage (JSON file not available)")}catch(o){console.warn("Failed to load settings from localStorage:",o),ke()}else n&&(console.log("Loaded settings from data.json"),ke());xt()}function Ct(e,n){try{const o={};e&&Array.isArray(e)&&e.forEach((s,a)=>{const l=ae(s.mesh);if(l?.color){const m=s.name||`mesh_${a}`;o[m]={r:l.color.r,g:l.color.g,b:l.color.b}}});const t={};n&&Array.isArray(n)&&n.forEach((s,a)=>{const l=s.name||`light_${a}`;t[l]={r:s.color.r,g:s.color.g,b:s.color.b,intensity:s.intensity}});const i={moveSpeed:Ze,cameraSettings:oe,startCameraPosition:He,startCameraRotation:Ae,colorSettings:o,lightSettings:t,bloomSettings:q,ledStripSettings:v,pageColorSettings:R,scrollSettings:Je,canvasSettings:St,screenSettings:Ke,textureRotationSettings:Z,pageBackgroundSettings:D};localStorage.setItem("domeDreamingSettings",JSON.stringify(i))}catch(o){console.warn("Failed to save settings:",o)}}let X=null,it=null,we=null;function st(){const n=document.getElementById("canvas-container").getBoundingClientRect(),o=new c.Vector2(n.width,n.height),t=new c.WebGLRenderTarget(o.width,o.height,{type:c.HalfFloatType,samples:0});X=new Ot(I,t),it=new Gt(O,d),X.addPass(it);const i=q.enabled!==!1?q.strength:0;we=new qt(o,i,q.radius,q.threshold),we.enabled=q.enabled!==!1,X.addPass(we),Zt(()=>{const a=document.getElementById("canvas-container").getBoundingClientRect(),l=a.width,m=a.height;d.aspect=l/m,d.updateProjectionMatrix(),I.setSize(l,m),I.setPixelRatio(Math.min(window.devicePixelRatio,1.5)),rn()}),console.log("Post-processing initialized")}function sn(){X?X.render():I.render(O,d)}function rn(){if(X){const n=document.getElementById("canvas-container").getBoundingClientRect(),o=n.width,t=n.height;X.setSize(o,t),we&&we.setSize(o,t)}}let x=null,H=null,M=null,A=null,Me=null;function rt(e){x=e}function an(){return H}function ln(){return A}function cn(e=Ke.defaultImage||"assets/media/background.jpg"){if(!x)return;new c.TextureLoader().load(e,o=>{$e(o),o.rotation=0,ze(o,x),A=o},void 0,()=>{})}function Pt(e){if(!x)return;const n=new FileReader;n.onload=o=>{new c.TextureLoader().load(o.target.result,i=>{H&&(H.dispose(),H=null),M&&(M.pause(),M.src="",URL.revokeObjectURL(M.src),M=null),A&&A.dispose(),Z.enabled=!1,$e(i),i.rotation=0,ze(i,x),A=i;const s=ae(x);s&&setTimeout(()=>{Object.assign(s,re),s.needsUpdate=!0},200)},void 0,()=>{})},n.readAsDataURL(e)}function kt(e){if(!x)return;const n=document.createElement("video");n.src=URL.createObjectURL(e),n.crossOrigin="anonymous",n.loop=!0,n.muted=!0,n.playsInline=!0,n.addEventListener("loadedmetadata",()=>{n.play(),H&&H.dispose(),M&&(M.pause(),M.src="",URL.revokeObjectURL(M.src)),A&&(A.dispose(),A=null),Z.enabled=!1;const o=new c.VideoTexture(n);$e(o),o.minFilter=c.LinearFilter,o.magFilter=c.LinearFilter,o.rotation=0,ze(o,x),H=o,M=n;const t=ae(x);t&&setTimeout(()=>{Object.assign(t,re),t.needsUpdate=!0},200)}),n.addEventListener("error",()=>{})}function dn(){if(x){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){alert("Webcam access is not available in your browser.");return}navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(e=>{H&&(H.dispose(),H=null),M&&(M.pause(),M.srcObject=null,M=null),A&&(A.dispose(),A=null),Me&&(Me.getTracks().forEach(o=>o.stop()),Me=null),Z.enabled=!1;const n=document.createElement("video");n.srcObject=e,n.autoplay=!0,n.playsInline=!0,n.muted=!0,n.addEventListener("loadedmetadata",()=>{n.play();const o=new c.VideoTexture(n);$e(o),o.minFilter=c.LinearFilter,o.magFilter=c.LinearFilter,o.rotation=0,ze(o,x),H=o,M=n,Me=e;const t=ae(x);t&&setTimeout(()=>{Object.assign(t,re),t.needsUpdate=!0},200)}),n.addEventListener("error",()=>{alert("Error accessing webcam.")})}).catch(e=>{console.error("Error accessing webcam:",e),alert("Could not access webcam. Please check permissions.")})}}function un(){const e=document.getElementById("drop-zone");function n(t){t.preventDefault(),t.stopPropagation()}function o(t){if(!x)return;const i=ae(x);i&&(t?(i.emissive=new c.Color(38655),i.emissiveIntensity=.8):(Object.assign(i,re),i.needsUpdate=!0))}document.addEventListener("dragenter",t=>{n(t),e.classList.add("drag-over"),o(!0)},!1),document.addEventListener("dragover",t=>{n(t),e.classList.add("drag-over"),o(!0)},!1),document.addEventListener("dragleave",t=>{n(t),t.clientX===0&&t.clientY===0&&(e.classList.remove("drag-over"),o(!1))},!1),document.addEventListener("drop",t=>{n(t),e.classList.remove("drag-over"),o(!1);const i=t.dataTransfer.files;if(i.length>0){const s=i[0];s.type.startsWith("image/")?Pt(s):s.type.startsWith("video/")&&kt(s)}},!1)}let ye=!1,ge=null,_e=[],J=null;function mn(){return J}async function Rt(){if(!ye)try{await Yt(),ye=!0,fn()}catch(e){console.error("Failed to initialize recast-navigation:",e),ye=!0}}async function fn(){if(!ye){await Rt();return}try{const e=await fetch("assets/models/navmesh.bin");if(e.ok){const n=await e.arrayBuffer(),o=new Uint8Array(n),{navMesh:t}=Xt(o);J=new yt(t),Wt(J),console.log("Navmesh loaded from navmesh.bin"),B&&Tt();return}}catch{console.log("navmesh.bin not found, will generate from GLTF")}gn()}function gn(){new wt().load("assets/models/navmesh.gltf",async n=>{if(ge=n.scene,ge.scale.setScalar(1),ge.visible=!1,_(ge,o=>{o.isMesh&&(_e.push(o),o.updateMatrixWorld())}),O.add(ge),_e.length>0&&ye){const{success:o,navMesh:t}=Qt(_e,{cs:.05,ch:.05,walkableRadius:.2});o&&(J=new yt(t),Wt(J),console.log("Navmesh generated from GLTF"))}},void 0,n=>{console.warn("Navmesh GLTF not found:",n)})}function Tt(){if(!J||!B)return;const e={x:d.position.x,y:d.position.y-j,z:d.position.z},n=J.findClosestPoint(e,{halfExtents:Pe});n.success&&(d.position.y=n.point.y+j)}function hn(){Rt().catch(console.error)}let Q=null,k=[],V=null;const b=384,he=.03;let te=0,We=2,Le=.3,se=0,Fe=4,Ve=!1,T={hueStart:.5,hueRange:.3,saturation:1,lightness:.5};function pn(){We=v.pulseSpeed,Le=v.pulseWidth,se=v.baseIntensity,Fe=v.maxIntensity,Ve=v.mirrored||!1,T.hueStart=v.hueStart,T.hueRange=v.hueRange,T.saturation=v.saturation,T.lightness=v.lightness;const e=v.rimVisible!==void 0?v.rimVisible:!1;$t(e)}function wn(e){We=e,v.pulseSpeed=e,le()}function yn(e){Le=e,v.pulseWidth=e,le()}function vn(e){se=e,v.baseIntensity=e,le()}function bn(e){Fe=e,v.maxIntensity=e,le()}function Ln(e,n,o,t){T.hueStart=e,T.hueRange=n,T.saturation=o,T.lightness=t,v.hueStart=e,v.hueRange=n,v.saturation=o,v.lightness=t,le()}function En(e){Ve=e,v.mirrored=e,le()}function le(){Lt(()=>Promise.resolve().then(()=>Rn),void 0).then(e=>{Ct(e.fbxMeshes,e.glbLights)})}function It(e){if(!e)return console.warn("findLEDRim: model is null"),null;let n=null;const o=[];return e.traverse(t=>{o.push(t.name||"unnamed");const i=t.name||"",s=i.toLowerCase();(i==="LED_Rim"||i.includes("LED_Rim")||i.includes("LEDRim")||i.includes("led_rim")||s.includes("ledrim")||s.includes("led")&&s.includes("rim"))&&(n=t,console.log(`Found LED rim object: "${t.name}", type: ${t.type||t.constructor.name}`))}),n||console.warn("LED_Rim object not found. Available object names:",o.filter(t=>t).slice(0,20)),n}function Dt(e){if(!e){console.warn("LED_Rim object not found");return}Q=e,V=new c.Group,V.name="LED_Strip";let n=null;e.traverse(u=>{u.isMesh&&u.geometry&&(n=u.geometry)});const o=new c.Box3;o.setFromObject(e);const t=o.getSize(new c.Vector3);o.getCenter(new c.Vector3);let i=Math.max(t.x,t.z)/2;const s=t.y/2;let a=i*.75;i<.1&&(console.warn(`LED Rim radius too small (${i.toFixed(2)}), using default 5.0`),i=5,a=3.5),console.log(`LED Rim dimensions: outerRadius=${i.toFixed(2)}, innerRadius=${a.toFixed(2)}, height=${s.toFixed(2)}, size:`,t),console.log("Rim object position:",e.position),console.log("Rim object rotation:",e.rotation),console.log("Rim object scale:",e.scale),console.log("Rim object matrix:",e.matrix);let l=[];if(n&&n.attributes&&n.attributes.position){const u=n.attributes.position,w=u.count;console.log(`Found rim geometry with ${w} vertices`);const S=[];for(let h=0;h<w;h++){const C=u.getX(h),de=u.getY(h),$=u.getZ(h);S.push(new c.Vector3(C,de,$))}const W=Math.min(...S.map(h=>h.y)),K=Math.max(...S.map(h=>h.y)),G=K-W,ee=W+G*.1;console.log(`Rim Y range: ${W.toFixed(2)} to ${K.toFixed(2)}, using bottom Y: ${ee.toFixed(2)}`);const z=S.filter(h=>Math.abs(h.y-ee)<G*.15).map(h=>{const C=Math.sqrt(h.x*h.x+h.z*h.z);return{vertex:h,distance:C,angle:Math.atan2(h.z,h.x)}}).sort((h,C)=>h.angle-C.angle);if(z.length>10){console.log(`Found ${z.length} bottom edge vertices`);const h=z.reduce(($,F)=>$+F.vertex.x,0)/z.length,C=z.reduce(($,F)=>$+F.vertex.z,0)/z.length,de=ee;new c.Vector3(h,de,C),z.reduce(($,F)=>{const ue=F.vertex.x-h,me=F.vertex.z-C;return $+Math.sqrt(ue*ue+me*me)},0)/z.length;for(let $=0;$<b;$++){const F=$/b*Math.PI*2;let ue=z[0],me=1/0;for(const Ne of z){const Bt=Math.atan2(Ne.vertex.z-C,Ne.vertex.x-h);let fe=Math.abs(Bt-F);fe>Math.PI&&(fe=Math.PI*2-fe),fe<me&&(me=fe,ue=Ne)}const jt=new c.Vector3(h+Math.cos(F)*a,ue.vertex.y,C+Math.sin(F)*a);l.push(jt)}console.log(`Created ${l.length} evenly distributed LED positions using angular distribution`)}else{console.log(`Not enough bottom vertices (${z.length}), using perfectly evenly distributed circle positions`);for(let h=0;h<b;h++){const C=h/b*Math.PI*2,de=new c.Vector3(Math.cos(C)*a,ee,Math.sin(C)*a);l.push(de)}}}else{console.log("No rim geometry found, using perfectly evenly distributed circle positions");for(let u=0;u<b;u++){const w=u/b*Math.PI*2,S=new c.Vector3(Math.cos(w)*a,-s,Math.sin(w)*a);l.push(S)}}if(l.length!==b){console.log(`Adjusting positions from ${l.length} to ${b} for even distribution`);const u=[];for(let w=0;w<b;w++){const S=w/b,W=Math.floor(S*l.length),K=(W+1)%l.length,G=S*l.length-W,ee=new c.Vector3().lerpVectors(l[W],l[K],G);u.push(ee)}l=u}const m=new c.CylinderGeometry(he*.8,he*.8,he*.3,8,1),p=new c.MeshStandardMaterial({color:16777215,emissive:65535,emissiveIntensity:0,metalness:0,roughness:.8}),L=new c.Group;L.name="LED_Diffuser";const r=new c.TorusGeometry(a+he*.2,he*.15,16,64),f=new c.MeshStandardMaterial({color:16777215,transparent:!0,opacity:.3,roughness:1,metalness:0,side:c.DoubleSide}),g=new c.Mesh(r,f);if(g.position.y=-s,g.rotation.x=Math.PI/2,L.add(g),l.length!==b){for(console.warn(`Position count mismatch: ${l.length} positions, need ${b}. Creating missing positions.`);l.length<b;){const w=l.length/b*Math.PI*2,S=new c.Vector3(Math.cos(w)*a,-s,Math.sin(w)*a);l.push(S)}l=l.slice(0,b)}for(let u=0;u<b&&u<l.length;u++){const w=new c.Mesh(m,p.clone());w.position.copy(l[u]);const S=new c.Vector3(0,l[u].y,0);w.lookAt(S),w.rotateX(Math.PI/2),w.name=`LED_${u}`,k.push({mesh:w,index:u,material:w.material}),V.add(w)}if(e.add(V),e.add(L),V.visible=!0,V.matrixAutoUpdate=!0,console.log(`Created LED strip with ${k.length} pixels (target: ${b}) at inner radius ${a.toFixed(2)}`),console.log(`Positions array length: ${l.length}`),k.length!==b?console.error(`LED count mismatch! Expected ${b}, got ${k.length}`):console.log(`âœ“ Successfully created all ${b} LEDs`),console.log("LED strip group position (local):",V.position),console.log("LED strip group visible:",V.visible),console.log("Rim object visible:",e.visible),k.length>0){const u=k[0].mesh,w=new c.Vector3;u.getWorldPosition(w);const S=new c.Vector3;e.getWorldPosition(S);const W=new c.Quaternion;if(e.getWorldQuaternion(W),console.log("First LED local position:",u.position),console.log("First LED world position:",w),console.log("Rim object world position:",S),console.log("Rim object world rotation:",e.getWorldQuaternion(W)),console.log("Rim object world scale:",e.getWorldScale(new c.Vector3)),k.length>10){const K=k[Math.floor(k.length/4)].mesh,G=new c.Vector3;K.getWorldPosition(G),console.log("Quarter LED world position:",G)}}}function zt(e){k.length!==0&&(te+=e*We,k.forEach((n,o)=>{const t=o/b;let i;if(Ve){const L=t-.5,r=Math.abs(L),f=(.5-r+te)%1,g=(.5-r-te+1)%1;i=Math.min(f,g)}else i=(t+te)%1;const s=Math.abs(i-.5)*2;let a=0;s<Le?(a=1-s/Le,a=Math.pow(a,2),a=se+(Fe-se)*a):a=se,n.material.emissiveIntensity=Math.max(a,0);const l=te*.1,m=(T.hueStart+(t+te*.5)*T.hueRange+l)%1,p=new c.Color().setHSL(m,T.saturation,T.lightness);n.material.emissive=p,n.mesh.visible=!0}))}function Sn(e){k.forEach(n=>{n.material.emissive.set(e)})}function Mn(e){k.forEach(n=>{n.material.emissiveIntensity=e})}function xn(){return V}function Cn(){return Q}function $t(e){Q&&(Q.visible=e,Q.traverse(n=>{n.isMesh&&(n.visible=e)}))}function Pn(){return Q?Q.visible:!0}const kn=Object.freeze(Object.defineProperty({__proto__:null,get baseIntensity(){return se},colorPalette:T,createLEDStrip:Dt,findLEDRim:It,getLEDStrip:xn,getRimObject:Cn,isRimVisible:Pn,loadLEDStripSettings:pn,get maxIntensity(){return Fe},get mirrored(){return Ve},get pulseSpeed(){return We},get pulseWidth(){return Le},setBaseIntensity:vn,setColorPalette:Ln,setLEDColor:Sn,setLEDIntensity:Mn,setMaxIntensity:bn,setMirrored:En,setPulseSpeed:wn,setPulseWidth:yn,setRimVisible:$t,updateLEDAnimation:zt},Symbol.toStringTag,{value:"Module"}));let Ht=null,ve=[],N=[],ne=null,At=[];function qe(){const e=new wt,n=new Ut;n.setDecoderPath("https://cdn.jsdelivr.net/npm/three@0.181.0/examples/jsm/libs/draco/gltf/"),e.setDRACOLoader(n);const o=document.getElementById("loading");e.load("assets/models/wisdome.glb",t=>{if(console.log("Wisdome GLB loaded successfully"),!t||!t.scene){console.error("GLB loaded but scene is missing"),o.innerHTML='<div style="color: #ff4444;">Error: Model scene is missing.</div>';return}const i=t.scene;Ht=i,i.scale.setScalar(1),i.position.set(0,0,0),Et(i),ne=new c.Group,ne.name="GLBLights";const s=()=>{_(i,r=>{r.isLight&&(N.push(r),ne.add(r),console.log("Found GLB light:",r.name||"Unnamed",r.type,"intensity:",r.intensity))})};"requestIdleCallback"in window?requestIdleCallback(s,{timeout:100}):s(),N.length===0&&(console.log("No lights found with isLight, checking object for light instances..."),_(i,r=>{(r instanceof c.Light||r instanceof c.DirectionalLight||r instanceof c.PointLight||r instanceof c.SpotLight||r instanceof c.RectAreaLight||r instanceof c.HemisphereLight)&&(N.includes(r)||(N.push(r),ne.add(r),console.log("Found additional light:",r.name||"Unnamed",r.constructor.name)))})),N.length>0?(O.add(ne),console.log(`Grouped ${N.length} lights from GLB`),window.savedLightSettings&&N.forEach((r,f)=>{const g=r.name||`light_${f}`,u=window.savedLightSettings[g];if(u){r.color.setRGB(u.r,u.g,u.b);const w=Math.max(0,Math.min(u.intensity??r.intensity,10));r.intensity=w}})):console.log("No lights found in GLB file. Lights GUI will not be available."),_(i,r=>{r.name==="Hotspots"&&_(r,f=>{if(f.name==="Hotspot.001"||f.name.includes("Hotspot")){const g=new c.Vector3;f.getWorldPosition(g),At.push({object:f,position:g,name:f.name,triggered:!1}),console.log(`Found hotspot: ${f.name} at position:`,g)}})});const a=It(i);a?(console.log("Found LED_Rim object, creating LED strip..."),Lt(()=>Promise.resolve().then(()=>kn),void 0).then(r=>{r.loadLEDStripSettings()}),Dt(a)):console.log("LED_Rim object not found in model"),_(i,r=>{if(r.isMesh){const f=r.name.toLowerCase();if(f.includes("led_rim")||f.includes("led_strip")||f.startsWith("led_"))return;if(f.includes("screen")||f.includes("display")||f.includes("monitor")||f.includes("panel")||f.includes("projection")||f.includes("canvas"))rt(r),r.visible=!0;else{let g=ae(r);const u=g?.color?g.color.clone():new c.Color(16777215);if(g){if(g.metalness!==void 0&&(g.metalness=Math.max(g.metalness||0,.1)),g.roughness!==void 0&&(g.roughness=Math.min(g.roughness||.5,.8)),g.map&&(g.map.colorSpace=c.SRGBColorSpace),g.isMeshBasicMaterial){const w=new c.MeshStandardMaterial({color:g.color,map:g.map,transparent:g.transparent,opacity:g.opacity,metalness:.1,roughness:.5});r.material=w,g=w}g.needsUpdate=!0}ve.push({mesh:r,name:r.name||"Unnamed",originalColor:u})}}});let l=!1;_(i,r=>{r.isMesh&&r.name&&(r.name.toLowerCase().includes("screen")||r.name.toLowerCase().includes("display")||r.name.toLowerCase().includes("monitor")||r.name.toLowerCase().includes("panel")||r.name.toLowerCase().includes("projection")||r.name.toLowerCase().includes("canvas"))&&(l=!0)}),!l&&i&&i.children.length>0&&_(i,r=>{r.isMesh&&!l&&(rt(r),r.visible=!0,ve=ve.filter(f=>f.mesh!==r),l=!0)}),O.add(i),setTimeout(()=>{o.classList.add("hidden");const r=document.getElementById("canvas-container"),f=document.getElementById("info-panel");r&&r.classList.add("loaded"),f&&f.classList.add("loaded")},300);const m=He||{x:0,y:5.4,z:-4.3},p=Ae||{x:-3,y:0,z:3.121154018741333};d.position.set(m.x,m.y,m.z),d.rotation.set(p.x,p.y,p.z),d.updateMatrixWorld(),P.setFromQuaternion(d.quaternion),In(!0),mn()&&Tt(),hn(),cn(),un()},void 0,t=>{console.error("Error loading 3D model:",t),o.innerHTML='<div style="color: #ff4444;">Error loading 3D model.</div>'})}const Rn=Object.freeze(Object.defineProperty({__proto__:null,get fbxMeshes(){return ve},glbLights:N,get glbLightsGroup(){return ne},hotspots:At,loadModel:qe,get wisdomeModel(){return Ht}},Symbol.toStringTag,{value:"Module"}));let pe=null,E={forward:!1,backward:!1,left:!1,right:!1};function Wt(e){pe=e}function Tn(){if(!B)return;d.updateMatrixWorld();const e=new c.Vector3;e.setFromMatrixColumn(d.matrixWorld,2),e.multiplyScalar(-1).normalize();const n=new c.Vector3;n.setFromMatrixColumn(d.matrixWorld,0),n.normalize();const o=new c.Vector3,t=Ze;ie.w&&o.add(e.clone().multiplyScalar(t)),ie.s&&o.add(e.clone().multiplyScalar(-t)),ie.a&&o.add(n.clone().multiplyScalar(-t)),ie.d&&o.add(n.clone().multiplyScalar(t));const i=t*2;if(E.forward&&o.add(e.clone().multiplyScalar(i)),E.backward&&o.add(e.clone().multiplyScalar(-i)),E.left&&o.add(n.clone().multiplyScalar(-i)),E.right&&o.add(n.clone().multiplyScalar(i)),o.length()!==0)if(pe){const s=d.position.clone();s.x+=o.x,s.z+=o.z;const a={x:s.x,y:s.y-j,z:s.z},l=pe.findClosestPoint(a,{halfExtents:Pe});if(l.success)d.position.set(l.point.x,l.point.y+j,l.point.z);else{const m=pe.findClosestPoint({x:s.x,y:d.position.y-j,z:d.position.z},{halfExtents:Pe});if(m.success)d.position.set(m.point.x,m.point.y+j,d.position.z);else{const p=pe.findClosestPoint({x:d.position.x,y:d.position.y-j,z:s.z},{halfExtents:Pe});p.success&&d.position.set(d.position.x,p.point.y+j,p.point.z)}}}else d.position.add(o)}let xe=!1,P=new c.Euler(-3,0,3.121154018741333,"YXZ"),B=!1,je=0,Be=0,ie={};function In(e){B=e}function at(){function e(){const t=xe;xe=document.pointerLockElement===y||document.mozPointerLockElement===y||document.webkitPointerLockElement===y,!t&&xe&&B&&P.setFromQuaternion(d.quaternion)}document.addEventListener("pointerlockchange",e),document.addEventListener("mozpointerlockchange",e),document.addEventListener("webkitpointerlockchange",e);function n(t){if(!xe||!B)return;const i=t.movementX||t.mozMovementX||t.webkitMovementX||0,s=t.movementY||t.mozMovementY||t.webkitMovementY||0;P.y-=i*oe.sensitivity,P.x-=s*oe.sensitivity,P.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,P.x)),d.quaternion.setFromEuler(P)}y.addEventListener("mousemove",n);let o=null;y.addEventListener("touchstart",t=>{if(!(!document.body.classList.contains("dome-mode")||!B)){if(t.preventDefault(),t.touches.length===1&&o===null){const i=t.touches[0];o=i.identifier,je=i.clientX,Be=i.clientY,P.setFromQuaternion(d.quaternion)}t.touches.length===2&&(E.forward=!0)}},{passive:!1}),y.addEventListener("touchmove",t=>{if(!(!document.body.classList.contains("dome-mode")||!B)){if(t.preventDefault(),o!==null){const i=Array.from(t.touches).find(s=>s.identifier===o);if(i){const s=i.clientX-je,a=i.clientY-Be;P.y-=s*oe.sensitivity,P.x-=a*oe.sensitivity,P.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,P.x)),d.quaternion.setFromEuler(P),je=i.clientX,Be=i.clientY}}t.touches.length===2?(E.forward=!0,E.backward=!1,E.left=!1,E.right=!1):t.touches.length===1&&(E.forward=!1)}},{passive:!1}),y.addEventListener("touchend",t=>{if(document.body.classList.contains("dome-mode")){t.preventDefault();for(let i=0;i<t.changedTouches.length;i++)t.changedTouches[i].identifier===o&&(o=null);t.touches.length<2&&(E.forward=!1,E.backward=!1,E.left=!1,E.right=!1)}},{passive:!1}),y.addEventListener("touchcancel",t=>{if(document.body.classList.contains("dome-mode")){t.preventDefault();for(let i=0;i<t.changedTouches.length;i++)t.changedTouches[i].identifier===o&&(o=null);E.forward=!1,E.backward=!1,E.left=!1,E.right=!1}},{passive:!1}),window.addEventListener("keydown",t=>{ie[t.key.toLowerCase()]=!0,(t.key==="c"||t.key==="C")&&(console.log("Camera Position:",d.position),console.log("Camera Rotation:",d.rotation))}),window.addEventListener("keyup",t=>{ie[t.key.toLowerCase()]=!1,t.key==="q"||t.key==="Q"||t.key==="e"||t.key})}function Ft(){return window.visualViewport&&window.visualViewport.height?window.visualViewport.height:document.documentElement.clientHeight||window.innerHeight}function lt(){const e=Ft();document.documentElement.style.setProperty("--actual-vh",`${e}px`)}function ce(){const n=getComputedStyle(document.documentElement).getPropertyValue("--row-height"),o=parseFloat(n);return!isNaN(o)&&o>0?o:Ft()/10}let be=!1,ct=0;const Dn=50;let dt=0,Ue=0,U=0;function Vt(e){const n=ce();return Math.round(e/n)*n}function Ye(){if(be)return;const e=window.pageYOffset||document.documentElement.scrollTop,n=Vt(e);Math.abs(e-n)>1&&(be=!0,window.scrollTo({top:n,behavior:"auto"}),setTimeout(()=>{be=!1},50))}function zn(){if(be)return;const e=window.pageYOffset||document.documentElement.scrollTop,n=Vt(e),t=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?5:1;Math.abs(e-n)>t&&Ye()}function Nt(e){const n=Date.now();if(n-ct<Dn)return;const o=ce(),t=window.pageYOffset||document.documentElement.scrollTop;if(e!==0){const a=(Math.round(t/o)+e)*o,l=Math.max(document.body.scrollHeight-window.innerHeight,document.documentElement.scrollHeight-window.innerHeight),m=Math.max(0,Math.min(a,l));Math.abs(m-t)>1&&(ct=n,window.scrollTo({top:m,behavior:"auto"}))}}function $n(e){if(document.body.classList.contains("dome-mode"))return;e.preventDefault();const n=e.deltaY;let o=0;n>0?o=1:n<0&&(o=-1),o!==0&&Nt(o)}function Hn(e){document.body.classList.contains("dome-mode")||e.touches.length===1&&(dt=e.touches[0].clientY,Ue=dt,U=0)}function An(e){if(document.body.classList.contains("dome-mode")||e.touches.length!==1)return;e.preventDefault();const n=e.touches[0].clientY,o=Ue-n;U+=o,Ue=n;const i=ce()*.3;if(Math.abs(U)>=i){const s=U>0?1:-1;Nt(s),U=U%i}}function Wn(e){document.body.classList.contains("dome-mode")||(e.preventDefault(),U=0)}function Fn(){if(!Je.enabled||document.body.classList.contains("dome-mode"))return;window.addEventListener("wheel",$n,{passive:!1}),document.addEventListener("touchstart",Hn,{passive:!1}),document.addEventListener("touchmove",An,{passive:!1}),document.addEventListener("touchend",Wn,{passive:!1});let e=null;window.addEventListener("scroll",()=>{if(be)return;e&&clearTimeout(e),e=setTimeout(()=>{zn(),e=null},50)},{passive:!0}),window.addEventListener("load",()=>{setTimeout(()=>{Ye()},100)}),window.addEventListener("resize",()=>{setTimeout(()=>{Ye()},100)})}let Y=null,Te=15,Oe=0,Ie=0;function Vn(){const e=document.getElementById("dots");e&&e.remove(),Y=document.createElement("div"),Y.id="dots",document.body.appendChild(Y),Xe(),Re()}function Xe(){const e=getComputedStyle(document.documentElement),n=document.documentElement.clientWidth||window.innerWidth,o=e.getPropertyValue("--col-width");o?Oe=parseFloat(o)||n/Te:Oe=n/Te;const t=e.getPropertyValue("--row-height"),i=parseFloat(t);Ie=!isNaN(i)&&i>0?i:Oe}function Re(){if(!Y)return;Y.innerHTML="";const e=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight),n=Math.ceil(e/Ie);for(let o=0;o<n;o++){const t=document.createElement("div");t.className="dot-row";for(let i=0;i<Te;i++){const s=document.createElement("div");s.className="dot",s.dataset.col=i+1,s.dataset.row=o+1,s.style.gridColumn=i+1,s.style.gridRow=o+1,s.style.pointerEvents="none";const a=i+1,l=o+1,m=a+(l-1)*Te;s.style.setProperty("--dot-delay",m),t.appendChild(s)}Y.appendChild(t)}Y.style.height=`${n*Ie}px`}function Nn(){Vn();let e;const n=()=>{clearTimeout(e),e=setTimeout(()=>{Xe(),Re()},150)};window.addEventListener("resize",n),window.addEventListener("orientationchange",()=>{setTimeout(()=>{Xe(),Re()},300)});let o=0;function t(){const s=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight);Math.abs(s-o)>Ie&&(o=s,Re())}new MutationObserver(()=>{window.dotsUpdateTimeout&&clearTimeout(window.dotsUpdateTimeout),window.dotsUpdateTimeout=setTimeout(()=>{t()},500)}).observe(document.body,{childList:!0,subtree:!0}),o=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)}function ut(e){document.querySelectorAll(".dashboard-block.active, .page-content .block.active").forEach(n=>{n.classList.remove("active")}),e.classList.add("active")}function _n(){document.querySelectorAll(".dashboard-block").forEach(o=>{o.addEventListener("click",()=>{ut(o)})}),document.querySelectorAll(".page-content .block img").forEach(o=>{const t=o.closest(".block");t&&t.addEventListener("click",()=>{ut(t)})})}function mt(){const e=document.querySelectorAll(".block.responsive"),n=ce(),t=window.innerWidth<=768?12:10,i=n*t;e.forEach(s=>{s.style.height=`${i}px`,s.style.minHeight=`${i}px`})}function Ge(){if(!(window.innerWidth<=768)){document.querySelectorAll(".page-content.responsive").forEach(s=>{const a=s.closest(".page-section");a&&(a.style.height="",a.style.minHeight="")});return}const n=document.querySelectorAll(".page-content.responsive"),o=ce(),t=10;n.forEach(i=>{const s=i.closest(".page-section");if(!s)return;s.style.height="auto",s.style.minHeight="auto";const a=i.offsetHeight,l=o*t;if(a>l){const m=Math.ceil(a/o);s.style.height=`calc(var(--row-height) * ${m})`,s.style.minHeight=`calc(var(--row-height) * ${m})`}else s.style.height=`calc(var(--row-height) * ${t})`,s.style.minHeight=`calc(var(--row-height) * ${t})`})}function jn(){mt(),Ge();let e;window.addEventListener("resize",()=>{clearTimeout(e),e=setTimeout(()=>{mt(),Ge()},100)}),window.addEventListener("load",()=>{Ge()})}let De=0,ft=0;const Bn=2e3;function Qe(){const e=document.getElementById("canvas-container"),n=document.querySelector(".canvas-wrapper");if(!e||!n)return;const t=ce()*10;e.style.height=`${t}px`,e.style.padding="0",e.style.margin="0",n.style.height=`${t}px`}function On(){const e=document.querySelector("main");if(!e)return;const n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1),o=[];let t;for(;t=n.nextNode();)t.parentElement?.classList.contains("dome-dreaming-text")||/dome\s+dreaming/i.test(t.textContent)&&o.push(t);o.forEach(i=>{const s=i.parentNode;if(!s)return;const a=i.textContent,l=/(dome\s+dreaming)/gi,m=a.split(l),p=document.createDocumentFragment();m.forEach(L=>{if(L&&/^dome\s+dreaming$/i.test(L)){const r=document.createElement("span");r.className="dome-dreaming-text",r.textContent=L,p.appendChild(r)}else L&&p.appendChild(document.createTextNode(L))}),s.replaceChild(p,i)})}async function gt(){await on(),lt(),Fn(),Nn(),jn(),_n(),On(),"requestIdleCallback"in window?requestIdleCallback(()=>{tt(),st(),at()},{timeout:1e3}):setTimeout(()=>{tt(),st(),at(),initParallaxLayer()},50);const e=document.getElementById("connect-webcam-link");e&&e.addEventListener("click",t=>{t.preventDefault(),dn()});const n=document.getElementById("upload-file-link");if(n){const t=document.createElement("input");t.type="file",t.accept="image/*,video/*",t.style.display="none",document.body.appendChild(t),t.addEventListener("change",i=>{const s=i.target.files?.[0];s&&(s.type.startsWith("image/")?Pt(s):s.type.startsWith("video/")&&kt(s)),t.value=""}),n.addEventListener("click",i=>{i.preventDefault(),t.click()})}Qe();const o=()=>{lt(),Qe()};window.addEventListener("resize",o),window.visualViewport&&window.visualViewport.addEventListener("resize",o),window.addEventListener("orientationchange",()=>{setTimeout(o,100)}),"requestIdleCallback"in window?requestIdleCallback(()=>{qe(),ht()},{timeout:2e3}):requestAnimationFrame(()=>{setTimeout(()=>{qe(),ht()},100)})}function _t(e){requestAnimationFrame(_t);const n=(e-De)/1e3;De=e,Tn(),Ee.x=d.position.x,Ee.y=d.position.y,Ee.z=d.position.z,Se.x=d.rotation.x,Se.y=d.rotation.y,Se.z=d.rotation.z,e-ft>=Bn&&(Object.assign(He,Ee),Object.assign(Ae,Se),Ct(ve,N),ft=e),zt(n),Gn(n),sn()}function Gn(e){if(!Z.enabled)return;const n=ln(),o=an(),t=n||o;if(t)for((!t.center||t.center.x!==.5||t.center.y!==.5)&&(t.center?t.center.set(.5,.5):t.center=new THREE.Vector2(.5,.5)),t.rotation-=Z.speed*e;t.rotation<0;)t.rotation+=Math.PI*2}function ht(){De=performance.now(),_t(De)}function pt(){const e=document.getElementById("enter-dome-btn"),n=document.body;function o(s=!1){if(n.classList.contains("dome-mode"))return;n.classList.add("dome-mode"),document.documentElement.style.overflow="hidden";const a=document.getElementById("canvas-container");if(a){const m=getComputedStyle(document.documentElement).getPropertyValue("--actual-vh");a.style.height=m||"100vh",a.style.width="100vw"}const l=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||"ontouchstart"in window||navigator.maxTouchPoints>0;if(s&&y&&!l){const m=y.requestPointerLock||y.mozRequestPointerLock||y.webkitRequestPointerLock;m&&m.call(y)}}function t(){n.classList.contains("dome-mode")&&(n.classList.remove("dome-mode"),document.documentElement.style.overflow="auto",document.getElementById("canvas-container")&&Qe()),y&&(document.pointerLockElement===y||document.mozPointerLockElement===y||document.webkitPointerLockElement===y)&&document.exitPointerLock()}window.enterDomeModeFromCanvas=()=>{o(!0)},e&&y&&(e.addEventListener("click",s=>{s.stopPropagation(),o(!0)}),e.addEventListener("touchend",s=>{s.stopPropagation(),s.preventDefault(),o(!0)})),document.addEventListener("keydown",s=>{s.key==="Escape"&&t()});function i(){const s=y&&(document.pointerLockElement===y||document.mozPointerLockElement===y||document.webkitPointerLockElement===y),a=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||"ontouchstart"in window||navigator.maxTouchPoints>0;!s&&n.classList.contains("dome-mode")&&!a&&t()}document.addEventListener("pointerlockchange",i),document.addEventListener("mozpointerlockchange",i),document.addEventListener("webkitpointerlockchange",i)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{gt(),pt()}):(gt(),pt());
