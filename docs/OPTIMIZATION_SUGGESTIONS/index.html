<h1>Optimization Suggestions for Dome Dreaming</h1><h2>Production Pipeline</h2><h3>1. CSS Minification</h3><p><strong>Current</strong>: CSS files are not minified <strong>Suggestion</strong>: Add CSS minification to build process<pre><code class="language-javascript">// scripts/minify-css.js
const fs = require('fs');
const path = require('path');
const cssnano = require('cssnano');
const postcss = require('postcss');

// Minify all CSS files in docs/assets/css
</code></pre><p><strong>Benefits</strong>: Reduces CSS file size by 20-30%<h3>2. Image Optimization Pipeline</h3><p><strong>Current</strong>: Images are copied as-is <strong>Suggestion</strong>: Add image optimization step<pre><code class="language-bash"># Add to package.json
"build:images": "imagemin assets/img/**/*.{jpg,png} --out-dir=docs/assets/img --plugin=imagemin-mozjpeg --plugin=imagemin-pngquant"
</code></pre><p><strong>Benefits</strong>: Significant file size reduction (6,482 KiB potential savings per Lighthouse)<h3>3. Build Script Improvements</h3><p><strong>Current</strong>: Sequential execution <strong>Suggestion</strong>: Parallelize where possible<pre><code class="language-json">{
  "scripts": {
    "build": "npm run build:eleventy && npm run build:assets",
    "build:eleventy": "ELEVENTY_OUTPUT_DIR=docs eleventy",
    "build:assets": "npm run build:js & npm run build:css & npm run build:images",
    "build:js": "node scripts/minify-js.js",
    "build:css": "node scripts/minify-css.js",
    "build:images": "node scripts/optimize-images.js"
  }
}
</code></pre><h3>4. Source Maps for Production Debugging</h3><p><strong>Suggestion</strong>: Generate source maps for minified JS (optional, for debugging)<pre><code class="language-javascript">// In minify-js.js
const result = await minify(code, {
  sourceMap: {
    filename: file,
    url: file + '.map'
  },
  // ... other options
});
</code></pre><h2>Code Structure</h2><h3>5. TypeScript or JSDoc</h3><p><strong>Current</strong>: Plain JavaScript <strong>Suggestion</strong>: Add JSDoc comments for better IDE support and documentation<pre><code class="language-javascript">/**
 * Loads and applies a texture to the 3D screen
 * @param {THREE.Texture} texture - The texture to apply
 * @param {THREE.Mesh} screenObject - The screen mesh object
 * @returns {Promise&lt;void>}
 */
export async function applyTextureToScreen(texture, screenObject) {
  // ...
}
</code></pre><h3>6. Environment Variables</h3><p><strong>Suggestion</strong>: Use environment variables for configuration<pre><code class="language-javascript">// .env.example
NODE_ENV=production
ELEVENTY_OUTPUT_DIR=docs
ENABLE_SOURCE_MAPS=false
</code></pre><h3>7. Error Handling Improvements</h3><p><strong>Current</strong>: Some console.error/warn statements <strong>Suggestion</strong>: Centralized error handling<pre><code class="language-javascript">// assets/js/core/error-handler.js
export function handleError(error, context) {
  if (process.env.NODE_ENV === 'development') {
    console.error(`[${context}]`, error);
  }
  // Could send to error tracking service in production
}
</code></pre><h3>8. Constants File</h3><p><strong>Suggestion</strong>: Extract magic numbers and strings<pre><code class="language-javascript">// assets/js/core/constants.js
export const CONFIG = {
  CAMERA_SAVE_INTERVAL: 2000,
  GRID_COLUMNS: 16,
  GRID_ROWS: 16,
  MOBILE_BREAKPOINT: 768,
  LANDSCAPE_BREAKPOINT: 1024
};
</code></pre><h2>Performance</h2><h3>9. CSS Critical Path</h3><p><strong>Suggestion</strong>: Extract critical CSS for above-the-fold content<pre><code class="language-javascript">// scripts/extract-critical-css.js
// Use penthouse or critical CSS extractor
</code></pre><h3>10. Lazy Load Non-Critical CSS</h3><p><strong>Current</strong>: All CSS loaded synchronously <strong>Suggestion</strong>: Load non-critical CSS asynchronously<pre><code class="language-html">&lt;link rel="preload" href="assets/css/main.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
&lt;noscript>&lt;link rel="stylesheet" href="assets/css/main.css">&lt;/noscript>
</code></pre><h3>11. Service Worker for Caching</h3><p><strong>Suggestion</strong>: Add service worker for offline support and caching<pre><code class="language-javascript">// sw.js - Cache static assets
self.addEventListener('install', (event) => {
  event.waitUntil(
    caches.open('v1').then((cache) => {
      return cache.addAll([
        '/assets/css/main.css',
        '/assets/js/main.js',
        // ... other critical assets
      ]);
    })
  );
});
</code></pre><h3>12. Bundle Analysis</h3><p><strong>Suggestion</strong>: Add bundle size analysis<pre><code class="language-bash">npm install --save-dev webpack-bundle-analyzer
# Or use source-map-explorer for ES modules
</code></pre><h2>Developer Experience</h2><h3>13. Pre-commit Hooks</h3><p><strong>Suggestion</strong>: Add Husky + lint-staged<pre><code class="language-json">{
  "husky": {
    "hooks": {
      "pre-commit": "lint-staged"
    }
  },
  "lint-staged": {
    "*.{js,css}": ["prettier --write", "git add"]
  }
}
</code></pre><h3>14. ESLint Configuration</h3><p><strong>Suggestion</strong>: Add ESLint for code quality<pre><code class="language-json">{
  "extends": ["eslint:recommended"],
  "env": {
    "browser": true,
    "es2021": true
  },
  "parserOptions": {
    "ecmaVersion": "latest",
    "sourceType": "module"
  }
}
</code></pre><h3>15. Prettier Configuration</h3><p><strong>Suggestion</strong>: Consistent code formatting<pre><code class="language-json">{
  "semi": true,
  "singleQuote": true,
  "tabWidth": 2,
  "trailingComma": "es5"
}
</code></pre><h2>Code Quality</h2><h3>16. Remove Unused CSS</h3><p><strong>Suggestion</strong>: Use PurgeCSS to remove unused CSS<pre><code class="language-javascript">// .eleventy.js
const purgecss = require('@fullhuman/postcss-purgecss');
// Configure to scan .njk files
</code></pre><h3>17. CSS Custom Properties Optimization</h3><p><strong>Current</strong>: Many CSS variables <strong>Suggestion</strong>: Audit and consolidate similar variables<h3>18. Module Organization</h3><p><strong>Suggestion</strong>: Consider barrel exports for cleaner imports<pre><code class="language-javascript">// assets/js/3d/index.js
export { scene, camera, renderer } from './scene.js';
export { setupLighting } from './lighting.js';
// ... etc
</code></pre><p>Then: <code>import { scene, camera, setupLighting } from './3d/index.js';</code><h2>Testing & Quality Assurance</h2><h3>19. Visual Regression Testing</h3><p><strong>Suggestion</strong>: Add Percy or Chromatic for visual testing<h3>20. Lighthouse CI</h3><p><strong>Suggestion</strong>: Automate Lighthouse checks in CI/CD<pre><code class="language-yaml"># .github/workflows/lighthouse.yml
- name: Run Lighthouse CI
  run: |
    npm install -g @lhci/cli
    lhci autorun
</code></pre><h2>Documentation</h2><h3>21. README Improvements</h3><p><strong>Suggestion</strong>: Add comprehensive README with:<ul><li>Setup instructions<li>Build process<li>Architecture overview<li>Deployment guide</ul><h3>22. Code Comments</h3><p><strong>Suggestion</strong>: Add more inline comments for complex logic (especially 3D rendering)<h2>Security</h2><h3>23. Content Security Policy</h3><p><strong>Suggestion</strong>: Add CSP headers<pre><code class="language-html">&lt;meta http-equiv="Content-Security-Policy" 
      content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; ...">
</code></pre><h3>24. Dependency Auditing</h3><p><strong>Suggestion</strong>: Regular security audits<pre><code class="language-bash">npm audit
npm audit fix
</code></pre><h2>Monitoring</h2><h3>25. Analytics & Error Tracking</h3><p><strong>Suggestion</strong>: Add error tracking (Sentry) and analytics<pre><code class="language-javascript">// Only in production
if (process.env.NODE_ENV === 'production') {
  // Initialize Sentry
}
</code></pre><h2>Quick Wins (High Priority)</h2><ol><li>✅ <strong>CSS Minification</strong> - Easy to implement, immediate benefit<li>✅ <strong>Image Optimization</strong> - Huge file size savings<li>✅ <strong>Remove console statements in production</strong> - Already done via minify<li>✅ <strong>Bundle unused file cleanup</strong> - Already implemented<li>⚠️ <strong>CSS Critical Path</strong> - Medium effort, good performance gain<li>⚠️ <strong>Service Worker</strong> - Medium effort, great UX improvement</ol><h2>Medium Priority</h2><ol start="7"><li><strong>TypeScript/JSDoc</strong> - Better developer experience<li><strong>ESLint/Prettier</strong> - Code quality and consistency<li><strong>Environment variables</strong> - Better configuration management<li><strong>Error handling</strong> - Better debugging and monitoring</ol><h2>Lower Priority (Nice to Have)</h2><ol start="11"><li><strong>Service Worker</strong> - Offline support<li><strong>Visual regression testing</strong> - Quality assurance<li><strong>Lighthouse CI</strong> - Automated performance monitoring</ol>